function GLTFViewer(a,c,d,e,f,g,k){this.document=document;this.body=$("body");this._option=[];var h=GLTFViewer.Utils.IsNull(g)?0:g,l;try{l=require("nw.gui"),this.hasNodeJS=!0}catch(u){}if(0===h){var m,n;if(this.hasNodeJS)for(var h=l.App.argv,p=h.length,q=0;q<p;++q)"-p"===h[q]?this._option.p=!0:"-t"===h[q]?this._option.t=!0:"-w"===h[q].substring(0,2)?m=h[q].substring(2):"-h"===h[q].substring(0,2)?n=h[q].substring(2):"-tn"===h[q]&&(this._option.tn=!0);this._option.tn?(m=n=256,this._option.p=!0,this.wantLogo=
!1):!this._option.p&&this.hasNodeJS&&l.Window.get().show();if(m||n)l=m?this.body.width()-m:0,n=n?this.body.height()-n:0,window.resizeBy(-l,-n)}this._Main(a,c,d,e,f,g,k)}
GLTFViewer.prototype=Object.create(null,{_resizeReadyEvent:{writable:!0,value:null},_option:{writable:!0,value:null},wantLazyLoad:{writable:!0,value:!0},wantLogo:{writable:!0,value:!0},wantFile:{writable:!0,value:!0},wantOptions:{writable:!0,value:!0},wantSave:{writable:!0,value:!1},wantZoom:{writable:!0,value:!0},wantSelection:{writable:!0,value:!0},wantClip:{writable:!0,value:!0},wantMarkup:{writable:!0,value:!0},wantExplode:{writable:!0,value:!0},wantViewport:{writable:!0,value:!0},wantFull:{writable:!0,
value:!0},wantAbout:{writable:!0,value:!0},wantAnimation:{writable:!0,value:!0},wantMultiFile:{writable:!0,value:!0},_wantPropertyEdit:{writable:!0,value:!0},_wantSTLExport:{writable:!0,value:!0},wantPrint:{writable:!0,value:!1},loadAndExit:{writable:!0,value:!1},_helpSystem:{writable:!0,value:null},_helpHTML:{writable:!0,value:null},_legalHTML:{writable:!0,value:null},_titles:{writable:!0,value:null},_backButton:{writable:!0,value:null},_printButton:{writable:!0,value:null},_iFrame:{writable:!0,
value:null},_iFrameMenu:{writable:!0,value:null},messageHandler:{writable:!0,value:null},containerID:{writable:!0,value:null},controllingViewer:{writable:!0,value:null},viewportNumber:{writable:!0,value:0},_viewportLayout:{writable:!0,value:1},_viewportLock:{writable:!0,value:!1},isServed:{writable:!0,value:!1},isEKM:{writable:!0,value:!1},tmpDir:{writable:!0,value:null},imageDir:{writable:!0,value:null},scene:{writable:!0,value:null},hasNodeJS:{writable:!0,value:!1},isReport:{writable:!0,value:!1},
_state:{writable:!0,value:null},mobile:{writable:!0,value:!1},popup1:{writable:!0,value:null},popup2:{writable:!0,value:null},contextMenuContainer:{writable:!0,value:null},contextMenuMarkup:{writable:!0,value:null},viewport02:{writable:!0,value:null},viewport13:{writable:!0,value:null},viewport0:{writable:!0,value:null},viewport1:{writable:!0,value:null},viewer1:{writable:!0,value:null},viewport2:{writable:!0,value:null},viewer2:{writable:!0,value:null},viewport3:{writable:!0,value:null},viewer3:{writable:!0,
value:null},body:{writable:!0,value:null},bodyOverflow:{writable:!0,value:null},imageContainer:{writable:!0,value:null},container:{writable:!0,value:null},_rootContainer:{writable:!0,value:null},_fullContainer:{writable:!0,value:null},_nonFullContainer:{writable:!0,value:null},shield:{writable:!0,value:null},viewerContainer:{writable:!0,value:null},viewer:{writable:!0,value:null},viewerWidth:{writable:!0,value:0},viewerHeight:{writable:!0,value:0},blkLogo:{writable:!0,value:null},whtLogo:{writable:!0,
value:null},inputFile:{writable:!0,value:null},outputFile:{writable:!0,value:null},c3d:{writable:!0,value:null},overlay:{writable:!0,value:null},progress:{writable:!0,value:null},menu:{writable:!0,value:null},fileBtn:{writable:!0,value:null},optionsBtn:{writable:!0,value:null},viewportBtn:{writable:!0,value:null},viewportMenu:{writable:!0,value:null},viewportMenuBtns:{writable:!0,value:null},saveBtn:{writable:!0,value:null},saveMUPName:{writable:!0,value:null},saveViewName:{writable:!0,value:null},
FileManagerBtn:{writable:!0,value:null},zoom:{writable:!0,value:null},fullBtn:{writable:!0,value:null},isFull:{writable:!0,value:!1},selectionBtn:{writable:!0,value:null},selectionMenu:{writable:!0,value:null},selectionMenuBtns:{writable:!0,value:null},selectionMenuItemSelected:{writable:!0,value:null},clipBtn:{writable:!0,value:null},clipMenu:{writable:!0,value:null},clipMenuBtns:{writable:!0,value:null},clipMenuItemSelected:{writable:!0,value:null},markupBtn:{writable:!0,value:null},markupMenu:{writable:!0,
value:null},markupMenuBtns:{writable:!0,value:null},markupMenuMenus:{writable:!0,value:null},markupLineShapeMenuBtns:{writable:!0,value:null},markupTextArea:{writable:!0,value:null},markupFontSize:{writable:!0,value:null},colorPickerPanel:{writable:!0,value:null},explodeBtn:{writable:!0,value:null},explodeMenu:{writable:!0,value:null},explodePanel:{writable:!0,value:null},AboutBtnState:{writable:!0,value:null},AboutBtnStateIframe:{writable:!0,value:null},_aboutDialog:{writable:!0,value:null},animationDialog:{writable:!0,
value:null},multiFileDialog:{writable:!0,value:null},_fileManager:{writable:!0,value:null},_Main:{value:function(a,c,d,e,f,g,k){function h(a,c,d){function e(a,c,d,f){++a.fileNum;a.status=a.status?f:!1;(4<=a.fileNum||a.fileNum>=a.numFiles)&&this.hasNodeJS&&(d?a.status?this.wantPrint=!0:process.exit(1):this.loadAndExit&&process.exit(!a.status))}var f=this.NumFiles(),h={numFiles:1,fileNum:0,status:!0};this.wantViewport&&1<f?(h.numFiles=f,2<f?this.SetupViewports(4):this.SetupViewports(2),this.SelectFile(0,
e.bind(this,h,a,c)),this.viewer1.SelectFile(1,e.bind(this,h,a,c)),2<f&&this.viewer2.SelectFile(2,e.bind(this,h,a,c)),3<f&&this.viewer3.SelectFile(3,e.bind(this,h,a,c))):this.hasNodeJS?e.call(this,h,a,c,d):a&&a(d)}this.AboutBtnState=this.NoopBtnState.bind(this);this.AboutBtnStateIframe=this.NoopBtnState.bind(this);this.containerID=GLTFViewer.Utils.IsNull(k)?a:k.containerID;this.viewportNumber=GLTFViewer.Utils.IsNull(g)?0:g;this.controllingViewer=0===this.viewportNumber?this:k;k=window;g=$("#"+a);if(window.frames&&
window.frames.ANSYSViewerFrame){g=window.frames.ANSYSViewerFrame;var l=g.contentDocument;k=g.contentWindow;this.body=$(l.body);g=$("#"+a,this.body);this.document=l}g.css("overflow","hidden");GLTFViewer.Utils.IsNull(e)||(this.isEKM=!0);GLTFViewer.Utils.IsNull(c)||c instanceof Array||(l=c.split(","),1<l.length&&(c=l));if(!this.isEKM&&"file:"!==window.location.protocol){var l="help/ans_viewer/ans_viewer.html",m=new XMLHttpRequest;m.open("HEAD",l,!1);m.send();200===m.status&&(this._helpHTML=l);l="help/ans_viewer/ans_viewer_legal.html";
m=new XMLHttpRequest;m.open("HEAD",l,!1);m.send();200===m.status&&(this._legalHTML=l)}if(this.mobile=GLTFViewer.Utils.IsMobile())this.wantOptions=!1;if(this.hasNodeJS&&!GLTFViewer.Utils.IsNull(c))if(c instanceof Array)for(l=0;l<c.length;++l)GLTFViewer.Utils.IsAbsolutePath(c[l])||(c[l]=GLTFViewer.Utils.ResolvePath(k.location.pathname+"/../"+c[l]).substr(1));else GLTFViewer.Utils.IsAbsolutePath(c)||(c=GLTFViewer.Utils.ResolvePath(k.location.pathname+"/../"+c).substr(1));k=!1;if(this.hasNodeJS){k=this._option.p;
this.loadAndExit=this._option.t;if(k||this.loadAndExit)k?this.loadAndExit=!0:this.wantViewport=!1;this.loadAndExit&&(__DONTSHOWALERT__=!0);this.wantSave=!0;try{this._helpSystem=new GLTFViewer.Utils.Help}catch(n){}}else"file:"!==window.location.protocol&&(this.isServed=!0);l=null;f&&(GLTFViewer.Utils.IsNull(f.showFileOpen)||f.showFileOpen||(this.wantFile=!1),GLTFViewer.Utils.IsNull(f.allowEdit)||f.allowEdit||(this.wantSave=!1),GLTFViewer.Utils.IsNull(f.showFit)||f.showFit||(this.wantZoom=!1),GLTFViewer.Utils.IsNull(f.showHighlight)||
f.showHighlight||(this.wantSelection=!1),GLTFViewer.Utils.IsNull(f.showClip)||f.showClip||(this.wantClip=!1),GLTFViewer.Utils.IsNull(f.showMarkup)||f.showMarkup||(this.wantMarkup=!1),GLTFViewer.Utils.IsNull(f.showExplode)||f.showExplode||(this.wantExplode=!1),GLTFViewer.Utils.IsNull(f.showAbout)||f.showAbout||(this.wantAbout=!1),GLTFViewer.Utils.IsNull(f.showLogo)||f.showLogo||(this.wantLogo=!1),GLTFViewer.Utils.IsNull(f.lazyLoad)||f.lazyLoad||(this.wantLazyLoad=!1),!GLTFViewer.Utils.IsNull(f.callback)&&
f.callback instanceof Function&&(l=f.callback),!GLTFViewer.Utils.IsNull(f.report)&&f.report&&(this.isReport=!0,this.wantViewport=this.wantAbout=this.wantSave=this.wantFile=!1));this.imageDir=this.isEKM?e+"/3d-viewer/images/":this.hasNodeJS&&this.isReport?"../images/":"images/";this.isEKM&&(this.wantFile=!1,this.wantSave=!0,this.wantViewport=c instanceof Array,this.wantFull=this.wantAbout=!1);this.mobile&&(this.wantSelection=!1);this.messageHandler=new GLTFViewer.Utils.MessageHandler(this);0===this.viewportNumber?
(this._nonFullContainer=g,g.append("<canvas style='position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;visibility:hidden;'></canvas>"),this.imageContainer=$("canvas",g).last(),this.wantAbout&&(this._aboutDialog=this.BuildAboutDialog(this.body)),this.wantFull&&(this.body.append("<div style='position:fixed;padding:0;margin:0;border:0;left:0;top:0;width:100%;height:100%;visibility:hidden;z-index:99990;overflow:hidden;'></div>"),this._fullContainer=$("div",this.body).last()),
g.append("<div style='position:relative;padding:0;margin:0;border:0;left:0;top:0;width:100%;height:100%;display:flex;display:-webkit-flex;flex-direction:row;-webkit-flex-direction:row;'></div>"),this._rootContainer=$("div",g).last(),this._fileManager=new GLTFViewer.FileManager(this,this.wantViewport?4:1,this._rootContainer),this._rootContainer.append("<div style='position:relative;padding:0;margin:0;border:0;width:100%;height:100%;flex:1;-webkit-flex:1;'></div>"),g=$("div",this._rootContainer).last(),
this.wantViewport&&(g.append("<div style='position:absolute;padding:0;margin:0;border:0;left:0;top:0;width:50%;height:100%;overflow:hidden;'></div>"),this.viewport02=$("div",g).last(),g.append("<div style='position:absolute;padding:0;margin:0;border:0;left:50%;top:0;width:50%;height:100%;overflow:hidden;'></div>"),this.viewport13=$("div",g).last(),this.viewport02.append("<div id='"+a+"__viewer0__' style='position:absolute;padding:0;margin:0;border:0;left:0;top:0;width:100%;height:50%;overflow:hidden;'></div>"),
g=this.viewport0=$("div",this.viewport02).last(),this.viewport02.append("<div id='"+a+"__viewer2__' style='position:absolute;padding:0;margin:0;border:0;left:0;top:50%;width:100%;height:50%;overflow:hidden;'></div>"),this.viewport2=$("div",this.viewport02).last(),this.viewport13.append("<div id='"+a+"__viewer1__' style='position:absolute;padding:0;margin:0;border:0;left:0;top:0;width:100%;height:50%;overflow:hidden;'></div>"),this.viewport1=$("div",this.viewport13).last(),this.viewport13.append("<div id='"+
a+"__viewer3__' style='position:absolute;padding:0;margin:0;border:0;left:0;top:50%;width:100%;height:50%;overflow:hidden;'></div>"),this.viewport3=$("div",this.viewport13).last(),this.viewer1=new GLTFViewer(a+"__viewer1__",null,null,null,f,1,this),this.viewer2=new GLTFViewer(a+"__viewer2__",null,null,null,f,2,this),this.viewer3=new GLTFViewer(a+"__viewer3__",null,null,null,f,3,this))):this.wantViewport=!1;this.container=g;this.wantAnimation||this.wantMultiFile?this.container.append("<div style='position:relative;padding:0;margin:0;border:0;width:100%;height:100%;display:flex;display:-webkit-flex;flex-direction:column;-webkit-flex-direction:column;'></div>"):
this.container.append("<div style='position:relative;padding:0;margin:0;border:0;width:100%;height:100%;'></div>");this.viewerContainer=$("div",this.container).last();this.viewerContainer.append("<div tabindex=1' style='touch-action:none;position:relative;padding:0;margin:0;border:0;width:100%;height:100%;overflow:hidden;flex:1;-webkit-flex:1;'></div>");this.viewer=$("div",this.viewerContainer).last();this.viewer.css("background","url('"+this.imageDir+"back.png')");this.viewer.css("background-size",
"100% 100%");this.wantAnimation&&(this.animationDialog=this.BuildAnimationDialog(this.viewerContainer));this.wantMultiFile&&(this.multiFileDialog=this.BuildMultiFileDialog(this.viewerContainer));this.BuildHTML(this.viewerContainer);if(this.viewer&&this.c3d&&this.overlay&&this.progress)try{this.scene=GLTFViewer.Utils.Scene.Create(this,this.viewer[0],this.c3d[0],this.overlay[0],this.progress[0])}catch(n){GLTFViewer.Utils.WriteErr(n),this.scene=null,this.FileBtnState(null,GLTFViewer.MENUHIDE),this.wantFile=
!1,this.SaveBtnState(null,GLTFViewer.MENUHIDE),this.wantSave=!1}GLTFViewer.Utils.IsNull(this.scene)?(this.Reset(),GLTFViewer.Utils.WriteErr("ERROR(GLTFViewer): Can't create scene")):(this.inputFile&&this.inputFile.bind("change",function(a){if(0!==a.target.files.length){this.scene&&this.scene.navigator.ClearKeys();var c=GLTFViewer.LT_REPLACE;this.inputFile._ctrlKey?c=GLTFViewer.LT_APPEND:this.inputFile._shiftKey&&(c=GLTFViewer.LT_UPDATE);this.AddFiles(null,a.target.files,null,c);a.target.value=""}}.bind(this)),
this.hasNodeJS&&(0!==this.viewportNumber||window.frames&&window.frames.ANSYSViewerFrame||(this.body.append("<div class='AVDontPrint' style='z-index:99990;position:absolute;padding-top:"+GLTFViewer.CONTAINER_INNER_MARGIN+"px;padding-left:"+(GLTFViewer.CONTAINER_INNER_MARGIN-GLTFViewer.ICONSEPARATION)+"px;'><ul style='display:none;list-style:none;margin:0;padding:0;border:0;'></ul></div>"),this._iFrameMenu=$("ul",this.body).last(),this._iFrameMenu.append("<li style='width:1px;height:1px;'><a></a><ul style='list-style:none;'><li><a></a></li></ul></li>"),
this.body.append("<iframe id='ANSYSViewerFrame' style='display:none;width:100%;height:100%;margin:0;border:0;padding:0;' frameborder=0></iframe>"),this._iFrame=$("iframe",this.body).last(),ret=this.AppendBtns(this._iFrameMenu,1),this.SetUpMenuBtn(ret.btns[0],GLTFViewer.ICONPRINT,GLTFViewer.printHelp,null,function(a){a.contentWindow.print()}.bind(this,this._iFrame[0]),GLTFViewer.ICONSEPARATION),ret=this.AppendBtns(this._iFrameMenu,1),a=ret.btns[0],e=ret.menus[0],ret=this.AppendBtns(e,GLTFViewer.aboutMenuBtnsHelp.length),
f=ret.btns,this.AboutBtnStateIframe=this._AboutBtnState.bind(this,a,f,e,this._AboutMenuBtnState.bind(this)),g=this._AboutMenuBtnState.bind(this,f,e,this.AboutBtnStateIframe),this.SetUpMenuBtn(a,GLTFViewer.ICONABOUT,GLTFViewer.aboutHelp,null,this.AboutBtnStateIframe,GLTFViewer.ICONSEPARATION),this.SetUpMenuBtns(e,f,GLTFViewer.ICONABOUTHELP,GLTFViewer.aboutMenuBtnsHelp,null,g),this._helpSystem||this._helpHTML||g(0,null,GLTFViewer.MENUDISABLE),ret=this.AppendBtns(this._iFrameMenu,1),this.SetUpMenuBtn(ret.btns[0],
GLTFViewer.ICONCLOSE,GLTFViewer.closeHelp,null,this.HideARZ.bind(this),GLTFViewer.ICONSEPARATION)),this.outputFile.bind("change",function(a){this.OutputSaveFile(a.target.value);a.target.value=""}.bind(this))),this.Reset(),0===this.viewportNumber&&this.SetupViewports(1),this.shield=GLTFViewer.Utils.CreateModalShield(),this.viewer&&this.viewer[0].addEventListener("keydown",this.ContainerKeyDown.bind(this),!1),this.viewerContainer&&(this.viewerContainer.on("mouseleave",function(a){this.MenuFade(!0)}.bind(this)),
this.viewerContainer.on("drag",function(a){a.preventDefault();a.stopPropagation()}),this.viewerContainer.on("dragover",function(a){a.preventDefault();a.stopPropagation()}),this.viewerContainer.on("dragenter",function(a){a.preventDefault();a.stopPropagation()}),this.viewerContainer.on("drop",function(a){a.preventDefault();a.stopPropagation();if(GLTFViewer.GetElementVisible(this.fileBtn)&&a.originalEvent.dataTransfer.files.length){var c=GLTFViewer.LT_REPLACE;a.ctrlKey?c=GLTFViewer.LT_APPEND:a.shiftKey&&
(c=GLTFViewer.LT_UPDATE);this.AddFiles(null,a.originalEvent.dataTransfer.files,null,c)}}.bind(this))),this._resizeReadyEvent=function(){setTimeout(this.UpdateLayout.bind(this),0)},$(window).resize(this._resizeReadyEvent.bind(this)),$(document).ready(this._resizeReadyEvent.bind(this)),0!==this.viewportNumber||GLTFViewer.Utils.IsNull(c)||this.AddFiles(null,c,d,GLTFViewer.LT_REPLACE,!0,h.bind(this,l,k)),this.MenuFade(!0),this.messageHandler.AddListener(GLTFViewer.MSGLOCK,this._Synchronize.bind(this)),
this.messageHandler.AddListener(GLTFViewer.MSGIMAGE,this._Image.bind(this)),this.messageHandler.AddListener(GLTFViewer.MSGTITLE,this.SetTitle.bind(this,"READ")))}},fileManager:{get:function(){return this.controllingViewer._fileManager}},rootContainer:{get:function(){return this.controllingViewer._rootContainer}},fullContainer:{get:function(){return this.controllingViewer._fullContainer}},nonFullContainer:{get:function(){return this.controllingViewer._nonFullContainer}},iFrame:{get:function(){return this.controllingViewer._iFrame}},
iFrameMenu:{get:function(){return this.controllingViewer._iFrameMenu}},aboutDialog:{get:function(){return this.controllingViewer._aboutDialog}},viewportLayout:{get:function(){return this.controllingViewer._viewportLayout},set:function(a){this.controllingViewer._viewportLayout=a}},wantPropertyEdit:{get:function(){var a=this.controllingViewer.viewerState.Beta;return this._wantPropertyEdit&&a}},wantSTLExport:{get:function(){var a=this.controllingViewer.viewerState.Beta;return this._wantSTLExport&&a&&
this.hasNodeJS}},canSave:{get:function(){return this.wantSave&&!this.isReport}},viewportLock:{get:function(){return this._viewportLock},set:function(a){this._viewportLock!==a&&(this._viewportLock=a,0===this.viewportNumber&&this.messageHandler.SendMessage(GLTFViewer.MSGLOCK,a))}},OutputSaveFile:{value:function(a,c){this.Enable(!1);try{var d=this.outputFile._type;if("PNG"===d)this.WriteImage(a,this.outputFile._imageData),this.Enable(!0);else if("AVZ"===d){var e=d=!1;if(!this._option.tn)var f=this.saveMUPName?
GLTFViewer.Utils.RemoveExt(this.saveMUPName)+"_.mup":this.outputFile._zipFolder+"/file.mup",d=this.scene.handler.SaveMarkups(f),g=this.saveViewName?GLTFViewer.Utils.RemoveExt(this.saveViewName)+"_.view":this.outputFile._zipFolder+"/file.view",e=this.scene.handler.SaveViews(g);var k=require("fs"),h=require("archiver")("zip",{level:8}),l=k.createWriteStream(a);l.on("close",function(a,c,d,e,f,h){if(c)try{a.unlinkSync(d)}catch(g){}if(e)try{a.unlinkSync(f)}catch(g){}h&&h();this.Enable(!0)}.bind(this,k,
d,f,e,g,c));h.pipe(l);for(var m=k.readdirSync(this.outputFile._zipFolder),l=0;l<m.length;++l){var n=this.outputFile._zipFolder+"/"+m[l],p=GLTFViewer.Utils.GetExtension(m[l]);this._option.tn||"mup"!==p?this._option.tn||"view"!==p?h.append(k.readFileSync(n),{name:m[l]}):e&&m[l]===GLTFViewer.Utils.GetFileName(g)&&h.append(k.readFileSync(n),{name:m[l]}):d&&m[l]===GLTFViewer.Utils.GetFileName(f)&&h.append(k.readFileSync(n),{name:m[l]})}h.finalize()}else if("STL"===d||"STLBIN"===d)k=require("fs"),e=k.openSync(a,
"w+"),this.scene.handler.Export(e,d),k.closeSync(e),this.Enable(!0)}catch(q){GLTFViewer.Utils.WriteErr("ERROR(OutputFileSelect): Can't create '"+a+"'"),this.Enable(!0)}this.outputFile._imageData=null;this.outputFile._zipFolder=null}},_Image:{value:function(a,c,d){function e(a,c){if(!GLTFViewer.Utils.IsNull(c)){var d=a.ActiveFileObj(),e=1===this.viewportLayout||a.isFull?GLTFViewer.Utils.RemoveExt(d._name)+".png":"ANSYSViewer.png";if(this.hasNodeJS){this.outputFile._imageData=c;this.outputFile._zipFolder=
null;this.outputFile._type="PNG";var l=require("path"),e=d._isURL||this.isReport?l.join(process.env.USERPROFILE,e):l.join(l.dirname(d._path),e);this._option.tn?(e=l.join(this.tmpDir.name,"thumbnail.png"),e=this.WriteImage(e,c),this.wantPrint=!1,this.SaveAVZ(function(a){process.exit(a?0:1)}.bind(this,e))):this.wantPrint?(e=this.WriteImage(e,c),this.wantPrint=!1,process.exit(e?0:1)):(this.outputFile.prop("nwsaveas",e),this.outputFile.prop("accept",".png"),this.outputFile.click())}else window.navigator.msSaveBlob?
(d=function(a){var c;c=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):unescape(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var d=new Uint8Array(c.length),e=0;e<c.length;e++)d[e]=c.charCodeAt(e);return new Blob([d],{type:a})}(c),window.navigator.msSaveBlob(d,e)):(d=document.createElement("a"),d.download=e,d.href=c,d.onclick=function(a){a.stopPropagation();document.body.removeChild(a.target)},d.style.display="none",document.body.appendChild(d),d.click())}}this.viewportNumber||
this.GetImage(e.bind(this,d))}},_Synchronize:{value:function(a,c,d){this.viewportNumber&&(this.viewportLock=d)}},Reset:{value:function(a){this.popup1&&(this.popup1.callback(),this.popup1=null,this.popup2&&(this.popup2.callback(),this.popup2=null));a||this.SetMultiFileSlider(0,!0);this.SetAnimationSlider(0,!0);this.SetAnimationMinMaxSpeed(0,5);this.ShowSceneAnimation(!1);this.saveViewName=this.saveMUPName=null;this.SetTitle("WRITE","");GLTFViewer.Utils.ShowAlert=!0;!a&&this.scene&&this.scene.Reset();
this.ViewportBtnState(null,GLTFViewer.MENURESET);this.FileBtnState(null,GLTFViewer.MENURESET);this.scene&&this.FileBtnState(null,GLTFViewer.MENUSHOW);this.OptionsBtnState(null,GLTFViewer.MENURESET);0===this.viewportNumber&&this.OptionsBtnState(null,GLTFViewer.MENUSHOW);this.SaveBtnState(null,GLTFViewer.MENURESET);this.ZoomBtnState(null,GLTFViewer.MENUHIDE);this.SelectionBtnState(null,GLTFViewer.MENURESET);this.SelectionBtnState(null,GLTFViewer.MENUHIDE);this.ClipBtnState(null,GLTFViewer.MENUHIDE);
this.MarkupBtnState(null,GLTFViewer.MENUHIDE);this.ExplodeBtnState(null,GLTFViewer.MENURESET);this.ExplodeBtnState(null,GLTFViewer.MENUHIDE);this.AboutBtnStateIframe(null,GLTFViewer.MENURESET);this.AboutBtnState(null,GLTFViewer.MENUHIDE);0===this.viewportNumber&&this.AboutBtnState(null,GLTFViewer.MENUSHOW)}},Clear:{value:function(){GLTFViewer.prototype.Reset.call(this);$(window).off("resize",this._resizeReadyEvent);$(document).off("ready",this._resizeReadyEvent);this._helpSystem&&(this._helpSystem.Clear(),
this._helpSystem=null);this._titles=null;this.messageHandler&&(this.messageHandler.Clear(),this.messageHandler=null);this._resizeReadyEvent=null;this.scene&&(this.scene.Clear(),this.scene=null);0===this.viewportNumber&&this._aboutDialog&&(this._aboutDialog.box&&this._aboutDialog.box.remove(),this._aboutDialog=null);0===this.viewportNumber&&this._fullContainer&&(this._fullContainer.remove(),this._fullContainer=null);0===this.viewportNumber&&this._nonFullContainer&&(this._nonFullContainer.remove(),
this._nonFullContainer=null);0===this.viewportNumber&&this._fileManager&&(this._fileManager.Clear(),this._fileManager=null);this.viewer=this.viewerContainer=this.bodyOverflow=this.body=this.contextMenuMarkup=this.contextMenuContainer=this.popup2=this.popup1=this.imageDir=this.tmpDir=null;this.shield&&(this.shield.remove(),this.shield=null);this.imageContainer=this._rootContainer=this.container=this.multFileDialog=this.animationDialog=this.explodePanel=this.explodeMenu=this.explodeBtn=this.colorPickerPanel=
this.markupFontSize=this.markupTextArea=this.markupLineShapeMenuBtns=this.markupMenuMenus=this.markupMenuBtns=this.markupMenu=this.markupBtn=this.selectionMenuItemSelected=this.selectionMenuBtns=this.selectionMenu=this.selectionBtn=this.clipMenuItemSelected=this.clipMenuBtns=this.clipMenu=this.clipBtn=this.zoomBtn=this.fullBtn=this.saveBtn=this.viewportMenuBtns=this.viewportMenu=this.viewportBtn=this.optionsBtn=this.fileBtn=this.menu=this.FileManagerBtn=this.progress=this.overlay=this.c3d=this.outputFile=
this.inputFile=this.whtLogo=this.blkLogo=null;this.viewer1&&(this.viewer1.Clear(),this.viewer1=null);this.viewer2&&(this.viewer2.Clear(),this.viewer2=null);this.viewer3&&(this.viewer3.Clear(),this.viewer3=null);this.controllingViewer=this.containerID=this.viewport13=this.viewport02=this.viewport3=this.viewport2=this.viewport1=this.viewport0=null}},GetCookie:{value:function(a){if(!GLTFViewer.Utils.IsNull(localStorage))return GLTFViewer.Utils.IsNull(localStorage[a])?null:decodeURIComponent(localStorage[a]);
a+="=";for(var c=decodeURIComponent(document.cookie).split(";"),d=0;d<c.length;++d){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1);if(0===e.indexOf(a))return e.substring(a.length,e.length)}return null}},SetCookie:{value:function(a,c){GLTFViewer.Utils.IsNull(localStorage)?document.cookie=a+"="+encodeURIComponent(c)+"; expires=Tue, 19 Jan 2038 03:14:07 UTC; path=/":localStorage[a]=encodeURIComponent(c)}},Enable:{value:function(a){a?(document.body.style.cursor="default",this.shield.css("display",
"none")):(document.body.style.cursor="wait",this.shield.css("display","inline"),this.shield.css("width",GLTFViewer.Utils.GetBrowserWidth()+"px"),this.shield.css("height",GLTFViewer.Utils.GetBrowserHeight()+"px"),this.shield.focus())}},Options:{value:function(){function a(a){a=a.split("+");for(var c="",d=0;d<a.length;++d){var k=a[d][0].toUpperCase()+a[d].substr(1).toLowerCase();0<d&&(c+="+");c+=k}return c}function c(c){var d=[];d.push(["ANSYS Viewer State",GLTFViewer.Utils.Dialog.DATALABEL]);d.push(["Beta Features (Restart required)",
GLTFViewer.Utils.Dialog.DATACHECKBOX,c.Beta?1:0]);d.push(["Mouse Button Assignment",GLTFViewer.Utils.Dialog.DATALABEL]);d.push([a(GLTFViewer.MOUSEBUTTONS[0]),GLTFViewer.Utils.Dialog.DATALIST,c[GLTFViewer.MOUSEBUTTONS[0]],["None","Zoom"]]);for(var g=1;g<GLTFViewer.MOUSEBUTTONS.length;++g)d.push([a(GLTFViewer.MOUSEBUTTONS[g]),GLTFViewer.Utils.Dialog.DATALIST,c[GLTFViewer.MOUSEBUTTONS[g]],"None RotateXY RotateZ PanXY Zoom ZoomBox".split(" ")]);return d}var d=c.call(this,this.viewerState);new GLTFViewer.Utils.Dialog("Options",
d,!0,function(a,c){if(a){var d={};d.Beta=c[1];for(var k=3,h=0;h<GLTFViewer.MOUSEBUTTONS.length;++h,++k)d[GLTFViewer.MOUSEBUTTONS[h]]=c[k];this.viewerState=d}}.bind(this),function(a){var d=c.call(this,this.defaultState);a&&a(d)}.bind(this),!0,!1)}},defaultState:{get:function(){var a={Beta:0};a[GLTFViewer.MOUSEBUTTONS[0]]="Zoom";a[GLTFViewer.MOUSEBUTTONS[1]]="RotateXY";a[GLTFViewer.MOUSEBUTTONS[2]]="Zoom";a[GLTFViewer.MOUSEBUTTONS[3]]="PanXY";a[GLTFViewer.MOUSEBUTTONS[4]]="ZoomBox";a[GLTFViewer.MOUSEBUTTONS[5]]=
"RotateXY";a[GLTFViewer.MOUSEBUTTONS[6]]="RotateXY";a[GLTFViewer.MOUSEBUTTONS[7]]="Zoom";a[GLTFViewer.MOUSEBUTTONS[8]]="RotateXY";a[GLTFViewer.MOUSEBUTTONS[9]]="RotateXY";a[GLTFViewer.MOUSEBUTTONS[10]]="RotateZ";a[GLTFViewer.MOUSEBUTTONS[11]]="RotateXY";a[GLTFViewer.MOUSEBUTTONS[12]]="RotateXY";return a}},viewerState:{get:function(){if(GLTFViewer.Utils.IsNull(this.controllingViewer._state)){var a=this.GetCookie("State");return GLTFViewer.Utils.IsNull(a)?this.defaultState:JSON.parse(a)}return this.controllingViewer._state},
set:function(a){this.controllingViewer._state=a;this.SetCookie("State",JSON.stringify(a))}},PostChanges:{value:function(){this.scene.handler.PostMarkups();this.scene.handler.PostViews()}},GetViewerByNumber:{value:function(a){switch(a){case 1:return this.controllingViewer.viewer1;case 2:return this.controllingViewer.viewer2;case 3:return this.controllingViewer.viewer3;default:return this.controllingViewer}}},GetViewer:{value:function(a){return GLTFViewer.Utils.IsNull(a)?this.controllingViewer.viewer1&&
this.controllingViewer.viewer1.isFull?this.controllingViewer.viewer1:this.controllingViewer.viewer2&&this.controllingViewer.viewer2.isFull?this.controllingViewer.viewer2:this.controllingViewer.viewer3&&this.controllingViewer.viewer3.isFull?this.controllingViewer.viewer3:this:this.GetViewerByNumber(a)}},GetMainUIViewer:{value:function(){return this.controllingViewer.viewer1&&this.controllingViewer.viewer1.isFull?this.controllingViewer.viewer1:this.controllingViewer.viewer2&&this.controllingViewer.viewer2.isFull?
this.controllingViewer.viewer2:this.controllingViewer.viewer3&&this.controllingViewer.viewer3.isFull?this.controllingViewer.viewer3:this.controllingViewer}},OnlyOne:{value:function(a){a.call(this.controllingViewer)}},NumFiles:{value:function(){return this.fileManager.numFiles}},Files:{value:function(){return this.fileManager.files}},FileNames:{value:function(){return this.fileManager.fileNames}},FilePaths:{value:function(){return this.fileManager.filePaths}},AddFile:{value:function(a,c,d,e,f,g){return this.fileManager.AddFile(this,
a,c,d,e,f,g)}},FindFile:{value:function(a,c){return this.fileManager.FindFile(a,c)}},RemoveFile:{value:function(a){this.fileManager.RemoveFile(this,a)}},SelectFile:{value:function(a,c,d){this.fileManager.SelectFile(this,a,c,d)}},ActiveFileObj:{value:function(){return this.fileManager.ActiveFileObj(this)}},CloseFile:{value:function(a){this.HideARZ();this.fileManager.CloseFile(this,a)}},ClearVisibilityList:{value:function(){this.fileManager.RemoveAllEntries(this)}},DeleteEntryVisibilityList:{value:function(a){this.fileManager.RemoveEntry(this,
a)}},AddEntryVisibilityList:{value:function(a,c,d,e,f,g){return this.fileManager.AddEntry(this,a,c,d,e,f,g)}},DeleteEntrySceneList:{value:function(a){a&&this.fileManager.RemoveScene(this,a)}},SetSelectionSceneList:{value:function(a){this.fileManager.SelectScene(this,a)}},AddEntrySceneList:{value:function(a,c){return this.fileManager.AddScene(this,a,c)}},WriteImage:{value:function(a,c){if(!this.hasNodeJS||GLTFViewer.Utils.IsNull(a)||!c)return!1;try{var d=require("fs"),e=c.replace(/^data:image\/png;base64,/,
"");d.writeFileSync(a,e,"base64")}catch(f){return GLTFViewer.Utils.WriteErr("ERROR(WriteImage): Can't create '"+a+"'"),!1}return!0}},GetImage:{value:function(a){function c(c,d,g,k){d.image[g]=k;0>=--d.numImages&&(c=function(a,c,d,e){a.image[c]=new Image;a.image[c].onload=e;a.image[c].src=d},g=function(a,c){if(!(0<--c.numImages)){var d=this.imageContainer[0].getContext("2d"),e=this.viewerWidth+this.viewer1.viewerWidth,f=this.viewerHeight+(2===this.viewportLayout?0:this.viewer2.viewerHeight);this.imageContainer[0].width=
e;this.imageContainer[0].height=f;d.clearRect(0,0,e,f);2===this.viewportLayout?(d.drawImage(c.image[0],0,0,this.viewerWidth,f),d.drawImage(c.image[1],this.viewerWidth,0,this.viewer1.viewerWidth,f)):(d.drawImage(c.image[0],0,0,this.viewerWidth,this.viewerHeight),d.drawImage(c.image[1],this.viewerWidth,0,this.viewer1.viewerWidth,this.viewer1.viewerHeight),d.drawImage(c.image[2],0,this.viewerHeight,this.viewer2.viewerWidth,this.viewer2.viewerHeight),d.drawImage(c.image[3],this.viewerWidth,this.viewerHeight,
this.viewer2.viewerWidth,this.viewer2.viewerHeight));d=this.imageContainer[0].toDataURL();this.scene.Invalidate(!0);a(d)}},k={image:[],numImages:0},2===this.viewportLayout?(k.numImages=2,c(k,0,d.image[0],g.bind(this,a,k)),c(k,1,d.image[1],g.bind(this,a,k))):(k.numImages=4,c(k,0,d.image[0],g.bind(this,a,k)),c(k,1,d.image[1],g.bind(this,a,k)),c(k,2,d.image[2],g.bind(this,a,k)),c(k,3,d.image[3],g.bind(this,a,k))))}if(GLTFViewer.Utils.IsNull(this.scene))a(null);else{var d={image:[!1,!1,!1,!1],numImages:0};
if(1===this.viewportLayout||2===this.viewportLayout&&!this.viewer1.isFull||4===this.viewportLayout&&!this.viewer1.isFull&&!this.viewer2.isFull&&!this.viewer3.isFull)d.image[0]=!0,++d.numImages;if(2===this.viewportLayout&&!this.isFull||4===this.viewportLayout&&!this.isFull&&!this.viewer2.isFull&&!this.viewer3.isFull)d.image[1]=!0,++d.numImages;4!==this.viewportLayout||this.isFull||this.viewer1.isFull||this.viewer3.isFull||(d.image[2]=!0,++d.numImages);4!==this.viewportLayout||this.isFull||this.viewer1.isFull||
this.viewer2.isFull||(d.image[3]=!0,++d.numImages);1===d.numImages?d.image[0]?this.scene.GetImage(a):d.image[1]?this.viewer1.scene.GetImage(a):d.image[2]?this.viewer2.scene.GetImage(a):d.image[3]&&this.viewer3.scene.GetImage(a):(d.image[0]&&this.scene.GetImage(c.bind(this,a,d,0)),d.image[1]&&this.viewer1.scene.GetImage(c.bind(this,a,d,1)),d.image[2]&&this.viewer2.scene.GetImage(c.bind(this,a,d,2)),d.image[3]&&this.viewer3.scene.GetImage(c.bind(this,a,d,3)))}}},Export:{value:function(a){if(this.hasNodeJS){var c=
this.ActiveFileObj(),d=GLTFViewer.Utils.RemoveExt(c._name),e=require("path"),d=e.join(e.dirname(c._path),d);switch(a){case "STL":case "STLBIN":c=".stl";break;default:return}this.outputFile._imageData=null;this.outputFile._zipFolder=null;this.outputFile._type=a;this.outputFile.prop("nwsaveas",d+c);this.outputFile.prop("accept",c);this.outputFile.click()}}},SaveAVZ:{value:function(a){if(this.hasNodeJS&&this.scene&&this.scene.handler){var c=this.ActiveFileObj(),d=require("path"),c=d.join(d.dirname(c._path),
c._name);this.outputFile._imageData=null;this.outputFile._zipFolder=this.tmpDir.name;this.outputFile._type="AVZ";this.outputFile.prop("nwsaveas",c);this.outputFile.prop("accept",".avz");a?this.OutputSaveFile(c,a):this.outputFile.click()}}},SaveImage:{value:function(){this.messageHandler.SendMessage(GLTFViewer.MSGIMAGE,this)}},SaveSTL:{value:function(){this.Export("STLBIN")}},SetUpMenuBtn:{value:function(a,c,d,e,f,g){a.css("width",GLTFViewer.ICONSIZE-2+"px");a.css("height",GLTFViewer.ICONSIZE-2+"px");
(g=g?g:0)&&a.css("margin-left",g+"px");d&&a.prop("title",d);0<=c&&(d="",e&&(d="rgba("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+","+(Math.round(e.a)?1:0)+") "),a.css("background",d+"url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*c+"px"));e||GLTFViewer.SetElemColor(a,GLTFViewer.MODENORMAL);a.css("border","1px solid "+GLTFViewer.BORDERCOLOR);a.css("border-radius","4px");if(f)if(a.click(function(c){c.preventDefault();c.stopPropagation();this.CloseContextMenus();this.scene&&
this.scene.navigator.ClearKeys();GLTFViewer.GetElementEnable(a)&&f.call(this,c,GLTFViewer.MENUCLICK)}.bind(this)),a.on("mousedown mousemove mouseover mouseout",function(c){GLTFViewer.GetElementEnable(a)&&c.stopPropagation()}),window.navigator.pointerEnabled)a.on("pointerdown pointermove pointerup",function(c){GLTFViewer.GetElementEnable(a)&&c.stopPropagation()});else a.on("touchstart touchmove touchend",function(c){GLTFViewer.GetElementEnable(a)&&c.stopPropagation()});$("a",a).first();a.hover(function(){this.scene&&
0===this.scene.navigator._touchHandler.Touches.Count()&&GLTFViewer.GetElementEnable(a)&&(this.MenuFade(!1,250),a.css("border-color",GLTFViewer.HOVERCOLOR))}.bind(this),function(){GLTFViewer.GetElementEnable(a)&&(a.css("border-color",GLTFViewer.BORDERCOLOR),this.MenuFade(!0,5E3,!0))}.bind(this));GLTFViewer.Utils.NoContext(this,a)}},SetUpMenuBtns:{value:function(a,c,d,e,f,g,k,h){GLTFViewer.Utils.IsNull(h)||(h=h*(GLTFViewer.ICONSIZE+0)+(GLTFViewer.Utils.IsNull(k)?0:GLTFViewer.ICONSEPARATION)+0,a.css("width",
h+"px"));for(a=0;a<c.length;++a){h=null;e&&a<e.length&&(h=e[a]);var l=null;f&&a<f.length&&(l=f[a]);var m=null;g&&(m=g.bind(this,a));this.SetUpMenuBtn(c[a],d instanceof Array?d[a]:d+a,h,l,m,a===k?GLTFViewer.ICONSEPARATION:0)}}},AppendBtns:{value:function(a,c){for(var d=[],e=[],f=0;f<c;++f){a.append("<li style='float:left;'><div style='padding-top:"+GLTFViewer.ICONSIZE+"px;'></div><ul style='position:absolute;list-style:none;margin:0;padding:0;border:0;'></ul></li>");var g=$("li",a).last();d.push(g);
g=$("ul",g).last();e.push(g)}return{btns:d,menus:e}}},BuildHTML:{value:function(a){this.wantFile&&(this.hasNodeJS?this.viewer.append("<div><input type='file' accept='.scdoc,.avz,.avzm,.arz' multiple style='display:none;'></input></div>"):this.viewer.append("<div><input type='file' accept='.scdoc,.avz,.avzm' multiple style='display:none;'></input></div>"),this.inputFile=$("input",this.viewer).last());this.hasNodeJS&&(this.viewer.append("<div><input type='file' style='display:none;'></input></div>"),
this.outputFile=$("input",this.viewer).last());this.viewer.append("<canvas style='position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;'></canvas>");this.c3d=$("canvas",this.viewer).last();this.viewer.append("<canvas style='position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;'></canvas>");this.overlay=$("canvas",this.viewer).last();this.viewer.append("<progress max=1 style='position:absolute;top:50%;left:50%;width:150px;height:20px;margin-top:-10px;margin-left:-75px;visibility:hidden;'></progress>");
this.progress=$("progress",this.viewer).last();this.wantLogo&&(this.viewer.append("<img src='"+this.imageDir+"ANSYS_blk_lrg.png' style='visible:hidden;position:absolute;padding:0;margin:0;border:0;right:-19px;top:-20px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-o-user-select:none;user-select:none;'></img>"),this.blkLogo=$("img",this.viewer).last(),this.viewer.append("<img src='"+this.imageDir+"ANSYS_wht_lrg.png' style='visible:hidden;position:absolute;padding:0;margin:0;border:0;right:-19px;top:-20px;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-o-user-select:none;user-select:none;'></img>"),
this.whtLogo=$("img",this.viewer).last());this.viewer.append("<div class='AVDontPrint' style='position:relative;padding-top:"+GLTFViewer.CONTAINER_INNER_MARGIN+"px;padding-left:"+(GLTFViewer.CONTAINER_INNER_MARGIN-GLTFViewer.ICONSEPARATION)+"px;'><ul style='list-style:none;margin:0;padding:0;border:0;'></ul></div>");this.menu=$("ul",this.viewer).last();this.menu.append("<li style='width:1px;height:1px;'><a></a><ul style='list-style:none;'><li><a></a></li></ul></li>");if(this.wantFile){var c=this.AppendBtns(this.menu,
1);this.fileBtn=c.btns[0];this.SetUpMenuBtn(this.fileBtn,GLTFViewer.ICONFILE,GLTFViewer.fileHelp,null,this.FileBtnState,GLTFViewer.ICONSEPARATION)}this.wantSave&&(c=this.AppendBtns(this.menu,1),this.saveBtn=c.btns[0],this.SetUpMenuBtn(this.saveBtn,GLTFViewer.ICONSAVE,this.isServed?GLTFViewer.saveHelpServed:GLTFViewer.saveHelpLocal,null,this.SaveBtnState,GLTFViewer.ICONSEPARATION));c=this.AppendBtns(this.menu,1);this.FileManagerBtn=c.btns[0];this.SetUpMenuBtn(this.FileManagerBtn,GLTFViewer.ICONVIS,
GLTFViewer.FileManagerBtnHelp,null,this.FileManagerBtnState,GLTFViewer.ICONSEPARATION);this.viewportNumber&&this.FileManagerBtnState(null,GLTFViewer.MENUHIDE);this.wantZoom&&(c=this.AppendBtns(this.menu,1),this.zoomBtn=c.btns[0],this.SetUpMenuBtn(this.zoomBtn,GLTFViewer.ICONZOOM,GLTFViewer.zoomHelp,null,this.ZoomBtnState,GLTFViewer.ICONSEPARATION));this.wantSelection&&(c=this.AppendBtns(this.menu,1),this.selectionBtn=c.btns[0],this.selectionMenu=c.menus[0],c=this.AppendBtns(this.selectionMenu,GLTFViewer.selectionMenuBtnsHelp.length),
this.selectionMenuBtns=c.btns,this.SetUpMenuBtn(this.selectionBtn,GLTFViewer.ICONSELECTIONBODY,GLTFViewer.selectionHelp,null,this.SelectionBtnState,GLTFViewer.ICONSEPARATION),this.SetUpMenuBtns(this.selectionMenu,this.selectionMenuBtns,GLTFViewer.ICONSELECTIONEDGE,GLTFViewer.selectionMenuBtnsHelp,null,this.SelectionMenuBtnState));this.wantClip&&(c=this.AppendBtns(this.menu,1),this.clipBtn=c.btns[0],this.clipMenu=c.menus[0],c=this.AppendBtns(this.clipMenu,GLTFViewer.clipMenuBtnsHelp.length),this.clipMenuBtns=
c.btns,this.SetUpMenuBtn(this.clipBtn,GLTFViewer.ICONCLIP,GLTFViewer.clipHelp,null,this.ClipBtnState,GLTFViewer.ICONSEPARATION),this.SetUpMenuBtns(this.clipMenu,this.clipMenuBtns,GLTFViewer.ICONCLIP0,GLTFViewer.clipMenuBtnsHelp,null,this.ClipMenuBtnState,GLTFViewer.clipMenuBtnsHelp.length-1));this.wantMarkup&&(this.contextMenuMarkup=new GLTFViewer.Utils.SimpleContextMenu(this,this.controllingViewer.body,[GLTFViewer.CM_MARKUP_DELETE_MARKUP],null,function(a,c){switch(a[0]){case GLTFViewer.CM_MARKUP_DELETE_MARKUP:this.scene&&
this.scene.MarkupDelete(c)}}.bind(this)),c=this.AppendBtns(this.menu,1),this.markupBtn=c.btns[0],this.markupMenu=c.menus[0],this.colorPickerPanel=this.BuildColorPickerPanel(),c=this.AppendBtns(this.markupMenu,GLTFViewer.markupMenuBtnsHelp.length),this.markupMenuBtns=c.btns,this.markupMenuMenus=c.menus,this.markupMenuBtns[GLTFViewer.markupMenuBtnsFontSize].append("<textarea maxlength=2 style='resize:none;position:absolute;top:0;padding-top:6px;text-align:center;overflow:hidden;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></textarea>"),
this.markupFontSize=$("textarea",this.markupMenuBtns[GLTFViewer.markupMenuBtnsFontSize]).last(),this.markupMenuBtns[GLTFViewer.markupMenuBtnsFontSize]=this.markupFontSize,c=this.AppendBtns(this.markupMenuMenus[GLTFViewer.markupMenuBtnsLineShape],GLTFViewer.markupLineShapeMenuBtnsHelp.length),this.markupLineShapeMenuBtns=c.btns,this.viewer.append("<textarea style='visibility:hidden;position:absolute;top:0;left:0;width:10px;height:10px;overflow:hidden;font-size:16px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></textarea>"),
this.markupTextArea=$("textarea",this.viewer).last(),this.markupTextArea[0].addEventListener("blur",function(a){this.scene&&this.scene.MarkupTextEvent("blur",a)}.bind(this),!1),this.markupTextArea[0].addEventListener("keydown",function(a){this.scene&&this.scene.MarkupTextEvent("keydown",a)}.bind(this),!1),this.markupTextArea[0].addEventListener("keyup",function(a){this.scene&&this.scene.MarkupTextEvent("keyup",a)}.bind(this),!1),this.markupTextArea[0].addEventListener("paste",function(a){this.scene&&
this.scene.MarkupTextEvent("paste",a)}.bind(this),!1),this.markupTextArea[0].addEventListener("mousedown",function(a){this.scene&&this.scene.MarkupTextEvent("mousedown",a)}.bind(this),!0),window.navigator.pointerEnabled?this.markupTextArea[0].addEventListener("pointerdown",function(a){this.scene&&this.scene.MarkupTextEvent("mousedown",a)}.bind(this),!0):this.markupTextArea[0].addEventListener("touchstart",function(a){this.scene&&this.scene.MarkupTextEvent("mousedown",a)}.bind(this),!0),this.markupTextArea[0].addEventListener("mousemove",
function(a){this.scene&&this.scene.MarkupTextEvent("mousedown",a)}.bind(this),!0),window.navigator.pointerEnabled?this.markupTextArea[0].addEventListener("pointermove",function(a){this.scene&&this.scene.MarkupTextEvent("mousemove",a)}.bind(this),!0):this.markupTextArea[0].addEventListener("touchmove",function(a){this.scene&&this.scene.MarkupTextEvent("mousemove",a)}.bind(this),!0),this.markupTextArea[0].addEventListener("mouseup",function(a){this.scene&&this.scene.MarkupTextEvent("mouseup",a)}.bind(this),
!1),window.navigator.pointerEnabled?this.markupTextArea[0].addEventListener("pointerup",function(a){this.scene&&this.scene.MarkupTextEvent("mouseup",a)}.bind(this),!0):this.markupTextArea[0].addEventListener("touchend",function(a){this.scene&&this.scene.MarkupTextEvent("mousedown",a)}.bind(this),!0),this.SetUpMenuBtn(this.markupBtn,GLTFViewer.ICONMARKUP,GLTFViewer.markupHelp,null,this.MarkupBtnState,GLTFViewer.ICONSEPARATION),this.SetUpMenuBtns(this.markupMenu,this.markupMenuBtns,[GLTFViewer.ICONMARKUP2D,
GLTFViewer.ICONMARKUP3D,GLTFViewer.ICONMARKUPLINE,GLTFViewer.ICONLINECOLOR,GLTFViewer.ICONFONTCOLOR,GLTFViewer.ICONBACKCOLOR,GLTFViewer.ICONFONTSIZE],GLTFViewer.markupMenuBtnsHelp,null,this.MarkupMenuBtnState,2),this.markupFontSize.css("background","white"),this.markupFontSize.css("width",GLTFViewer.ICONSIZE-4+"px"),this.markupFontSize.css("height",GLTFViewer.ICONSIZE-9+"px"),this.SetUpMenuBtns(this.markupMenuMenus[GLTFViewer.markupMenuBtnsLineShape],this.markupLineShapeMenuBtns,GLTFViewer.ICONMARKUPLINE,
GLTFViewer.markupLineShapeMenuBtnsHelp,null,this.MarkupLineShapeBtnState,null,1),this.markupFontSize[0].addEventListener("keydown",function(a){a.stopPropagation();13===a.keyCode&&(a.preventDefault(),this.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsFontSize,null,GLTFViewer.MENUCLICK,this.markupFontSize[0].value))}.bind(this),!1),this.markupFontSize[0].addEventListener("blur",function(a){a.stopPropagation();a.preventDefault();this.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsFontSize,null,GLTFViewer.MENUCLICK,
this.markupFontSize[0].value)}.bind(this),!1));this.wantExplode&&(c=this.AppendBtns(this.menu,1),this.explodeBtn=c.btns[0],this.explodeMenu=c.menus[0],this.SetUpMenuBtn(this.explodeBtn,GLTFViewer.ICONEXPLODE,GLTFViewer.explodeBtnHelp,null,this.ExplodeBtnState,GLTFViewer.ICONSEPARATION),this.explodeMenu.css("background","transparent"),this.explodeMenu.css("border","1px solid "+GLTFViewer.BORDERCOLOR),this.explodeMenu.css("padding","0"),this.explodeMenu.css("width","auto"),GLTFViewer.Utils.NoContext(this,
this.explodeMenu),this.explodePanel=this.BuildExplodePanel());this.wantViewport&&(c=this.AppendBtns(this.menu,1),this.viewportBtn=c.btns[0],this.viewportMenu=c.menus[0],c=this.AppendBtns(this.viewportMenu,GLTFViewer.viewportMenuBtnsHelp.length),this.viewportMenuBtns=c.btns,this.SetUpMenuBtn(this.viewportBtn,GLTFViewer.ICONVP4,GLTFViewer.viewportHelp,null,this.ViewportBtnState,GLTFViewer.ICONSEPARATION),this.SetUpMenuBtns(this.viewportMenu,this.viewportMenuBtns,GLTFViewer.ICONVP1,GLTFViewer.viewportMenuBtnsHelp,
null,this.ViewportMenuBtnState,GLTFViewer.viewportMenuBtnsHelp.length-1));this.wantFull&&(c=this.AppendBtns(this.menu,1),this.fullBtn=c.btns[0],this.SetUpMenuBtn(this.fullBtn,GLTFViewer.ICONFULL,GLTFViewer.fullHelp,null,this.FullBtnState,GLTFViewer.ICONSEPARATION));this.wantOptions&&(c=this.AppendBtns(this.menu,1),this.optionsBtn=c.btns[0],this.SetUpMenuBtn(this.optionsBtn,GLTFViewer.ICONOPTIONS,GLTFViewer.optionsHelp,null,this.OptionsBtnState,GLTFViewer.ICONSEPARATION));if(this.wantAbout){c=this.AppendBtns(this.menu,
1);a=c.btns[0];var d=c.menus[0],c=this.AppendBtns(d,GLTFViewer.aboutMenuBtnsHelp.length),c=c.btns;this.AboutBtnState=this._AboutBtnState.bind(this,a,c,d,this._AboutMenuBtnState.bind(this));var e=this._AboutMenuBtnState.bind(this,c,d,this.AboutBtnState);this.SetUpMenuBtn(a,GLTFViewer.ICONABOUT,GLTFViewer.aboutHelp,null,this.AboutBtnState,GLTFViewer.ICONSEPARATION);this.SetUpMenuBtns(d,c,GLTFViewer.ICONABOUTHELP,GLTFViewer.aboutMenuBtnsHelp,null,e);this._helpSystem||this._helpHTML||e(0,null,GLTFViewer.MENUDISABLE)}$("<style>@media print { .AVDontPrint { display: none; } }</style>").appendTo($("head",
this.document))}},DrawBorder:{value:function(){if(!this.IsVisible()||this.isFull||1===this.viewportLayout)return[0,0,0];var a=this.viewer.parent().width(),c=this.viewer.parent().height();if(2===this.viewportLayout){if(0===this.viewportNumber)return[2,a,c]}else{if(0===this.viewportNumber)return[6,a,c];if(1===this.viewportNumber)return[4,a,c];if(2===this.viewportNumber)return[2,a,c]}return[0,0,0]}},IsVisible:{value:function(){return GLTFViewer.GetElementVisible(this.container)}},SetupViewports:{value:function(a){this.viewportLayout=
a;if(this.controllingViewer.wantViewport)switch(a){case 2:GLTFViewer.SetElementVisible(this.controllingViewer.viewport02,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport13,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport0,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport1,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport2,!1);GLTFViewer.SetElementVisible(this.controllingViewer.viewport3,!1);this.controllingViewer.viewport02.css("width",
"50%");this.controllingViewer.viewport02.css("height","100%");this.controllingViewer.viewport13.css("width","50%");this.controllingViewer.viewport13.css("height","100%");this.controllingViewer.viewport13.css("left","50%");this.controllingViewer.viewport0.css("height","100%");this.controllingViewer.viewport1.css("height","100%");break;case 4:GLTFViewer.SetElementVisible(this.controllingViewer.viewport02,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport13,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport0,
!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport1,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport2,!0);GLTFViewer.SetElementVisible(this.controllingViewer.viewport3,!0);this.controllingViewer.viewport02.css("width","50%");this.controllingViewer.viewport02.css("height","100%");this.controllingViewer.viewport13.css("width","50%");this.controllingViewer.viewport13.css("height","100%");this.controllingViewer.viewport13.css("left","50%");this.controllingViewer.viewport0.css("height",
"50%");this.controllingViewer.viewport1.css("height","50%");this.controllingViewer.viewport2.css("height","50%");this.controllingViewer.viewport2.css("top","50%");this.controllingViewer.viewport3.css("height","50%");this.controllingViewer.viewport3.css("top","50%");break;default:GLTFViewer.SetElementVisible(this.controllingViewer.viewport02,!0),GLTFViewer.SetElementVisible(this.controllingViewer.viewport13,!1),GLTFViewer.SetElementVisible(this.controllingViewer.viewport0,!0),GLTFViewer.SetElementVisible(this.controllingViewer.viewport1,
!1),GLTFViewer.SetElementVisible(this.controllingViewer.viewport2,!1),GLTFViewer.SetElementVisible(this.controllingViewer.viewport3,!1),this.controllingViewer.viewport02.css("width","100%"),this.controllingViewer.viewport02.css("height","100%"),this.controllingViewer.viewport0.css("height","100%")}this.UpdateLayout();this.controllingViewer.SetTitle("REFRESH")}},SetupFullViewport:{value:function(a){if(this.controllingViewer.wantViewport)switch(a){case 0:this.controllingViewer.viewport02.css("display",
"flex");this.controllingViewer.viewport02.css("display","-webkit-flex");this.controllingViewer.viewport13.css("display","none");this.controllingViewer.viewport0.css("display","flex");this.controllingViewer.viewport0.css("display","-webkit-flex");this.controllingViewer.viewport1.css("display","none");this.controllingViewer.viewport2.css("display","none");this.controllingViewer.viewport3.css("display","none");this.controllingViewer.viewport02.css("width","100%");this.controllingViewer.viewport02.css("height",
"100%");this.controllingViewer.viewport0.css("height","100%");break;case 1:this.controllingViewer.viewport02.css("display","none");this.controllingViewer.viewport13.css("display","flex");this.controllingViewer.viewport13.css("display","-webkit-flex");this.controllingViewer.viewport0.css("display","none");this.controllingViewer.viewport1.css("display","flex");this.controllingViewer.viewport1.css("display","-webkit-flex");this.controllingViewer.viewport2.css("display","none");this.controllingViewer.viewport3.css("display",
"none");this.controllingViewer.viewport13.css("width","100%");this.controllingViewer.viewport13.css("height","100%");this.controllingViewer.viewport13.css("left","0");this.controllingViewer.viewport1.css("height","100%");break;case 2:this.controllingViewer.viewport02.css("display","flex");this.controllingViewer.viewport02.css("display","-webkit-flex");this.controllingViewer.viewport13.css("display","none");this.controllingViewer.viewport0.css("display","none");this.controllingViewer.viewport1.css("display",
"none");this.controllingViewer.viewport2.css("display","flex");this.controllingViewer.viewport2.css("display","-webkit-flex");this.controllingViewer.viewport3.css("display","none");this.controllingViewer.viewport02.css("width","100%");this.controllingViewer.viewport02.css("height","100%");this.controllingViewer.viewport2.css("height","100%");this.controllingViewer.viewport2.css("top","0");break;case 3:this.controllingViewer.viewport02.css("display","none"),this.controllingViewer.viewport13.css("display",
"flex"),this.controllingViewer.viewport13.css("display","-webkit-flex"),this.controllingViewer.viewport0.css("display","none"),this.controllingViewer.viewport1.css("display","none"),this.controllingViewer.viewport2.css("display","none"),this.controllingViewer.viewport3.css("display","flex"),this.controllingViewer.viewport3.css("display","-webkit-flex"),this.controllingViewer.viewport13.css("width","100%"),this.controllingViewer.viewport13.css("height","100%"),this.controllingViewer.viewport13.css("left",
"0"),this.controllingViewer.viewport3.css("height","100%"),this.controllingViewer.viewport3.css("top","0")}this.UpdateLayout();this.controllingViewer.SetTitle("REFRESH")}},CloseContextMenus:{value:function(){this.fileManager&&this.fileManager.CloseContextMenus();for(var a=0;4>a;++a){var c=this.GetViewerByNumber(a);if(GLTFViewer.Utils.IsNull(c))break;c.contextMenuContainer&&c.contextMenuContainer.Show(!1);c.contextMenuMarkup&&c.contextMenuMarkup.Show(!1)}}},BuildColorPickerPanel:{value:function(){function a(a,
c,d,e,f){var h="rgba("+f.r+","+f.g+","+f.b+", "+f.a/255+")",g=Math.round(a-.8660254*d),k=Math.round(a);a=Math.round(a+.8660254*d);var l=Math.round(c-d),m=Math.round(c-.5*d),n=Math.round(c+.5*d);c=Math.round(c+d);d=""+(a+","+m)+(","+k+","+l);d+=","+g+","+m;d+=","+g+","+n;d+=","+k+","+c;d+=","+a+","+n;0===f.a?(e.strokeStyle="rgba(0, 0, 0, 1)",e.lineWidth=1):(e.fillStyle=h,e.lineWidth=0);e.beginPath();e.moveTo(a,m);e.lineTo(k,l);e.lineTo(g,m);e.lineTo(g,n);e.lineTo(k,c);e.lineTo(a,n);0===f.a?(e.closePath(),
e.stroke()):e.fill();return d}function c(a,c){c.preventDefault();c.stopPropagation();f.__callback__&&f.__callback__(a.__color__)}var d=Math.round(157.6166228),e=Math.round(140),f=$("<div style='display:block;margin-left:-"+(d-GLTFViewer.ICONSIZE)/2+"px;width:"+d+"px;height:"+e+"px;background:transparent;'></div>");f.append("<map name='imgmap'></map>");var g=$("map",f).last();f.append("<canvas style='position:absolute:top:0;left:0;width:"+d+"px;height:"+e+"px;background:transparent;'></canvas>");var k=
$("canvas",f).last();k[0].width=k.width();k[0].height=k.height();f.__canvas__=k;var h=k[0].getContext("2d");h.clearRect(0,0,d,e);var l=new GLTFViewer.Utils.HSL(0,1,0,1),m=d/2,n=e/2,p=new GLTFViewer.Utils.RGBA(255,255,255,255),q=a(m,n,7,h,p);g.append("<area style='cursor:pointer;' shape='poly' coords='"+q+"'></area>");q=$("area",g).last();q.__color__=p;q.click(c.bind(this,q));for(var u=1;6>=u;++u)for(var r=m+12.1243556*u,w=n,t=0;t<6*u;++t){var p=r-m,q=w-n,x=Math.abs((72.7461336-Math.sqrt(p*p+q*q))/
72.7461336);.5>x&&(x=Math.sqrt(2*x)/2);l.l=x;p=Math.atan2(q,p);0>p&&(p+=2*Math.PI);l.h=p/(2*Math.PI);p=GLTFViewer.Utils.RGBA.CreateFromHSL(l);6===u&&0===t%(2*u)&&(p.a=0);q=a(r,w,7,h,p);g.append("<area style='cursor:pointer;' shape='poly' coords='"+q+"'></area>");q=$("area",g).last();q.__color__=p;q.click(c.bind(this,q));switch(Math.floor(t/u)){case 0:r-=6.0621778;w-=10.5;break;case 1:r-=12.1243556;break;case 2:r-=6.0621778;w+=10.5;break;case 3:r+=6.0621778;w+=10.5;break;case 4:r+=12.1243556;break;
case 5:r+=6.0621778,w-=10.5}}f.append("<img width="+d+" height="+e+" usemap='#imgmap'></img>");$("img",f).last()[0].src=k[0].toDataURL();k.remove();return f}},AttachColorPickerPanel:{value:function(a,c){this.colorPickerPanel.detach();a.append(this.colorPickerPanel);this.colorPickerPanel.__callback__=c}},AnyAnnimationRunning:{value:function(){return this.controllingViewer&&this.controllingViewer.scene&&!this.controllingViewer.scene.AnimationStopped()||this.controllingViewer.viewer1&&this.controllingViewer.viewer1.scene&&
!this.controllingViewer.viewer1.scene.AnimationStopped()||this.controllingViewer.viewer2&&this.controllingViewer.viewer2.scene&&!this.controllingViewer.viewer2.scene.AnimationStopped()||this.controllingViewer.viewer3&&this.controllingViewer.viewer3.scene&&!this.controllingViewer.viewer3.scene.AnimationStopped()?!0:!1}},ShowSceneAnimation:{value:function(a){GLTFViewer.Utils.IsNull(this.animationDialog)||GLTFViewer.Utils.IsNull(this.scene)||(!a||!this.scene||!this.scene.HasAnimation()||1<this.NumMultiFiles()?
(this.scene.AnimationStop(),GLTFViewer.GetElementVisible(this.animationDialog.controls)&&(this.animationDialog.controls.css("display","none"),this.UpdateLayout())):(this.animationDialog.minTime=this.scene.AnimationMinTime(),this.animationDialog.maxTime=this.scene.AnimationMaxTime(),GLTFViewer.SetElementCheck(this.animationDialog.loopButton,this.scene.AnimationLoop),GLTFViewer.GetElementVisible(this.animationDialog.controls)||(this.animationDialog.controls.css("display","flex"),this.animationDialog.controls.css("display",
"-webkit-flex"),this.UpdateLayout())))}},SetAnimationSlider:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(this.animationDialog)){this.CloseContextMenus();var d=parseInt(10*a)/10;this.animationDialog.label.text(d.toFixed(1)+"s");if(GLTFViewer.Utils.IsNull(c)||c)d=GLTFViewer.Utils.IsNull(this.animationDialog.minTime)?0:this.animationDialog.max*(a-this.animationDialog.minTime)/(this.animationDialog.maxTime-this.animationDialog.minTime),this.animationDialog.slider.val(d),this.animationDialog.slider.toggle().toggle()}}},
SetAnimationMinMaxSpeed:{value:function(a,c){if(!(GLTFViewer.Utils.IsNull(this.animationDialog)||GLTFViewer.Utils.IsNull(this.scene)||c<a||c===a)){var d=c-a;if(0!==d){var d=5<d?5:d,e=d/25,d=parseInt(Math.ceil(Math.log(d)/Math.LN10*1E3))/1E3,e=parseInt(Math.floor(Math.log(e)/Math.LN10*1E3))/1E3;this.animationDialog.speed.prop("min",e);this.animationDialog.speed.prop("max",d);if(0>d){var e=Math.pow(10,d),f=parseInt(100*e+.5)/100;this.animationDialog.speedLabel.text(f.toFixed(2)+"X");this.animationDialog.speed.val(d);
this.scene.AnimationSpeed(e)}else this.animationDialog.speedLabel.text("1.00X"),this.animationDialog.speed.val(0),this.scene.AnimationSpeed(1);this.animationDialog.speed.toggle().toggle()}}}},BuildAnimationDialog:{value:function(a){function c(a,c,d,k){c.hover(function(){c.css("border-color",GLTFViewer.HOVERCOLOR);c.css("cursor","pointer")},function(){c.css("border-color",GLTFViewer.BORDERCOLOR);c.css("cursor","")});return function(h){this.CloseContextMenus();h.stopPropagation();"PLAY"===a?(this.scene.AnimationPlay(),
c.css("display","none"),d.css("display","inline")):"PAUSE"===a?(this.scene.AnimationPause(),c.css("display","none"),d.css("display","inline")):"STOP"===a?(this.scene.AnimationStop(),d.css("display","none"),k.css("display","inline")):"LOOP"===a&&(h=!this.scene.AnimationLoop,this.scene.AnimationLoop=h,GLTFViewer.SetElementCheck(c,h))}.bind(this)}var d={};a.append("<div style='-webkit-print-color-adjust:exact;width:100%;height:42px;background:linear-gradient(#34485D,#283849);display:none;flex-direction:row;-webkit-flex-direction:row;'></div>");
d.controls=$("div",a).last();d.controls.append("<div style='left:0;background:transparent;width:37px;'></div>");a=$("div",d.controls).last();a.append("<button id='loopButton' title='Loop' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:16px;'></button>");d.loopButton=$("button",a).last();d.loopButton.css("background","url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONLOOP+"px");
d.loopButton.css("background-color",GLTFViewer.BUTTONCOLOR);$("<style>button[id='loopButton']:focus {outline:none;}</style>").appendTo($("head",this.document));d.controls.append("<div style='left:0;background:transparent;width:37px;'></div>");a=$("div",d.controls).last();a.append("<button id='stopButton' title='Stop' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:16px;'></button>");d.stopButton=$("button",
a).last();d.stopButton.css("background","url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONSTOP+"px");d.stopButton.css("background-color",GLTFViewer.BUTTONCOLOR);$("<style>button[id='stopButton']:focus {outline:none;}</style>").appendTo($("head",this.document));d.controls.append("<div style='background:transparent;width:42px;'></div>");a=$("div",d.controls).last();a.append("<button id='playButton' title='Play' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+
GLTFViewer.BORDERCOLOR+";border-radius:16px;'></button>");d.playButton=$("button",a).last();d.playButton.css("background","url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONPLAY+"px");d.playButton.css("background-color",GLTFViewer.BUTTONCOLOR);$("<style>button[id='playButton']:focus {outline:none;}</style>").appendTo($("head",this.document));a.append("<button id='pauseButton' title='Pause' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+
GLTFViewer.BORDERCOLOR+";border-radius:16px;display:none;'></button>");d.pauseButton=$("button",a).last();d.pauseButton.css("background","url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONPAUSE+"px");d.pauseButton.css("background-color",GLTFViewer.BUTTONCOLOR);$("<style>button[id='pauseButton']:focus {outline:none;}</style>").appendTo($("head",this.document));d.playButton.click(c.call(this,"PLAY",d.playButton,d.pauseButton));d.pauseButton.click(c.call(this,"PAUSE",d.pauseButton,
d.playButton));d.stopButton.click(c.call(this,"STOP",d.stopButton,d.pauseButton,d.playButton));d.loopButton.click(c.call(this,"LOOP",d.loopButton));d.controls.append("<div style='background:transparent;text-align:center;'></div>");a=$("div",d.controls).last();a.append("<label style='display:block;border:0;padding:0;margin:0;margin-top:2px;color:white;text-align:center;height:9px;line-height:10px;font-size:10px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></label>");d.speedLabel=$("label",a).last();
d.speedLabel.text("1");d.speed=GLTFViewer.Utils.BuildSlider(this,a,"slider1",100,12,4,12,3,-.7,.7,.001);d.speed.css("display","block");a.append("<p style='border:0;padding:0;margin:0;margin-top:-3px;color:white;height:10px;line-height:10px;font-size:10px;font-family:Segoe UI,Arial,Helvetica,sans-serif;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-o-user-select:none;user-select:none;cursor:default;'>Speed</p>");d.speed.on("input change",
function(a,c){this.CloseContextMenus();if(this.scene){var d=Math.pow(10,c.val()),k=parseInt(100*d+.5)/100;a.speedLabel.text(k.toFixed(2)+"X");setTimeout(this.scene.AnimationSpeed(d),0)}}.bind(this,d,d.speed));d.controls.append("<div style='background:transparent;flex:1;-webkit-flex:1;display:flex;display:-webkit-flex;flex-direction:row;-webkit-flex-direction:row;'></div>");a=$("div",d.controls).last();d.slider=GLTFViewer.Utils.BuildSlider(this,a,"slider2",null,32,5,16,5,0,1E3,1);d.max=1E3;d.minTime=
0;d.maxTime=1;d.slider.on("input change",function(a,c,d){this.CloseContextMenus();this.scene&&(a=c.val()*(a.maxTime-a.minTime)/a.max+a.minTime,setTimeout(this.scene.AnimationPlayOneFrame(a,!1),0))}.bind(this,d,d.slider));a.append("<label style='padding:0;margin:0;border:0;display:inline;background:transparent;color:white;height:16px;margin:5px;margin-top:13px;line-height:16px;width:40px;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></label>");d.label=$("label",a).last();d.label.text("0.0s");
return d}},NumMultiFiles:{value:function(){var a=this.fileManager.ActiveFileObj(this);return GLTFViewer.Utils.IsNull(a)?0:a.NumMultiFiles()}},GetMultiFiles:{value:function(){var a=this.fileManager.ActiveFileObj(this);return GLTFViewer.Utils.IsNull(a)?[]:a.GetMultiFiles()}},GetLoadedIdx:{value:function(){var a=this.GetMultiFiles();return 0>=a.length?-1:a.indexOf(this.fileManager.ActiveFileObj(this))}},ShowMultiFile:{value:function(a){if(!GLTFViewer.Utils.IsNull(this.multiFileDialog)){if(1<this.NumMultiFiles()&&
a){if(GLTFViewer.GetElementVisible(this.multiFileDialog.controls))return;this.multiFileDialog.controls.css("display","flex");this.multiFileDialog.controls.css("display","-webkit-flex")}else{if(!GLTFViewer.GetElementVisible(this.multiFileDialog.controls))return;this.multiFileDialog.controls.css("display","none")}this.UpdateLayout()}}},SetMultiFileSlider:{value:function(a,c){if(GLTFViewer.Utils.IsNull(a)){if(a=this.GetLoadedIdx(),0>a){this.ShowMultiFile(!1);return}}else a=parseInt(a);var d=this.NumMultiFiles();
if(2>d||GLTFViewer.Utils.IsNull(this.multiFileDialog)||0>a||a>=d)this.ShowMultiFile(!1);else{this.multiFileDialog.val=a;var e=this.GetMultiFiles()[a];this.multiFileDialog.label.prop("title",e._containerFile?e._path+" : "+e._name:e._name);var e=e._name,f=a+1+"/"+d+" "+e,g=this.overlay[0].getContext("2d");g.font="14px sans-serif";for(var k=e.length-1;0<=k&&!(GLTFViewer.Utils.TextWidth(g,f)<this.multiFileDialog.labelWidth);--k)f=a+1+"/"+d+" "+e.substring(0,k)+"...";this.multiFileDialog.label.text(f);
if(GLTFViewer.Utils.IsNull(c)||c)this.ShowMultiFile(!0),this.multiFileDialog.max=d-1,this.multiFileDialog.slider.prop("max",this.multiFileDialog.max),this.multiFileDialog.loaded=a,this.multiFileDialog.slider.val(a),this.multiFileDialog.slider.toggle().toggle()}}},LoadMultiFileFile:{value:function(a){function c(a,c){c&&this.SetMultiFileSlider(a)}a=parseInt(a);a>this.multiFileDialog.max?a=this.multiFileDialog.max:0>a&&(a=0);a!==this.multiFileDialog.loaded&&this.SelectFile(this.GetMultiFiles()[a],c.bind(this,
a),GLTFViewer.LT_UPDATE)}},BuildMultiFileDialog:{value:function(a){function c(a,c){c.hover(function(){c.css("border-color",GLTFViewer.HOVERCOLOR);c.css("cursor","pointer")},function(){c.css("border-color",GLTFViewer.BORDERCOLOR);c.css("cursor","")});return function(c){this.CloseContextMenus();c.stopPropagation();"FF"===a?this.LoadMultiFileFile(this.multiFileDialog.val+1):"REW"===a&&this.LoadMultiFileFile(this.multiFileDialog.val-1)}.bind(this)}var d={};a.append("<div style='width:100%;height:42px;background:linear-gradient(#34485D,#283849);display:none;flex-direction:row;-webkit-flex-direction:row;'></div>");
d.controls=$("div",a).last();d.controls.append("<div style='left:0;background:transparent;width:37px;'></div>");a=$("div",d.controls).last();a.append("<button id='mfrewButton' title='Back' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:16px;'></button>");d.rewButton=$("button",a).last();d.rewButton.css("background","url('"+this.imageDir+"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONREW+"px");d.rewButton.css("background-color",
GLTFViewer.BUTTONCOLOR);$("<style>button[id='mfrewButton']:focus {outline:none;}</style>").appendTo("head");d.controls.append("<div style='left:0;background:transparent;width:37px;'></div>");a=$("div",d.controls).last();a.append("<button id='mfffButton' title='Forward' type='button' style='margin:5px;padding:0;width:32px;height:32px;position:relative;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:16px;'></button>");d.ffButton=$("button",a).last();d.ffButton.css("background","url('"+this.imageDir+
"Icons.png') -0px -"+GLTFViewer.ICONSIZE*GLTFViewer.ICONFF+"px");d.ffButton.css("background-color",GLTFViewer.BUTTONCOLOR);$("<style>button[id='mfffButton']:focus {outline:none;}</style>").appendTo("head");d.rewButton.click(c.call(this,"REW",d.rewButton));d.ffButton.click(c.call(this,"FF",d.ffButton));d.controls.append("<div style='background:transparent;flex:1;-webkit-flex:1;display:flex;display:-webkit-flex;flex-direction:row;-webkit-flex-direction:row;'></div>");a=$("div",d.controls).last();d.slider=
GLTFViewer.Utils.BuildSlider(this,a,"slider3",null,32,5,16,5,0,1,1);d.slider.on("input change",function(a,c){this.scene&&this.SetMultiFileSlider(c.val(),!1)}.bind(this,d,d.slider));d.slider.on("mouseup",function(a,c){this.scene&&this.LoadMultiFileFile(c.val())}.bind(this,d,d.slider));d.labelWidth=120;a.append("<div style='padding:0;margin:0;border:0;display:inline;background:transparent;height:16px;margin:5px;margin-top:13px;width:"+d.labelWidth+"px;'></div>");a=$("div",a).last();a.append("<label style='padding:0;margin:0;border:0;margin:0;background:transparent;color:white;line-height:16px;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;white-space:nowrap;'></label>");
d.label=$("label",a).last();d.label.text("<unknown>");return d}},SetExplodeSlider:{value:function(a){GLTFViewer.Utils.IsNull(this.explodePanel)||(this.explodePanel.val(a),this.explodePanel.toggle().toggle())}},BuildExplodePanel:{value:function(){function a(a){this.scene&&(a=1*a.val(),this.scene.SetExplosion(a,!1))}if(this.wantExplode){this.explodeMenu.append("<div style='background:linear-gradient(#34485D,#283849);'></div>");var c=$("div",this.explodeMenu).last(),c=GLTFViewer.Utils.BuildSlider(this,
c,"slider4",100,16,5,12,3,0,2,.1);c.on("input change",a.bind(this,c));c.on("click",function(a){a.stopPropagation()}.bind(this));return c}}},BuildAboutDialog:{value:function(a){function c(a){return function(c){c.stopPropagation();a.css("display","none")}}a={};var d="undefined"!==typeof GLTFViewer_About&&null!==GLTFViewer_About,e=d?GLTFViewer_About.build_date:"unknown",f=d?GLTFViewer_About.extern_release_id:"Release unknown",g="";d&&(d=/(20[0-9][0-9])/.exec(e))&&2===d.length&&(g=d[1]+" ");a.box=GLTFViewer.Utils.CreateModalShield();
a.box.append("<div style='width:416px;height:270px;position:relative;border:1px solid "+GLTFViewer.BORDERCOLOR+";margin:10% auto;background:white;'></div>");a.dialog=$("div",a.box).last();a.dialog.append("<div style='width:100%;height:"+(GLTFViewer.TITLEHEIGHT-1)+"px;position:relative;border-bottom:1px solid "+GLTFViewer.BORDERCOLOR+";background:linear-gradient(#34485D,#283849);'></div>");d=$("div",a.dialog).last();d.append("<p style='position:absolute;left:15px;top:-6px;color:white;font-size:12px;font-weight:600;font-family:Segoe UI,Arial,Helvetica,sans-serif;'>About ANSYS Viewer</p>");
d.append("<img src='"+this.imageDir+"close.png' title='Close' style='position:absolute;right:10px;top:"+(GLTFViewer.TITLEHEIGHT-1-15)/2+"px;background:transparent;border-radius:8px;'></img>");var k=$("img",d).last();k.hover(function(){k.css("background",GLTFViewer.HOVERCOLOR);k.css("cursor","pointer")},function(){k.css("background","transparent");k.css("cursor","")});k.click(c(a.box));a.dialog.append("<div style='width:100%;height:"+(272-GLTFViewer.TITLEHEIGHT-60-3-12)+"px;position:relative;border-bottom:1px solid "+
GLTFViewer.BORDERCOLOR+";background:white;'></div>");a.content=$("div",a.dialog).last();a.content.append("<p style='padding:5px 8px 8px 8px;font-size:12px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'>ANSYS<sup>&reg;</sup> Viewer<br>"+f+"<br>Build date: "+e+" <br><br>&copy; 2015-"+g+" ANSYS, Inc. All rights reserved. Unauthorized use, distribution or duplication is prohibited. This product is subject to U.S. laws governing export and re-export. For full Legal Notice, see documentation.<br><br></p>");
e=$("p",a.content).last();this._helpSystem?(e.append("<a href='javascript:void(0);' target='_blank'>Legal Notices</a>"),$("a",e).last().click(function(a){a.stopPropagation();this._helpSystem&&this._helpSystem.Open("HLP:file:ans_viewer/ans_viewer_legal.html")}.bind(this))):this._legalHTML&&e.append("<a href='"+this._legalHTML+"' target='_blank'>Legal Notices</a>");a.dialog.append("<button type='button' style='width:70px;height:19px;position:relative;background:"+GLTFViewer.BUTTONCOLOR+";color:black;margin:20.5px 173px;border:1px solid "+
GLTFViewer.BORDERCOLOR+";border-radius:5px;'>OK</button>");var h=$("button",a.dialog).last();h.hover(function(){h.css("border-color",GLTFViewer.HOVERCOLOR);h.css("cursor","pointer")},function(){h.css("border-color",GLTFViewer.BORDERCOLOR);h.css("cursor","")});h.click(c(a.box));$(window).resize(function(a){GLTFViewer.GetElementVisible(a.box)&&this.ShowAboutDialog(!0)}.bind(this,a));a.box[0].addEventListener("keydown",function(a,c){27===c.keyCode&&a.box.css("display","none")}.bind(this,a),!1);GLTFViewer.MakeUnselectable(a.box[0]);
return a}},ShowAboutDialog:{value:function(a){if(GLTFViewer.Utils.IsNull(a)||a){this.aboutDialog.box.css("display","inline");this.aboutDialog.box.css("width",GLTFViewer.Utils.GetBrowserWidth()+"px");this.aboutDialog.box.css("height",GLTFViewer.Utils.GetBrowserHeight()+"px");a=(this.body.width()-this.aboutDialog.dialog.width())/2;var c=(this.body.height()-this.aboutDialog.dialog.height())/2;this.aboutDialog.dialog.css("margin-top",c+"px");this.aboutDialog.dialog.css("margin-left",a+"px");this.aboutDialog.box.focus()}else this.aboutDialog.box.css("display",
"none")}},ShowHelp:{value:function(){this._helpSystem?this._helpSystem.Open("HLP:file:ans_viewer/ans_viewer_help.html"):this._helpHTML&&window.open(this._helpHTML)}},UpdateLayout:{value:function(){this.controllingViewer.IsVisible()&&this.controllingViewer._UpdateLayout();1!==this.viewportLayout&&(this.controllingViewer.viewer1&&this.controllingViewer.viewer1.IsVisible()&&this.controllingViewer.viewer1._UpdateLayout(),this.controllingViewer.viewer2&&this.controllingViewer.viewer2.IsVisible()&&this.controllingViewer.viewer2._UpdateLayout(),
this.controllingViewer.viewer3&&this.controllingViewer.viewer3.IsVisible()&&this.controllingViewer.viewer3._UpdateLayout())}},_UpdateLayout:{value:function(){var a=0,c=0;this.IsVisible()&&(a=this.viewer.width(),c=this.viewer.height());this.viewerWidth=a;this.viewerHeight=c;this.wantLogo&&(this.blkLogo[0].style.left=a-129+19+"px",this.whtLogo[0].style.left=a-129+19+"px");this.c3d[0].width=a;this.c3d[0].height=c;this.c3d[0].style.width=a+"px";this.c3d[0].style.height=c+"px";this.overlay[0].width=a;
this.overlay[0].height=c;this.overlay[0].style.width=a+"px";this.overlay[0].style.height=c+"px";this.scene&&this.scene.Invalidate(!0)}},MenuFade:{value:function(a,c,d){var e;if(!GLTFViewer.Utils.IsNull(this.iFrame)&&GLTFViewer.GetElementVisible(this.iFrame)){if(!this.iFrameMenu)return;e=$([]).add(this.iFrameMenu)}else d||(a&&this.popup2&&this.popup2.callback(),e=$([]).add(this.menu),this.popup1&&(e=e.add(this.popup1.menu)));e&&(e.stop(),e.fadeTo(c?c:0,a?.2:1))}},NoopBtnState:{value:function(){}},
FullBtnState:{value:function(a,c){if(this.wantFull)switch(c){case GLTFViewer.MENURESET:this.isFull&&this.FullBtnState(a,GLTFViewer.MENUCLICK);break;case GLTFViewer.MENUCLICK:this.isFull?(this.isFull=!1,this.rootContainer.detach(),this.rootContainer.appendTo(this.nonFullContainer),this.fullContainer.css("visibility","hidden"),this.body.css("overflow",this.bodyOverflow),this.ViewportBtnState(a,GLTFViewer.MENUENABLE),0!==this.viewportNumber&&(this.FileManagerBtnState(a,GLTFViewer.MENUHIDE),this.OptionsBtnState(a,
GLTFViewer.MENUHIDE),this.AboutBtnState(a,GLTFViewer.MENUHIDE)),this.controllingViewer.FileManagerBtnState(a,GLTFViewer.MENUSHOW),this.SetupViewports(this.viewportLayout)):(this.isFull=!0,this.rootContainer.detach(),this.rootContainer.appendTo(this.fullContainer),this.fullContainer.css("visibility","visible"),this.bodyOverflow=this.body.css("overflow"),this.body.css("overflow","hidden"),0!==this.viewportNumber&&this.controllingViewer.FileManagerBtnState(a,GLTFViewer.MENUHIDE),this.ViewportBtnState(a,
GLTFViewer.MENUDISABLE),this.FileManagerBtnState(a,GLTFViewer.MENUSHOW),this.OptionsBtnState(a,GLTFViewer.MENUSHOW),this.AboutBtnState(a,GLTFViewer.MENUSHOW),this.SetupFullViewport(this.viewportNumber));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.fullBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.fullBtn,!1);break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.fullBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.fullBtn,
!1)}}},FileBtnState:{value:function(a,c){if(this.wantFile)switch(c){case GLTFViewer.MENURESET:this.FileBtnState(a,GLTFViewer.MENUHIDE);break;case GLTFViewer.MENUCLICK:this.inputFile._ctrlKey=a.ctrlKey;this.inputFile._shiftKey=a.shiftKey;this.inputFile._altKey=a.altKey;this.inputFile.click();break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.fileBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.fileBtn,!1)}}},OptionsBtnState:{value:function(a,c){if(this.wantOptions)switch(c){case GLTFViewer.MENURESET:this.OptionsBtnState(a,
GLTFViewer.MENUHIDE);break;case GLTFViewer.MENUCLICK:this.controllingViewer.Options();break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.optionsBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.optionsBtn,!1)}}},ViewportBtnState:{value:function(a,c){if(this.wantViewport)switch(c){case GLTFViewer.MENURESET:this.ViewportMenuBtnState(null,a,GLTFViewer.MENURESET);this.ViewportBtnState(a,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.viewportMenu)?
this.ViewportBtnState(a,GLTFViewer.MENUCLOSE):this.ViewportBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(this.viewportMenu)||(this.popup1&&this.popup1.callback(),this.popup1={menu:this.viewportMenu,callback:this.ViewportBtnState.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.viewportMenu,!0));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(this.viewportMenu)&&(this.popup1&&this.popup1.menu===this.viewportMenu&&(this.popup1=
null),GLTFViewer.SetElementVisible(this.viewportMenu,!1));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.viewportBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.viewportBtn,!1);break;case GLTFViewer.MENUSHOW:this.ViewportBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.viewportBtn,!0);break;case GLTFViewer.MENUHIDE:this.ViewportBtnState(a,GLTFViewer.MENURESET),GLTFViewer.SetElementVisible(this.viewportBtn,!1)}}},ViewportMenuBtnState:{value:function(a,
c,d){if(this.wantViewport&&this.viewportMenuBtns)switch(d){case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.viewportMenu)?this.ViewportBtnState(c,GLTFViewer.MENUCLOSE):this.ViewportBtnState(c,GLTFViewer.MENUOPEN);if(this.scene)switch(a){case 0:this.SetupViewports(1);break;case 1:this.SetupViewports(2);break;case 2:this.SetupViewports(4);break;case 3:this.ViewportMenuBtnState(a,null,this.viewportLock?GLTFViewer.MENUUNCHECK:GLTFViewer.MENUCHECK)}break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.viewportMenuBtns[a],
!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.viewportMenuBtns[a],!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.viewportMenuBtns[a],!0);3===a&&(this.viewportLock=!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.viewportMenuBtns[a],!1);3===a&&(this.viewportLock=!1);break;case GLTFViewer.MENUUNCHECKALL:this.viewportMenuBtns.forEach(function(a,c){this.ViewportMenuBtnState(c,null,GLTFViewer.MENUUNCHECK)}.bind(this))}}},SaveBtnState:{value:function(a,
c){if(this.wantSave)switch(c){case GLTFViewer.MENURESET:this.SaveBtnState(a,GLTFViewer.MENUHIDE);break;case GLTFViewer.MENUCLICK:this.hasNodeJS?this.SaveAVZ():this.isServed&&this.PostChanges();break;case GLTFViewer.MENUENABLE:this.canSave&&GLTFViewer.SetElementEnable(this.saveBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.saveBtn,!1);break;case GLTFViewer.MENUSHOW:this.canSave&&GLTFViewer.SetElementVisible(this.saveBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.saveBtn,
!1)}}},FileManagerBtnState:{value:function(a,c){switch(c){case GLTFViewer.MENURESET:this.FileManagerBtnState(a,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUCLICK:this.fileManager.IsPanelVisible()?this.FileManagerBtnState(a,GLTFViewer.MENUCLOSE):this.FileManagerBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:this.fileManager.ShowPanel(!0);GLTFViewer.SetElementVisible(this.FileManagerBtn,!1);break;case GLTFViewer.MENUCLOSE:this.fileManager.IsPanelVisible()&&(this.fileManager.ShowPanel(!1),
GLTFViewer.SetElementVisible(this.FileManagerBtn,!0));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.FileManagerBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.FileManagerBtn,!1);break;case GLTFViewer.MENUSHOW:this.fileManager.IsPanelVisible(!0)||GLTFViewer.SetElementVisible(this.FileManagerBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.FileManagerBtn,!1)}}},ZoomBtnState:{value:function(a,c){if(this.wantZoom)switch(c){case GLTFViewer.MENUCLICK:this.scene&&
this.scene.navigator.ZoomExtents(!0);break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.zoomBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.zoomBtn,!1)}}},SelectionBtnState:{value:function(a,c,d){if(this.wantSelection)switch(c){case GLTFViewer.MENURESET:this.SelectionMenuBtnState(null,a,GLTFViewer.MENURESET);this.scene&&this.scene.SetSelectionMode(GLTFViewer.SELECTION_NONE);GLTFViewer.SetElementCheck(this.selectionBtn,!1);this.SelectionBtnState(a,GLTFViewer.MENUCLOSE);
break;case GLTFViewer.MENUICON:this.SetUpMenuBtn(this.selectionBtn,d);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.selectionMenu)?this.SelectionBtnState(a,GLTFViewer.MENUCLOSE):this.SelectionBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(this.selectionMenu)||(this.popup1&&this.popup1.callback(),this.popup1={menu:this.selectionMenu,callback:this.SelectionBtnState.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.selectionMenu,
!0),this.scene&&this.scene.SetSelectionMode(this.scene.GetSelectionMode()));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(this.selectionMenu)&&(this.popup1&&this.popup1.menu===this.selectionMenu&&(this.popup1=null),GLTFViewer.SetElementVisible(this.selectionMenu,!1));break;case GLTFViewer.MENUSHOW:this.SelectionBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.selectionBtn,!0);break;case GLTFViewer.MENUHIDE:this.SelectionBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.selectionBtn,
!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.selectionBtn,!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.selectionBtn,!1)}}},SelectionMenuBtnState:{value:function(a,c,d){if(this.wantSelection)switch(d){case GLTFViewer.MENUCLICK:this.scene&&(a===this.scene.GetSelectionMode()?this.scene.SetSelectionMode(GLTFViewer.SELECTION_NONE):this.SetSelectionMode(a));this.SelectionBtnState(c,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.selectionMenuBtns[a],
!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.selectionMenuBtns[a],!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.selectionMenuBtns[a],!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.selectionMenuBtns[a],!1);break;case GLTFViewer.MENUUNCHECKALL:this.selectionMenuBtns.forEach(function(a,c){this.SelectionMenuBtnState(c,null,GLTFViewer.MENUUNCHECK)}.bind(this))}}},ClipBtnState:{value:function(a,c){if(this.wantClip)switch(c){case GLTFViewer.MENURESET:this.ClipMenuBtnState(null,
a,GLTFViewer.MENURESET);this.ClipBtnState(a,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.clipMenu)?this.ClipBtnState(a,GLTFViewer.MENUCLOSE):this.ClipBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(this.clipMenu)||(this.popup1&&this.popup1.callback(),this.popup1={menu:this.clipMenu,callback:this.ClipBtnState.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.clipMenu,!0),this.scene&&(this.scene.ClipState=
this.scene.ClipState,this.scene.ClipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(this.clipMenu)&&(this.popup1&&this.popup1.menu===this.clipMenu&&(this.popup1=null),GLTFViewer.SetElementVisible(this.clipMenu,!1),this.scene&&(this.scene.ClipDrawMode!==GLTFViewer.Utils.Clip.DRAWMODE_DONE&&this.scene.ClipDrawMode!==GLTFViewer.Utils.Clip.DRAWMODE_MOVE&&(this.scene.ClipState=GLTFViewer.Utils.Clip.STATE_DISABLED),this.scene.ClipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE));
break;case GLTFViewer.MENUSHOW:this.ClipBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.clipBtn,!0);break;case GLTFViewer.MENUHIDE:this.ClipBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.clipBtn,!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.clipBtn,!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.clipBtn,!1)}}},ClipMenuBtnState:{value:function(a,c,d){if(this.wantClip&&this.clipMenuBtns)switch(d){case GLTFViewer.MENURESET:this.scene&&
(this.scene.ClipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE,this.scene.ClipState=GLTFViewer.Utils.Clip.STATE_DISABLED);this.ClipMenuBtnState(3,c,GLTFViewer.MENUHIDE);break;case GLTFViewer.MENUCLICK:if(this.scene)switch(a){case 0:case 1:case 2:case 3:case 4:this.scene.ClipState=a===this.scene.ClipState-GLTFViewer.Utils.Clip.STATE_Z?GLTFViewer.Utils.Clip.STATE_DISABLED:a+GLTFViewer.Utils.Clip.STATE_Z;break;case 5:this.scene.ClipDrawMode=this.scene.ClipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_MOVE?
GLTFViewer.Utils.Clip.DRAWMODE_DONE:GLTFViewer.Utils.Clip.DRAWMODE_MOVE}break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.clipMenuBtns[a],!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.clipMenuBtns[a],!1);break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.clipMenuBtns[a],!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.clipMenuBtns[a],!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.clipMenuBtns[a],!0);break;
case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.clipMenuBtns[a],!1);break;case GLTFViewer.MENUUNCHECKALL:this.clipMenuBtns.forEach(function(a,c){this.ClipMenuBtnState(c,null,GLTFViewer.MENUUNCHECK)}.bind(this))}}},MarkupBtnState:{value:function(a,c){if(this.wantMarkup)switch(c){case GLTFViewer.MENURESET:this.MarkupMenuBtnState(null,a,GLTFViewer.MENURESET);this.MarkupBtnState(a,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.markupMenu)?this.MarkupBtnState(a,
GLTFViewer.MENUCLOSE):this.MarkupBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(this.markupMenu)||(this.popup1&&this.popup1.callback(),this.popup1={menu:this.markupMenu,callback:this.MarkupBtnState.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.markupMenu,!0),this.SelectionBtnState(null,GLTFViewer.MENURESET),this.scene&&(this.scene.MarkupLineType=this.scene.MarkupLineType,this.scene.MarkupLineShape=this.scene.MarkupLineShape,this.scene.MarkupLineColor=
this.scene.MarkupLineColor,this.scene.MarkupFontColor=this.scene.MarkupFontColor,this.scene.MarkupBackColor=this.scene.MarkupBackColor,this.scene.MarkupFontSize=this.scene.MarkupFontSize,this.scene.MarkupState=GLTFViewer.Utils.Markup.STATE_ENABLED));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(this.markupMenu)&&(this.popup1&&this.popup1.menu===this.markupMenu&&(this.popup1=null,this.popup2&&this.popup2.callback()),GLTFViewer.SetElementVisible(this.markupMenu,!1),this.MarkupMenuBtnState(null,
a,GLTFViewer.MENUCLOSEALL),this.scene&&(this.scene.MarkupState=GLTFViewer.Utils.Markup.STATE_DISABLED));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.markupBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.markupBtn,!1);break;case GLTFViewer.MENUSHOW:this.MarkupBtnState(a,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(this.markupBtn,!0);break;case GLTFViewer.MENUHIDE:this.MarkupBtnState(a,GLTFViewer.MENURESET),GLTFViewer.SetElementVisible(this.markupBtn,
!1)}}},MarkupMenuBtnState:{value:function(a,c,d,e){function f(a,c,d){c(d);this.MarkupMenuBtnState(a,null,GLTFViewer.MENUCLOSE)}if(this.wantMarkup&&this.markupMenuMenus)switch(d){case GLTFViewer.MENURESET:this.MarkupMenuBtnState(null,c,GLTFViewer.MENUCLOSEALL);break;case GLTFViewer.MENUICON:switch(a){case GLTFViewer.markupMenuBtnsLineShape:this.SetUpMenuBtn(this.markupMenuBtns[a],e);break;case GLTFViewer.markupMenuBtnsLineColor:this.SetUpMenuBtn(this.markupMenuBtns[a],GLTFViewer.ICONLINECOLOR,null,
e);break;case GLTFViewer.markupMenuBtnsFontColor:this.SetUpMenuBtn(this.markupMenuBtns[a],GLTFViewer.ICONFONTCOLOR,null,e);break;case GLTFViewer.markupMenuBtnsBackColor:this.SetUpMenuBtn(this.markupMenuBtns[a],GLTFViewer.ICONBACKCOLOR,null,e);break;case GLTFViewer.markupMenuBtnsFontSize:this.markupFontSize[0].value=e}break;case GLTFViewer.MENUCLICK:switch(a){case GLTFViewer.markupMenuBtns2D:case GLTFViewer.markupMenuBtns3D:this.scene&&(this.scene.MarkupLineType=GLTFViewer.Utils.Markup.LINE_TYPE_2D+
a);break;case GLTFViewer.markupMenuBtnsLineShape:case GLTFViewer.markupMenuBtnsLineColor:case GLTFViewer.markupMenuBtnsFontColor:case GLTFViewer.markupMenuBtnsBackColor:GLTFViewer.GetElementVisible(this.markupMenuMenus[a])?this.MarkupMenuBtnState(a,c,GLTFViewer.MENUCLOSE):this.MarkupMenuBtnState(a,c,GLTFViewer.MENUOPEN);break;case GLTFViewer.markupMenuBtnsFontSize:GLTFViewer.Utils.IsNull(e)||(this.scene.MarkupFontSize=e)}break;case GLTFViewer.MENUOPEN:switch(a){case GLTFViewer.markupMenuBtnsLineShape:case GLTFViewer.markupMenuBtnsLineColor:case GLTFViewer.markupMenuBtnsFontColor:case GLTFViewer.markupMenuBtnsBackColor:if(GLTFViewer.GetElementVisible(this.markupMenuMenus[a])||
(this.popup2&&this.popup2.callback(),this.popup2={menu:this.markupMenuMenus[a],callback:this.MarkupMenuBtnState.bind(this,a,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.markupMenuMenus[a],!0)),this.scene)switch(a){case GLTFViewer.markupMenuBtnsLineColor:this.AttachColorPickerPanel(this.markupMenuMenus[a],f.bind(this,a,function(a){this.scene.MarkupLineColor=a}.bind(this)));break;case GLTFViewer.markupMenuBtnsFontColor:this.AttachColorPickerPanel(this.markupMenuMenus[a],f.bind(this,
a,function(a){this.scene.MarkupFontColor=a}.bind(this)));break;case GLTFViewer.markupMenuBtnsBackColor:this.AttachColorPickerPanel(this.markupMenuMenus[a],f.bind(this,a,function(a){a=a.Clone();a.a=a.a?127:0;this.scene.MarkupBackColor=a}.bind(this)))}}break;case GLTFViewer.MENUCLOSE:switch(a){case GLTFViewer.markupMenuBtnsLineShape:case GLTFViewer.markupMenuBtnsLineColor:case GLTFViewer.markupMenuBtnsFontColor:case GLTFViewer.markupMenuBtnsBackColor:GLTFViewer.GetElementVisible(this.markupMenuMenus[a])&&
(this.popup2&&this.popup2.menu===this.markupMenuMenus[a]&&(this.popup2=null),GLTFViewer.SetElementVisible(this.markupMenuMenus[a],!1))}break;case GLTFViewer.MENUCLOSEALL:this.markupMenuMenus.forEach(function(a,c){this.MarkupMenuBtnState(c,null,GLTFViewer.MENUCLOSE)}.bind(this));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.markupMenuBtns[a],!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.markupMenuBtns[a],!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.markupMenuBtns[a],
!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.markupMenuBtns[a],!1)}}},MarkupLineShapeBtnState:{value:function(a,c,d){if(this.wantMarkup)switch(d){case GLTFViewer.MENUCLICK:this.scene&&(this.scene.MarkupLineShape=GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE+a),this.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineShape,null,GLTFViewer.MENUCLOSE)}}},ExplodeBtnState:{value:function(a,c){if(this.wantExplode)switch(c){case GLTFViewer.MENURESET:this.SetExplodeSlider(0,!0);this.ExplodeBtnState(null,
GLTFViewer.MENUUNCHECK);this.ExplodeBtnState(a,GLTFViewer.MENUCLOSE);this.ExplodeBtnState(a,GLTFViewer.MENUHIDE);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(this.explodeMenu)?this.ExplodeBtnState(a,GLTFViewer.MENUCLOSE):this.ExplodeBtnState(a,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(this.explodeMenu)||(this.popup1&&this.popup1.callback(),this.popup1={menu:this.explodeMenu,callback:this.ExplodeBtnState.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(this.explodeMenu,
!0));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(this.explodeMenu)&&(this.popup1&&this.popup1.menu===this.explodeMenu&&(this.popup1=null),GLTFViewer.SetElementVisible(this.explodeMenu,!1));break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(this.explodeBtn,!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(this.explodeBtn,!1);break;case GLTFViewer.MENUSHOW:GLTFViewer.SetElementVisible(this.explodeBtn,!0);break;case GLTFViewer.MENUHIDE:GLTFViewer.SetElementVisible(this.explodeBtn,
!1);break;case GLTFViewer.MENUCHECK:GLTFViewer.SetElementCheck(this.explodeBtn,!0);break;case GLTFViewer.MENUUNCHECK:GLTFViewer.SetElementCheck(this.explodeBtn,!1)}}},_AboutBtnState:{value:function(a,c,d,e,f,g){if(this.wantAbout){var k=arguments.callee.bind(this,a,c,d,e);switch(g){case GLTFViewer.MENURESET:e(c,d,k,null,f,GLTFViewer.MENURESET);k(f,GLTFViewer.MENUCLOSE);break;case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(d)?k(f,GLTFViewer.MENUCLOSE):k(f,GLTFViewer.MENUOPEN);break;case GLTFViewer.MENUOPEN:GLTFViewer.GetElementVisible(d)||
(this.popup1&&this.popup1.callback(),this.popup1={menu:d,callback:k.bind(this,null,GLTFViewer.MENUCLOSE)},GLTFViewer.SetElementVisible(d,!0));break;case GLTFViewer.MENUCLOSE:GLTFViewer.GetElementVisible(d)&&(this.popup1&&this.popup1.menu===d&&(this.popup1=null),GLTFViewer.SetElementVisible(d,!1));break;case GLTFViewer.MENUSHOW:k(f,GLTFViewer.MENURESET);GLTFViewer.SetElementVisible(a,!0);break;case GLTFViewer.MENUHIDE:k(f,GLTFViewer.MENURESET),GLTFViewer.SetElementVisible(a,!1)}}}},_AboutMenuBtnState:{value:function(a,
c,d,e,f,g){if(this.wantAbout)switch(g){case GLTFViewer.MENUCLICK:GLTFViewer.GetElementVisible(c)?d(f,GLTFViewer.MENUCLOSE):d(f,GLTFViewer.MENUOPEN);switch(e){case 0:this.ShowHelp();break;case 1:this.ShowAboutDialog(!0)}break;case GLTFViewer.MENUCLOSE:switch(e){case 1:this.ShowAboutDialog(!1)}break;case GLTFViewer.MENUENABLE:GLTFViewer.SetElementEnable(a[e],!0);break;case GLTFViewer.MENUDISABLE:GLTFViewer.SetElementEnable(a[e],!1)}}},ContainerKeyDown:{value:function(a){(GLTFViewer.Utils.IsNull(this.aboutDialog)||
GLTFViewer.GetElementVisible(this.aboutDialog.box))&&a.stopPropagation()}},ContainerContextMenu:{value:function(a){a&&a.preventDefault&&a.preventDefault();var c=this.NumFiles();if(this.scene&&(this.scene.handler||c))if(this.scene.OkToShowContextMenu()){var d=[],e=null,f=null;if(this.wantFile&&(e=[],d.push(GLTFViewer.CM_FILE_CLOSE_FILE),e.push(null),c)){var g=[GLTFViewer.CM_MAIN_SELECT_FILE],k=[null],f=this.FileNames(),g=g.concat(f);d.push(g);g=this.FilePaths();k=k.concat(g);e.push(k);d.push("-")}d.push(GLTFViewer.CM_MAIN_HIDE_BODY);
this.wantPropertyEdit&&d.push(GLTFViewer.CM_MAIN_EDIT_PROPERTIES);d.push(GLTFViewer.CM_MAIN_CREATE_PROBE,"-",GLTFViewer.CM_MAIN_RESET_VIEW,GLTFViewer.CM_MAIN_SAVE_VIEW,GLTFViewer.CM_MAIN_DELETE_VIEW);this.wantSTLExport?d.push([GLTFViewer.CM_MAIN_SAVE_IMAGE,GLTFViewer.CM_MAIN_SAVE_IMAGE_PNG,GLTFViewer.CM_MAIN_SAVE_IMAGE_STL]):d.push(GLTFViewer.CM_MAIN_SAVE_IMAGE);this.contextMenuContainer=new GLTFViewer.Utils.SimpleContextMenu(this,this.controllingViewer.body,d,e,function(a,c){var d=a[0],e=a[1],f=
2<a.length?a[2]:"";if(this.scene)switch(d){case GLTFViewer.CM_FILE_CLOSE_FILE:this.CloseFile();break;case GLTFViewer.CM_MAIN_HIDE_BODY:this.scene.handler.HideBody(c);break;case GLTFViewer.CM_MAIN_EDIT_PROPERTIES:this.scene.handler.EditProperties(c);break;case GLTFViewer.CM_MAIN_CREATE_PROBE:this.scene.MarkupCreate3D();break;case GLTFViewer.CM_MAIN_RESET_VIEW:this.scene.ResetScene();break;case GLTFViewer.CM_MAIN_SAVE_VIEW:d=this.scene.handler.CurScene;new GLTFViewer.Utils.Dialog("New View Name",[["View Name",
GLTFViewer.Utils.Dialog.DATATEXT,d?d.name+"_Copy":"View"]],!0,function(a,c){a&&c[0]&&c[0].length&&this.scene.handler.CreateScene(c[0])}.bind(this));break;case GLTFViewer.CM_MAIN_DELETE_VIEW:d=this.scene.handler.CurScene;d.editable&&this.scene.handler.DeleteScene(d);break;case GLTFViewer.CM_MAIN_SAVE_IMAGE:case GLTFViewer.CM_MAIN_SAVE_IMAGE_PNG:this.SaveImage();break;case GLTFViewer.CM_MAIN_SAVE_IMAGE_STL:this.SaveSTL();break;default:f===GLTFViewer.CM_MAIN_SELECT_FILE&&this.SelectFile(e)}}.bind(this));
this.scene.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW&&this.ClipMenuBtnState(null,a,GLTFViewer.MENURESET);this.scene.MarkupDelete();d={};if(this.wantFile&&(GLTFViewer.Utils.IsNull(this.ActiveFileObj())||(d[GLTFViewer.CM_FILE_CLOSE_FILE]=1),c))for(d[GLTFViewer.CM_MAIN_SELECT_FILE]=1,c=0;c<f.length;++c)d[f[c]]=1;if(this.scene.handler){d[GLTFViewer.CM_MAIN_SAVE_IMAGE]=1;d[GLTFViewer.CM_MAIN_SAVE_IMAGE_PNG]=1;this.wantSTLExport&&(d[GLTFViewer.CM_MAIN_SAVE_IMAGE_STL]=1);(f=this.scene.AnimationStopped())&&
(d[GLTFViewer.CM_MAIN_RESET_VIEW]=1);var h=this.scene.HitIndx();this.scene.handler.CurScene&&(this.canSave&&(d[GLTFViewer.CM_MAIN_SAVE_VIEW]=1,this.scene.handler.CurScene.editable&&f&&(d[GLTFViewer.CM_MAIN_DELETE_VIEW]=1)),!GLTFViewer.Utils.IsNull(h)&&0<=h&&f&&(d[GLTFViewer.CM_MAIN_HIDE_BODY]=1,this.wantPropertyEdit&&(d[GLTFViewer.CM_MAIN_EDIT_PROPERTIES]=1),this.scene.handler.CanMarkup&&this.scene.MarkupState===GLTFViewer.Utils.Markup.STATE_DISABLED&&GLTFViewer.GetElementEnable(this.markupBtn)&&
this.scene.AnyHit()&&0<=this.scene.HitIndx()&&(d[GLTFViewer.CM_MAIN_CREATE_PROBE]=1)))}this.contextMenuContainer.Show(!0,a,d,h)}else(h=this.scene.MarkupHit)&&this.scene.MarkupEditable(h)&&(d={},d[GLTFViewer.CM_MARKUP_DELETE_MARKUP]=1,this.contextMenuMarkup.Show(!0,a,d,h))}},CurrentSceneState:{value:function(){return this.scene&&this.scene.handler?this.scene.handler.GetSceneState():null}},SetTitle:{value:function(a,c,d,e){if(!this.isEKM&&!this.isReport&&this.messageHandler)if("READ"===a){if(0===this.viewportNumber){GLTFViewer.Utils.IsNull(this._titles)&&
(this._titles={});GLTFViewer.Utils.IsNull(e)||(e.length?this._titles[c]=e:delete this._titles[c]);a="ANSYS Viewer";if(1===this.viewportLayout||2===this.viewportLayout&&!this.viewer1.isFull||4===this.viewportLayout&&!this.viewer1.isFull&&!this.viewer2.isFull&&!this.viewer3.isFull)a=a+" - "+(this._titles[0]?this._titles[0]:"");if(2===this.viewportLayout&&!this.isFull||4===this.viewportLayout&&!this.isFull&&!this.viewer2.isFull&&!this.viewer3.isFull)a=a+" - "+(this._titles[1]?this._titles[1]:"");4!==
this.viewportLayout||this.isFull||this.viewer1.isFull||this.viewer3.isFull||(a=a+" - "+(this._titles[2]?this._titles[2]:""));4!==this.viewportLayout||this.isFull||this.viewer1.isFull||this.viewer2.isFull||(a=a+" - "+(this._titles[3]?this._titles[3]:""));"ANSYS Viewer - "===a&&(a="ANSYS Viewer");document.title=a;window.resizeBy(0,-1);window.resizeBy(0,1)}}else"REFRESH"===a?this.messageHandler.SendMessage(GLTFViewer.MSGTITLE,null):this.messageHandler.SendMessage(GLTFViewer.MSGTITLE,c)}},ReadFile:{value:function(a,
c,d,e,f,g){function k(a,c,d,e,f,h,g,k){this.scene.EnableUpdate(!0);d===GLTFViewer.FT_GLTF||d===GLTFViewer.FT_AVZ?(this.SelectionMenuBtnState(0,null,GLTFViewer.MENUDISABLE),this.SelectionMenuBtnState(1,null,GLTFViewer.MENUDISABLE),(d===GLTFViewer.FT_AVZ||this.isServed)&&this.canSave?this.SaveBtnState(null,GLTFViewer.MENUSHOW):this.SaveBtnState(null,GLTFViewer.MENUHIDE)):(this.ClipMenuBtnState(3,null,GLTFViewer.MENUSHOW),this.SelectionMenuBtnState(0,null,GLTFViewer.MENUENABLE),this.SelectionMenuBtnState(1,
null,GLTFViewer.MENUENABLE),this.SaveBtnState(null,GLTFViewer.MENUHIDE));this.ZoomBtnState(null,GLTFViewer.MENUSHOW);e.CanExplode&&this.ExplodeBtnState(null,GLTFViewer.MENUSHOW);this.ShowSceneAnimation(e.HasAnimation());if(k){if(d===GLTFViewer.FT_AVZ)if("string"!==typeof h){for(var l=function(a){GLTFViewer.Utils.IsNull(a)||n(a,"markup")},n=function(a,c,d){try{var f=JSON.parse(a);"markup"==c?e.ReadMarkups(f):e.ReadViews(f,d,m)}catch(h){GLTFViewer.Utils.WriteErr("ERROR(ReadFile:"+B+"): "+h+" in "+c+
" data")}},E,A,D=Object.keys(h),H=0;H<D.length;++H){var B=D[H];e.CanMarkup&&0<B.search(/\.mup$/)?E=h[B]:e.CanCreateViews&&0<B.search(/\.view$/)&&(A=h[B])}GLTFViewer.Utils.IsNull(A)?GLTFViewer.Utils.IsNull(E)||n(E,"markup"):n(A,"view",l.bind(this,E))}else{h=function(a){GLTFViewer.Utils.IsNull(a)||N(a,"markup")};var N=function(a,c,d){require("fs").readFile(a,function(a,c,d,f){if(d)GLTFViewer.Utils.WriteErr("ERROR(ReadFile): "+d+" in "+a+" data");else{var h;try{h=JSON.parse(f)}catch(g){GLTFViewer.Utils.WriteErr("ERROR(ReadFile): "+
g+" in "+a+" data");return}"markup"==a?e.ReadMarkups(h):e.ReadViews(h,c,m)}}.bind(this,c,d))};this.saveMUPName=e.CanMarkup?this.tmpDir.FindFile(/\.mup$/):null;this.saveViewName=e.CanCreateViews?this.tmpDir.FindFile(/\.view$/):null;GLTFViewer.Utils.IsNull(this.saveViewName)?GLTFViewer.Utils.IsNull(this.saveMUPName)||N(this.saveMUPName,"markup"):N(this.saveViewName,"view",h.bind(this,this.saveMUPName))}else if(d===GLTFViewer.FT_GLTF)if(h){var l=function(a){GLTFViewer.Utils.IsNull(a)||K(a,"markup")},
K=function(a,c,d){var f=new FileReader;f.onloadend=function(a,c,d,f){if(GLTFViewer.Utils.IsNull(f.target.result)||!GLTFViewer.Utils.IsNull(f.target.error))GLTFViewer.Utils.WriteErr("ERROR(ReadFile:"+a+"): bad "+c+" data");else{var h;try{h=JSON.parse(f.target.result)}catch(g){GLTFViewer.Utils.WriteErr("ERROR(ReadFile:"+a+"): "+g+" in "+c+" data");return}"markup"==c?e.ReadMarkups(h):e.ReadViews(h,d,m)}}.bind(this,GLTFViewer.Utils.GetFilePath(a),c,d);f.readAsText(a)},F,Y;for(Y in h)D=h[Y],E=GLTFViewer.GetFileType(GLTFViewer.Utils.GetFilePath(D)),
e.CanMarkup&&E===GLTFViewer.FT_MUP?H=D:e.CanCreateViews&&E===GLTFViewer.FT_VIEW&&(F=D);GLTFViewer.Utils.IsNull(F)?GLTFViewer.Utils.IsNull(H)||K(H,"markup"):K(F,"view",l.bind(this,H))}else{h=function(a){GLTFViewer.Utils.IsNull(a)||C(a,"markup")};var C=function(a,c,d){GLTFViewer.Utils.FileGLTF.LoadJSON(a,!0,function(a,c,d){d?"markup"==a?e.ReadMarkups(d):e.ReadViews(d,c,m):GLTFViewer.Utils.IsNull(c)||c()}.bind(this,c,d))};A=GLTFViewer.Utils.GetEKMBasePath(a);E=A.ekmUrlParamNameContextIdValue;A=A.pathBase;
e.CanMarkup&&(l=GLTFViewer.Utils.ResolveEKMPath(E,A,"file.mup"));e.CanCreateViews&&(D=GLTFViewer.Utils.ResolveEKMPath(E,A,"file.view"));GLTFViewer.Utils.IsNull(D)?GLTFViewer.Utils.IsNull(l)||C(l,"markup"):C(D,"view",h.bind(this,l))}this.scene.CanSelect()&&this.SelectionBtnState(null,GLTFViewer.MENUSHOW);g&&g(!0)}else g&&g(!1)}var h=c._file,l=c._fileType;c=GLTFViewer.Utils.IsNull(g)?c._loadType:g;var m=c===GLTFViewer.LT_REPLACE?null:this.CurrentSceneState(),h=GLTFViewer.Utils.GetFilePath(h),n;if(l===
GLTFViewer.FT_MUP)this.MarkupBtnState(null,GLTFViewer.MENURESET),(n=this.scene.handler)&&n.ReadMarkups(d),f&&f(!0);else if(l===GLTFViewer.FT_VIEW)(n=this.scene.handler)&&n.ReadViews(d,null,m),f&&f(!0);else{this.CloseFile(c!==GLTFViewer.LT_REPLACE);if(l===GLTFViewer.FT_GLTF||l===GLTFViewer.FT_AVZ)try{this.scene.handler instanceof GLTFViewer.Utils.FileGLTF?(n=this.scene.handler,n._fileType=l,n._data=d,n._other=e):n=new GLTFViewer.Utils.FileGLTF(this.scene,l,d,e)}catch(p){f&&f(!1);return}else try{n=
new GLTFViewer.Utils.FileSpaceClaim(this.scene,l,d,e)}catch(p){f&&f(!1);return}this.ShowSceneAnimation(!1);this.scene.EnableUpdate(!1);this.scene.ReadFile(n,k.bind(this,a,h,l,n,d,e,f),c,m)}}},ParseArrayBuffer:{value:function(a,c,d,e){function f(a,c,d,e,f){for(var g=c._fileType,q=null,u={},r=Object.keys(a.entries),w=null,t=0;t<r.length;++t)if(w=r[t],GLTFViewer.Utils.IsNull(q)&&GLTFViewer.GetFileType(w)===GLTFViewer.FT_GLTF){q=a.entries[w];break}else g===GLTFViewer.FT_AVZM&&GLTFViewer.GetFileType(w)===
GLTFViewer.FT_AVZ&&(u[w]=a.entries[w]);if(q){var x;try{x=JSON.parse(q)}catch(y){GLTFViewer.Utils.WriteErr("ERROR(ParseArrayBuffer:"+d+"): "+y+" in JSON data");e&&e(!1);return}this.ReadFile(w,c,x,a.entries,e,f)}else{this.RemoveFile(c);a=Object.keys(u);if(a.length){f=-1;g=null;r=[];for(t=0;t<a.length;t++)w=a[t],GLTFViewer.GetFileType(w)===GLTFViewer.FT_AVZ&&(q=u[w],x=this.FindFile(w,c._file),0>x&&(x=this.AddFile(w,GLTFViewer.FT_AVZ,GLTFViewer.LT_REPLACE,q,c._file,r),0<=x&&r.push(this.Files()[x])),0<=
x&&(0>f||x<f)&&(f=x,g=this.Files()[f]));1<r.length&&r.sort(GLTFViewer.FileManager.FileNameCompare);if(g){this.SelectFile(g,e.bind(this,!0));return}}GLTFViewer.Utils.WriteErr("ERROR(ParseArrayBuffer:"+d+"): No '*.avz' found");e&&e(!1)}}var g=GLTFViewer.Utils.GetFilePath(a._file);if(!e.target||GLTFViewer.Utils.IsNull(e.target.error)&&!GLTFViewer.Utils.IsNull(e.target.result))if(e=e.target?e.target.result:e,e=new JSUnzip(e,this.scene.progressBar),e.isZipFile())try{e.readEntries(f.bind(this,e,a,g,c,d))}catch(k){GLTFViewer.Utils.WriteErr(k),
c&&c(!1)}else GLTFViewer.Utils.WriteErr("ERROR(ParseArrayBuffer:"+g+"): cannot be loaded"),c&&c(!1);else GLTFViewer.Utils.WriteErr("ERROR(ParseArrayBuffer:"+g+"): cannot be loaded"),c&&c(!1)}},ReadFromArrayBuffer:{value:function(a,c,d,e){var f=a._fileType,g=GLTFViewer.Utils.GetFilePath(a._file);switch(f){case GLTFViewer.FT_SCDOC:this.ReadFile(g,a,e,null,c,!1);break;case GLTFViewer.FT_AVZ:case GLTFViewer.FT_AVZM:this.ParseArrayBuffer(a,c,d,e);break;default:c&&c(!1)}}},ReadFileObject:{value:function(a,
c,d){var e=a._file,f=a._fileType,g=a._resources,k=GLTFViewer.Utils.GetFilePath(e);switch(f){case GLTFViewer.FT_GLTF:f=new FileReader;f.onloadend=function(a,c,d,e,f,g){if(GLTFViewer.Utils.IsNull(g.target.error))if(GLTFViewer.Utils.IsNull(g.target.result))GLTFViewer.Utils.WriteErr("ERROR(ReadFileObject:"+c+"): bad JSON data"),e&&e(!1);else{var k;try{k=JSON.parse(g.target.result)}catch(r){GLTFViewer.Utils.WriteErr("ERROR(ReadFileObject:"+c+"): "+r+" in JSON data");e&&e(!1);return}this.ReadFile(c,a,k,
d,e,f)}else GLTFViewer.Utils.WriteErr("ERROR(ReadFileObject:"+c+"): cannot be loaded"),e&&e(!1)}.bind(this,a,k,g,c,d);f.readAsText(e);break;case GLTFViewer.FT_AVZ:case GLTFViewer.FT_AVZM:f=new FileReader;f.onloadend=this.ParseArrayBuffer.bind(this,a,c,d);f.readAsArrayBuffer(a._file);break;case GLTFViewer.FT_SCDOC:f=new FileReader;f.onloadend=function(a,c,d,e,f){GLTFViewer.Utils.IsNull(f.target.error)?this.ReadFile(c,a,f.target.result,null,d,e):(GLTFViewer.Utils.WriteErr("ERROR(ReadFileObject:"+c+
"): cannot be loaded"),d&&d(!1))}.bind(this,a,k,c,d);f.readAsArrayBuffer(e);break;default:c&&c(!1)}}},ReadFilePath:{value:function(a,c,d){var e=a._fileType,f=GLTFViewer.Utils.GetFilePath(a._file);switch(e){case GLTFViewer.FT_GLTF:GLTFViewer.Utils.FileGLTF.LoadJSON(f,!1,function(a,c,d,e,f){f?this.ReadFile(c,a,f,null,d,e):d&&d(!1)}.bind(this,a,f,c,d));break;case GLTFViewer.FT_AVZ:case GLTFViewer.FT_AVZM:case GLTFViewer.FT_SCDOC:e={};e.HandleError=function(a,c,d){GLTFViewer.Utils.WriteErr("ERROR(ReadFilePath:"+
c+"): "+d);a&&a(!1)}.bind(this,c);e.HandleProgress=function(a,c,d,e){this.scene.progressBar.Update(e/d*a)}.bind(this,1E4);e.HandleData=function(a,c,d,e,f){this.ReadFromArrayBuffer(a,c,d,f)}.bind(this,a,c,d);this.scene.progressBar.Start(1E4);this.isServed?GLTFViewer.Utils.FileGLTF.LoadStream(f,"arraybuffer",e):GLTFViewer.Utils.FileGLTF.LoadStream(f,"FILE",e);break;default:c&&c(!1)}}},ReadUsingNodeJS:{value:function(a,c,d){var e=a._fileType,f=GLTFViewer.Utils.GetFilePath(a._file);switch(e){case GLTFViewer.FT_GLTF:var g=
require("fs");g.readFile(f,"utf8",function(c,d,e,f,g){if(f)GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS:"+c+"): "+f),d&&d(!1);else{var p;try{p=65279===g.charCodeAt(0)?JSON.parse(g.substring(1)):JSON.parse(g)}catch(q){GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS): "+q+" in JSON data");d&&d(!1);return}this.ReadFile(c,a,p,a._resources,d,e)}}.bind(this,f,c,d));break;case GLTFViewer.FT_ARZ:this.controllingViewer.ReadARZ(f,c);break;case GLTFViewer.FT_AVZ:case GLTFViewer.FT_AVZM:GLTFViewer.FileManager.UnZipFile(a,
function(a,c,d,g){this.tmpDir=g;if(GLTFViewer.Utils.IsNull(this.tmpDir))GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS): Can't decompress '"+f+"'"),c&&c(!1);else if(e===GLTFViewer.FT_AVZ)g=this.tmpDir.FindFile(/\.json$|\.gltf$/),GLTFViewer.Utils.IsNull(g)?(GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS:"+f+"): No '*.gltf' found"),c&&c(!1)):require("fs").readFile(g,"utf8",function(c,d,e,f,h){if(f)GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS:"+c+"): "+f),d&&d(!1);else{var g;try{g=65279===h.charCodeAt(0)?
JSON.parse(h.substring(1)):JSON.parse(h)}catch(l){GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS): "+l+" in JSON data");d&&d(!1);return}this.ReadFile(c,a,g,this.tmpDir.name,d,e)}}.bind(this,g,c,d));else{this.RemoveFile(a);d=this.tmpDir.FindAllFiles(/\.avz$/);if(d.length){g=-1;for(var n=null,p=[],q=0;q<d.length;q++){var u=d[q];if(GLTFViewer.GetFileType(u)===GLTFViewer.FT_AVZ){var r=this.FindFile(u,a._file);0>r&&(r=this.AddFile(u,GLTFViewer.FT_AVZ,GLTFViewer.LT_REPLACE,null,a._file,p),0<=r&&p.push(this.Files()[r]));
0<=r&&(0>g||r<g)&&(g=r,n=this.Files()[g])}}1<p.length&&p.sort(GLTFViewer.FileManager.FileNameCompare);if(n){this.SelectFile(n,c.bind(this,!0));return}}GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS:"+f+"): No '*.avz' found");c&&c(!1)}}.bind(this,a,c,d));break;case GLTFViewer.FT_SCDOC:g=require("fs");g.readFile(f,function(a,c,e,f,g){f?(GLTFViewer.Utils.WriteErr("ERROR(ReadUsingNodeJS:"+c+"): "+f),e&&e(!1)):this.ReadFromArrayBuffer(a,e,d,g)}.bind(this,a,f,c));break;default:c&&c(!1)}}},ShowARZ:{value:function(a){GLTFViewer.Utils.IsNull(this.iFrame)||
GLTFViewer.GetElementVisible(this.iFrame)||(document.title="ANSYS Report Viewer",window.resizeBy(0,-1),window.resizeBy(0,1),GLTFViewer.SetElementVisible(this.rootContainer,!1),GLTFViewer.SetElementVisible(this.iFrame,!0),GLTFViewer.Utils.IsNull(this.iFrameMenu)||(GLTFViewer.SetElementVisible(this.iFrameMenu,!0),this.MenuFade(!0)));this.iFrame.prop("src",a)}},HideARZ:{value:function(){!GLTFViewer.Utils.IsNull(this.iFrame)&&GLTFViewer.GetElementVisible(this.iFrame)&&(this.rootContainer.css("display",
"flex"),this.rootContainer.css("display","-webkit-flex"),GLTFViewer.SetElementVisible(this.iFrame,!1),GLTFViewer.Utils.IsNull(this.iFrameMenu)||GLTFViewer.SetElementVisible(this.iFrameMenu,!1),this.iFrame.prop("src",""),setTimeout(function(){this.UpdateLayout();this.controllingViewer.SetTitle("REFRESH")}.bind(this),1))}},ReadARZ:{value:function(a,c){try{var d=new GLTFViewer.Utils.TempDir(".");(new (require("adm-zip"))(a)).extractAllTo(d.name,!0);var e=d.FindFile(/\.html$|\.htm$/);c&&c(!0);this.ShowARZ(e)}catch(f){GLTFViewer.Utils.WriteErr("ERROR(ReadARZ): Can't decompress '"+
a+"'"),c&&c(!1)}}},LoadFile:{value:function(a,c,d){function e(a,c,d){this.Enable(!0);this.scene.progressBar.Stop();c&&c(d)}try{this.Enable(!1),setTimeout(this._LoadFile.bind(this,a,e.bind(this,a,c),d),0)}catch(f){this.Enable(!0),this.scene.progressBar.Stop(),c&&c(!1)}}},_LoadFile:{value:function(a,c,d){var e=a._file,f=a._fileType,g=a._resources;this.scene?(GLTFViewer.Utils.GetFilePath(e),f===GLTFViewer.FT_UNKNOWN?c&&c(!1):(c=function(a,c,d){d?(this.SetAnimationSlider(this.scene?this.scene.AnimationMinTime():
0,!0),this.SetAnimationMinMaxSpeed(this.scene.AnimationMinTime(),this.scene.AnimationMaxTime())):GLTFViewer.Utils.WriteErr("ERROR(LoadFile): Failed to load '"+GLTFViewer.Utils.GetFilePath(a)+"'");c&&c(d)}.bind(this,e,c),e=e instanceof Object,g instanceof ArrayBuffer?this.ReadFromArrayBuffer(a,c,d,g):this.hasNodeJS?this.ReadUsingNodeJS(a,c,d):e?this.ReadFileObject(a,c,d):this.ReadFilePath(a,c,d))):c&&c(!1)}},AddFiles:{value:function(a,c,d,e,f,g){d=GLTFViewer.GetFileType(null,d);if(!this.scene||GLTFViewer.Utils.IsNull(c))g&&
g(!1);else{if("string"===typeof c||GLTFViewer.Utils.IsNull(c.length))c=[c];var k={};if(1<c.length||!(c[0]instanceof ArrayBuffer)){for(var h=0;h<c.length;h++){var l=c[h],m=GLTFViewer.GetFileType(GLTFViewer.Utils.GetFilePath(l),d);if(m===GLTFViewer.FT_AVZM||m===GLTFViewer.FT_ARZ){c=[l];d=m;break}}if(d===GLTFViewer.FT_UNKNOWN){for(h=0;h<c.length;h++)if(l=c[h],m=GLTFViewer.GetFileType(GLTFViewer.Utils.GetFilePath(l),d),m!==GLTFViewer.FT_UNKNOWN&&m!==GLTFViewer.FT_MUP&&m!==GLTFViewer.FT_VIEW){d=m;break}if(d===
GLTFViewer.FT_UNKNOWN){g&&g(!1);return}}for(var n=[],h=0;h<c.length;++h){var l=c[h],p=GLTFViewer.Utils.GetFileName(GLTFViewer.Utils.GetFilePath(l)),m=GLTFViewer.GetFileType(p);"string"===typeof l&&m===GLTFViewer.FT_UNKNOWN&&(m=d);k[p]=l;m===d&&n.push(l)}c=n}else k=c[0];1<c.length&&(e=GLTFViewer.LT_REPLACE);m=-1;n=null;p=[];for(h=0;h<c.length;h++){var l=c[h],q=GLTFViewer.GetFileType(GLTFViewer.Utils.GetFilePath(l),d);if(q===GLTFViewer.FT_AVZ||q===GLTFViewer.FT_SCDOC||q===GLTFViewer.FT_GLTF||q===GLTFViewer.FT_AVZM||
q===GLTFViewer.FT_ARZ){var u=this.FindFile(l,null);0>u&&(u=this.AddFile(l,q,e,k,null,q!==GLTFViewer.FT_AVZM?p:[]),0<=u&&q!==GLTFViewer.FT_AVZM&&!f&&p.push(this.Files()[u]));0<=u&&(0>m||u<=m)&&(m=u,n=this.Files()[m])}}1<p.length&&p.sort(GLTFViewer.FileManager.FileNameCompare);n?this.GetViewer(a).SelectFile(n,g):g&&g(!1)}}},CanSelect:{value:function(){return this.scene?this.scene.CanSelect():null}},SetSelectionMode:{value:function(a){return this.scene?this.scene.SetSelectionMode(a):null}},GetTopParts:{value:function(){return this.scene?
this.scene.GetTopParts():null}},GetPartName:{value:function(a){return this.scene?this.scene.GetPartName(a):null}},GetPartParent:{value:function(a){return this.scene?this.scene.GetPartParent(a):null}},GetPartParts:{value:function(a){return this.scene?this.scene.GetPartParts(a):null}},GetPartBodys:{value:function(a){return this.scene?this.scene.GetPartBodys(a):null}},GetBodyName:{value:function(a){return this.scene?this.scene.GetBodyName(a):null}},GetRegions:{value:function(){return this.scene?this.scene.GetRegions():
null}},GetRegionName:{value:function(a){return this.scene?this.scene.GetRegionName(a):null}},GetSelections:{value:function(){return this.scene?this.scene.GetSelections():null}},FileOpen:{value:function(){this.inputFile._ctrlKey=!1;this._inputFile._shiftKey=!1;this._inputFile._altKey=!1;this.inputFile.click()}},FileLoad:{value:function(a,c,d,e,f){this.AddFiles(a,c,d,GLTFViewer.Utils.IsNull(e)?GLTFViewer.LT_REPLACE:e,!1,f)}}});
Object.defineProperties(GLTFViewer,{CM_MAIN_SELECT_FILE:{value:"Select File"},CM_MAIN_HIDE_BODY:{value:"Hide Body"},CM_MAIN_EDIT_PROPERTIES:{value:"Edit Properties"},CM_MAIN_CREATE_PROBE:{value:"Create Probe"},CM_MAIN_RESET_VIEW:{value:"Restore Defaults"},CM_MAIN_SAVE_VIEW:{value:"Save View"},CM_MAIN_DELETE_VIEW:{value:"Delete View"},CM_MAIN_SAVE_IMAGE:{value:"Save Image"},CM_MAIN_SAVE_IMAGE_PNG:{value:"PNG"},CM_MAIN_SAVE_IMAGE_STL:{value:"STL"},CM_MARKUP_DELETE_MARKUP:{value:"Delete Markup"},CM_FILE_CLOSE_FILE:{value:"Close File"},
CM_SCENE_RESET_VIEW:{value:"Restore Defaults"},CM_SCENE_COPY_VIEW:{value:"Copy View"},CM_SCENE_DELETE_VIEW:{value:"Delete View"},CM_ENTRY_EDIT_PROPERTIES:{value:"Edit Properties"},FileManagerBtnHelp:{value:"View Manager"},fullHelp:{value:"Expand or restore viewer window"},viewportHelp:{value:"Split Viewer window"},viewportMenuBtnsHelp:{value:["1 Viewport","2 Viewports","4 Viewports","Synchronize viewports"]},fileHelp:{value:"Open local file"},printHelp:{value:"Print file"},closeHelp:{value:"Close file"},
optionsHelp:{value:"Options"},saveHelpLocal:{value:"Save local AVZ file"},saveHelpServed:{value:"Save changes to server"},zoomHelp:{value:"Zoom to fit"},selectionHelp:{value:"Highlight mode"},clipHelp:{value:"Cut plane"},markupHelp:{value:"Markup"},explodeBtnHelp:{value:"Explode Model"},aboutHelp:{value:"Help"},selectionMenuBtnsHelp:{value:["Highlight edge","Highlight face","Highlight body"]},aboutMenuBtnsHelp:{value:["Viewer Help","About"]},clipMenuBtnsHelp:{value:"Cut plane Z;Cut plane X;Cut plane Y;Cut plane by point;Cut plane by three points;Move cut plane".split(";")},
markupMenuBtnsHelp:{value:"2D;3D;Line shape;Line color;Font color;Background color;Font size".split(";")},markupMenuBtns2D:{value:0},markupMenuBtns3D:{value:1},markupMenuBtnsLineShape:{value:2},markupMenuBtnsLineColor:{value:3},markupMenuBtnsFontColor:{value:4},markupMenuBtnsBackColor:{value:5},markupMenuBtnsFontSize:{value:6},markupLineShapeMenuBtnsHelp:{value:["Line","Arrow","Ball"]},BORDERCOLOR:{value:"rgb(152, 168, 169)"},HOVERCOLOR:{value:"rgb(51, 152, 218)"},SELECTCOLOR:{value:"rgb(51, 152, 218)"},
BUTTONCOLOR:{value:"rgb(189, 195, 199)"},MOUSEBUTTONS:{value:"WHEEL LEFT MIDDLE RIGHT SHIFT+LEFT SHIFT+MIDDLE SHIFT+RIGHT CTRL+LEFT CTRL+MIDDLE CTRL+RIGHT CTRL+SHIFT+LEFT CTRL+SHIFT+MIDDLE CTRL+SHIFT+RIGHT".split(" ")},MSGLOCK:{value:"_LOCK_"},MSGIMAGE:{value:"_IMAGE_"},MSGTITLE:{value:"_TITLE_"},TITLEHEIGHT:{value:30},CONTAINER_INNER_MARGIN:{value:5},ICONSEPARATION:{value:8},ICONSIZE:{value:32},ICONNONE:{value:0},ICONFONTSIZE:{value:0},ICONZOOM:{value:1},ICONFILE:{value:2},ICONVIS:{value:3},ICONABOUT:{value:4},
ICONABOUTHELP:{value:4},ICONABOUTABOUT:{value:5},ICONPLAY:{value:6},ICONPAUSE:{value:7},ICONSTOP:{value:8},ICONCLIP:{value:9},ICONCLIP0:{value:10},ICONCLIP1:{value:11},ICONCLIP2:{value:12},ICONCLIP3:{value:13},ICONCLIP4:{value:14},ICONCLIP5:{value:15},ICONFULL:{value:16},ICONMARKUPLINE:{value:17},ICONMARKUPARROW:{value:18},ICONMARKUPBALL:{value:19},ICONMARKUP2D:{value:20},ICONMARKUP3D:{value:21},ICONSAVE:{value:22},ICONFONTCOLOR:{value:23},ICONLINECOLOR:{value:24},ICONBACKCOLOR:{value:25},ICONMARKUP:{value:26},
ICONFF:{value:27},ICONREW:{value:28},ICONLOOP:{value:29},ICONSELECTION:{value:32},ICONSELECTIONEDGE:{value:30},ICONSELECTIONFACE:{value:31},ICONSELECTIONBODY:{value:32},ICONEXPLODE:{value:33},ICONVP1:{value:34},ICONVP2:{value:35},ICONVP4:{value:36},ICONVPLOCK:{value:37},ICONOPTIONS:{value:38},ICONPRINT:{value:39},ICONCLOSE:{value:40},MODENORMAL:{value:0},MODEHOVER:{value:1},MODESELECTED:{value:2},MENURESET:{value:0},MENUICON:{value:1},MENUCLICK:{value:2},MENUOPEN:{value:3},MENUCLOSE:{value:4},MENUCLOSEALL:{value:5},
MENUSHOW:{value:6},MENUHIDE:{value:7},MENUHIDEALL:{value:8},MENUENABLE:{value:9},MENUDISABLE:{value:10},MENUDISABLEALL:{value:11},MENUCHECK:{value:12},MENUUNCHECK:{value:13},MENUUNCHECKALL:{value:14},FT_UNKNOWN:{value:0},FT_GLTF:{value:1},FT_SCDOC:{value:2},FT_AVZ:{value:3},FT_ARZ:{value:4},FT_MUP:{value:5},FT_VIEW:{value:6},FT_AVZM:{value:7},SELECTION_NONE:{value:-1},SELECTION_EDGE:{value:0},SELECTION_FACE:{value:1},SELECTION_BODY:{value:2},LT_REPLACE:{value:0},LT_APPEND:{value:1},LT_UPDATE:{value:2},
DEFAULT_MARKUP_FONT_SIZE:{value:16},GetFileType:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(c)){if("GLTF"===c||c===GLTFViewer.FT_GLTF)return GLTFViewer.FT_GLTF;if("SCDOC"===c||c===GLTFViewer.FT_SCDOC)return GLTFViewer.FT_SCDOC;if("AVZ"===c||c===GLTFViewer.FT_AVZ)return GLTFViewer.FT_AVZ;if("ARZ"===c||c===GLTFViewer.FT_ARZ)return GLTFViewer.FT_ARZ;if("MUP"===c||c===GLTFViewer.FT_MUP)return GLTFViewer.FT_MUP;if("VIEW"===c||c===GLTFViewer.FT_VIEW)return GLTFViewer.FT_VIEW;if("AVZM"===c||c===GLTFViewer.FT_AVZM)return GLTFViewer.FT_AVZM}a instanceof
Array&&(a=a[0]);if(GLTFViewer.Utils.IsNull(a)||"string"!==typeof a||0===a.length)return GLTFViewer.FT_UNKNOWN;var d=GLTFViewer.Utils.GetExtension(a);return"json"===d||"gltf"===d?GLTFViewer.FT_GLTF:"scdoc"===d?GLTFViewer.FT_SCDOC:"avz"===d?GLTFViewer.FT_AVZ:"arz"===d?GLTFViewer.FT_ARZ:"mup"===d?GLTFViewer.FT_MUP:"view"===d?GLTFViewer.FT_VIEW:"avzm"===d?GLTFViewer.FT_AVZM:GLTFViewer.FT_UNKNOWN}},GetFileTypeExt:{value:function(a){return"GLTF"===a||a===GLTFViewer.FT_GLTF?"gltf":"SCDOC"===a||a===GLTFViewer.FT_SCDOC?
"scdoc":"AVZ"===a||a===GLTFViewer.FT_AVZ?"avz":"ARZ"===a||a===GLTFViewer.FT_ARZ?"arz":"MUP"===a||a===GLTFViewer.FT_MUP?"mup":"VIEW"===a||a===GLTFViewer.FT_VIEW?"view":"AVZM"===a||a===GLTFViewer.FT_AVZM?"avzm":"unknown"}},SetElementCheck:{value:function(a,c){GLTFViewer.Utils.IsNull(a)||GLTFViewer.SetElemColor(a,GLTFViewer.Utils.IsNull(c)||c?GLTFViewer.MODESELECTED:GLTFViewer.MODENORMAL)}},GetElementCheck:{value:function(a){return GLTFViewer.Utils.IsNull(a)?!1:a.css("background-color")===GLTFViewer.SELECTCOLOR}},
SetElementEnable:{value:function(a,c){GLTFViewer.Utils.IsNull(a)||(GLTFViewer.Utils.IsNull(c)||c?(a.css("opacity",1),a.prop("disabled",!1)):(a.css("opacity",.3),a.prop("disabled",!0)))}},GetElementEnable:{value:function(a){return!GLTFViewer.Utils.IsNull(a)&&GLTFViewer.GetElementVisible(a)&&!a.prop("disabled")}},SetElementVisible:{value:function(a,c){GLTFViewer.Utils.IsNull(a)||(c?a.css("display","block"):a.css("display","none"))}},GetElementVisible:{value:function(a){return!GLTFViewer.Utils.IsNull(a)&&
"none"!==a.css("display")}},SetElemColor:{value:function(a,c){c===GLTFViewer.MODESELECTED?a.css("background-color",GLTFViewer.SELECTCOLOR):a.css("background-color",GLTFViewer.BUTTONCOLOR)}},MakeUnselectable:{value:function(a){1==a.nodeType&&a.setAttribute("unselectable","on");for(a=a.firstChild;a;)GLTFViewer.MakeUnselectable(a),a=a.nextSibling}},IsURL:{value:function(a){var c=/^\\/i;if(a.match(c))return!1;try{var d=require("url").parse(a,!0,!0);if(d&&d.host)return!0}catch(e){}c=/^[a-z]:/i;if(a.match(c))return!1;
c=/^.*:\/\//i;return a.match(c)?!0:!1}}});GLTFViewer.FileManager=function(a,c,d){this._controllingViewer=a;this._numWindows=c;this._files=[];this._activeFileObj=[];this._panel=new GLTFViewer.FileManager.Panel(this._controllingViewer,this,c,d)};
GLTFViewer.FileManager.prototype=Object.create(null,{_controllingViewer:{writable:!0,value:null},_numWindows:{writable:!0,value:null},_panel:{writable:!0,value:null},_files:{writable:!0,value:null},_activeFileObj:{writable:!0,value:null},numFiles:{get:function(){return this._files.length}},files:{get:function(){return this._files}},fileNames:{get:function(){for(var a=[],c=0;c<this.numFiles;++c){var d=this._files[c]._name;this._files[c]._mTime&&(d=d+" "+(new Date(this._files[c]._mTime)).toLocaleString());
a.push(d)}return a}},filePaths:{get:function(){for(var a=[],c=0;c<this.numFiles;++c)a.push(this._files[c]._path);return a}},ActiveFileObj:{value:function(a){a=GLTFViewer.Utils.IsNull(a.viewportNumber)?a:a.viewportNumber;return this._activeFileObj[a]}},ActiveFileIndex:{value:function(a){return this.FindFile(this.ActiveFileObj(a))}},AddFile:{value:function(a,c,d,e,f,g,k){a=this.FindFile(c,g);if(0<=a)return a;c=new GLTFViewer.FileManager.FileObject(c,d,e,f,g,k);this._files.push(c);this._files.sort(GLTFViewer.FileManager.FileNameCompare);
return this.FindFile(c)}},RemoveFile:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(c)){var d=this.FindFile(c);if(!(0>d)){var e=this.ActiveFileObj(a);c==e&&this.CloseFile(a);for(e=0;e<c.NumMultiFiles();++e)if(c===c._multiFile[e]){c._multiFile.splice(e,1);break}this._files.splice(d,1);0===this.numFiles&&this._controllingViewer.Reset()}}}},SelectFile:{value:function(a,c,d,e){function f(a,c,d,e,f){if(d._fileType!==GLTFViewer.FT_AVZM&&d._fileType!==GLTFViewer.FT_ARZ){if(f)this._activeFileObj[a.viewportNumber]=
d,GLTFViewer.Utils.GetFilePath(d._file),a.SetTitle("WRITE",d._name),this.ActiveFileIndex(a),this._panel&&this._panel.SelectFile(a.viewportNumber,d);else{this.CloseFile(a);this.RemoveFile(a,d);e&&e(!1);return}a.SetMultiFileSlider()}e&&e(f)}if(GLTFViewer.Utils.IsNull(c))d&&d(!0);else{c instanceof GLTFViewer.FileManager.FileObject||isNaN(c)||(c=parseInt(c),c>this.numFiles-1?c=this.numFiles-1:0>c&&(c=0),c=this._files[c]);var g=this.ActiveFileObj(a);c&&!GLTFViewer.FileManager.SameFiles(c._file,c._containerFile,
c._mTime,g)?(a.SaveBtnState(null,c._containerFile?GLTFViewer.MENUDISABLE:GLTFViewer.MENUENABLE),a.LoadFile(c,f.bind(this,a,g,c,d),e)):d&&d(!0)}}},CloseFile:{value:function(a,c){var d=a.viewportNumber;this._panel&&this._panel.CloseFile(d);this._activeFileObj[d]=null;a.Reset(c)}},IsMultiFile:{value:function(a){a=this.FindFile(a);return 0>a?!1:1<this._files[a].NumMultiFiles()}},AddScene:{value:function(a,c,d){return this._panel?this._panel.AddScene(a.viewportNumber,c,d):null}},RemoveScene:{value:function(a,
c){this._panel&&this._panel.RemoveScene(a.viewportNumber,c)}},SelectScene:{value:function(a,c){this._panel&&this._panel.SelectScene(a.viewportNumber,c)}},AddEntry:{value:function(a,c,d,e,f,g,k){return this._panel?this._panel.AddEntry(a.viewportNumber,c,d,e,f,g,k):null}},RemoveEntry:{value:function(a,c){this._panel&&this._panel.RemoveEntry(a.viewportNumber,c)}},RemoveAllEntries:{value:function(a){this._panel&&this._panel.RemoveAllEntries(a.viewportNumber)}},CloseContextMenus:{value:function(){this._panel&&
this._panel.CloseContextMenus()}},IsPanelVisible:{value:function(){return this._panel?this._panel.IsVisible():!1}},ShowPanel:{value:function(a){this._panel&&this._panel.Show(a)}},FindFile:{value:function(a,c){if(GLTFViewer.Utils.IsNull(a))return-1;GLTFViewer.Utils.IsNull(c)&&!GLTFViewer.Utils.IsNull(a._containerFile)&&(c=a._containerFile);GLTFViewer.Utils.IsNull(a._fileType)||(a=a._file);for(var d=GLTFViewer.FileManager.GetMTime(a,c),e=0;e<this.numFiles;++e)if(GLTFViewer.FileManager.SameFiles(a,c,
d,this._files[e]))return e;return-1}},Reset:{value:function(){this._panel&&this._panel.Reset()}},Clear:{value:function(){GLTFViewer.FileManager.prototype.Reset.call(this);this._panel&&this._panel.Clear();this._activeFileObj=this._files=this._controllingViewer=null}}});
Object.defineProperties(GLTFViewer.FileManager,{SameFiles:{value:function(a,c,d,e){if(GLTFViewer.Utils.IsNull(a)||GLTFViewer.Utils.IsNull(e))return!1;a=GLTFViewer.Utils.GetFilePath(a)===GLTFViewer.Utils.GetFilePath(e._file);c=GLTFViewer.Utils.GetFilePath(c)===GLTFViewer.Utils.GetFilePath(e._containerFile);d=d===e._mTime;return a&&c&&d}},FileNameCompare:{value:function(a,c){function d(a,c,d,e){var f=a.length,g=d.length;if(0===f&&0===g)return 0;if(0===f||0===g)return 0===f?-1:1;f=GLTFViewer.Utils.GetExtension(a);
g=GLTFViewer.Utils.GetExtension(d);a=GLTFViewer.Utils.RemoveExt(a);d=GLTFViewer.Utils.RemoveExt(d);var q=/(\D)+|(\d)+/g;a=a.match(q);d=d.match(q);for(var q=Math.min(a.length,d.length),u=0;u<q;++u){var r=a[u],w=d[u];if(r!==w)return isNaN(r)||isNaN(w)?r.localeCompare(w):r-w}return f===g?a.length===d.length?c-e:a.length-d.length:f<g}var e=a._name.toUpperCase().trim(),f=a._mTime,g=c._name.toUpperCase().trim(),e=d(e,f,g,c._mTime);0===e&&(e=a._containerFile?GLTFViewer.Utils.RemoveExt(GLTFViewer.Utils.GetFileName(GLTFViewer.Utils.GetFilePath(a._containerFile))).toUpperCase().trim():
"",f=a._containerFile?a._containerFile._mTime:0,g=c._containerFile?GLTFViewer.Utils.RemoveExt(GLTFViewer.Utils.GetFileName(GLTFViewer.Utils.GetFilePath(c._containerFile))).toUpperCase().trim():"",e=d(e,f,g,g));return e}},GetMTime:{value:function(a,c){function d(a){if(a.lastModified)return a.lastModified;if(a.lastModifiedDate)return(new Date(a.lastModifiedDate)).getTime();var c;try{c=require("fs");var d=GLTFViewer.Utils.GetFilePath(a),e=c.statSync(d);if(e)return e.mtime.getTime()}catch(l){}return 0}
if(GLTFViewer.Utils.IsNull(a))return 0;GLTFViewer.Utils.IsNull(c)&&!GLTFViewer.Utils.IsNull(a._containerFile)&&(c=a._containerFile);GLTFViewer.Utils.IsNull(a._fileType)||(a=a._file);if(!GLTFViewer.Utils.IsNull(c)){var e=d(c);if(e)return e}return d(a)}},UnZipFile:{value:function(a,c){if(GLTFViewer.Utils.IsNull(a))c(null);else{var d=a._dir;if(GLTFViewer.Utils.IsNull(d)){d=GLTFViewer.Utils.GetFilePath(a._file);if(!GLTFViewer.IsURL(d)){try{var e=new GLTFViewer.Utils.TempDir(".");(new (require("adm-zip"))(d)).extractAllTo(e.name,
!0);a._dir=e;c(e);return}catch(g){}c(null)}var f=GLTFViewer.Utils.GetFileName(d);try{e=new GLTFViewer.Utils.TempDir(".");f=require("path").join(e.name,f);(function(a,c,d){require("http").get(a,function(a,c,d){if(200!==d.statusCode)c(!1);else{var e=require("fs").createWriteStream(a);d.pipe(e);e.on("finish",function(){e.close(c.bind(this,!0))})}}.bind(this,c,d)).on("error",function(a){a(!1)}.bind(this,d))})(d,f,function(a,c,d,e,f){f?((new (require("adm-zip"))(e)).extractAllTo(a.name,!0),c._dir=a,d(a)):
d(null)}.bind(this,e,a,c,f));return}catch(g){}c(null)}else c(d)}}}});
GLTFViewer.FileManager.FileObject=function(a,c,d,e,f,g){var k=GLTFViewer.Utils.GetFilePath(a);this._file=a;this._name=GLTFViewer.Utils.GetFileName(k);GLTFViewer.GetFileType(this._name)!==c&&(this._name="ANSYSViewer."+GLTFViewer.GetFileTypeExt(c));this._fileType=c;this._loadType=d;this._mTime=GLTFViewer.FileManager.GetMTime(a,f);this._resources=e;this._containerFile=f;this._multiFile=g;this._path=f?GLTFViewer.Utils.GetFilePath(f):k;this._isURL=GLTFViewer.IsURL(this._path)};
GLTFViewer.FileManager.FileObject.prototype=Object.create(null,{_file:{writable:!0,value:null},_name:{writable:!0,value:null},_fileType:{writable:!0,value:null},_loadType:{writable:!0,value:null},_mTime:{writable:!0,value:null},_resources:{writable:!0,value:null},_containerFile:{writable:!0,value:null},_multiFile:{writable:!0,value:null},_dir:{writable:!0,value:null},_path:{writable:!0,value:null},_isURL:{writable:!0,value:!1},GetMultiFiles:{value:function(){return this._multiFile?this._multiFile.filter(function(a){return void 0!==
a&&null!=a}):[]}},NumMultiFiles:{value:function(){return this.GetMultiFiles().length}}});
GLTFViewer.FileManager.Panel=function(a,c,d,e){this._controllingViewer=a;this._fileManager=c;this._numWindows=d;e.append("<div style='display:none;padding:0;margin:0;border:0;min-width:230px;height:100%;overflow:hidden;background:white;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:-moz-none;-ms-user-select:none;-o-user-select:none;user-select:none;'></div>");this._panel2=$("div",e).last();a.mobile?(this._resizeBarSize=1,this._panel2.append("<div style='float:right;padding:0;margin:0;width:0;height:100%;border-right:"+
this._resizeBarSize+"px ridge "+GLTFViewer.BORDERCOLOR+";'></div>"),c=GLTFViewer.Utils.Dialog.GeneratePanelResizeURL(16,32,GLTFViewer.BORDERCOLOR),e.append("<img src='"+c+"' style='display:none;z-index:99991;position:absolute;bottom:25%;left:100px;background:transparent;'></img>"),this._resizeTouchImage=$("img",e).last(),this._resizeTouchImage.hover(function(){$(this).css("cursor","ew-resize")},function(){$(this).css("cursor","")}),this._resizeTouchHandler=new GLTFViewer.Utils.TouchHandler(a,this._resizeTouchImage,
null,this._Resize.bind(this))):(this._resizeBarSize=3,this._panel2.append("<div style='float:right;padding:0;margin:0;width:0;height:100%;border-right:"+this._resizeBarSize+"px ridge "+GLTFViewer.BORDERCOLOR+";'></div>"),e=$("div",this._panel2).last(),e.hover(function(){$(this).css("cursor","ew-resize")},function(){$(this).css("cursor","")}),this._resizeTouchHandler=new GLTFViewer.Utils.TouchHandler(a,e,null,this._Resize.bind(this)));this._panel2.append("<div style='padding:0;margin:0;width:"+(230-
this._resizeBarSize)+"px;height:100%;overflow:auto;background:white;'></div>");this._panel=$("div",this._panel2).last();this._minWidth=120;this._panel.append("<div style='padding:"+GLTFViewer.CONTAINER_INNER_MARGIN+"px;border-bottom:1px solid "+GLTFViewer.BORDERCOLOR+";'></div>");a=$("div",this._panel).last();a.append("<label style='display:inline;padding:0;margin:0;border:0;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'>View Manager</label>");a.append("<a style='float:right;font-size:13px;'>&#10005;</a>");
a=$("a",a).last();a.hover(function(){$(this).css("color",GLTFViewer.HOVERCOLOR);$(this).css("cursor","pointer")},function(){$(this).css("color","black");$(this).css("cursor","")});a.click(function(a){a.stopPropagation();this._controllingViewer.CloseContextMenus();this._controllingViewer.GetMainUIViewer().FileManagerBtnState(a,GLTFViewer.MENUCLOSE)}.bind(this));this._panel.click(function(a){this._controllingViewer.CloseContextMenus()}.bind(this));this._fileContainer=[];this._sceneContainer=[];this._visibilityList=
[];for(a=0;a<d;++a)this._panel.append("<ul style='list-style-type:none;padding:0;margin:"+GLTFViewer.CONTAINER_INNER_MARGIN+"px;'></ul>"),e=$("ul",this._panel).last(),e.append("<label style='padding:0;margin:0;border:0;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;white-space:nowrap'></label>"),c=$("label",e).last(),this._controllingViewer.wantViewport&&c.text("Window "+(a+1)),c.__th__=this._BuildFileContextMenu(a,c),e.append("<ul style='list-style-type:none;padding:0;margin-left:15px;'></ul>"),
this._sceneContainer[a]=$("ul",e).last(),this._fileContainer[a]=e;GLTFViewer.MakeUnselectable(this._panel[0]);GLTFViewer.Utils.NoContext(this._controllingViewer,this._panel);this._controllingViewer.wantPropertyEdit&&(this._contextMenuEntry=new GLTFViewer.Utils.SimpleContextMenu(this._controllingViewer,this._controllingViewer.body,[GLTFViewer.CM_ENTRY_EDIT_PROPERTIES],null,function(a,c){switch(a[0]){case GLTFViewer.CM_ENTRY_EDIT_PROPERTIES:c&&c()}}.bind(this)))};
GLTFViewer.FileManager.Panel.prototype=Object.create(null,{_controllingViewer:{writable:!0,value:null},_numWindows:{writable:!0,value:0},_fileManager:{writable:!0,value:null},_panel:{writable:!0,value:null},_panel2:{writable:!0,value:null},_resizeBarSize:{writable:!0,value:0},_fileContainer:{writable:!0,value:null},_sceneContainer:{writable:!0,value:null},_visibilityList:{writable:!0,value:null},_lastClickedVisList:{writable:!0,value:null},_contextMenuFile:{writable:!0,value:null},_contextMenuScene:{writable:!0,
value:null},_contextMenuEntry:{writable:!0,value:null},_resizeTouchHandler:{writable:!0,value:null},_resizeTouchImage:{writable:!0,value:null},_SetSize:{value:function(a){a<this._minWidth&&(a=this._minWidth);var c=this._controllingViewer._nonFullContainer.width();20<c&&(c-=20);a>c&&(a=c);this._panel2.css("min-width",a+"px");this._panel2.css("width",a+"px");this._panel2.css("height","100%");this._panel.css("width",a-this._resizeBarSize+"px");this._panel.css("height","100%");this._panel.toggle().toggle();
this._resizeTouchImage&&this._resizeTouchImage.css("left",a+"px");this._controllingViewer.UpdateLayout()}},_Resize:{value:function(a){a=this._resizeTouchHandler.Touches.Count();0!==a&&1===a&&(a=this._resizeTouchHandler.Touches.GetTouchByIndex(0).GetID(),0===a||1===a)&&(a=this._resizeTouchHandler.Touches.GetStartDelta(1),a=this._panel2.width()+a.x,this._SetSize(a))}},_BuildFileContextMenu:{value:function(a,c){function d(a,c){var d=[],k=[];d.push(GLTFViewer.CM_FILE_CLOSE_FILE);k.push(null);var h=null,
l=this._fileManager.numFiles;if(l){var m=[GLTFViewer.CM_MAIN_SELECT_FILE],n=[null],h=this._fileManager.fileNames,m=m.concat(h);d.push(m);n=n.concat(this._fileManager.filePaths);k.push(n)}this._contextMenuFile=new GLTFViewer.Utils.SimpleContextMenu(this._controllingViewer,this._controllingViewer.body,d,k,function(a,c){var d=a[0],e=a[1],f=2<a.length?a[2]:"",h=this._controllingViewer.GetViewerByNumber(c);switch(d){case GLTFViewer.CM_FILE_CLOSE_FILE:h&&this._fileManager.CloseFile(h);break;default:f===
GLTFViewer.CM_MAIN_SELECT_FILE&&h&&h.SelectFile(e)}}.bind(this));c.preventDefault();c.stopPropagation();d={};d[GLTFViewer.CM_FILE_CLOSE_FILE]=!GLTFViewer.Utils.IsNull(this._fileManager.ActiveFileObj(a));if(l)for(d[GLTFViewer.CM_MAIN_SELECT_FILE]=1,l=0;l<h.length;++l)d[h[l]]=1;this._contextMenuFile.Show(!0,c,d,a)}if(this._controllingViewer.wantFile)return new GLTFViewer.Utils.TouchHandler(this._controllingViewer,c,null,null,null,null,null,null,null,d.bind(this,a))}},_FindVisibilityElemIndex:{value:function(a,
c){function d(a,c,e){a=a.childrenVisList;for(var h=0;h<a.length;++h){if(c.li===a[h].li)return!0;++e.indx;if(a[h].childrenVisList.length&&d(a[h],c,e))return!0}return!1}if(!this._visibilityList[a])return-1;var e={indx:0};return d(this._visibilityList[a],c,e)?e.indx:-1}},_SetInpValue:{value:function(a,c,d,e,f,g){function k(a){a=a.childrenVisList;for(var c=2,d=0;d<a.length;++d){var e=a[d].displayedValue;if(0===d)c=e;else if(c!==e)return 2}return c}var h=a.inp;if(d){d=a.childrenVisList;for(g=0;g<d.length;++g)this._SetInpValue(d[g],
c,!0,!1,f,c);g=c}else GLTFViewer.Utils.IsNull(g)&&(g=a.childrenVisList.length?k(a):c);a.onlyGroups&&(c=g);h&&(d=c===g?c:2,a.displayedValue=d,0===d?(h.prop("checked",!1),h.prop("indeterminate",!1)):1===d?(h.prop("checked",!0),h.prop("indeterminate",!1)):h.prop("indeterminate",!0));2!==c&&(a.value=c,f&&a.visCallback&&a.visCallback(c));a=a.parentVisList;e&&a.inp&&(e=k(a),a.onlyGroups?this._SetInpValue(a,e,!1,!0,!1,e):this._SetInpValue(a,a.value,!1,!0,!1,e))}},_AddExpandableLabelWithCheckBox:{value:function(a,
c,d,e,f,g,k){var h=!GLTFViewer.Utils.IsNull(c)&&c.length;GLTFViewer.Utils.IsNull(g)&&(g=this._visibilityList[a].childrenVisList[0]);d={li:null,ul:null,inp:null,imgC:null,imgE:null,ToggleFunc:null,parentVisList:g,childrenVisList:[],visCallback:e,value:d?1:0,displayedValue:d?1:0,onlyGroups:k};g.childrenVisList.push(d);if(h){h=function(a,c,d,e,f){f.stopPropagation();this._controllingViewer.CloseContextMenus();"Expand"===a?(d.css("display","none"),e.css("display","inline"),c.css("display","block")):(d.css("display",
"inline"),e.css("display","none"),c.css("display","none"))};d.ToggleFunc=function(c,d){var e=!GLTFViewer.Utils.IsNull(d);this._controllingViewer.CloseContextMenus();var f=c.value?0:1;if(e&&d.shiftKey&&!GLTFViewer.Utils.IsNull(this._lastClickedVisList)&&this._lastClickedVisList!=c){var h=this._FindVisibilityElemIndex(a,this._lastClickedVisList);0<=h?(e=this._FindVisibilityElemIndex(a,c),function(c,d,e){function f(a,c,d,e,h){a=a.childrenVisList;for(var g=0;g<a.length&&!(h.indx>d);++g)h.indx>=c&&this._SetInpValue(a[g],
e,!1,!0,!0),++h.indx,a[g].childrenVisList.length&&f.call(this,a[g],c,d,e,h)}return f.call(this,this._visibilityList[a],c,d,e,{indx:0})}.call(this,e<h?e:h,e<h?h:e,f)):this._SetInpValue(c,f,e,!0,!0)}else this._SetInpValue(c,f,e,!0,!0);this._lastClickedVisList=c}.bind(this,d);g.ul.append("<li style='list-style-type:none;margin:0;white-space:nowrap;'></li>");e=$("li",g.ul).last();d.li=e;e.append("<img src='"+this._controllingViewer.imageDir+"closed.png' style='display:none;margin-right:5px'></img>");
k=$("img",e).last();d.imgE=k;e.append("<img src='"+this._controllingViewer.imageDir+"open.png' style='display:none;margin-right:5px'></img>");var l=$("img",e).last();d.imgC=l;e.append("<label style='padding:0;margin:0;border:0;margin-left:32px;margin-right:5px;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></label>");var m=$("label",e).last();m.append("<input type='checkbox' style='padding:0;margin:0;border:1px solid black;margin-left:0;margin-right:5px;'></input>");var n=$("input",
m).last();d.inp=n;n.on("click",d.ToggleFunc);m.append(c);k.hover(function(a){a.css("cursor","pointer")}.bind(this,k),function(a){a.css("cursor","")}.bind(this,k));l.hover(function(a){a.css("cursor","pointer")}.bind(this,l),function(a){l.css("cursor","")}.bind(this,l));m.hover(function(a){a.css("color",GLTFViewer.HOVERCOLOR);a.css("cursor","pointer")}.bind(this,m),function(a){m.css("color","black");m.css("cursor","")}.bind(this,m));c=m.css("margin-left").replace("px","");m.css("margin-left",c-18+"px");
e.append("<ul style='display:none;list-style-type:none;padding:0;margin-left:14px;'></ul>");c=$("ul",e).last();d.ul=c;k.click(h.bind(this,"Expand",c,k,l));l.click(h.bind(this,"Collapse",c,k,l));GLTFViewer.MakeUnselectable(e[0]);!g.li||GLTFViewer.GetElementVisible(g.imgC)||GLTFViewer.GetElementVisible(g.imgE)||(g.imgE.css("display","inline"),$("label",g.li).first().css("margin-left",0));this._SetInpValue(d,d.value,!1,!0,!1);f&&this._contextMenuEntry&&(d.__th__=new GLTFViewer.Utils.TouchHandler(this._controllingViewer,
m,null,null,null,null,null,null,null,function(a,c){c.preventDefault();c.stopPropagation();var d={};d[GLTFViewer.CM_ENTRY_EDIT_PROPERTIES]=this._controllingViewer.scene.AnimationStopped();this._contextMenuEntry.Show(!0,c,d,a)}.bind(this,f)))}return d}},SelectFile:{value:function(a,c){var d=GLTFViewer.Utils.GetFilePath(c._file),e=c._name;c._mTime&&(e=e+" "+(new Date(c._mTime)).toLocaleString());if(this._controllingViewer.wantFile){var f=$("label",this._fileContainer[a]).first();this._controllingViewer.wantViewport?
f.text("Window "+(a+1)+": "+e):f.text(e);e=c._containerFile;GLTFViewer.Utils.IsNull(e)||(d=GLTFViewer.Utils.GetFilePath(e));f.prop("title",d)}}},CloseFile:{value:function(a){var c=$("label",this._fileContainer[a]).first();this._controllingViewer.wantViewport?c.text("Window "+(a+1)):c.text("");this.RemoveAllScenes(a)}},AddScene:{value:function(a,c,d){this._sceneContainer[a].append("<li style='list-style-type:none;margin:0;white-space:nowrap;'></li>");var e=$("li",this._sceneContainer[a]).last();e.append("<label style='padding:0;margin:0;border:0;font-size:14px;font-family:Segoe UI,Arial,Helvetica,sans-serif;'></label>");
var f=$("label",e).last();f.append(c.name);GLTFViewer.Utils.IsNull(d)||(f.hover(function(a){a.css("background-color")===GLTFViewer.HOVERCOLOR?a.css("color","white"):a.css("color",GLTFViewer.HOVERCOLOR);a.css("cursor","pointer")}.bind(this,f),function(a){a.css("color","black");a.css("cursor","")}.bind(this,f)),f.click(function(a,c){c.preventDefault();c.stopPropagation();this._controllingViewer.CloseContextMenus();a()}.bind(this,d)),e.__th__=new GLTFViewer.Utils.TouchHandler(this._controllingViewer,
f,null,null,null,null,null,null,null,function(a,c,d){a=this._controllingViewer.GetViewerByNumber(a);this._contextMenuScene=new GLTFViewer.Utils.SimpleContextMenu(this._controllingViewer,this._controllingViewer.body,[GLTFViewer.CM_SCENE_RESET_VIEW,GLTFViewer.CM_SCENE_COPY_VIEW,GLTFViewer.CM_SCENE_DELETE_VIEW],null,function(a,c,d){c=c[0];if(a.scene&&a.scene.handler)switch(c){case GLTFViewer.CM_SCENE_RESET_VIEW:a.scene.ResetScene(d);break;case GLTFViewer.CM_SCENE_COPY_VIEW:d=d instanceof GLTFViewer.Utils.FileGLTF.SceneItem?
d:null;new GLTFViewer.Utils.Dialog("New View Name",[["View Name",GLTFViewer.Utils.Dialog.DATATEXT,d?d.name+"_Copy":"View"]],!0,function(c,d,e){d&&e[0]&&e[0].length&&a.scene.handler.CreateScene(e[0],c)}.bind(this,d));break;case GLTFViewer.CM_SCENE_DELETE_VIEW:a.scene.handler.DeleteScene(d)}}.bind(this,a));d.preventDefault();d.stopPropagation();a={};a[GLTFViewer.CM_SCENE_RESET_VIEW]=1;a[GLTFViewer.CM_SCENE_COPY_VIEW]=this._controllingViewer.canSave;a[GLTFViewer.CM_SCENE_DELETE_VIEW]=this._controllingViewer.canSave&&
c.editable;this._contextMenuScene.Show(!0,d,a,c)}.bind(this,a,c)));GLTFViewer.MakeUnselectable(e[0]);return e}},RemoveScene:{value:function(a,c){c.remove()}},RemoveAllScenes:{value:function(a){this.RemoveAllEntries(a);this._sceneContainer&&this._sceneContainer[a]&&this._sceneContainer[a].children().remove()}},SelectScene:{value:function(a,c){$("> label",this._sceneContainer[a].children()).css("background-color","white");$("> label",c).css("background-color",GLTFViewer.HOVERCOLOR);this._lastClickedVisList=
null;this._visibilityList[a]&&(this._visibilityList[a].ul.detach(),c.append(this._visibilityList[a].ul))}},AddEntry:{value:function(a,c,d,e,f,g,k){GLTFViewer.Utils.IsNull(this._visibilityList[a])&&(this._visibilityList[a]={li:null,ul:$("<ul style='list-style-type:none;padding:0;margin-left:5px;'></ul>"),inp:null,imgC:null,imgE:null,ToggleFunc:null,parentVisList:null,childrenVisList:[],visCallback:null,onlyGroups:!0},this._AddExpandableLabelWithCheckBox(a,"All",!0,null,null,this._visibilityList[a],
!0));return this._AddExpandableLabelWithCheckBox(a,c,d,e,f,g,k)}},RemoveEntry:{value:function(a,c){function d(a,c){for(var g=a.childrenVisList,k=0;k<g.length;++k){if(c===g[k]){if(g[k].li){for(;c.childrenVisList.length;)d(c,c.childrenVisList[0]);$(g[k].li).remove()}a.childrenVisList.splice(k,1);break}g[k].childrenVisList.length&&d(g[k],c)}}GLTFViewer.Utils.IsNull(this._visibilityList[a])||GLTFViewer.Utils.IsNull(c)||(d(this._visibilityList[a],c),this._visibilityList[a].childrenVisList.length&&0===
this._visibilityList[a].childrenVisList[0].childrenVisList.length&&d(this._visibilityList[a],this._visibilityList[a].childrenVisList[0]),0===this._visibilityList[a].childrenVisList.length&&(this._visibilityList[a].ul.remove(),this._visibilityList[a]=null))}},RemoveAllEntries:{value:function(a){if(this._visibilityList[a])for(;this._visibilityList[a]&&this._visibilityList[a].childrenVisList.length;)this.RemoveEntry(a,this._visibilityList[a].childrenVisList[0])}},CloseContextMenus:{value:function(){this._contextMenuFile&&
this._contextMenuFile.Show(!1);this._contextMenuScene&&this._contextMenuScene.Show(!1);this._contextMenuEntry&&this._contextMenuEntry.Show(!1)}},IsVisible:{value:function(){return this._panel2?GLTFViewer.GetElementVisible(this._panel2):!1}},Show:{value:function(a){this._panel2&&(!a&&this.IsVisible()?(this._resizeTouchImage&&GLTFViewer.SetElementVisible(this._resizeTouchImage,!1),this._panel2.hide(0,this._controllingViewer.UpdateLayout.bind(this._controllingViewer))):a&&!this.IsVisible()&&(a=this._panel2.width(),
this._SetSize(a),this._resizeTouchImage&&GLTFViewer.SetElementVisible(this._resizeTouchImage,!0),this._panel2.show(0,this._controllingViewer.UpdateLayout.bind(this._controllingViewer))))}},Reset:{value:function(){}},Clear:{value:function(){GLTFViewer.FileManager.Panel.prototype.Reset.call(this);this._visibilityList=this._fileContainer=this._contextMenuEntry=this._contextMenuScene=this._contextMenuFile=this._panel2=this._panel=this._sceneContainer=this._fileManager=this._controllingViewer=null}}});
GLTFViewer.GLTFViewer=function(){GLTFViewer.apply(this,arguments)};GLTFViewer.GLTFViewer.prototype=Object.create(GLTFViewer.prototype,{constructor:{value:GLTFViewer.GLTFViewer}});window.requestAnimationFrame=window.requestAnimationFrame||function(){return window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}();GLTFViewer.Utils=function(){};
Object.defineProperties(GLTFViewer.Utils,{ShowAlert:{writable:!0,value:!0},maxValue:{value:1.79769E308},maxDouble:{value:1E13},root2:{value:1.4142135623730951},root3:{value:1.7320508075688772},root6:{value:2.449489742783178},epsilon:{value:1E-13},lengthAccuracy:{value:1E-8},lengthAccuracySquared:{value:1E-8*1E-8},angleAccuracy:{value:1E-6},fitAccuracy:{value:1E-5},GetXY:{value:function(a){var c=[];a.touches?c=a.touches:a.pointerId?c=[a]:c.push({timeStamp:a.timeStamp,clientX:a.clientX,clientY:a.clientY});
return c.length?c[0]:{timestammp:a.timeStamp,clientX:-1,clientY:-1}}},GetClientXY:{value:function(a,c){var d=a.getBoundingClientRect();c=GLTFViewer.Utils.GetXY(c);return{t:c.timeStamp,x:c.clientX-d.left,y:c.clientY-d.top}}},tEmptyArray:{get:function(){return new Int8Array(0)}},glMtxIdentity:{get:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},IslengthZero:{value:function(a){return a<=GLTFViewer.Utils.lengthAccuracy&&a>=-GLTFViewer.Utils.lengthAccuracy}},EqualDoubles:{value:function(a,
c){return GLTFViewer.Utils.WithinTolerance(a,c,GLTFViewer.Utils.epsilon,GLTFViewer.Utils.epsilon)}},EqualLengths:{value:function(a,c){return GLTFViewer.Utils.WithinTolerance(a,c,GLTFViewer.Utils.epsilon,GLTFViewer.Utils.lengthAccuracy)}},WithinTolerance:{value:function(a,c,d,e){var f=a-c;0>f&&(f=-f);a+=c;0>a&&(a=-a);return f<e||f<=.5*d*a}},CRLFtoCR:{value:function(a){if("string"!==typeof a)return"";a=a.replace(/\n\r/g,"\n");return a=a.replace(/\r/g,"\n")}},acos:{value:function(a){if(-1<=a&&1>=a)return Math.acos(a);
var c=1+GLTFViewer.Utils.angleAccuracy;return-1>a&&a>-c?Math.PI:0}},IsFullScreenAvailable:{value:function(){return document.fullscreenEnabled||document.msFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||!1}},IsFullScreen:{value:function(){return GLTFViewer.Utils.IsFullScreenAvailable()?document.fullscreenElement?null!==document.fullscreenElement:document.msFullscreenElement?null!==document.msFullscreenElement:document.mozFullScreenElement?null!==document.mozFullScreenElement:
document.webkitFullscreenElement?null!==document.webkitFullscreenElement:!1:!1}},ToFullScreen:{value:function(a){a=a||document.documentElement;GLTFViewer.Utils.IsFullScreenAvailable()&&!GLTFViewer.Utils.IsFullScreen()&&(a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen?-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")?a.webkitRequestFullScreen():a.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):
a.webkitRequestFullscreen&&(-1!==navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")?a.webkitRequestFullscreen():a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)))}},FromFullScreen:{value:function(){GLTFViewer.Utils.IsFullScreen()&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen&&
document.webkitExitFullscreen())}},IsApple:{value:function(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("ipod")||-1!==a.indexOf("iphone")||-1!==a.indexOf("ipad")}},IsMobile:{value:function(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("ipod")||-1!==a.indexOf("iphone")||-1!==a.indexOf("ipad")||-1!==a.indexOf("android")||-1!==a.indexOf("googletv")||-1!==a.indexOf("playbook")||-1!==a.indexOf("bb10")&&-1!==a.indexOf("mobi")||-1!==a.indexOf("blackberry")&&-1!==a.indexOf("webkit")||
-1!==a.indexOf("windows phone")||-1!==a.indexOf("hpwos")&&-1!==a.indexOf("tablet")||-1!==a.indexOf("htc_flyer")||-1!==a.indexOf("webos")||-1!==a.indexOf("bada")||-1!==a.indexOf("tizen")}},Base64EncArr:{value:function(a){for(var c=function(a){return 26>a?a+65:52>a?a+71:62>a?a-4:62===a?43:63===a?47:65},d,e="",f=a.length,g=0,k=0;k<f;k++)if(d=k%3,g|=a[k]<<(16>>>d&24),2===d||1===a.length-k)e+=String.fromCharCode(c(g>>>18&63),c(g>>>12&63),c(g>>>6&63),c(g&63)),g=0;return e.replace(/A(?=A$|$)/g,"=")}},StrokeEllipse:{value:function(a,
c,d,e,f){var g=e/2*.5522848,k=f/2*.5522848,h=c+e,l=d+f;e=c+e/2;f=d+f/2;a.beginPath();a.moveTo(c,f);a.bezierCurveTo(c,f-k,e-g,d,e,d);a.bezierCurveTo(e+g,d,h,f-k,h,f);a.bezierCurveTo(h,f+k,e+g,l,e,l);a.bezierCurveTo(e-g,l,c,f+k,c,f);a.closePath();a.stroke()}},FillEllipse:{value:function(a,c,d,e,f){var g=e/2*.5522848,k=f/2*.5522848,h=c+e,l=d+f;e=c+e/2;f=d+f/2;a.beginPath();a.moveTo(c,f);a.bezierCurveTo(c,f-k,e-g,d,e,d);a.bezierCurveTo(e+g,d,h,f-k,h,f);a.bezierCurveTo(h,f+k,e+g,l,e,l);a.bezierCurveTo(e-
g,l,c,f+k,c,f);a.closePath();a.fill()}},TextWidth:{value:function(a,c){if(!(c instanceof Array))c=[c];else if(!c.length)return 0;for(var d=0,e=0;e<c.length;++e)var f=a.measureText(c[e]),d=Math.max(d,f.width);return d}},FlatRgba:{value:function(a,c,d,e,f){f[0]=a/255;f[1]=c/255;f[2]=d/255;f[3]=e/255}},FlatColor:{value:function(a,c){c[0]=(a>>16&255)/255;c[1]=(a>>8&255)/255;c[2]=(a&255)/255;c[3]=(a>>24&255)/255}},RemoveDuplicates:{value:function(a){return a?a.filter(function(c,d){return a.indexOf(c)==
d}):a}},IsNull:{value:function(a){return"undefined"===typeof a||null===a}},InsertReplace:{value:function(a,c,d){var e=a.match(c);if(!e||1!==e.length)return null;e=a.search(c);c=a.match(c);c=e+c[0].length;e=a.substr(0,e);a=a.substr(c);return e+d+a}},InsertAfter:{value:function(a,c,d){var e=a.match(c);if(!e||1!==e.length)return null;e=a.search(c);c=a.match(c);e+=c[0].length;c=a.substr(0,e);a=a.substr(e);return c+d+a}},InsertBefore:{value:function(a,c,d){var e=a.match(c);if(!e||1!==e.length)return null;
e=a.search(c);c=a.substr(0,e);a=a.substr(e);return c+d+a}},SplitLine:{value:function(a,c,d){var e=[];if(GLTFViewer.Utils.IsNull(d)||""==d)return e;d=d.split("~");for(var f=0;f<d.length;++f)d[f]=d[f].split(" ");for(var f="",g=0,k=0;k<d.length;++k){k&&(f+=":");for(var h=0;h<d[k].length;++h){var l=f;l.length&&0<h&&(l+=" ");var l=l+d[k][h],m=a.measureText(l);c&&m.width>c?(e.push(f),f=d[k][h],m=a.measureText(f),g=Math.max(g,m.width),m.width>c&&(e.push(f),f="")):(f=l,g=Math.max(g,m.width))}}f.length&&(m=
a.measureText(f),e.push(f),g=Math.max(g,m.width));return{width:g+2,data:e}}},NoContext:{value:function(a,c){c.on("contextmenu",function(a,c){a&&a.CloseContextMenus();c.preventDefault();c.stopPropagation()}.bind(this,a))}},GetMemoryUsage:{value:function(){try{return process.memoryUsage()}catch(a){return null}}},Interpolate:{value:function(a,c,d){if(0>=d)return a;if(1<=d)return c;if("number"===typeof a)return a+(c-a)*d;if(a instanceof Array&&16===a.length){var e=[a[12],a[13],a[14]],f=[c[12],c[13],c[14]],
g=[Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]),Math.sqrt(a[4]*a[4]+a[5]*a[5]+a[6]*a[6]),Math.sqrt(a[8]*a[8]+a[9]*a[9]+a[10]*a[10])],k=[Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]),Math.sqrt(c[4]*c[4]+c[5]*c[5]+c[6]*c[6]),Math.sqrt(c[8]*c[8]+c[9]*c[9]+c[10]*c[10])],h=[a[0]/g[0],a[1]/g[0],a[2]/g[0],0,a[4]/g[1],a[5]/g[1],a[6]/g[1],0,a[8]/g[2],a[9]/g[2],a[10]/g[2],0,0,0,0,1],l=[c[0]/k[0],c[1]/k[0],c[2]/k[0],0,c[4]/k[1],c[5]/k[1],c[6]/k[1],0,c[8]/k[2],c[9]/k[2],c[10]/k[2],0,0,0,0,1];c=[];a=[];var m=0<h[0]+h[5]+
h[10],n=h[0]>h[5]&&h[0]>h[10],p=h[5]>h[10],q=2*(m?Math.sqrt(1+h[0]+h[5]+h[10]):n?Math.sqrt(1+h[0]-h[5]-h[10]):p?Math.sqrt(1-h[0]+h[5]-h[10]):Math.sqrt(1-h[0]-h[5]+h[10]));c[0]=m?(h[6]-h[9])/q:n?.25*q:p?(h[1]+h[4])/q:(h[2]+h[8])/q;c[1]=m?(-h[2]+h[8])/q:n?(h[1]+h[4])/q:p?.25*q:(h[6]+h[9])/q;c[2]=m?(h[1]-h[4])/q:n?(h[2]+h[8])/q:p?(h[6]+h[9])/q:.25*q;c[3]=m?.25*q:n?(h[6]-h[9])/q:p?(-h[2]+h[8])/q:(h[1]-h[4])/q;h=0<l[0]+l[5]+l[10];m=l[0]>l[5]&&l[0]>l[10];n=l[5]>l[10];p=2*(h?Math.sqrt(1+l[0]+l[5]+l[10]):
m?Math.sqrt(1+l[0]-l[5]-l[10]):n?Math.sqrt(1-l[0]+l[5]-l[10]):Math.sqrt(1-l[0]-l[5]+l[10]));a[0]=h?(l[6]-l[9])/p:m?.25*p:n?(l[1]+l[4])/p:(l[2]+l[8])/p;a[1]=h?(-l[2]+l[8])/p:m?(l[1]+l[4])/p:n?.25*p:(l[6]+l[9])/p;a[2]=h?(l[1]-l[4])/p:m?(l[2]+l[8])/p:n?(l[6]+l[9])/p:.25*p;a[3]=h?.25*p:m?(l[6]-l[9])/p:n?(-l[2]+l[8])/p:(l[1]-l[4])/p;h=[];m=[];n=[];for(l=0;3>l;++l)h[l]=e[l]+(f[l]-e[l])*d,m[l]=g[l]+(k[l]-g[l])*d;d=GLTFViewer.Utils.Quat.Slerp(new GLTFViewer.Utils.Quat(c[0],c[1],c[2],c[3]),new GLTFViewer.Utils.Quat(a[0],
a[1],a[2],a[3]),d);n[0]=d.x;n[1]=d.y;n[2]=d.z;n[3]=d.w;e=[];e[0]=(1-2*n[1]*n[1]-2*n[2]*n[2])*m[0];e[1]=(2*n[0]*n[1]+2*n[2]*n[3])*m[0];e[2]=(2*n[0]*n[2]-2*n[1]*n[3])*m[0];e[3]=0;e[4]=(2*n[0]*n[1]-2*n[2]*n[3])*m[1];e[5]=(1-2*n[0]*n[0]-2*n[2]*n[2])*m[1];e[6]=(2*n[1]*n[2]+2*n[0]*n[3])*m[1];e[7]=0;e[8]=(2*n[0]*n[2]+2*n[1]*n[3])*m[2];e[9]=(2*n[1]*n[2]-2*n[0]*n[3])*m[2];e[10]=(1-2*n[0]*n[0]-2*n[1]*n[1])*m[2];e[11]=0;e[12]=h[0];e[13]=h[1];e[14]=h[2];e[15]=1;return e}e=[];for(l=0;l<a.length;++l)e[l]=a[l]+
(c[l]-a[l])*d;return e}},MakeBallImage:{value:function(a,c){var d=Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)));a=.625*d;var e=new Uint8Array(8*d*d);c/=2;for(var f=0;f<d;++f)for(var g=0;g<d;++g){var k=Math.sqrt(g*g+f*f),h;k<a+1?(cl=255,h=k<=a?255:255*(k-a)):h=cl=0;if(c&&k<a+c&&k>=a-c){var l=1-Math.abs(k-a)/c;cl=k>a?0:cl*(1-l);h=h*(1-l)+255*l}var m=d-1-g,n=d-1-f,k=4*(d+f)*d+2*(d+g),l=4*(d+f)*d+2*m,p=4*n*d+2*(d+g),m=4*n*d+2*m;e[k+0]=e[l+0]=e[p+0]=e[m+0]=cl;e[k+1]=e[l+1]=e[p+1]=e[m+1]=h}return e}},
MakeFacedCylinder3D:{value:function(a,c,d,e,f){for(var g=e*(f+3)+2,k=6*(e+f*e),h=new Float32Array(6*g),l=new Uint16Array(k),m=new Float32Array(2*e),n=Math.PI/2,p=2*Math.PI/e,q=0;q<e;n-=p,q++)m[2*q]=Math.cos(n),m[2*q+1]=Math.sin(n);n=(a-c)/f;p=-d/2;d/=f;var u=1;0===c&&(u=Math.cos(Math.PI));var r=c=0;h[c++]=0;h[c++]=0;h[c++]=p;h[c++]=0;h[c++]=0;h[c++]=-1;for(var q=0;q<e;q++)h[c++]=a*m[2*q],h[c++]=a*m[2*q+1],h[c++]=p,h[c++]=0,h[c++]=0,h[c++]=-1,0<q&&(l[r++]=0,l[r++]=q,l[r++]=q+1);l[r++]=0;l[r++]=e;l[r++]=
1;f++;for(var w=1;w<=f;w++){for(q=0;q<e;q++){var t=u*m[2*q],x=u*m[2*q+1],y=Math.sqrt(t*t+x*x+0);h[c++]=a*m[2*q];h[c++]=a*m[2*q+1];h[c++]=p;h[c++]=t/y;h[c++]=x/y;h[c++]=0/y;1<w&&0<q&&(t=e*w,l[r++]=t+q-e,l[r++]=t+q,l[r++]=t+q-e+1,l[r++]=t+q-e+1,l[r++]=t+q,l[r++]=t+q+1)}1<w&&(t=e*w,l[r++]=t+q-e,l[r++]=t+q,l[r++]=t-e+1,l[r++]=t-e+1,l[r++]=t+q,l[r++]=t+1);w<f&&(p+=d,a-=n)}for(q=0;q<e;q++)h[c++]=a*m[2*q],h[c++]=a*m[2*q+1],h[c++]=p,h[c++]=0,h[c++]=0,h[c++]=1,0<q&&(t=e*w,l[r++]=t+q,l[r++]=g-1,l[r++]=t+q+
1);h[c++]=0;h[c++]=0;h[c++]=p;h[c++]=0;h[c++]=0;h[c++]=1;t=e*w;l[r++]=t+q;l[r++]=g-1;l[r++]=t+1;return{vertices:h,indices:l,size:k}}},WriteLn:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(a)){var d=a;GLTFViewer.Utils.IsNull(c)||(d=d+" "+c);console.log(d)}}},WriteErr:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(a)){var d=a;GLTFViewer.Utils.IsNull(c)||(d=d+" "+c);GLTFViewer.Utils.IsNull(null)||(d=GLTFViewer.Utils.IsNull(null)?"null:"+d:"null:null:"+d);console.log(d);"undefined"===typeof __DONTSHOWALERT__&&
GLTFViewer.Utils.ShowAlert&&(d=d.match(/.{1,55}/g).join("\n"),GLTFViewer.Utils.ShowAlert=!confirm(d+"\nIgnore further messages?"))}}},IsAbsolutePath:{value:function(a){var c=new RegExp("^"+window.location.protocol,"i");if(a.match(c))return!0;c=/^[a-z]+:/i;if(a.match(c))return!0;c=/^[/\\]/;return a.match(c)?!0:!1}},ResolveEKMPath:{value:function(a,c,d){this.IsAbsolutePath(d)||(d=c+d);c=d;null!==a&&void 0!==a&&0<a.length&&(c=c+"?tab="+a);return c}},GetEKMBasePath:{value:function(a){var c=document.createElement("a");
c.href=a;for(var d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=c.search.substring(1),g={};null!=(a=e.exec(f));)g[decodeURIComponent(a[1].replace(d," "))]=decodeURIComponent(a[2].replace(d," "));a="tab"in g?g.tab:"";c=c.href.replace(/\\/g,"/");d=c.lastIndexOf("/");c=0!==d?c.substring(0,d+1):"";return{ekmUrlParamNameContextIdValue:a,pathBase:c}}},GetFilePath:{value:function(a){return GLTFViewer.Utils.IsNull(a)?"<unknown>":a.path?a.path:a.name?a.name:"string"===typeof a?a:"<unknown>"}},GetFileName:{value:function(a){a=
a.split(/:|\/|\\/);return a.length?a[a.length-1]:""}},RemoveExt:{value:function(a){if("string"!==typeof a)return"";var c=a.lastIndexOf(".");return 0<c?a.substr(0,c):a}},GetExtension:{value:function(a){if("string"!==typeof a)return"";var c=a.lastIndexOf(".");return 0<c?a.substr(c+1).toLowerCase():""}},ReplaceExtension:{value:function(a,c){var d=a.lastIndexOf(".");return 0<d?a.substr(0,d+1)+c:""}},ReplaceFileName:{value:function(a,c){var d=a.split(/:/);d.length&&(s2=d[d.length-1].split(/\/|\\/),s2.length&&
(s2[s2.length-1]=c),d[d.length-1]=s2.join("/"));return d.join(":")}},ResolvePath:{value:function(a){a=a.split(/:/);if(a.length){var c="\\";"/"==a[a.length-1].charAt(0)&&(c="/");s2=a[a.length-1].split(/\/|\\/);for(var d=1;d<s2.length;)".."===s2[d]?(s2.splice(d-1,2),--d):"."===s2[d]?s2.splice(d,1):++d;a[a.length-1]=s2.join(c)}return a.join(":")}},ExplosionMatrix:{value:function(a,c,d){a=GLTFViewer.Utils.Vec3.Create(a,c).Scale(d);return GLTFViewer.Utils.Transformation.Identity.Translate(a)}},GetBrowserHeight:{value:function(){return Math.max($(document).height(),
$(window).height(),document.documentElement.clientHeight)}},GetBrowserWidth:{value:function(){return Math.max($(document).width(),$(window).width(),document.documentElement.clientWidth)}},BuildSlider:{value:function(a,c,d,e,f,g,k,h,l,m,n){var p=h/2,q=GLTFViewer.Utils.IsNull(e);c.append("<input id='"+d+"' type='range' min='"+l+"' max='"+m+"' step='"+n+"' value='0' style='display:inline;border:0;margin:"+g+"px;padding:0;"+(q?"flex:1;-webkit-flex:1;":"")+"'></input>");c=$("input",c).last();q||c.css("width",
e+"px");c.css("height",f+"px");$("<style>input[id='"+d+"'] {-webkit-appearance:none;border:0;background:transparent;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']:focus {outline:none;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-webkit-slider-runnable-track {height:"+h+"px;background:white;border:none;border-radius:"+p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']:focus::-webkit-slider-runnable-track {background:white;}</style>").appendTo($("head",
a.document));$("<style>input[id='"+d+"']::-webkit-slider-thumb {-webkit-appearance:none;border:none;height:"+k+"px;width:"+k+"px;border-radius:50%;background:"+GLTFViewer.BUTTONCOLOR+";margin-top:"+(h-k)/2+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-moz-range-track     {height:"+h+"px;background:white;border:none;border-radius:"+p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-moz-range-thumb     {border:none;height:"+k+"px;width:"+k+
"px;border-radius:50%;background:"+GLTFViewer.BUTTONCOLOR+";}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-ms-track            {height:"+h+"px;background:transparent;border-color:transparent;border:none;color:transparent;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']:focus::-ms-fill-lower {background:white;border-radius:"+p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']:focus::-ms-fill-upper {background:white;border-radius:"+
p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-ms-fill-lower       {background:white;border-radius:"+p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-ms-fill-upper       {background:white;border-radius:"+p+"px;}</style>").appendTo($("head",a.document));$("<style>input[id='"+d+"']::-ms-thumb            {border:none;height:"+k+"px;width:"+k+"px;border-radius:50%;background:"+GLTFViewer.BUTTONCOLOR+";}</style>").appendTo($("head",a.document));
$("<style>input[id='"+d+"']::-ms-tooltip {display:none;}</style>").appendTo($("head",a.document));return c}},CreateModalShield:{value:function(){var a=$("body");a.append("<div style='display:none;z-index:99998;position:absolute;top:0;left:0;width:"+GLTFViewer.Utils.GetBrowserWidth()+"px;height:"+GLTFViewer.Utils.GetBrowserHeight()+"px;background:transparent;'></div>");a=$("div",a).last();GLTFViewer.Utils.NoContext(null,a);a.on("keydown",function(a){a.stopPropagation()});$(window).resize(function(a){GLTFViewer.GetElementVisible(a)&&
(a.css("width",GLTFViewer.Utils.GetBrowserWidth()+"px"),a.css("height",GLTFViewer.Utils.GetBrowserHeight()+"px"))}.bind(this,a));return a}}});
GLTFViewer.Utils.ShaderProgram=function(a,c,d,e){this._gl=a;this._shaders=[];this._attribLocation={};this._uniformLocation={};this._program=a.createProgram();var f=a.getError();if(0!==f)throw Error("ERROR(ShaderProgram): Can't create shader program: "+f);this._AttachShader(a.VERTEX_SHADER,d);d=e;c&&(d="precision "+c+" float;\n"+d);this._AttachShader(a.FRAGMENT_SHADER,d);this._Link()};
GLTFViewer.Utils.ShaderProgram.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.ShaderProgram},_gl:{writable:!0,value:null},_inUse:{writable:!0,value:!1},_program:{writable:!0,value:null},_shaders:{writable:!0,value:null},_attribLocation:{writable:!0,value:null},_uniformLocation:{writable:!0,value:null},attribLocation:{get:function(){return this._attribLocation}},uniformLocation:{get:function(){return this._uniformLocation}},_AttachShader:{value:function(a,c){var d=this._gl.createShader(a);
this._gl.shaderSource(d,c);this._gl.compileShader(d);if(!this._gl.getShaderParameter(d,this._gl.COMPILE_STATUS))throw Error("ERROR(ShaderProgram.AttachShader): ",this._gl.getShaderInfoLog(d));this._gl.attachShader(this._program,d);this._shaders.push(d)}},_Link:{value:function(){if(0===this._shaders.length)throw Error("ERROR(ShaderProgram.Link): No shaders attached");this._gl.linkProgram(this._program);if(!this._gl.getProgramParameter(this._program,this._gl.LINK_STATUS))throw Error("ERROR(ShaderProgram.Link): Unable to initialize the shader program");
for(var a in this._shaders)this._gl.deleteShader(this._shaders[a]);this._shaders=[];this._attribLocation={};var c=this._gl.getProgramParameter(this._program,this._gl.ACTIVE_ATTRIBUTES);for(a=0;a<c;++a){var d=this._gl.getActiveAttrib(this._program,a),e=d.name.replace(/\[[0-9]*\]/,"");this._attribLocation[e]=this._gl.getAttribLocation(this._program,d.name);this[e]=this._attribLocation[e]}this._uniformLocation={};c=this._gl.getProgramParameter(this._program,this._gl.ACTIVE_UNIFORMS);for(a=0;a<c;++a)d=
this._gl.getActiveUniform(this._program,a),e=d.name.replace(/\[[0-9]*\]/,""),this._uniformLocation[e]=this._gl.getUniformLocation(this._program,d.name),this[e]=this._uniformLocation[e]}},StartProgram:{value:function(){if(!this._program)return!1;if(this._gl.__EKM_SHADER__&&this._gl.__EKM_SHADER__===this)return!0;this._gl.__EKM_SHADER__&&this._gl.__EKM_SHADER__.StopProgram();this._gl.useProgram(this._program);this._gl.__EKM_SHADER__=this;for(var a in this._attribLocation)this._gl.enableVertexAttribArray(this._attribLocation[a]);
return!0}},StopProgram:{value:function(){for(var a in this._attribLocation)this._gl.disableVertexAttribArray(this._attribLocation[a]);this._gl.useProgram(null);this._gl.__EKM_SHADER__=null}},DeleteProgram:{value:function(){this._gl.__EKM_SHADER__===this&&this._gl.__EKM_SHADER__.StopProgram();this._program&&(this._gl.deleteProgram(this._program),this._program=null)}}});
Object.defineProperties(GLTFViewer.Utils.ShaderProgram,{precision:{value:"highp"},CreateClipableProgram:{value:function(a,c,d,e,f,g,k){var h=/\s*void\s*main\s*\([^)]*\)\s*\{/;(d=GLTFViewer.Utils.InsertBefore(d,h,"\nvarying vec4 _v_objPosition_;\nuniform mat4 "+f+";\n"))&&(d=GLTFViewer.Utils.InsertAfter(d,h,"\n_v_objPosition_ = "+f+" * vec4("+g+", 1.0);\n"));if(!d)return GLTFViewer.Utils.WriteLn("ERROR(ShaderProgram.CreateClipableProgram): Can't add clip code to vertex shader"),null;(e=GLTFViewer.Utils.InsertBefore(e,
h,"\nvarying vec4 _v_objPosition_;\nuniform vec4 "+k+";\n"))&&(e=GLTFViewer.Utils.InsertAfter(e,h,"\nif (dot(_v_objPosition_, "+k+") < 0.0) discard;\n"));if(!e)return GLTFViewer.Utils.WriteLn("ERROR(ShaderProgram.CreateClipableProgram): Can't add clip code to fragment shader"),null;k=null;try{k=new GLTFViewer.Utils.ShaderProgram(a,c,d,e)}catch(l){GLTFViewer.Utils.WriteErr(l)}return k}},CreateClipableCapProgram:{value:function(a,c,d,e,f,g,k,h){var l=/\s*void\s*main\s*\([^)]*\)\s*\{/;(d=GLTFViewer.Utils.InsertBefore(d,
l,"\nvarying vec4 _v_objPosition_;\nuniform mat4 "+f+";\n"))&&(d=GLTFViewer.Utils.InsertAfter(d,l,"\n_v_objPosition_ = "+f+" * vec4("+g+", 1.0);\n"));if(!d)return GLTFViewer.Utils.WriteLn("ERROR(ShaderProgram.CreateClipableCapProgram): Can't add clip code to vertex shader"),null;(e=GLTFViewer.Utils.InsertBefore(e,l,"\nvarying vec4 _v_objPosition_;\nuniform vec4 "+k+";\nuniform vec4 "+h+";\n"))&&(e=GLTFViewer.Utils.InsertAfter(e,l,"\nif (dot(_v_objPosition_, "+k+") < 0.0) discard;\n"));e&&(l=/gl_FragColor\s*=\s*[^;]*\s*;/,
e=GLTFViewer.Utils.InsertReplace(e,l,"\ngl_FragColor = "+h+";\n"));if(!e)return GLTFViewer.Utils.WriteLn("ERROR(ShaderProgram.CreateClipableCapProgram): Can't add clip code to fragment shader"),null;k=null;try{k=new GLTFViewer.Utils.ShaderProgram(a,c,d,e)}catch(m){GLTFViewer.Utils.WriteErr(m)}return k}},CreatePeelProgram:{value:function(a,c,d,e){var f=/\s*void\s*main\s*\(\s*\)\s*\{/;e=GLTFViewer.Utils.InsertBefore(e,f,"\nuniform vec2 uSze;\nuniform int uPass;\nconst float fAcc = 0.00001;\nuniform sampler2D DepthTex;\n");
if(!e)return null;f=/gl_FragColor.*;/;e=GLTFViewer.Utils.InsertAfter(e,f,"\nif (uPass == 1) {\n  gl_FragColor.r = gl_FragCoord.z;\n} else if (uPass == 2) {\n  float d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\n  if (d == 0.0 || abs(d - gl_FragCoord.z) > fAcc) discard;\n} else if (uPass == 3) {\n  float d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\n  if (d == 0.0 || d - gl_FragCoord.z >= -fAcc) discard;\n  gl_FragColor.r = gl_FragCoord.z;\n}\n");if(!e)return null;f=null;try{f=new GLTFViewer.Utils.ShaderProgram(a,
c,d,e)}catch(g){GLTFViewer.Utils.WriteErr(g)}return f}},RemoveComments:{value:function(a){return a.replace(/\/\*[^]*?\*\//gm,"").replace(/\/\/.*/g,"")}}});
GLTFViewer.Utils.Background=function(a){this._gl=a;this._colorShader=new GLTFViewer.Utils.ShaderProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Background._vsColor,GLTFViewer.Utils.Background._fsColor);var c=new ArrayBuffer(48);this._solidPos=new Float32Array(c,0,12);this._solidClr=new Uint32Array(c,0,12);this._solidBuf=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._solidBuf);a.bufferData(a.ARRAY_BUFFER,c,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null)};
GLTFViewer.Utils.Background.prototype=Object.create(null,{_gl:{writable:!0,value:null},_colorSet:{writable:!0,value:!1},_bkColor0:{writable:!0,value:-1},_bkColor1:{writable:!0,value:-1},_bkColor2:{writable:!0,value:-1},_bkColor3:{writable:!0,value:-1},_colorShader:{writable:!0,value:null},_solidBuf:{writable:!0,value:null},_solidPos:{writable:!0,value:null},_solidClr:{writable:!0,value:null},IsDark:{value:function(a){if(!this._colorSet)return!1;var c=new GLTFViewer.Utils.RGBA,d=new GLTFViewer.Utils.RGBA;
switch(a){case GLTFViewer.Utils.Background.LEFTTOP:c.SetRawABGR(this._bkColor0);break;case GLTFViewer.Utils.Background.TOP:c.SetRawABGR(this._bkColor0);d.SetRawABGR(this._bkColor0);c.r=(c.r+d.r)/2;c.g=(c.g+d.g)/2;c.b=(c.b+d.b)/2;c.a=(c.a+d.a)/2;break;case GLTFViewer.Utils.Background.RIGHTTOP:c.SetRawABGR(this._bkColor1);break;case GLTFViewer.Utils.Background.RIGHT:c.SetRawABGR(this._bkColor1);d.SetRawABGR(this._bkColor3);c.r=(c.r+d.r)/2;c.g=(c.g+d.g)/2;c.b=(c.b+d.b)/2;c.a=(c.a+d.a)/2;break;case GLTFViewer.Utils.Background.RIGHTBOTTOM:c.SetRawABGR(this._bkColor3);
break;case GLTFViewer.Utils.Background.BOTTOM:c.SetRawABGR(this._bkColor3);d.SetRawABGR(this._bkColor2);c.r=(c.r+d.r)/2;c.g=(c.g+d.g)/2;c.b=(c.b+d.b)/2;c.a=(c.a+d.a)/2;break;case GLTFViewer.Utils.Background.LEFTBOTTOM:c.SetRawABGR(this._bkColor2);break;case GLTFViewer.Utils.Background.LEFT:c.SetRawABGR(this._bkColor2);d.SetRawABGR(this._bkColor0);c.r=(c.r+d.r)/2;c.g=(c.g+d.g)/2;c.b=(c.b+d.b)/2;c.a=(c.a+d.a)/2;break;default:c.SetRawABGR(this._bkColor1),d.SetRawABGR(this._bkColor2),c.r=(c.r+d.r)/2,
c.g=(c.g+d.g)/2,c.b=(c.b+d.b)/2,c.a=(c.a+d.a)/2}return.5>c.GetGray()}},Reset:{value:function(){this._colorSet=!1;this._bkColor3=this._bkColor2=this._bkColor1=this._bkColor0=-1}},Clear:{value:function(){GLTFViewer.Utils.Background.prototype.Reset.call(this);null!==this._colorShader&&(this._colorShader.DeleteProgram(),this._colorShader=null);this._solidClr=this._solidPos=null;this._solidBuf&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,null),this._gl.deleteBuffer(this._solidBuf),this._solidBuf=null);
this._gl=null}},SetSolidColors:{value:function(a,c,d,e){this._colorSet=!0;this._bkColor0=a;this._bkColor1=c;this._bkColor2=d;this._bkColor3=e}},Render:{value:function(){var a=this._gl;if(this._colorSet){var c=this._solidPos,d=this._solidClr,e=this._colorShader;if(e.StartProgram()){a.disable(a.DEPTH_TEST);a.bindBuffer(a.ARRAY_BUFFER,this._solidBuf);var f=0;c[f++]=0;c[f++]=0;d[f++]=this._bkColor0;c[f++]=1;c[f++]=0;d[f++]=this._bkColor1;c[f++]=0;c[f++]=1;d[f++]=this._bkColor2;c[f++]=1;c[f++]=1;d[f++]=
this._bkColor3;a.bufferSubData(a.ARRAY_BUFFER,0,this._solidPos);a.vertexAttribPointer(e.aPos,2,a.FLOAT,!1,12,0);a.vertexAttribPointer(e.aTex,4,a.UNSIGNED_BYTE,!0,12,8);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.bindBuffer(a.ARRAY_BUFFER,null);a.enable(a.DEPTH_TEST)}}}}});
Object.defineProperties(GLTFViewer.Utils.Background,{_vsColor:{value:"attribute vec2 aPos;\nattribute vec4 aTex;\nvarying vec4 vTex;\nvoid main() {\nvec2 tmp = (aPos * 2.0 - 1.0) * vec2(1, -1);\nvTex = aTex;\ngl_Position = vec4(tmp, 0, 1);\n}"},_fsColor:{value:"varying vec4 vTex;\nvoid main() {\ngl_FragColor = vTex;\n}"},LEFTTOP:{value:0},TOP:{value:1},RIGHTTOP:{value:2},RIGHT:{value:3},RIGHTBOTTOM:{value:4},BOTTOM:{value:5},LEFTBOTTOM:{value:6},LEFT:{value:7},CENTER:{VALUE:8}});
GLTFViewer.Utils.Ruler=function(a,c){this._gx=a;this._navigator=c};
GLTFViewer.Utils.Ruler.prototype=Object.create(null,{_navigator:{writable:!0,value:null},_gx:{writable:!0,value:null},Reset:{value:function(){}},Clear:{value:function(){this._gx=this._navigator=null}},Render:{value:function(){var a=this._navigator;if(!a.persp&&!a._scene.viewer._option.tn){var c=a._scene,d=c?c.handler:null;if(d){var e=c.background&&c.background.IsDark(GLTFViewer.Utils.Background.BOTTOM)?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)",c=c.background&&c.background.IsDark(GLTFViewer.Utils.Background.BOTTOM)?
"rgba(0, 0, 0, 0.5)":"rgba(255, 255, 255, 0.5)",f=this._gx,g=a.canvasWidth,k=a.canvasHeight,h=a.projectionTM.a33;g>k&&(h*=g/k);var a=1/3*h,l=Math.log(a)/Math.LN10,l=Math.pow(10,Math.floor(l)),a=Math.floor(a/l)*l;rulerWidth=a/h;h=null;if(d=d.Ruler){l=d.scale;if(0<l){h=d.units;if(!h||""===h)return;a*=l}d=1E5<=a?a.toExponential(3):1E3<=a?a.toFixed(0):100<=a?a.toFixed(1):10<=a?a.toFixed(2):1<=a?a.toFixed(3):.01<=a?a.toFixed(4):a.toExponential(3);h&&(d+="  ("+h+")");a=g*(1-rulerWidth)/2;k-=50;f.lineCap=
"round";f.textBaseline="middle";f.textAlign="start";f.font="12px Sans-Serif";var m=a,n=k,h=m-2,l=n-2,m=m+g*rulerWidth+10+f.measureText(d).width+2,n=n+12+2;f.fillStyle=c;f.lineWidth=0;f.beginPath();f.moveTo(h,l);f.lineTo(h,n);f.lineTo(m,n);f.lineTo(m,l);f.fill();f.strokeStyle=e;f.lineWidth=1;m=a;n=k;f.beginPath();f.moveTo(m,n);n+=12;f.lineTo(m,n);m+=g*rulerWidth;f.lineTo(m,n);n-=12;f.lineTo(m,n);f.stroke();f.fillStyle=e;f.fillText(d,m+10,n+6)}}}}}});
GLTFViewer.Utils.Legend=function(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w,t,x){this._scene=a;this._vertical=c;"number"===typeof d&&0<=d&&1>d&&(this._x=d);"number"===typeof e&&0<=e&&1>e&&(this._y=e);"number"===typeof f&&0<f&&1>=f&&(this._size=f);"number"===typeof g&&0<=g&&15>=g&&(this._attachment=g);k&&(this._border=!0);this._foregroundColor=h instanceof GLTFViewer.Utils.RGBA?"rgba("+Math.round(h.r)+","+Math.round(h.g)+","+Math.round(h.b)+","+h.a/255+")":"rgba(0, 0, 0, 1)";l instanceof GLTFViewer.Utils.RGBA&&
l.a&&(this._backgroundColor="rgba("+Math.round(l.r)+","+Math.round(l.g)+","+Math.round(l.b)+","+l.a/255+")");m instanceof Array?(this._title=m,2<this._title.length&&(this._title.length=2)):this._title=[];"number"===typeof n&&(this._valueMin=n);"number"===typeof n&&(this._valueMax=p);this._valueMin>this._valueMax&&(a=this._valueMax,this._valueMax=this._valueMin,this._valueMin=a);"number"===typeof q&&3<q?this._numTicks=q:GLTFViewer.Utils.IsNull(u)||(this._numTicks=u.length/2);GLTFViewer.Utils.IsNull(u)&&
r&&(this._logIt=!0);this._valueLocation=u;this._img=w;this._units=[];"string"===typeof t&&t.length&&(this._units=[],this._units.push("["+t+"]"));this._other=x instanceof Array?x:[]};
GLTFViewer.Utils.Legend.prototype=Object.create(null,{_scene:{writable:!0,value:null},_vertical:{writable:!0,value:!0},_x:{writable:!0,value:0},_y:{writable:!0,value:0},_size:{writable:!0,value:.5},_attachment:{writable:!0,value:7},_border:{writable:!0,value:!1},_foregroundColor:{writable:!0,value:null},_backgroundColor:{writable:!0,value:null},_title:{writable:!0,value:null},_valueMin:{writable:!0,value:0},_valueMax:{writable:!0,value:1},_numTicks:{writable:!0,value:0},_valueLocatino:{writable:!0,
value:null},_logIt:{writable:!0,value:!1},_img:{writable:!0,value:null},_units:{writable:!0,value:null},_other:{writable:!0,value:null},_canvasWidth:{writable:!0,value:0},_canvasHeight:{writable:!0,value:0},_legendImage:{writable:!0,value:null},_legendX:{writable:!0,value:0},_legendY:{writable:!0,value:0},_legendWidth:{writable:!0,value:0},_legendHeight:{writable:!0,value:0},_GenerateTickValues:{value:function(a){var c=[],d=this._valueMax,e=this._valueMin,f=d-e;c.push([0,e.toExponential(4)]);if(2<
a)if(GLTFViewer.Utils.IsNull(this._valueLocation))if(this._logIt&&0<this._valueMin&&0<this._valueMax)for(e=Math.log(e)/Math.LN10,f=(Math.log(d)/Math.LN10-e)/(3<a?a-1:1),h=1;h<a-1;++h)e+=f,k=Math.pow(10,e),c.push([h/(a-1),k.toExponential(4)]);else for(h=1;h<a-1;++h){var g=h/(a-1),k=e+g*f;c.push([g,k.toExponential(4)])}else for(var h=1;h<a-1;++h){var k=this._valueLocation[2*h+0]*f+e;c.push([this._valueLocation[2*h+1],k.toExponential(4)])}c.push([1,d.toExponential(4)]);return c}},_BuildVerticalImage:{value:function(){var a=
this._canvasWidth,c=this._canvasHeight;this._legendHeight=Math.ceil((a>c?c:a)*this._size);var d=this._numTicks?this._numTicks:3,a=Math.floor((this._legendHeight-2*GLTFViewer.Utils.Legend._MARGIN-(this._title.length?GLTFViewer.Utils.Legend._MARGIN:0)-(this._other.length?GLTFViewer.Utils.Legend._MARGIN:0))/(this._title.length+d+this._units.length+GLTFViewer.Utils.Legend._OTHERFONTSCALE*this._other.length));1>a?a=1:a>GLTFViewer.Utils.Legend._MAXFONTSIZE&&(a=GLTFViewer.Utils.Legend._MAXFONTSIZE);c=Math.floor(a*
GLTFViewer.Utils.Legend._OTHERFONTSCALE);1>c&&(c=1);this._numTicks||(d=Math.floor((this._legendHeight-2*GLTFViewer.Utils.Legend._MARGIN-(this._title.length?GLTFViewer.Utils.Legend._MARGIN:0)-(this._other.length?GLTFViewer.Utils.Legend._MARGIN:0)-this._other.length*c)/a)-this._title.length-this._units.length,d>GLTFViewer.Utils.Legend._MAXTICKS&&(d=GLTFViewer.Utils.Legend._MAXTICKS));var e=this._GenerateTickValues(d),f=this._scene.gx;f.textBaseline="top";f.textAlign="left";f.font="bold "+a+"px sans-serif";
f.fillStyle="black";this._legendWidth=f.lineWidth=0;for(var g=GLTFViewer.Utils.TextWidth(f,this._title),k=0,h=0;h<e.length;++h){var l=GLTFViewer.Utils.TextWidth(f,e[h][1]);e[h].push(l);k=Math.max(k,l)}k+=GLTFViewer.Utils.Legend._BARSIZE+GLTFViewer.Utils.Legend._MARGIN+GLTFViewer.Utils.Legend._TICKSIZE;h=GLTFViewer.Utils.TextWidth(f,this._units);f.font=c+"px sans-serif";f=GLTFViewer.Utils.TextWidth(f,this._other);this._legendWidth=Math.ceil(Math.max(g,k,h,f)+2*GLTFViewer.Utils.Legend._MARGIN);g=this._legendHeight-
2*GLTFViewer.Utils.Legend._MARGIN-(this._title.length?GLTFViewer.Utils.Legend._MARGIN:0)-(this._other.length?GLTFViewer.Utils.Legend._MARGIN:0)-(this._title.length+this._units.length+1)*a-this._other.length*c;this._legendHeight=g+2*GLTFViewer.Utils.Legend._MARGIN+(this._title.length?GLTFViewer.Utils.Legend._MARGIN:0)+(this._other.length?GLTFViewer.Utils.Legend._MARGIN:0)+(this._title.length+this._units.length+1)*a+this._other.length*c;k=document.createElement("canvas");document.body.appendChild(k);
k.width=this._legendWidth;k.height=this._legendHeight;f=k.getContext("2d");f.mozImageSmoothingEnabled=!1;f.msImageSmoothingEnabled=!1;f.imageSmoothingEnabled=!1;GLTFViewer.Utils.IsNull(this._backgroundColor)||(f.fillStyle=this._backgroundColor,f.fillRect(0,0,this._legendWidth,this._legendHeight));f.font="bold "+a+"px sans-serif";f.fillStyle=this._foregroundColor;f.strokeStyle=this._foregroundColor;f.lineWidth=2;this._border&&f.strokeRect(0,0,this._legendWidth,this._legendHeight);h=Math.floor(this._attachment/
4);l=0==h&&.5<this._x||2==h;f.textAlign=l?"right":"left";var m=GLTFViewer.Utils.Legend._MARGIN;if(this._title.length){f.textBaseline="top";for(var n=l?this._legendWidth-GLTFViewer.Utils.Legend._MARGIN:GLTFViewer.Utils.Legend._MARGIN,h=0;h<this._title.length;++h)f.fillText(this._title[h],n,m),m+=a;m+=GLTFViewer.Utils.Legend._MARGIN}f.textBaseline="middle";var m=m+Math.ceil(.5*a),p=GLTFViewer.Utils.Legend._BARSIZE,n=l?this._legendWidth-GLTFViewer.Utils.Legend._MARGIN-p:GLTFViewer.Utils.Legend._MARGIN;
if(this._img){f.translate(n,m+g);f.rotate(-Math.PI/2);if(GLTFViewer.Utils.IsNull(this._valueLocation))f.drawImage(this._img,0,0,g,p);else for(var q=0,u=0,h=1;h<d;++h){var r=this._valueLocation[2*h+0]-this._valueLocation[2*h-2],w=this._valueLocation[2*h+1]-this._valueLocation[2*h-1];f.drawImage(this._img,q*this._img.width,0,r*this._img.width,this._img.height,u*g,0,w*g,p);q+=r;u+=w}f.rotate(Math.PI/2);f.translate(-n,-m-g)}f.strokeRect(n,m,p,g);n+=l?-GLTFViewer.Utils.Legend._TICKSIZE:p;m+=g;p=GLTFViewer.Utils.Legend._TICKSIZE;
for(h=0;h<e.length;++h)d=n,q=m-e[h][0]*g,f.beginPath(),f.moveTo(d,q),d+=p,f.lineTo(d,q),f.stroke(),d+=l?-(p+GLTFViewer.Utils.Legend._MARGIN):GLTFViewer.Utils.Legend._MARGIN,f.fillText(e[h][1],d,q);m+=Math.floor(.5*a);this._units.length&&(f.textBaseline="top",n=l?this._legendWidth-GLTFViewer.Utils.Legend._MARGIN:GLTFViewer.Utils.Legend._MARGIN,f.fillText(this._units[0],n,m),m+=a);if(this._other.length)for(f.textBaseline="top",f.font=c+"px sans-serif",n=l?this._legendWidth-GLTFViewer.Utils.Legend._MARGIN:
GLTFViewer.Utils.Legend._MARGIN,m+=GLTFViewer.Utils.Legend._MARGIN,h=0;h<this._other.length;++h)f.fillText(this._other[h],n,m),m+=c;this._legendImage=k.toDataURL();document.body.removeChild(k)}},_BuildHorizontalImage:{value:function(){var a=this._canvasWidth,c=this._canvasHeight,d,e,f,g,k,h,l,m,n;this._legendWidth=Math.ceil((a>c?c:a)*this._size);a=this._numTicks?this._numTicks:3;h=this._scene.gx;h.textBaseline="top";h.textAlign="left";h.font="bold 10px sans-serif";h.fillStyle="black";h.lineWidth=
0;d=GLTFViewer.Utils.TextWidth(h,this._title);f=GLTFViewer.Utils.TextWidth(h,this._units);c=this._GenerateTickValues(2);n=GLTFViewer.Utils.TextWidth(h,c[0][1]);l=GLTFViewer.Utils.TextWidth(h,c[1][1]);valueWidth=Math.max(n,l);m=Math.sqrt(25+valueWidth*valueWidth);m=Math.sqrt(25+l*l);m=Math.ceil(m*Math.cos(Math.PI/4-Math.acos(l/m)));h.font="8px sans-serif";k=GLTFViewer.Utils.TextWidth(h,this._other);l=Math.ceil(10*a*GLTFViewer.Utils.root2);fontSize=Math.floor((this._legendWidth-3*GLTFViewer.Utils.Legend._MARGIN-
Math.max(m,k+(k?GLTFViewer.Utils.Legend._MARGIN:0)))/Math.max(d+f,l)*10);1>fontSize?fontSize=1:fontSize>GLTFViewer.Utils.Legend._MAXFONTSIZE&&(fontSize=GLTFViewer.Utils.Legend._MAXFONTSIZE);var p=Math.floor(fontSize*GLTFViewer.Utils.Legend._OTHERFONTSCALE);1>p&&(p=1);this._numTicks||(m=Math.ceil(m*fontSize/10),k=Math.ceil(k*p/10),a=Math.floor((this._legendWidth-3*GLTFViewer.Utils.Legend._MARGIN-Math.max(m,k+(k?GLTFViewer.Utils.Legend._MARGIN:0)))/fontSize/GLTFViewer.Utils.root2),a>GLTFViewer.Utils.Legend._MAXTICKS&&
(a=GLTFViewer.Utils.Legend._MAXTICKS));c=this._GenerateTickValues(a);h.font="bold "+fontSize+"px sans-serif";d=GLTFViewer.Utils.TextWidth(h,this._title);e=this._title.length*fontSize;f=GLTFViewer.Utils.TextWidth(h,this._units);g=this._units.length*fontSize;n=GLTFViewer.Utils.TextWidth(h,c[0][1]);l=GLTFViewer.Utils.TextWidth(h,c[1][1]);valueWidth=Math.max(n,l);m=Math.sqrt(25+valueWidth*valueWidth);n=Math.ceil(m*Math.sin(Math.PI/4+Math.acos(valueWidth/m)));m=Math.sqrt(25+l*l);m=Math.ceil(m*Math.cos(Math.PI/
4-Math.acos(l/m)));l=Math.max(Math.max(f+d,Math.ceil(a*fontSize*GLTFViewer.Utils.root2)),this._legendWidth-3*GLTFViewer.Utils.Legend._MARGIN-Math.max(m,k+(k?GLTFViewer.Utils.Legend._MARGIN:0)));h.font=p+"px sans-serif";k=GLTFViewer.Utils.TextWidth(h,this._other);h=this._other.length*p;this._legendWidth=l+Math.max(m,k+(k?GLTFViewer.Utils.Legend._MARGIN:0))+3*GLTFViewer.Utils.Legend._MARGIN;m=Math.max(e,g);m+=m?GLTFViewer.Utils.Legend._MARGIN:0;this._legendHeight=3*GLTFViewer.Utils.Legend._MARGIN+Math.max(m+
GLTFViewer.Utils.Legend._BARSIZE,h)+GLTFViewer.Utils.Legend._TICKSIZE+n;k=document.createElement("canvas");document.body.appendChild(k);k.width=this._legendWidth;k.height=this._legendHeight;n=k.getContext("2d");n.mozImageSmoothingEnabled=!1;n.msImageSmoothingEnabled=!1;n.imageSmoothingEnabled=!1;GLTFViewer.Utils.IsNull(this._backgroundColor)||(n.fillStyle=this._backgroundColor,n.fillRect(0,0,this._legendWidth,this._legendHeight));n.font="bold "+fontSize+"px sans-serif";n.fillStyle=this._foregroundColor;
n.strokeStyle=this._foregroundColor;n.lineWidth=2;this._border&&n.strokeRect(0,0,this._legendWidth,this._legendHeight);d=this._attachment-4*Math.floor(this._attachment/4);d=0==d&&.5>this._y||2==d;f=2*GLTFViewer.Utils.Legend._MARGIN;h=d?GLTFViewer.Utils.Legend._MARGIN+Math.max(m+GLTFViewer.Utils.Legend._BARSIZE,h)-GLTFViewer.Utils.Legend._BARSIZE:this._legendHeight-Math.max(m+GLTFViewer.Utils.Legend._BARSIZE,h)-GLTFViewer.Utils.Legend._MARGIN;if(this._title.length)for(n.textAlign="left",n.textBaseline=
"top",m=d?h-GLTFViewer.Utils.Legend._MARGIN-e:h+GLTFViewer.Utils.Legend._BARSIZE+GLTFViewer.Utils.Legend._MARGIN,e=0;e<this._title.length;++e)n.fillText(this._title[e],f,m),m+=fontSize;this._title.length&&(n.textAlign="right",n.textBaseline="top",m=d?h-GLTFViewer.Utils.Legend._MARGIN-g:h+GLTFViewer.Utils.Legend._BARSIZE+GLTFViewer.Utils.Legend._MARGIN,n.fillText(this._units[0],f+l,m));if(this._other.length){n.font=p+"px sans-serif";n.textAlign="left";n.textBaseline="top";m=d?GLTFViewer.Utils.Legend._MARGIN:
h;g=f+GLTFViewer.Utils.Legend._MARGIN+l;for(e=0;e<this._other.length;++e)n.fillText(this._other[e],g,m),m+=p;n.font="bold "+fontSize+"px sans-serif"}n.textAlign="left";n.textBaseline="middle";p=l;g=GLTFViewer.Utils.Legend._BARSIZE;if(this._img)if(GLTFViewer.Utils.IsNull(this._valueLocation))n.drawImage(this._img,f,h,p,g);else for(m=l=0,e=1;e<a;++e){var q=this._valueLocation[2*e+0]-this._valueLocation[2*e-2],u=this._valueLocation[2*e+1]-this._valueLocation[2*e-1];n.drawImage(this._img,l*this._img.width,
0,q*this._img.width,this._img.height,f+m*p,h,u*p,g);l+=q;m+=u}n.strokeRect(f,h,p,g);h+=d?GLTFViewer.Utils.Legend._BARSIZE:-GLTFViewer.Utils.Legend._TICKSIZE;for(e=0;e<c.length;++e)g=f+c[e][0]*p,m=h,n.beginPath(),n.moveTo(g,m),m+=GLTFViewer.Utils.Legend._TICKSIZE,n.lineTo(g,m),n.stroke(),m+=d?GLTFViewer.Utils.Legend._MARGIN:-(GLTFViewer.Utils.Legend._MARGIN+GLTFViewer.Utils.Legend._TICKSIZE),n.translate(g,m),n.rotate((d?Math.PI:-Math.PI)/4),n.fillText(c[e][1],0,0),n.rotate((d?-Math.PI:Math.PI)/4),
n.translate(-g,-m);this._legendImage=k.toDataURL();document.body.removeChild(k)}},_BuildImage:{value:function(){var a=this._scene.navigator,c=a.canvasWidth,a=a.canvasHeight;if(this._canvasWidth!=c||this._canvasHeight!=a)this._legendImage=null,this._canvasWidth=c,this._canvasHeight=a,this._vertical?this._BuildVerticalImage():this._BuildHorizontalImage()}},Reset:{value:function(){this._canvasHeight=this._canvasWidth=0}},Clear:{value:function(){this._valueLocation=this._legendImage=this._other=this._units=
this.img=this._title=this._backgroundColor=this._foregroundColor=this._scene=null}},Render:{value:function(){this._BuildImage();if(!GLTFViewer.Utils.IsNull(this._legendImage)){var a=this._x?this._x*this._canvasWidth:0,c=this._y?this._y*this._canvasHeight:0,d=Math.floor(this._attachment/4),e=this._attachment-4*d;switch(d){case 1:a=0;break;case 2:a=this._canvasWidth-this._legendWidth;break;case 3:a=(this._canvasWidth-this._legendWidth)/2}switch(e){case 1:c=this._canvasHeight-this._legendHeight;break;
case 2:c=0;break;case 3:c=(this._canvasHeight-this._legendHeight)/2}d=document.createElement("img");d.src=this._legendImage;document.body.appendChild(d);e=this._scene.gx;e.mozImageSmoothingEnabled=!1;e.msImageSmoothingEnabled=!1;e.imageSmoothingEnabled=!1;e.drawImage(d,a-a%2,c-c%2,this._legendWidth,this._legendHeight);document.body.removeChild(d)}}}});
Object.defineProperties(GLTFViewer.Utils.Legend,{_MAXTICKS:{value:11},_MAXFONTSIZE:{value:15},_BARSIZE:{value:20},_TICKSIZE:{value:5},_MARGIN:{value:5},_OTHERFONTSCALE:{value:.8},RenderHighlight:{value:function(a){}}});
GLTFViewer.Utils.Markup=function(a){this._scene=a;this._dirty=GLTFViewer.Utils.Markup.DIRTY_NO;this._lines={};this._state=GLTFViewer.Utils.Markup.STATE_DISABLED;this._cursorRay=new GLTFViewer.Utils.CursorRay(a.navigator);this._lineID=1;this._hit=0;this._hitPnt=new GLTFViewer.Utils.Vec3;this._hitWhat=GLTFViewer.Utils.Markup.Line.HIT_NONE;this._select=0;this._selectWhat=GLTFViewer.Utils.Markup.Line.HIT_NONE;this._wantTextEdit=!1;this._textSize=GLTFViewer.DEFAULT_MARKUP_FONT_SIZE;this.LineType=GLTFViewer.Utils.Markup.LINE_TYPE_2D;
this._position=new GLTFViewer.Utils.Vec3;this._position2D=new GLTFViewer.Utils.Vec3;this._textOffset=new GLTFViewer.Utils.Vec3;this._textAttach=GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO;this.LineShape=GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE;this.LineColor=new GLTFViewer.Utils.RGBA(0,0,0,255);this._textFont="sans-serif";this.FontColor=new GLTFViewer.Utils.RGBA(0,0,0,255);this.BackColor=new GLTFViewer.Utils.RGBA(255,255,255,127);this.FontSize=GLTFViewer.DEFAULT_MARKUP_FONT_SIZE;this._startEdit=new GLTFViewer.Utils.Vec3;
this._offsetEdit=new GLTFViewer.Utils.Vec3;var c=this._scene.gl;this._lineShader=new GLTFViewer.Utils.ShaderProgram(a.gl,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Markup._vsSolid,GLTFViewer.Utils.Markup._fsSolid);this._dashShader=new GLTFViewer.Utils.ShaderProgram(a.gl,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Markup._vsDash,GLTFViewer.Utils.Markup._fsDash);this._solidPos=new Float32Array(9);this._solidBuf=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this._solidBuf);
c.bufferData(c.ARRAY_BUFFER,this._solidPos,c.DYNAMIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,null)};
GLTFViewer.Utils.Markup.prototype=Object.create(null,{_blurTimer:{writable:!0,value:null},_scene:{writable:!0,value:null},_dirty:{writable:!0,value:0},_lines:{writable:!0,value:null},_lineID:{writable:!0,value:1},_lineShader:{writable:!0,value:null},_dashShader:{writable:!0,value:null},_solidBuf:{writable:!0,value:null},_solidPos:{writable:!0,value:null},_state:{writable:!0,value:0},_cursorRay:{writable:!0,value:null},_hit:{writable:!0,value:0},_hitPnt:{writable:!0,value:null},_hitWhat:{writable:!0,
value:0},_select:{writable:!0,value:0},_selectWhat:{writable:!0,value:0},_textLine:{writable:!0,value:null},_wantTextEdit:{writable:!0,value:!1},_tip:{writable:!0,value:null},_type:{writable:!0,value:0},_position:{writable:!0,value:null},_index:{writable:!0,value:null},_position2D:{writable:!0,value:null},_lineShape:{writable:!0,value:0},_lineColor:{writable:!0,value:null},_textOffset:{writable:!0,value:null},_textAttach:{writable:!0,value:0},_textSize:{writable:!0,value:16},_textFont:{writable:!0,
value:null},_textColor:{writable:!0,value:null},_backColor:{writable:!0,value:null},_startEdit:{writable:!0,value:null},_offsetEdit:{writable:!0,value:null},IsDirty:{value:function(){return this.Dirty===GLTFViewer.Utils.Markup.DIRTY_YES}},ResetDirty:{value:function(){this.Dirty=GLTFViewer.Utils.Markup.DIRTY_NO}},Dirty:{get:function(){return this._dirty},set:function(a){this._dirty=a}},LineType:{get:function(){return this._type},set:function(a){a<GLTFViewer.Utils.Markup.LINE_TYPE_2D||a>GLTFViewer.Utils.Markup.LINE_TYPE_3D||
(this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns2D,null,GLTFViewer.MENUUNCHECK),this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns3D,null,GLTFViewer.MENUUNCHECK),this._scene.viewer.MarkupMenuBtnState(a-GLTFViewer.Utils.Markup.LINE_TYPE_2D,null,GLTFViewer.MENUCHECK),a===GLTFViewer.Utils.Markup.LINE_TYPE_2D?(this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineShape,null,GLTFViewer.MENUDISABLE),this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineColor,
null,GLTFViewer.MENUDISABLE)):(this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineShape,null,GLTFViewer.MENUENABLE),this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineColor,null,GLTFViewer.MENUENABLE)),this._type=a)}},LineShape:{get:function(){return this._lineShape},set:function(a){a<GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE||a>GLTFViewer.Utils.Markup.LINE_SYMBOL_BALL||(this._lineShape=a,this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineShape,null,
GLTFViewer.MENUICON,GLTFViewer.ICONMARKUPLINE+(a-GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE)),this._select&&(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),this._lines[this._select]._lineShape=a,this._scene.Invalidate(!0)))}},LineColor:{get:function(){return this._lineColor},set:function(a){this._lineColor=a.Clone();this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsLineColor,null,GLTFViewer.MENUICON,a);this._select&&(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&
(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),this._lines[this._select]._lineColor=a.Clone(),this._scene.Invalidate(!0))}},FontColor:{get:function(){return this._textColor},set:function(a){this._textColor=a.Clone();this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsFontColor,null,GLTFViewer.MENUICON,a);this._select&&(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),this._lines[this._select]._textColor=a.Clone(),this._scene.Invalidate(!0))}},
FontSize:{get:function(){return this._textSize},set:function(a){GLTFViewer.Utils.IsNull(a)||(a*=1,1>a||99<a||(this._textSize=a,this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsFontSize,null,GLTFViewer.MENUICON,a),this._select&&(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),this._lines[this._select]._textSize=a,this._scene.Invalidate(!0))))}},BackColor:{get:function(){return this._backColor},set:function(a){this._backColor=a.Clone();this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtnsBackColor,
null,GLTFViewer.MENUICON,this._backColor);this._select&&(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),this._lines[this._select]._backColor=this._backColor.Clone(),this._scene.Invalidate(!0))}},OnTextInputBlur:{value:function(a){this.EndTexting();GLTFViewer.Utils.IsNull(this._blurTimer)||clearTimeout(this._blurTimer);this._blurTimer=setTimeout(function(){this._blurTimer=null}.bind(this),500)}},OnTextInputKeyDown:{value:function(a){a.stopPropagation();
if(27===a.keyCode){var c=this._wantTextEdit;a.preventDefault();this.EndTexting();c?this._scene.MarkupDelete():this._scene.MarkupEsc()}}},OnTextInputKeyUp:{value:function(a){a.stopPropagation();this.TextInputChanged()}},OnTextInputMouseDown:{value:function(a){a.stopPropagation()}},OnTextInputMouseUp:{value:function(a){a.stopPropagation()}},OnTextInputMouseMove:{value:function(a){a.stopPropagation()}},OnTextInputOnPaste:{value:function(a){setTimeout(this.TextInputChanged.bind(this),10)}},_ToClosestHit3D:{value:function(a,
c){var d=this._scene,e=d.navigator;this._cursorRay.Update(a,c);return d.handler?d.handler.HitTestPos(e.uTVP,e.canvasWidth,e.canvasHeight,this._cursorRay):null}},_ToClosestHit2D:{value:function(a,c){var d=this._scene,e=d.navigator,f=this._ToClosestHit3D(a,c);return f?(e.Project(f),this._cursorRay.Update(f.x,f.y),d.handler.HitTest(e.uTVP,e.canvasWidth,e.canvasHeight,this._cursorRay,!0),d.handler.hit):new GLTFViewer.Utils.Vec3(a,c,0)}},TextInputChanged:{value:function(){this.UpdateTexting()}},_RenderTmpLine:{value:function(){var a=
this._scene.gx;if(this.LineType!==GLTFViewer.Utils.Markup.LINE_TYPE_2D){var c=this._position.x,d=this._position.y,e=c+this._textOffset.x,f=d+this._textOffset.y,g=this.LineShape===GLTFViewer.Utils.Markup.LINE_SYMBOL_BALL,k=this.LineShape===GLTFViewer.Utils.Markup.LINE_SYMBOL_ARROW,h=(c-e)*(c-e)+(d-f)*(d-f),l=(GLTFViewer.Utils.Markup._ballSize+1)/2,h=!g&&1<h||g&&h>l*l,l="rgba("+Math.round(this.LineColor.r)+","+Math.round(this.LineColor.g)+","+Math.round(this.LineColor.b)+","+this.LineColor.a/255+")";
g&&(a.lineWidth=0,a.fillStyle=l,a.beginPath(),a.arc(c,d,3.5,0,2*Math.PI,!1),a.fill());h&&(a.lineCap="round",a.strokeStyle=l,a.lineWidth=1.5,a.beginPath(),a.moveTo(c,d),a.lineTo(e,f),a.stroke(),k&&(f=new GLTFViewer.Utils.Vec3(c-e,d-f,0),f.Normalize(),e=new GLTFViewer.Utils.Vec3(f.x-f.y,f.y+f.x,0),e.Normalize(),f=new GLTFViewer.Utils.Vec3(f.x+f.y,f.y-f.x,0),f.Normalize(),a.beginPath(),a.moveTo(c-GLTFViewer.Utils.Markup._ballSize*e.x,d-GLTFViewer.Utils.Markup._ballSize*e.y),a.lineTo(c,d),a.lineTo(c-
GLTFViewer.Utils.Markup._ballSize*f.x,d-GLTFViewer.Utils.Markup._ballSize*f.y),a.stroke()))}GLTFViewer.Utils.Markup.RenderHighlight(a,this.LineType,this._position,this._textOffset,null,!0,GLTFViewer.Utils.Markup.Line.HIT_NONE,!0)}},Reset:{value:function(){for(var a=0;a<this._lines.length;++a)this._lines[a]=null;this.Dirty=GLTFViewer.Utils.Markup.DIRTY_NO;this._lines=[];this._lineID=1;this._hit=0;this._tip=null;this._hitWhat=this._selectWhat=GLTFViewer.Utils.Markup.Line.HIT_NONE;this.ResetSelection();
this._textLine=null;this._wantTextEdit=!1;GLTFViewer.Utils.IsNull(this._blurTimer)||(clearTimeout(this._blurTimer),this._blurTimer=null)}},Clear:{value:function(){GLTFViewer.Utils.Markup.prototype.Reset.call(this);for(var a=Object.keys(this._lines),c=0;c<a.length;++c)this._lines[a[c]].Clear(),delete this._lines[a[c]];this._lines=null;null!==this._lineShader&&(this._lineShader.DeleteProgram(),this._lineShader=null);null!==this._dashShader&&(this._dashShader.DeleteProgram(),this._dashShader=null);this._solidPos=
null;this._solidBuf&&(a=this._scene.gl,a.bindBuffer(a.ARRAY_BUFFER,null),a.deleteBuffer(this._solidBuf),this._solidBuf=null);this._scene=this._tip=this._textLine=this._cursorRay=this._backColor=this._textColor=this._lineColor=this._textOffset=this._position2D=this._position=this._hitPnt=null}},AnySelection:{value:function(){return 0!==this._select}},ResetSelection:{value:function(){this._select=0;this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns2D,null,GLTFViewer.MENUENABLE);GLTFViewer.Utils.IsApple()||
this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns3D,null,GLTFViewer.MENUENABLE)}},SetSelection:{value:function(a,c){this._select=a;this._selectWhat=c;this.UpdateState(a);this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns2D,null,this._select?GLTFViewer.MENUDISABLE:GLTFViewer.MENUENABLE);GLTFViewer.Utils.IsApple()||this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns3D,null,this._select?GLTFViewer.MENUDISABLE:GLTFViewer.MENUENABLE)}},UpdateSelection:{value:function(a,
c){var d=this._select;this._hit&&this._hitWhat===GLTFViewer.Utils.Markup.Line.HIT_TEXT&&this._state!==GLTFViewer.Utils.Markup.STATE_EDIT_TEXT?this.StartTexting(this._hitPnt):this.EndTexting();this._hit?this.SetSelection(this._hit,this._hitWhat):this.ResetSelection();return d!==this._select&&this._select}},UpdateState:{value:function(a){a&&(a=this._lines[a],this.LineType=a._type,this._position=a._position.Clone(),this._index=a._index,this._position2D=a._position2D.Clone(),this.LineColor=a._lineColor.Clone(),
this.LineShape=a._lineShape,this._textOffset=a._textOffset.Clone(),this.FontSize=a._textSize,this.FontColor=a._textColor.Clone(),this.BackColor=a._backColor.Clone())}},GetLineKeys:{value:function(){return Object.keys(this._lines)}},GetLine:{value:function(a){return this._lines[a]}},Render3D:{value:function(a){var c=Object.keys(this._lines);if(this._scene.AnimationStopped()&&0!==c.length){var d=this._scene.gl,e=this._lineShader;if(e.StartProgram()){d.enable(d.DEPTH_TEST);d.uniformMatrix4fv(e.uTVP,
!1,a);d.bindBuffer(d.ARRAY_BUFFER,this._solidBuf);for(var f=0;f<c.length;++f)this._lines[c[f]].RenderLine(GLTFViewer.Utils.Markup.LINE_SOLID,e,this._solidPos);d.bindBuffer(d.ARRAY_BUFFER,null)}e=this._dashShader;if(e.StartProgram()){d.disable(d.DEPTH_TEST);d.uniformMatrix4fv(e.uTVP,!1,a);d.bindBuffer(d.ARRAY_BUFFER,this._solidBuf);for(f=0;f<c.length;++f)this._lines[c[f]].RenderLine(GLTFViewer.Utils.Markup.LINE_DASHED,e,this._solidPos);d.bindBuffer(d.ARRAY_BUFFER,null)}}}},Render2D:{value:function(a){a=
Object.keys(this._lines);for(var c=0;c<a.length;++c){var d=this._lines[a[c]];(this._scene.AnimationStopped()||d._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D)&&d.RenderText(this._select==a[c],this._state===GLTFViewer.Utils.Markup.STATE_EDIT_TEXT&&d===this._textLine)}if(this._scene.AnimationStopped()&&(this._state===GLTFViewer.Utils.Markup.STATE_CREATE_LINE&&this._RenderTmpLine(),this._state!==GLTFViewer.Utils.Markup.STATE_EDIT_TEXT&&this._wantTextEdit&&this.StartTexting(),this._state!==GLTFViewer.Utils.Markup.STATE_DISABLED&&
(0!==this._hit||0!==this._select)))for(c=0;c<a.length;++c)if(this._hit==a[c]||this._select==a[c])d=this._lines[a[c]],d._isDrawn&&GLTFViewer.Utils.Markup.RenderHighlight(this._scene.gx,d._type,d._position2D,d._textOffset,d._textBox,this._select==a[c],this._hit==a[c]?this._hitWhat:GLTFViewer.Utils.Markup.Line.HIT_NONE,d===this._textLine)}},CreateMarkupLine:{value:function(a,c,d,e,f,g,k,h,l,m,n,p,q){a instanceof GLTFViewer.Utils.Markup.Line&&(q=a._backColor,p=a._textColor,n=a._textFont,m=a._textSize,
l=a._textAttach,h=a._textOffset,k=a._text,g=a._lineShape,f=a._lineColor,d=a._position,e=a._index,c=a._type,a=a._editable);var u=this._lineID;++this._lineID;this._lines[u]=new GLTFViewer.Utils.Markup.Line(this._scene,GLTFViewer.Utils.IsNull(a)?!1:a,GLTFViewer.Utils.IsNull(c)?this.LineType:c,d?d:this._position,GLTFViewer.Utils.IsNull(e)?this._index:e,f?f:this.LineColor,GLTFViewer.Utils.IsNull(g)?this.LineShape:g,GLTFViewer.Utils.IsNull(k)?"":k,h?h:this._textOffset,GLTFViewer.Utils.IsNull(l)?this._textAttach:
l,GLTFViewer.Utils.IsNull(m)?this.FontSize:m,GLTFViewer.Utils.IsNull(n)?this._textFont:n,p?p:this.FontColor,q?q:this.BackColor);this._lines[u].Editable&&this._state===GLTFViewer.Utils.Markup.STATE_ENABLED?(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_MAYBE),this._hitWhat=GLTFViewer.Utils.Markup.Line.HIT_TEXT,this._hit=u,this.SetSelection(this._hit,this._hitWhat),this._tip=null,this._wantTextEdit=!0,this._hitPnt.Set()):this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES;
return u}},DeleteMarkupLine:{value:function(a){var c=this._lines[a];GLTFViewer.Utils.IsNull(c)||(this.Dirty===GLTFViewer.Utils.Markup.DIRTY_MAYBE&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_NO),c.Clear(),delete this._lines[a]);this.EscMarkupLine()}},EscMarkupLine:{value:function(){this._hit=0;this.ResetSelection();this._textLine=this._tip=null;this._wantTextEdit=!1}},HitTip:{value:function(a,c,d){return"("+a.toPrecision(4)+", "+c.toPrecision(4)+(GLTFViewer.Utils.IsNull(d)?"":", "+d.toPrecision(4))+
")"}},HitMarkup:{value:function(a){if(this._wantTextEdit&&this._state===GLTFViewer.Utils.Markup.STATE_ENABLED)return this._hit;this._hitWhat=GLTFViewer.Utils.Markup.Line.HIT_NONE;this._hit=0;this._tip=null;for(var c=Object.keys(this._lines),d=0;d<c.length;++d){var e=c[d],f=this._lines[e];this._hitWhat=f.HitMarkup(a,e==this._select);if(this._hitWhat!==GLTFViewer.Utils.Markup.Line.HIT_NONE){this._hit=parseInt(e);this._hitPnt.Set(a);this._hitWhat===GLTFViewer.Utils.Markup.Line.HIT_START?this._tip=f._type===
GLTFViewer.Utils.Markup.LINE_TYPE_2D?this.HitTip(f._position.x,f._position.y):this.HitTip(f._position.x,f._position.y,f._position.z):this._hitWhat===GLTFViewer.Utils.Markup.Line.HIT_START_OFFSET&&(this._tip=this.HitTip(f._textOffset.x,f._textOffset.y));break}}return this._hit}},Start:{value:function(a,c){if(GLTFViewer.Utils.IsNull(this._blurTimer)){var d=this._hit,e=this._hitWhat;switch(this._state){case GLTFViewer.Utils.Markup.STATE_ENABLED:if(0!==d&&e!==GLTFViewer.Utils.Markup.Line.HIT_NONE){this.UpdateState(d);
this._startEdit.Set(a,c,0);this._offsetEdit.Set(0,0,0);if(this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_3D&&e===GLTFViewer.Utils.Markup.Line.HIT_LINE){var f=this._lines[d];this._offsetEdit.Set(a-f._position2D.x,c-f._position2D.y,0)}if(this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D&&e===GLTFViewer.Utils.Markup.Line.HIT_TEXT&&(f=this._lines[d],f._textBox&&f._textAttach!==GLTFViewer.Utils.Markup.TEXT_ATTACH_CENTER)){e=this._scene.navigator;d=e.canvasWidth;e=e.canvasHeight;f._textAttach=GLTFViewer.Utils.Markup.TEXT_ATTACH_CENTER;
var g=f._textBox.GetCenter();f._position2D.Set(g.x,g.y,0);f._position.Set(g.x/d,g.y/e,0);this._position2D.Set(f._position2D);this._position.Set(f._position)}this._state=GLTFViewer.Utils.Markup.STATE_EDIT_MOVE;break}if(0!==this._select)break;this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D?(this._position.Set(a,c,0),this._position2D.Set(a,c,0),this._textAttach=GLTFViewer.Utils.Markup.TEXT_ATTACH_CENTER):(f=this._ToClosestHit2D(a,c),this._position.Set(f.pnt),this._index=f.indx,this._position2D.Set(f.pnt),
this._textAttach=GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO);this._textOffset.Set();this._state=GLTFViewer.Utils.Markup.STATE_CREATE_LINE}}else clearTimeout(this._blurTimer),this._blurTimer=null}},Update:{value:function(a,c){function d(){var d=this._lines[k];if(this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D){var e=(d._textBox.max-d._textBox.mix)/2,h=(d._textBox.may-d._textBox.miy)/2,l=1,u=1;a=this._position.x+(a-this._startEdit.x)/f;c=this._position.y+(c-this._startEdit.y)/g;a*=f;c*=g;a<e?l=a=
0:a>f-e&&(a=f,l=2);c<h?u=c=0:c>g-h&&(c=g,u=2);a/=f;c/=g;d._position.Set(a,c,0);d._textAttach=GLTFViewer.Utils.Markup.Line.LRTBToAttach(l,u);this._tip=this.HitTip(d._position.x,d._position.y)}else if(e=this._ToClosestHit3D(a,c))d._position.Set(e),this._tip=this.HitTip(e.x,e.y,e.z);this._scene.Invalidate(!0)}var e=this._scene.navigator,f=e.canvasWidth,g=e.canvasHeight;0>a?a=0:a>f&&(a=f);0>c?c=0:c>g&&(c=g);this._tip=null;var k=this._hit,h=this._hitWhat;switch(this._state){case GLTFViewer.Utils.Markup.STATE_CREATE_LINE:this.LineType!==
GLTFViewer.Utils.Markup.LINE_TYPE_2D&&(5>a?a=5:a>f-5&&(a=f-5),5>c?c=5:c>g-5&&(c=g-5),a=Math.round(a-this._position.x),c=Math.round(c-this._position.y),this._textOffset.Set(a,c,0),this._tip=this.HitTip(a,c));break;case GLTFViewer.Utils.Markup.STATE_EDIT_MOVE:switch(e=this._lines[k],this.Dirty===GLTFViewer.Utils.Markup.DIRTY_NO&&(this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES),h){case GLTFViewer.Utils.Markup.Line.HIT_TEXT:case GLTFViewer.Utils.Markup.Line.HIT_START_OFFSET:if(this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D)d.call(this);
else{a=this._textOffset.x+(a-this._startEdit.x);c=this._textOffset.y+(c-this._startEdit.y);var h=this._position2D.x+a,l=this._position2D.y+c;5>h?a-=h-5:h>f-5&&(a-=h-(f-5));5>l?c-=l-5:l>g-5&&(c-=l-(g-5));e._textOffset.Set(a,c,0);this._tip=this.HitTip(a,c);this._scene.Invalidate(!0)}break;case GLTFViewer.Utils.Markup.Line.HIT_LINE:e=this._lines[k];a-=this._offsetEdit.x;c-=this._offsetEdit.y;if(h=this._ToClosestHit3D(a,c))e._position.Set(h),this._tip=this.HitTip(h.x,h.y,h.z);this._scene.Invalidate(!0);
break;case GLTFViewer.Utils.Markup.Line.HIT_START:d.call(this)}}this._scene.Invalidate()}},End:{value:function(a,c){this.Update(a,c);switch(this._state){case GLTFViewer.Utils.Markup.STATE_CREATE_LINE:var d=this._scene.navigator,e=d.canvasWidth,d=d.canvasHeight;this.LineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D?(this._position.x/=e,this._position.y/=d):this._scene.navigator.UnProject(this._position);this._scene.Invalidate();case GLTFViewer.Utils.Markup.STATE_EDIT_MOVE:this._state=GLTFViewer.Utils.Markup.STATE_ENABLED}}},
StartTexting:{value:function(a){if(this._state===GLTFViewer.Utils.Markup.STATE_ENABLED){var c=this._lines[this._hit];c.StartTexting(a)&&(this._state=GLTFViewer.Utils.Markup.STATE_EDIT_TEXT,this._textLine=c,this._scene.Invalidate())}}},UpdateTexting:{value:function(){this._state===GLTFViewer.Utils.Markup.STATE_EDIT_TEXT&&(this._textLine&&this._textLine.UpdateTexting(),this._scene.Invalidate())}},EndTexting:{value:function(){this._state===GLTFViewer.Utils.Markup.STATE_EDIT_TEXT&&(this._state=GLTFViewer.Utils.Markup.STATE_ENABLED,
this._wantTextEdit=!1,this._textLine&&(this._textLine.EndTexting(),this._textLine._text.length?this.Dirty=GLTFViewer.Utils.Markup.DIRTY_YES:this._scene.MarkupDelete(),this._textLine=null),this._scene.Invalidate())}},GetTip:{value:function(){return this._tip}},Editable:{value:function(a){a=this._lines[a];return GLTFViewer.Utils.IsNull(a)?!1:a.Editable}}});
Object.defineProperties(GLTFViewer.Utils.Markup,{_ballSize:{value:7},_vsSolid:{value:"uniform mat4 uTVP;\nattribute vec3 aPos;\nvoid main(void) {\ngl_PointSize = 7.0;\ngl_Position = uTVP * vec4(aPos, 1.0);\n}"},_fsSolid:{value:"uniform vec4 uClr;\nuniform bool uPnt;\nvoid main() {\nif (uPnt) {\nvec2 xy = gl_PointCoord - vec2(0.5);\nfloat dist = length(xy);\nif (dist > 0.5) discard;\n}\ngl_FragColor = uClr;\n}"},_vsDash:{value:"uniform mat4 uTVP;\nattribute vec3 aPos;\nvarying vec2 vPos;\nvoid main(void) {\ngl_Position = uTVP * vec4(aPos, 1.0);\nvPos = gl_Position.xy;\n}"},
_fsDash:{value:"uniform vec4 uClr;\nuniform vec2 uStart;\nuniform vec2 uSze;\nvarying vec2 vPos;\nvoid main() {\nvec2 v = vec2((1.0 + vPos.x) * uSze.x / 2.0, (1.0 - vPos.y) * uSze.y / 2.0);\nfloat f = length(v - uStart);\nif (mod(floor(f / 7.0), 2.0) == 1.0) discard;\ngl_FragColor = uClr;\n}"},_vsPoint:{value:"uniform mat4 uTVP;\nattribute vec3 aPos;\nvoid main(void) {\ngl_PointSize = 10.0;\ngl_Position = uTVP * vec4(aPos, 1.0);\n}"},_fsPoint:{value:"uniform vec4 uClr;\nvoid main() {\nvec2 xy = gl_PointCoord - vec2(0.5);\nfloat dist = length(xy);\nif (dist > 0.5) discard;\ngl_FragColor = uClr;\n}"},
DIRTY_NO:{value:0},DIRTY_MAYBE:{value:1},DIRTY_YES:{value:2},LINE_TYPE_2D:{value:0},LINE_TYPE_3D:{value:1},LINE_SYMBOL_NONE:{value:0},LINE_SYMBOL_ARROW:{value:1},LINE_SYMBOL_BALL:{value:2},LINE_SOLID:{value:0},LINE_DASHED:{value:1},TEXT_ATTACH_AUTO:{value:0},TEXT_ATTACH_NW:{value:1},TEXT_ATTACH_N:{value:2},TEXT_ATTACH_NE:{value:3},TEXT_ATTACH_W:{value:4},TEXT_ATTACH_CENTER:{value:5},TEXT_ATTACH_E:{value:6},TEXT_ATTACH_SW:{value:7},TEXT_ATTACH_S:{value:8},TEXT_ATTACH_SE:{value:9},STATE_DISABLED:{value:0},
STATE_ENABLED:{value:1},STATE_CREATE_LINE:{value:2},STATE_EDIT_MOVE:{value:3},STATE_EDIT_TEXT:{value:4},RenderHighlight:{value:function(a,c,d,e,f,g,k,h){var l="rgba(51,152,218,"+128/255+")",m="rgba(51,152,218,"+192/255+")";a.fillStyle=g?l:m;a.strokeStyle=g?l:m;var n=GLTFViewer.Utils.Markup.Line.HIGHLIGHT_LINE_WIDTH,p=n/2;f&&(a.fillStyle=g&&k!==GLTFViewer.Utils.Markup.Line.HIT_TEXT?l:m,h?(a.lineWidth=2,a.strokeRect(f.mix-p,f.miy-p,f.max-f.mix+n,f.may-f.miy+n)):(a.lineWidth=0,a.fillRect(f.mix-p,f.miy-
p,f.max-f.mix+n,f.may-f.miy+n)));f=d.x;d=d.y;h=f+e.x;e=d+e.y;a.lineWidth=n;a.lineCap="butt";c===GLTFViewer.Utils.Markup.LINE_TYPE_2D?g&&(a.lineWidth=0,a.fillStyle=k!==GLTFViewer.Utils.Markup.Line.HIT_TEXT?l:m,a.fillRect(f-n,d-n,2*n,2*n)):(a.strokeStyle=g?l:m,a.beginPath(),a.moveTo(f,d),a.lineTo(h,e),a.stroke(),a.lineWidth=0,a.fillStyle=g&&k!==GLTFViewer.Utils.Markup.Line.HIT_START?l:m,a.beginPath(),a.arc(f,d,n,0,2*Math.PI,!1),a.fill(),a.fillStyle=g&&k!==GLTFViewer.Utils.Markup.Line.HIT_START_OFFSET?
l:m,a.fillRect(h-n,e-n,2*n,2*n))}}});
GLTFViewer.Utils.Markup.Line=function(a,c,d,e,f,g,k,h,l,m,n,p,q,u){this._scene=a;this._input=a.viewer.markupTextArea;this._editable=GLTFViewer.Utils.IsNull(c)?!1:c;this._type=GLTFViewer.Utils.IsNull(d)?GLTFViewer.Utils.Markup.LINE_TYPE_2D:d;this._position=e?e.Clone():new GLTFViewer.Utils.Vec3;this._index=f;this._lineColor=g?g.Clone():new GLTFViewer.Utils.RGBA(0,0,0,255);this._lineShape=k?k:GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE;this._text=h?GLTFViewer.Utils.CRLFtoCR(h):"";this._textOffset=l&&this._type!==
GLTFViewer.Utils.Markup.LINE_TYPE_2D?l.Clone():new GLTFViewer.Utils.Vec3;this._textAttach=m?m:GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO;this._textSize=n&&0<n&&100>n?n:GLTFViewer.DEFAULT_MARKUP_FONT_SIZE;this._textFont=p?p:"san-serif";this._textColor=q?q.Clone():new GLTFViewer.Utils.RGBA(0,0,0,255);this._backColor=u?u.Clone():new GLTFViewer.Utils.RGBA(255,255,255,127);this._visible=!0;this._position2D=new GLTFViewer.Utils.Vec3;this._end2D=new GLTFViewer.Utils.Vec3};
GLTFViewer.Utils.Markup.Line.prototype=Object.create(null,{_type:{writable:!0,value:0},_editable:{writable:!0,value:!1},_position:{writable:!0,value:null},_index:{writable:!0,value:null},_lineColor:{writable:!0,value:null},_lineShape:{writable:!0,value:0},_text:{writable:!0,value:null},_textOffset:{writable:!0,value:null},_textAttach:{writable:!0,value:0},_textSize:{writable:!0,value:0},_textFont:{writable:!0,value:null},_textColor:{writable:!0,value:null},_backColor:{writable:!0,value:null},_visible:{writable:!0,
value:!0},_scene:{writable:!0,value:null},_input:{writable:!0,value:null},_isDrawn:{writable:!0,value:!1},_position2D:{writable:!0,value:null},_textBox:{writable:!0,value:null},_attachText:{writable:!0,value:0},_isTexting:{writable:!0,value:!1},Editable:{get:function(){return this._editable}},_UpdatePosition:{value:function(a){if(this._type===GLTFViewer.Utils.Markup.LINE_TYPE_3D&&!GLTFViewer.Utils.IsNull(this._index)&&this._scene.GetExplosion()){var c=this._scene.GetSceneBox(!0).GetCenter(),d=this._scene.handler._sceneNodeIndexToSceneNode[this._index];
if(d){var e=d.AccumulatedMatrix(),d=d.BoundingBox(null,0,!0,e).GetCenter(),e=GLTFViewer.Utils.ExplosionMatrix(c,d,this._scene.GetExplosion());a.Transform(e)}}}},_RenderBox:{value:function(a,c,d,e){var f=this._scene.navigator,g=f.canvasWidth,k=f.canvasHeight,f=GLTFViewer.Utils.Markup.Line.GetLRTBAttach(this._textAttach,this._textOffset,a),h=f.lr,l=f.tb,m=[[],[],[]];this._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D?(m[0][0]=[0,0],m[0][1]=[0,0],m[0][2]=[0,0],m[1][0]=[0,0],m[1][1]=[0,0],m[1][2]=[0,0],
m[2][0]=[0,0],m[2][1]=[0,0],m[2][2]=[0,0]):(m[0][0]=[2,5],m[0][1]=[5,3.5],m[0][2]=[2,5],m[1][0]=[5,3.5],m[1][1]=[0,0],m[1][2]=[5,3.5],m[2][0]=[2,5],m[2][1]=[5,3.5],m[2][2]=[2,5]);for(var n=this._position2D.Clone().Add(this._textOffset),p=[[],[],[]],q=[[],[],[]],u=[[],[],[]],r=[[],[],[]],w=[[],[],[]],f=0;2>=f;++f)for(var t=0;2>=t;++t)0===f?(q[f][t]=n.x+m[f][t][0],u[f][t]=n.x+a.x+m[f][t][0]):1===f?(q[f][t]=n.x-a.x/2,u[f][t]=n.x+a.x/2):(q[f][t]=n.x-a.x-m[f][t][0],u[f][t]=n.x-m[f][t][0]),0===t?(r[f][t]=
n.y+m[f][t][0],w[f][t]=n.y+a.y+m[f][t][0]):1===t?(r[f][t]=n.y-a.y/2,w[f][t]=n.y+a.y/2):(r[f][t]=n.y-a.y-m[f][t][0],w[f][t]=n.y-m[f][t][0]),p[f][t]=0<=q[f][t]&&u[f][t]<=g&&0<=r[f][t]&&w[f][t]<=k;f=h;t=l;if(this._textAttach===GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO){g=this._textOffset.NegateCreate();g.Normalize();this._type!==GLTFViewer.Utils.Markup.LINE_TYPE_2D&&(p[1][1]=!1);a=2===h?-1:0===h?1:0<=g.x?1:-1;g=2===l?-1:0===l?1:0<=g.y?1:-1;for(l=0;3>l&&!p[f][0]&&!p[f][1]&&!p[f][2];)f=(f+a+3)%3,++l;for(l=
0;3>l&&!p[f][t];)t=(t+g+3)%3,++l;1===f&&1===t&&(a=(f+a+3)%3,p[a][t]?f=a:(a=(t+g+3)%3,p[f][a]&&(t=a)));p[f][t]||(f=h)}if(e)return d=new GLTFViewer.Utils.Box(q[f][t],r[f][t],0,u[f][t],w[f][t],0),d.lrtb={lr:f,tb:t},d;e=this._scene.gx;GLTFViewer.Utils.IsNull(d)?e.lineWidth=0:(e.strokeStyle="rgba("+Math.round(d.r)+","+Math.round(d.g)+","+Math.round(d.b)+","+d.a/255+")",e.lineWidth=1);e.fillStyle="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+c.a/255+")";e.beginPath();1===f&&1==t||
this._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D?(c=q[f][t],h=r[f][t],e.moveTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h)):0===f&&0==t?(c=n.x,h=n.y,e.moveTo(c,h),c=q[f][t],h=r[f][t]+m[f][t][1],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t]+m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):0===f&&1==t?(c=n.x,h=n.y,e.moveTo(c,h),c=q[f][t],h=n.y+m[f][t][1],e.lineTo(c,h),h=w[f][t],e.lineTo(c,
h),c=u[f][t],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=n.y-m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):0===f&&2==t?(c=n.x,h=n.y,e.moveTo(c,h),c=q[f][t]+m[f][t][1],h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t]-m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):1===f&&0==t?(c=n.x,h=n.y,e.moveTo(c,h),c=n.x-m[f][t][1],h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),
h=r[f][t],e.lineTo(c,h),c=n.x+m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):1===f&&2==t?(c=n.x,h=n.y,e.moveTo(c,h),c=n.x+m[f][t][1],h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=n.x-m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):2===f&&0==t?(c=n.x,h=n.y,e.moveTo(c,h),c=u[f][t]-m[f][t][1],h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=r[f][t]+m[f][t][1],e.lineTo(c,
h),c=n.x,h=n.y,e.lineTo(c,h)):2===f&&1==t?(c=n.x,h=n.y,e.moveTo(c,h),c=u[f][t],h=n.y-m[f][t][1],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t],e.lineTo(c,h),h=n.y+m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h)):2===f&&2==t&&(c=n.x,h=n.y,e.moveTo(c,h),c=u[f][t],h=w[f][t]-m[f][t][1],e.lineTo(c,h),h=r[f][t],e.lineTo(c,h),c=q[f][t],e.lineTo(c,h),h=w[f][t],e.lineTo(c,h),c=u[f][t]-m[f][t][1],e.lineTo(c,h),c=n.x,h=n.y,e.lineTo(c,h));GLTFViewer.Utils.IsNull(d)||
(e.closePath(),e.stroke());e.fill();d=new GLTFViewer.Utils.Box(q[f][t],r[f][t],0,u[f][t],w[f][t],0);d.lrtb={lr:f,tb:t};return d}},_PointClipped:{value:function(a){if(this._scene.ClipViewState!==GLTFViewer.Utils.Clip.VIEWSTATE_PLANE)return!1;var c=this._scene.handler._clip;return c.flipped?-.001>c.glClip0[0]*a.x+c.glClip0[1]*a.y+c.glClip0[2]*a.z+c.glClip0[3]:-.001>c.glClip1[0]*a.x+c.glClip1[1]*a.y+c.glClip1[2]*a.z+c.glClip1[3]}},_PointVisible:{value:function(a,c,d){return 0>a.x||a.x>c||0>a.y||a.y>
d?!1:!0}},Reset:{value:function(){this._isTexting=!1}},Clear:{value:function(){GLTFViewer.Utils.Markup.Line.prototype.Reset.call(this);this._textBox=this._position2D=this._input=this._scene=this._backColor=this._textColor=this._textOffset=this._text=this._lineColor=this._position=null}},StartTexting:{value:function(a){var c=0;if(a&&(c=this.GetTextIndex(a),0>c))return!1;this._input[0].value=this._text;this._input.css("font-family",this._textFont);this._input.css("font-size",this._textSize+"px");this._input.css("visibility",
"visible");this._input.focus();this._isTexting=!0;this._attachText=this._textAttach;this._textBox&&(this._textAttach=GLTFViewer.Utils.Markup.Line.LRTBToAttach(this._textBox.lrtb.lr,this._textBox.lrtb.tb));this.UpdateTexting();this._input[0].setSelectionRange(c,c);return!0}},UpdateTexting:{value:function(){var a=this._scene.navigator,c=a.canvasWidth,a=a.canvasHeight;this._text=this._input[0].value;var d=Math.ceil(this._textSize/5),e=this._scene.gx;e.textBaseline="hanging";e.textAlign="left";e.font=
this._textSize+"px "+this._textFont;var f=this._text.split("\n"),e=Math.ceil(Math.max(GLTFViewer.Utils.TextWidth(e,f),GLTFViewer.Utils.Markup.Line.DEFAULT_TEXT_WIDTH*this._textSize/2)+2*d+this._textSize);e>c&&(e=c);f=Math.ceil(f.length*this._textSize+2*d+this._textSize);f>a&&(f=a);var g=GLTFViewer.Utils.Markup.Line.AttachToLRTB(this._textAttach),k=g.lr,g=g.tb;this._textBox=this._RenderBox(new GLTFViewer.Utils.Vec3(e,f,0),null,null,!0);var h=this._textBox.mix,l=this._textBox.miy;0>h&&(h=Math.ceil(-h),
e-=h,h=0);h+e>c&&(h=Math.ceil((1===k?2:1)*(h+e-c)),e-=h);0>l&&(h=Math.ceil(-l),f-=h,l=0);l+f>a&&(h=Math.ceil((1===g?2:1)*(l+f-a)),f-=h);this._textBox=this._RenderBox(new GLTFViewer.Utils.Vec3(e,f,0),null,null,!0);this._input.css("line-height",this._textSize+"px");this._input.css("width",e-d-1+"px");this._input.css("height",f-2+"px");this._input.css("left",this._textBox.mix-1+"px");this._input.css("top",this._textBox.miy+"px");this._input.css("border",0);this._input.css("padding-left",d+"px")}},EndTexting:{value:function(){this._input.css("visibility",
"hidden");this._isTexting&&(this._isTexting=!1,this._text=this._input[0].value,this._textAttach=this._attachText)}},RenderLine:{value:function(a,c,d){var e=this._scene.navigator,f=e.canvasWidth,g=e.canvasHeight,e=this._scene.gl;a!==GLTFViewer.Utils.Markup.LINE_DASHED&&(this._isDrawn=!1);var k=GLTFViewer.Utils.IsNull(this._index)||this._scene.handler.IsVisible(this._index);if(this._visible&&k){var h=this._position.Clone();if(this._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D)h.x*=f,h.y*=g,h.z=0;else{this._UpdatePosition(h);
if(this._PointClipped(h))return;this._scene.navigator.Project(h)}if(this._PointVisible(h,f,g)){this._position2D.Set(h);var l=new GLTFViewer.Utils.Vec3(h.x+this._textOffset.x,h.y+this._textOffset.y,h.z);if(this._PointVisible(l,f,g)){this._scene.navigator.UnProject(h);this._scene.navigator.UnProject(l);var m=this._textOffset.NegateCreate();m.Normalize();this._isDrawn=!0;if(this._type!==GLTFViewer.Utils.Markup.LINE_TYPE_2D){var n=this._lineShape===GLTFViewer.Utils.Markup.LINE_SYMBOL_BALL,k=this._lineShape===
GLTFViewer.Utils.Markup.LINE_SYMBOL_ARROW,p=this._textOffset.GetMagnitudeSquared(),q=(GLTFViewer.Utils.Markup._ballSize+1)/2,p=!n&&1<p||n&&p>q*q,q=k&&p;e.uniform4f(c.uClr,this._lineColor.r/255,this._lineColor.g/255,this._lineColor.b/255,this._lineColor.a/255);e.uniform1i(c.uPnt,0);p&&a===GLTFViewer.Utils.Markup.LINE_DASHED&&(e.uniform2f(c.uSze,f,g),e.uniform2f(c.uStart,this._position2D.x,this._position2D.y));d[0]=l.x;d[1]=l.y;d[2]=l.z;d[3]=h.x;d[4]=h.y;d[5]=h.z;e.bufferSubData(e.ARRAY_BUFFER,0,d);
e.vertexAttribPointer(c.aPos,3,e.FLOAT,!1,0,0);p&&e.drawArrays(e.LINES,0,2);a!==GLTFViewer.Utils.Markup.LINE_DASHED&&(e.disable(e.DEPTH_TEST),n&&(e.uniform1i(c.uPnt,1),e.drawArrays(e.POINTS,1,1),e.uniform1i(c.uPnt,0)),q&&(a=new GLTFViewer.Utils.Vec3(m.x-m.y,m.y+m.x,0),a.Normalize(),c=new GLTFViewer.Utils.Vec3(m.x+m.y,m.y-m.x,0),c.Normalize(),k&&(f=this._position2D.Clone(),f.x-=GLTFViewer.Utils.Markup._ballSize*a.x,f.y-=GLTFViewer.Utils.Markup._ballSize*a.y,this._scene.navigator.UnProject(f),d[0]=
f.x,d[1]=f.y,d[2]=f.z,f.x=this._position2D.x-GLTFViewer.Utils.Markup._ballSize*c.x,f.y=this._position2D.y-GLTFViewer.Utils.Markup._ballSize*c.y,f.z=this._position2D.z,this._scene.navigator.UnProject(f),d[6]=f.x,d[7]=f.y,d[8]=f.z,e.bufferSubData(e.ARRAY_BUFFER,0,d),e.drawArrays(e.LINE_STRIP,0,3))),e.enable(e.DEPTH_TEST))}}}}}},GetTextIndex:{value:function(a){if(GLTFViewer.Utils.IsNull(a)||0===a.x&&0===a.y||0===this._text.length)return-1;var c=Math.ceil(this._textSize/5),d=this._scene.gx;d.textBaseline=
"hanging";d.textAlign="left";d.font=this._textSize+"px "+this._textFont;var e=this._text.split("\n"),f=a.x-this._textBox.mix-c;a=Math.max(Math.floor((a.y-this._textBox.miy-c)/this._textSize),0);if(a>=e.length)return-1;for(var g=0,c=0;c<e[a].length;++c){var k=d.measureText(e[a].substr(0,c+1)).width;if(f<=g+(k-g)/2)break;g=k}d=c;for(f=0;f<a;++f)d+=e[f].length+1;return d}},RenderText:{value:function(a,c){c||(this._textBox=null);if(this._isDrawn&&(0!==this._text.length||c||a)){var d=Math.ceil(this._textSize/
5),e=this._scene.gx;e.textBaseline="hanging";e.textAlign="left";e.font=this._textSize+"px "+this._textFont;var f=this._text.split("\n"),g=Math.max(GLTFViewer.Utils.TextWidth(e,f),GLTFViewer.Utils.Markup.Line.DEFAULT_TEXT_WIDTH*this._textSize/2)+2*d,k=f.length*this._textSize+2*d;c&&(this._textBox?(g=this._textBox.max-this._textBox.mix+1,k=this._textBox.may-this._textBox.miy+1):(g+=this._textSize,k+=this._textSize));var h=null;if(this._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D){if(this._backColor.a){var l=
GLTFViewer.Utils.HSV.CreateFromColor(this._backColor);l.v=.5<l.v?l.v/2:(l.v+1)/2;l.a=(l.a+1)/2;h=new GLTFViewer.Utils.RGBA;h.SetHsv(l.h,l.s,l.v,l.a)}}else h=this._lineColor;c&&this._textBox||(this._textBox=this._RenderBox(new GLTFViewer.Utils.Vec3(g,k,0),this._backColor,h));if(!c&&this._text.length){g=this._textBox.mix+d;e.fillStyle="rgba("+Math.round(this._textColor.r)+","+Math.round(this._textColor.g)+","+Math.round(this._textColor.b)+","+this._textColor.a/255+")";e.lineWidth=0;k=this._textBox.miy+
d+1;h=window.navigator.userAgent.toLowerCase();if(h.match(/trident.*rv\:11\./)||-1!==h.indexOf("ipod")||-1!==h.indexOf("iphone")||-1!==h.indexOf("ipad"))k-=d;for(d=0;d<f.length;++d)e.fillText(f[d],g,k),k+=this._textSize}}}},HitMarkup:{value:function(a,c){if(!this._isDrawn||!this._editable)return GLTFViewer.Utils.Markup.Line.HIT_NONE;if(this._textBox&&this._textBox.IsWithin(a))return GLTFViewer.Utils.Markup.Line.HIT_TEXT;if(this._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D)return GLTFViewer.Utils.Markup.Line.HIT_NONE;
var d=GLTFViewer.Utils.Markup.Line.HIGHLIGHT_LINE_WIDTH,e=d/2,f=this._position2D.x,g=this._position2D.y,k=f+this._textOffset.x,h=g+this._textOffset.y;if(Math.abs(a.x-k)<d&&Math.abs(a.y-h)<d)return GLTFViewer.Utils.Markup.Line.HIT_START_OFFSET;if(Math.abs(a.x-f)<d&&Math.abs(a.y-g)<d)return GLTFViewer.Utils.Markup.Line.HIT_START;if((k<=f&&a.x>=k-e&&a.x<=f+e||k>f&&a.x>=f-e&&a.x<=k+e)&&(h<=g&&a.y>=h-e&&a.y<=g+e||h>g&&a.y>=g-e&&a.y<=h+e)){var e=h-g,l=f-k,f=k*g-f*h;if(g=Math.sqrt(e*e+l*l))e/=g,l/=g,f/=
g;g=a.x*e+a.y*l+f;if(Math.abs(g)<d)return GLTFViewer.Utils.Markup.Line.HIT_LINE}return GLTFViewer.Utils.Markup.Line.HIT_NONE}}});
Object.defineProperties(GLTFViewer.Utils.Markup.Line,{HIGHLIGHT_LINE_WIDTH:{value:5},DEFAULT_TEXT_WIDTH:{value:10},HIT_NONE:{value:0},HIT_TEXT:{value:1},HIT_LINE:{value:2},HIT_START:{value:3},HIT_START_OFFSET:{value:4},LRTBToAttach:{value:function(a,c){return[[GLTFViewer.Utils.Markup.TEXT_ATTACH_NW,GLTFViewer.Utils.Markup.TEXT_ATTACH_N,GLTFViewer.Utils.Markup.TEXT_ATTACH_NE],[GLTFViewer.Utils.Markup.TEXT_ATTACH_W,GLTFViewer.Utils.Markup.TEXT_ATTACH_CENTER,GLTFViewer.Utils.Markup.TEXT_ATTACH_E],[GLTFViewer.Utils.Markup.TEXT_ATTACH_SW,
GLTFViewer.Utils.Markup.TEXT_ATTACH_S,GLTFViewer.Utils.Markup.TEXT_ATTACH_SE]][c][a]}},AttachToLRTB:{value:function(a){return 0===a?{lr:0,tb:0}:[{lr:0,tb:0},{lr:1,tb:0},{lr:2,tb:0},{lr:0,tb:1},{lr:1,tb:1},{lr:2,tb:1},{lr:0,tb:2},{lr:1,tb:2},{lr:2,tb:2}][a-GLTFViewer.Utils.Markup.TEXT_ATTACH_NW]}},GetLRTBAttach:{value:function(a,c,d,e){var f;switch(a){case GLTFViewer.Utils.Markup.TEXT_ATTACH_N:a=1;f=0;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_NE:a=2;f=0;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_E:a=
2;f=1;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_SE:f=a=2;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_S:a=1;f=2;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_SW:a=0;f=2;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_W:a=0;f=1;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_NW:f=a=0;break;case GLTFViewer.Utils.Markup.TEXT_ATTACH_CENTER:f=a=1;break;default:a=c.x?c.y/c.x:c.y*GLTFViewer.Utils.maxDouble,f=d.y/d.x,0<=c.y?0<=c.x?a<f/2?(a=0,f=1):(a=a<2*f?0:1,f=0):a<-2*f?(a=1,f=0):a<-f/2?(a=2,f=0):
(a=2,f=1):0<=c.x?a>-f/2?(a=0,f=1):(a=a>-2*f?0:1,f=2):a>2*f?(a=1,f=2):a>f/2?f=a=2:(a=2,f=1),e&&(0===a?c.x-=d.x/2:2===a&&(c.x+=d.x/2),0===f?c.y-=d.y/2:2===f&&(c.y+=d.y/2))}return{lr:a,tb:f}}}});
GLTFViewer.Utils.Clip=function(a){var c=this._gl=a.gl;this._scene=a;this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_NONE;this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE;this.clipState=GLTFViewer.Utils.Clip.STATE_DISABLED;this.clipP0=new GLTFViewer.Utils.Vec3;this.clipP1=new GLTFViewer.Utils.Vec3;this.clipP2=new GLTFViewer.Utils.Vec3;this.clipP3=new GLTFViewer.Utils.Vec3;this.glClip0=new Float32Array(4);this.glClip1=new Float32Array(4);this._mtxArray=new Float32Array(16);this._uTex=new Float32Array([0,
0,1,0,1,1,0,1]);this._uClr=new Float32Array(8);this._uPos=new Float32Array([-1,1,1,1,1,-1,-1,-1]);this._uMtl=new Float32Array(16);a=new Float32Array(48);this._hintBuf=a.subarray(0,45);this._cutFaceBuf=a.subarray(0,24);this._clipPointBuf=a.subarray(0,48);this._clipPlaneBuf=a.subarray(0,15);this._glBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this._glBuffer);c.bufferData(c.ARRAY_BUFFER,a,c.DYNAMIC_DRAW);c.bindBuffer(c.ARRAY_BUFFER,null);try{this._pointShader=new GLTFViewer.Utils.ShaderProgram(c,
GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Clip._vsPoint,GLTFViewer.Utils.Clip._fsPoint),this._capShader=new GLTFViewer.Utils.ShaderProgram(c,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Clip._vsCap,GLTFViewer.Utils.Clip._fsCap),this._planeShader=new GLTFViewer.Utils.ShaderProgram(c,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Clip._vsPlane,GLTFViewer.Utils.Clip._fsPlane)}catch(d){throw GLTFViewer.Utils.WriteErr(d),this._pointShader&&(this._pointShader.DeleteProgram(),
this._pointShader=null),this._capShader&&(this._capShader.DeleteProgram(),this._capShader=null),this._planeShader&&(this._planeShader.DeleteProgram(),this._planeShader=null),c.deleteBuffer(this._glBuffer),this._glBuffer=null,d;}a=GLTFViewer.Utils.MakeBallImage(4,2);this._circleTexture=c.createTexture();c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this._circleTexture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);
c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texImage2D(c.TEXTURE_2D,0,c.LUMINANCE_ALPHA,8,8,0,c.LUMINANCE_ALPHA,c.UNSIGNED_BYTE,a);c.bindTexture(c.TEXTURE_2D,null);this._capTexture=c.createTexture();c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this._capTexture);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,null)};
GLTFViewer.Utils.Clip.prototype=Object.create(null,{_scene:{writable:!0,value:null},_gl:{writable:!0,value:null},_mtxArray:{writable:!0,value:null},_circleTexture:{writable:!0,value:null},_clipState:{writable:!0,value:null},_clipViewState:{writable:!0,value:null},_clipDrawMode:{writable:!0,value:null},_pointShader:{writable:!0,value:null},_capShader:{writable:!0,value:null},_planeShader:{writable:!0,value:null},_hintBuf:{writable:!0,value:null},_cutFaceBuf:{writable:!0,value:null},_clipPointBuf:{writable:!0,
value:null},_clipPlaneBuf:{writable:!0,value:null},_glBuffer:{writable:!0,value:null},_uTex:{writable:!0,value:null},_uClr:{writable:!0,value:null},_uPos:{writable:!0,value:null},_uMtl:{writable:!0,value:null},_capTexture:{writable:!0,value:null},_capTextureValid:{writable:!0,value:!1},_clipValid:{writable:!0,value:!1},_lastSelectionMode:{writable:!0,value:-1},clipO:{writable:!0,value:null},clipD:{writable:!0,value:null},glClip0:{writable:!0,value:null},glClip1:{writable:!0,value:null},clipPlane:{writable:!0,
value:null},clipP0:{writable:!0,value:null},clipP1:{writable:!0,value:null},clipP2:{writable:!0,value:null},clipP3:{writable:!0,value:null},flipped:{writable:!0,value:!1},_SetClipPointsFromPlane:{value:function(a){this.clipP0.x=a.orgn.x;this.clipP0.y=a.orgn.y;this.clipP0.z=a.orgn.z;this.clipP1.x=a.orgn.x+a.dix.x;this.clipP1.y=a.orgn.y+a.dix.y;this.clipP1.z=a.orgn.z+a.dix.z;this.clipP2.x=a.orgn.x+a.diy.x;this.clipP2.y=a.orgn.y+a.diy.y;this.clipP2.z=a.orgn.z+a.diy.z}},state:{get:function(){var a={};
a.clipState=this.clipState;a.clipPlane=this.clipPlane?this.clipPlane.Clone():null;return a},set:function(a){this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE;this._clipState=a.clipState;this._clipViewState=this._clipState!==GLTFViewer.Utils.Clip.STATE_DISABLED?GLTFViewer.Utils.Clip.VIEWSTATE_PLANE:GLTFViewer.Utils.Clip.VIEWSTATE_NONE;if(this.clipPlane=a.clipPlane?a.clipPlane.Clone():null)this._SetClipPointsFromPlane(this.clipPlane),this.UpdateClip();if(this._clipState===GLTFViewer.Utils.Clip.STATE_DISABLED)this._scene.viewer.ClipMenuBtnState(null,
null,GLTFViewer.MENUUNCHECKALL),this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUDISABLE),this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUUNCHECK);else switch(this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUCHECK),this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUENABLE),this._scene.viewer.ClipMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL),this._clipState){case GLTFViewer.Utils.Clip.STATE_Z:case GLTFViewer.Utils.Clip.STATE_X:case GLTFViewer.Utils.Clip.STATE_Y:this._scene.viewer.ClipMenuBtnState(this._clipState-
GLTFViewer.Utils.Clip.STATE_Z,null,GLTFViewer.MENUCHECK);break;case GLTFViewer.Utils.Clip.STATE_1PT:this._scene.viewer.ClipMenuBtnState(3,null,GLTFViewer.MENUCHECK);break;case GLTFViewer.Utils.Clip.STATE_3PTS:this._scene.viewer.ClipMenuBtnState(4,null,GLTFViewer.MENUCHECK)}this._scene.Invalidate(!0)}},capTexture:{get:function(){this._capTextureValid=!0;return this._capTexture}},clipDrawMode:{get:function(){return this._clipDrawMode},set:function(a){if(!(a<GLTFViewer.Utils.Clip.DRAWMODE_DONE||a>GLTFViewer.Utils.Clip.DRAWMODE_MOVING)){switch(a){case GLTFViewer.Utils.Clip.DRAWMODE_DONE:case GLTFViewer.Utils.Clip.DRAWMODE_1_PT:case GLTFViewer.Utils.Clip.DRAWMODE_3RD_OF_3_PTS:case GLTFViewer.Utils.Clip.DRAWMODE_2ND_OF_3_PTS:case GLTFViewer.Utils.Clip.DRAWMODE_1ST_OF_3_PTS:a===
GLTFViewer.Utils.Clip.DRAWMODE_1_PT?this._clipDrawMode!==a&&(this._lastSelectionMode=this._scene.GetSelectionMode(),this._scene.SetSelectionMode(GLTFViewer.SELECTION_FACE)):-1!==this._lastSelectionMode&&(this._scene.SetSelectionMode(this._lastSelectionMode),this._lastSelectionMode=-1);this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUUNCHECK);this._scene.container.style.cursor="default";break;case GLTFViewer.Utils.Clip.DRAWMODE_MOVE:case GLTFViewer.Utils.Clip.DRAWMODE_MOVING:this._scene.viewer.ClipMenuBtnState(5,
null,GLTFViewer.MENUENABLE),this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUCHECK),this._scene.container.style.cursor="url('"+this._scene.imageDir+"Point.cur'), default"}this._clipDrawMode=a}}},clipState:{get:function(){return this._clipState},set:function(a){if(!(a<GLTFViewer.Utils.Clip.STATE_DISABLED||a>GLTFViewer.Utils.Clip.STATE_3PTS)){switch(a){case GLTFViewer.Utils.Clip.STATE_DISABLED:this._scene.viewer.ClipMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL);this._scene.viewer.ClipMenuBtnState(5,
null,GLTFViewer.MENUDISABLE);this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUUNCHECK);this._clipState!==a&&(this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE,this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_NONE);this._lastSelectionState=-1;break;case GLTFViewer.Utils.Clip.STATE_Z:case GLTFViewer.Utils.Clip.STATE_X:case GLTFViewer.Utils.Clip.STATE_Y:this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUCHECK);this._scene.viewer.ClipMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL);this._scene.viewer.ClipMenuBtnState(a-
GLTFViewer.Utils.Clip.STATE_Z,null,GLTFViewer.MENUCHECK);if(this._clipState!==a){var c;c=a===GLTFViewer.Utils.Clip.STATE_X?GLTFViewer.Utils.Direction.dix:a===GLTFViewer.Utils.Clip.STATE_Y?GLTFViewer.Utils.Direction.diy:GLTFViewer.Utils.Direction.diz;var d=this._scene.GetSceneBox().GetCenter();0<c.TransformCreate(this._scene.navigator.modelViewInvTrp).z&&c.Negate();this.clipPlane=new GLTFViewer.Utils.Plane(d,c);this.UpdateClip();this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_MOVE;this._clipViewState=
GLTFViewer.Utils.Clip.VIEWSTATE_PLANE}break;case GLTFViewer.Utils.Clip.STATE_1PT:this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUCHECK);this._scene.viewer.ClipMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL);this._scene.viewer.ClipMenuBtnState(3,null,GLTFViewer.MENUCHECK);this._clipState!==a&&(this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_1_PT,this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW);break;case GLTFViewer.Utils.Clip.STATE_3PTS:this._scene.viewer.ClipBtnState(null,GLTFViewer.MENUCHECK),
this._scene.viewer.ClipMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL),this._scene.viewer.ClipMenuBtnState(4,null,GLTFViewer.MENUCHECK),this._clipState!==a&&(this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_1ST_OF_3_PTS,this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW)}this._clipState=a;this._scene.Invalidate(!0)}}},UpdateClip:{value:function(){var a=this._scene.GetSceneBox();if(a.IsEmpty())this._clipValid=!1;else{this._clipValid=!0;for(var c=this._scene.navigator,d=this.clipPlane.orgn,
e=this.clipPlane.dix,f=this.clipPlane.diy,g=this.clipPlane.diz,k,h,l=+GLTFViewer.Utils.maxDouble,m=+GLTFViewer.Utils.maxDouble,n=-GLTFViewer.Utils.maxDouble,p=-GLTFViewer.Utils.maxDouble,a=a.GetCorners(),q=a.length-1;0<=q;q--)k=a[q],h=new GLTFViewer.Utils.Vec3(k.x-d.x,k.y-d.y,k.z-d.z),k=h.Dot(e),h=h.Dot(f),l>k&&(l=k),m>h&&(m=h),n<k&&(n=k),p<h&&(p=h);e=c.ps?c.ps:c._GetPixelSize();f=20*e;l-=f;m-=f;n+=f;p+=f;this.clipPlane.Evaluate(this.clipP0,l,m);this.clipPlane.Evaluate(this.clipP1,l,p);this.clipPlane.Evaluate(this.clipP2,
n,p);this.clipPlane.Evaluate(this.clipP3,n,m);h=g.TransformCreate(c.modelViewInvTrp);c=0<h.z?-1:1;f=e/16*c;this.clipO=d=new GLTFViewer.Utils.Vec3(d.x-g.x*f,d.y-g.y*f,d.z-g.z*f);f=-g.Dot(d);this.glClip1[0]=g.x*c;this.glClip1[1]=g.y*c;this.glClip1[2]=g.z*c;this.glClip1[3]=f*c;this.clipD=new GLTFViewer.Utils.Direction(g.x,g.y,g.z);this.glClip0[0]=g.x;this.glClip0[1]=g.y;this.glClip0[2]=g.z;this.glClip0[3]=f;this.flipped=1!==c}}},RenderPlane:{value:function(a){if(this._clipValid&&this._clipViewState===
GLTFViewer.Utils.Clip.VIEWSTATE_PLANE){var c=this._gl,d=this._planeShader;if(d.StartProgram()){c.uniformMatrix4fv(d.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);c.uniformMatrix4fv(d.uTVP,!1,a);c.depthMask(!1);c.enable(c.DEPTH_TEST);c.enable(c.BLEND);c.enable(c.POLYGON_OFFSET_FILL);c.polygonOffset(-1,0);a=0;var e=this._clipPlaneBuf;e[a++]=this.clipP0.x;e[a++]=this.clipP0.y;e[a++]=this.clipP0.z;e[a++]=this.clipP1.x;e[a++]=this.clipP1.y;e[a++]=this.clipP1.z;e[a++]=this.clipP3.x;e[a++]=this.clipP3.y;e[a++]=
this.clipP3.z;e[a++]=this.clipP2.x;e[a++]=this.clipP2.y;e[a++]=this.clipP2.z;c.bindBuffer(c.ARRAY_BUFFER,this._glBuffer);c.bufferSubData(c.ARRAY_BUFFER,0,this._clipPlaneBuf);c.vertexAttribPointer(d.aPos,3,c.FLOAT,!1,12,0);var f=new Float32Array(4);GLTFViewer.Utils.FlatRgba(250,250,250,50,f);c.uniform4fv(d.uClr,f);c.drawArrays(c.TRIANGLE_STRIP,0,4);a=6;e[a++]=this.clipP2.x;e[a++]=this.clipP2.y;e[a++]=this.clipP2.z;e[a++]=this.clipP3.x;e[a++]=this.clipP3.y;e[a++]=this.clipP3.z;e[a++]=this.clipP0.x;
e[a++]=this.clipP0.y;e[a++]=this.clipP0.z;c.bufferSubData(c.ARRAY_BUFFER,0,this._clipPlaneBuf);GLTFViewer.Utils.FlatRgba(250,0,0,100,f);c.uniform4fv(d.uClr,f);c.drawArrays(c.LINE_STRIP,0,5);c.depthMask(!0);c.disable(c.BLEND);c.polygonOffset(0,0);c.disable(c.POLYGON_OFFSET_FILL)}}}},RenderCap:{value:function(a,c,d){if(this._capTextureValid&&this._clipValid&&(this._capTextureValid=!1,this._clipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE)){var e=this._gl,f=this._capShader;f.StartProgram()&&(e.bindBuffer(e.ARRAY_BUFFER,
this._glBuffer),e.vertexAttribPointer(f.aPos,3,e.FLOAT,!1,24,0),e.vertexAttribPointer(f.aNor,3,e.FLOAT,!1,24,12),e.uniformMatrix4fv(f.uTVP,!1,a),e.uniformMatrix4fv(f.uLit,!1,d),(new GLTFViewer.Utils.Material(new GLTFViewer.Utils.RGBA)).ToArray(this._uMtl,0),e.uniformMatrix4fv(f.uMtl,!1,this._uMtl),e.uniform3fv(f.uEye,c),e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(.1,0),e.enable(e.BLEND),a=0,c=this._cutFaceBuf,c[a++]=this.clipP0.x,c[a++]=this.clipP0.y,c[a++]=this.clipP0.z,c[a++]=this.clipD.x,c[a++]=
this.clipD.y,c[a++]=this.clipD.z,c[a++]=this.clipP1.x,c[a++]=this.clipP1.y,c[a++]=this.clipP1.z,c[a++]=this.clipD.x,c[a++]=this.clipD.y,c[a++]=this.clipD.z,c[a++]=this.clipP3.x,c[a++]=this.clipP3.y,c[a++]=this.clipP3.z,c[a++]=this.clipD.x,c[a++]=this.clipD.y,c[a++]=this.clipD.z,c[a++]=this.clipP2.x,c[a++]=this.clipP2.y,c[a++]=this.clipP2.z,c[a++]=this.clipD.x,c[a++]=this.clipD.y,c[a++]=this.clipD.z,e.bufferSubData(e.ARRAY_BUFFER,0,this._cutFaceBuf),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,
this._capTexture),e.drawArrays(e.TRIANGLE_STRIP,0,4),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.polygonOffset(0,0),e.disable(e.POLYGON_OFFSET_FILL))}}},RenderMoveHint:{value:function(a,c,d){var e=this._scene.navigator,f=this._gl,g=d.ray.orgn.Clone(),k=new GLTFViewer.Utils.Vec3(g.x+this.clipPlane.diz.x*e.ps,g.y+this.clipPlane.diz.y*e.ps,g.z+this.clipPlane.diz.z*e.ps);e.Project(g);e.Project(k);g.z=0;k.z=0;g=GLTFViewer.Utils.Direction.Create(g,k);if(!g.IsZero()){var k=
new GLTFViewer.Utils.Direction(-g.y,g.x,0),h=GLTFViewer.Utils.Transformation.orthoRH(a,-c,-10,100);h.Multiply(e.cameraTM);a=(a/2-d.x)/.7;c=(c/2-d.y)/.7;e=GLTFViewer.Utils.Transformation.TranslationCreate(-a+10*g.x,-c+10*g.y,-50+10*g.z);e.Multiply(GLTFViewer.Utils.Transformation.ScaleAboutPointCreate(.7,a,c,0));e.Multiply(GLTFViewer.Utils.Transformation.RotationCreate(g.x,g.y,g.z,k.x,k.y,k.z));d=this._planeShader;d.StartProgram()&&(f.disable(f.DEPTH_TEST),f.depthMask(!1),f.enable(f.BLEND),e.ToArray(this._mtxArray),
f.uniformMatrix4fv(d.uTWd,!1,this._mtxArray),h.ToArray(this._mtxArray),f.uniformMatrix4fv(d.uTVP,!1,this._mtxArray),h=new GLTFViewer.Utils.RGBA(50,50,255,100),e=new Float32Array(4),h.ToArray(e,0),f.uniform4fv(d.uClr,e),h=0,e=this._hintBuf,e[h++]=35,e[h++]=-30,e[h++]=0,e[h++]=55,e[h++]=0,e[h++]=0,e[h++]=35,e[h++]=-15,e[h++]=0,e[h++]=35,e[h++]=-15,e[h++]=0,e[h++]=55,e[h++]=0,e[h++]=0,e[h++]=35,e[h++]=15,e[h++]=0,e[h++]=35,e[h++]=-15,e[h++]=0,e[h++]=35,e[h++]=15,e[h++]=0,e[h++]=21,e[h++]=-15,e[h++]=
0,e[h++]=21,e[h++]=-15,e[h++]=0,e[h++]=35,e[h++]=15,e[h++]=0,e[h++]=21,e[h++]=15,e[h++]=0,e[h++]=55,e[h++]=0,e[h++]=0,e[h++]=35,e[h++]=30,e[h++]=0,e[h++]=35,e[h++]=15,e[h++]=0,f.bindBuffer(f.ARRAY_BUFFER,this._glBuffer),f.bufferSubData(f.ARRAY_BUFFER,0,this._hintBuf),f.vertexAttribPointer(d.aPos,3,f.FLOAT,!1,12,0),f.drawArrays(f.TRIANGLES,0,15),e=GLTFViewer.Utils.Transformation.TranslationCreate(-a-10*g.x,-c-10*g.y,-50-10*g.z),e.Multiply(GLTFViewer.Utils.Transformation.ScaleAboutPointCreate(.7,a,
c,0)),e.Multiply(GLTFViewer.Utils.Transformation.RotationCreate(-g.x,-g.y,-g.z,k.x,k.y,k.z)),e.ToArray(this._mtxArray),f.uniformMatrix4fv(d.uTWd,!1,this._mtxArray),f.drawArrays(f.TRIANGLES,0,15),f.bindBuffer(f.ARRAY_BUFFER,null),f.disable(f.BLEND),f.depthMask(!0),f.enable(f.DEPTH_TEST))}}},RenderPreview:{value:function(a,c,d,e,f){var g=this._scene.navigator;e=this._gl;if(this.clipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_1_PT){this.clipPlane=f;this._SetClipPointsFromPlane(f);c=this.clipP0;var k=this.clipP1;
d=this.clipP2;f=this.clipP3;g=100*g.ps/Math.sqrt(g.zoom);this.clipPlane.Evaluate(c,-g,-g);this.clipPlane.Evaluate(k,+g,-g);this.clipPlane.Evaluate(d,+g,+g);this.clipPlane.Evaluate(f,-g,+g);g=this._planeShader;if(g.StartProgram()){e.uniformMatrix4fv(g.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);e.uniformMatrix4fv(g.uTVP,!1,a);e.disable(e.DEPTH_TEST);e.depthMask(!1);e.enable(e.BLEND);e.enable(e.POLYGON_OFFSET_FILL);e.polygonOffset(-.5,0);a=0;var h=this._clipPlaneBuf;h[a++]=c.x;h[a++]=c.y;h[a++]=c.z;h[a++]=
k.x;h[a++]=k.y;h[a++]=k.z;h[a++]=f.x;h[a++]=f.y;h[a++]=f.z;h[a++]=d.x;h[a++]=d.y;h[a++]=d.z;e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer);e.bufferSubData(e.ARRAY_BUFFER,0,this._clipPlaneBuf);e.vertexAttribPointer(g.aPos,3,e.FLOAT,!1,12,0);k=new Float32Array(4);GLTFViewer.Utils.FlatRgba(250,250,250,80,k);e.uniform4fv(g.uClr,k);e.drawArrays(e.TRIANGLE_STRIP,0,4);e.enable(e.DEPTH_TEST);GLTFViewer.Utils.FlatRgba(250,250,250,100,k);e.uniform4fv(g.uClr,k);e.drawArrays(e.TRIANGLE_STRIP,0,4);e.disable(e.DEPTH_TEST);
a=6;h[a++]=d.x;h[a++]=d.y;h[a++]=d.z;h[a++]=f.x;h[a++]=f.y;h[a++]=f.z;h[a++]=c.x;h[a++]=c.y;h[a++]=c.z;e.bufferSubData(e.ARRAY_BUFFER,0,this._clipPlaneBuf);GLTFViewer.Utils.FlatRgba(250,150,150,80,k);e.uniform4fv(g.uClr,k);e.drawArrays(e.LINE_STRIP,0,5);e.enable(e.DEPTH_TEST);GLTFViewer.Utils.FlatRgba(250,0,0,180,k);e.uniform4fv(g.uClr,k);e.drawArrays(e.LINE_STRIP,0,5);e.bindBuffer(e.ARRAY_BUFFER,null);e.depthMask(!0);e.disable(e.BLEND);e.polygonOffset(0,0);e.disable(e.POLYGON_OFFSET_FILL)}}else this.clipDrawMode<
GLTFViewer.Utils.Clip.DRAWMODE_1ST_OF_3_PTS&&(g=this._pointShader,g.StartProgram()&&(e.bindBuffer(e.ARRAY_BUFFER,this._glBuffer),e.vertexAttribPointer(g.aPos,3,e.FLOAT,!1,16,0),e.vertexAttribPointer(g.aTex,1,e.FLOAT,!1,16,12),e.uniformMatrix4fv(g.uTVP,!1,a),e.uniform2fv(g.uPos,this._uPos),e.uniform2fv(g.uTex,this._uTex),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._circleTexture),e.disable(e.DEPTH_TEST),e.depthMask(!1),e.enable(e.BLEND),a=new GLTFViewer.Utils.RGBA(255,0,0,255),a.ToArray(this._uClr,
0),a.SetRgba(255,230,230,255),a.ToArray(this._uClr,4),e.uniform2f(g.uSze,9/c,9/d),e.uniform4fv(g.uClr,this._uClr),a=0,c=this.clipP0,h=this._clipPointBuf,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=0,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=1,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=2,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=2,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=3,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=0,g=6,this.clipDrawMode<GLTFViewer.Utils.Clip.DRAWMODE_2ND_OF_3_PTS&&(c=this.clipP1,h[a++]=c.x,h[a++]=
c.y,h[a++]=c.z,h[a++]=0,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=1,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=2,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=2,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=3,h[a++]=c.x,h[a++]=c.y,h[a++]=c.z,h[a++]=0,g+=6),e.bufferSubData(e.ARRAY_BUFFER,0,this._clipPointBuf),e.drawArrays(e.TRIANGLES,0,g),e.bindTexture(e.TEXTURE_2D,null),e.bindBuffer(e.ARRAY_BUFFER,null),e.disable(e.BLEND),e.depthMask(!0),e.enable(e.DEPTH_TEST)))}},SetClipPoint:{value:function(a){if(a){if(this.clipDrawMode===
GLTFViewer.Utils.Clip.DRAWMODE_1_PT){var c=a.diz.TransformCreate(this._scene.navigator.modelViewInvTrp);0<c.z&&a.diz.Negate();this.clipPlane=new GLTFViewer.Utils.Plane(a.orgn,a.diz);this._SetClipPointsFromPlane(a);this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_MOVE;this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_PLANE;this.UpdateClip();this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUCHECK)}else if(this.clipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_1ST_OF_3_PTS)this.clipP0.Set(a.x,
a.y,a.z),this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_2ND_OF_3_PTS;else if(this.clipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_2ND_OF_3_PTS)c=this.clipP0,(new GLTFViewer.Utils.Vec3(c.x-a.x,c.y-a.y,c.z-a.z)).IsLength(0)||(this.clipP1.Set(a.x,a.y,a.z),this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_3RD_OF_3_PTS);else if(this.clipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_3RD_OF_3_PTS){var c=this.clipP0,d=this.clipP1,e=new GLTFViewer.Utils.Vec3((c.x+d.x+a.x)/3,(c.y+d.y+a.y)/3,(c.z+d.z+a.z)/3),f=new GLTFViewer.Utils.Vec3,
g=new GLTFViewer.Utils.Vec3;g.Set(a.x-c.x,a.y-c.y,a.z-c.z);f.Set(d.x-c.x,d.y-c.y,d.z-c.z);f.Cross(g);a=f.GetDirection();c=a.TransformCreate(this._scene.navigator.modelViewInvTrp);0<c.z&&a.Negate();a.IsZero()||(this.clipPlane=new GLTFViewer.Utils.Plane(e,a),this.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_MOVE,this._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,this.UpdateClip(),this._scene.viewer.ClipMenuBtnState(5,null,GLTFViewer.MENUCHECK))}this._scene.Invalidate(!0)}}},Reset:{value:function(){this.clipState=
GLTFViewer.Utils.Clip.STATE_DISABLED;this._clipValid=this._capTextureValid=!1}},Clear:{value:function(){var a=this._gl;null!==this._pointShader&&(this._pointShader.DeleteProgram(),this._pointShader=null);null!==this._capShader&&(this._capShader.DeleteProgram(),this._capShader=null);null!==this._planeShader&&(this._planeShader.DeleteProgram(),this._planeShader=null);null!==this._capTexture&&(a.deleteTexture(this._capTexture),this._capTexture=null);this._circleTexture&&(a.deleteTexture(this._circleTexture),
this._circleTexture=null);null!==this._glBuffer&&(a.deleteBuffer(this._glBuffer),this._glBuffer=null);this._gl=this._scene=this.clipP3=this.clipP2=this.clipP1=this.clipP0=this.glClip1=this.glClip0=this._uMtl=this._uPos=this._uClr=this._uTex=this._clipPlaneBuf=this._clipPointBuf=this._cutFaceBuf=this._hintBuf=this._mtxArray=null}}});
Object.defineProperties(GLTFViewer.Utils.Clip,{_vsPoint:{value:"uniform mat4 uTVP;\nuniform vec2 uPos[4];\nuniform vec2 uTex[4];\nuniform vec2 uSze;\nattribute vec3 aPos;\nattribute float aTex;\nvarying vec2 vTex;\nvoid main() {\nint i = int(aTex);\nvTex = uTex[i];\nvec2 o = uPos[i] * uSze * uTVP[3][3];\ngl_Position = uTVP * vec4(aPos, 1) + vec4(o, 0, 0);\n}"},_fsPoint:{value:"uniform vec4 uClr[2];\nuniform sampler2D uSmp;\nvarying vec2 vTex;\nvoid main() {\nvec4 t = texture2D(uSmp, vTex);\nvec4 c = uClr[0] + uClr[1] * t.r;\nc.a *= t.a;\ngl_FragColor = c;\n}"},
_vsCap:{value:"uniform mat4 uTVP;\nuniform vec3 uEye;\nattribute vec3 aPos;\nattribute vec3 aNor;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvarying vec3 vTex;\nvoid main() {\nvDir = normalize(aPos - uEye);\nvec4 pos = uTVP * vec4(aPos, 1.0);\nvTex = vec3(pos.xy, pos.w);\nvNor = aNor;\ngl_Position = pos;\n}"},_fsCap:{value:"uniform mat4 uLit[2];\nuniform mat4 uMtl;\nuniform sampler2D uSmp;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvarying vec3 vTex;\nvoid main() {\nvec2 xy = .5 + vTex.xy / vTex.z / 2.0;\nvec4 c = texture2D(uSmp, xy);\nif(c.a == 0.0) discard;\nvec3 rgb = vec3(0);\nvec3 nor = normalize(vNor);\nnor *= -sign(dot(vDir, nor));\nvec3 r = reflect(uLit[0][3].xyz, nor);\nfloat s = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nfloat d = max(dot(uLit[0][3].xyz, nor), 0.0);\nvec3 sp = s * uLit[0][2].rgb / 7.0;\nvec3 di = d * c.rgb * uLit[0][1].rgb;\nvec3 am = c.rgb * uLit[0][0].rgb;\nrgb = am + di + sp;\nr = reflect(uLit[1][3].xyz, nor);\ns = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nd = max(dot(uLit[1][3].xyz, nor), 0.0);\nsp = s * uLit[1][2].rgb / 7.0;\ndi = d * c.rgb * uLit[1][1].rgb;\nam = c.rgb * uLit[1][0].rgb;\nrgb = rgb + am + di + sp;\ngl_FragColor = vec4(rgb, c.a);\n}"},
_vsPlane:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvoid main() {\nvec4 pos = uTWd * vec4(aPos, 1.0);\ngl_Position = uTVP * pos;\n}"},_fsPlane:{value:"uniform vec4 uClr;\nvoid main() {\ngl_FragColor = uClr;\n}"},GetClipPointsFromPlane:{value:function(a){var c=new GLTFViewer.Utils.Vec3(a.orgn.x,a.orgn.y,a.orgn.z),d=new GLTFViewer.Utils.Vec3(a.orgn.x+a.diy.x,a.orgn.y+a.diy.y,a.orgn.z+a.diy.z);a=new GLTFViewer.Utils.Vec3(a.orgn.x+a.dix.x,a.orgn.y+a.dix.y,a.orgn.z+a.dix.z);
return{p0:c,p1:d,p2:a}}},STATE_DISABLED:{value:0},STATE_Z:{value:1},STATE_X:{value:2},STATE_Y:{value:3},STATE_1PT:{value:4},STATE_3PTS:{value:5},DRAWMODE_DONE:{value:0},DRAWMODE_1_PT:{value:1},DRAWMODE_3RD_OF_3_PTS:{value:2},DRAWMODE_2ND_OF_3_PTS:{value:3},DRAWMODE_1ST_OF_3_PTS:{value:4},DRAWMODE_MOVE:{value:5},DRAWMODE_MOVING:{value:6},VIEWSTATE_NONE:{value:0},VIEWSTATE_PREVIEW:{value:1},VIEWSTATE_PLANE:{value:2}});GLTFViewer.Utils.CursorRay=function(a,c,d){this._navigator=a;this.Update(c,d)};
GLTFViewer.Utils.CursorRay.prototype=Object.create(null,{_navigator:{writable:!0,value:null},x:{writable:!0,value:0},y:{writable:!0,value:0},ray:{writable:!0,value:null},rx:{writable:!0,value:0},ry:{writable:!0,value:0},dix:{writable:!0,value:null},diy:{writable:!0,value:null},Clone:{value:function(){var a=new GLTFViewer.Utils.CursorRay;a._navigator=this._navigator;a.x=this.x;a.y=this.y;a.ray=this.ray.Clone();a.dix=this.dix.Clone();a.diy=this.diy.Clone();a.rx=this.rx;a.ry=this.ry;return a}},Update:{value:function(a,
c){var d=this._navigator;if(d&&"undefined"!==typeof a&&"undefined"!==typeof c){this.x=a;this.y=c;var e=new GLTFViewer.Utils.Vec3(a,c,0),f=new GLTFViewer.Utils.Vec3(a,c,1);d.UnProject(e);d.UnProject(f);f=GLTFViewer.Utils.Vec3.Create(e,f).GetDirection();f.IsZero()&&(f=d.projectionInvTM.GetZDirection().NegateCreate());this.ray=new GLTFViewer.Utils.Line(e,f);this.dix=this.ray.dir.CreateArbitraryPerpendicular();this.diy=this.ray.dir.CrossCreate(this.dix).GetDirection();this.rx=this.ray.orgn.Dot(this.dix);
this.ry=this.ray.orgn.Dot(this.diy)}}},TransformCreate:{value:function(a){var c=this.Clone();if(a.IsIdentity())return c;c._navigator=this._navigator;c.x=this.x;c.y=this.y;c.ray.Transform(a);c.dix.Set(c.ray.dir);c.dix.SetArbitraryPerpendicular();c.diy.Set(c.ray.dir);c.diy.Cross(c.dix).Normalize();c.rx=c.ray.orgn.Dot(c.dix);c.ry=c.ray.orgn.Dot(c.diy);return c}},ToArray:{value:function(a){var c=this.ray.orgn,d=this.ray.dir;a[0]=c.x;a[1]=c.y;a[2]=c.z;a[3]=this.x;a[4]=d.x;a[5]=d.y;a[6]=d.z;a[7]=this.y}}});
GLTFViewer.Utils.Light=function(){this.ambient=new GLTFViewer.Utils.RGBA(0,0,0,255);this.diffuse=new GLTFViewer.Utils.RGBA(0,0,0,255);this.specular=new GLTFViewer.Utils.RGBA(0,0,0,255);this.dir=new GLTFViewer.Utils.Vec3};GLTFViewer.Utils.Light.prototype=Object.create(null,{ambient:{writable:!0,value:null},diffuse:{writable:!0,value:null},specular:{writable:!0,value:null},dir:{writable:!0,value:null}});
GLTFViewer.Utils.Material=function(a,c,d,e){"undefined"===typeof a?(this.ambient=new GLTFViewer.Utils.RGBA,this.diffuse=new GLTFViewer.Utils.RGBA,this.specular=new GLTFViewer.Utils.RGBA,this.power=0):a instanceof GLTFViewer.Utils.RGBA?(this.ambient=new GLTFViewer.Utils.RGBA,this.diffuse=new GLTFViewer.Utils.RGBA,this.specular=new GLTFViewer.Utils.RGBA,this.Set(a)):(this.ambient=a.Clone(),this.diffuse=c.Clone(),this.specular=d.Clone(),this.power=e)};
GLTFViewer.Utils.Material.prototype=Object.create(null,{ambient:{writable:!0,value:null},diffuse:{writable:!0,value:null},specular:{writable:!0,value:null},power:{writable:!0,value:0},Set:{value:function(a){this.ambient.SetColor(a);this.diffuse.SetColor(a);this.specular.SetRgba(51,51,51,a.a);this.power=15}},ToArray:{value:function(a,c){a[c+0]=this.ambient.r/255;a[c+1]=this.ambient.g/255;a[c+2]=this.ambient.b/255;a[c+3]=this.ambient.a/255;a[c+4]=this.diffuse.r/255;a[c+5]=this.diffuse.g/255;a[c+6]=
this.diffuse.b/255;a[c+7]=this.diffuse.a/255;a[c+8]=this.specular.r/255;a[c+9]=this.specular.g/255;a[c+10]=this.specular.b/255;a[c+11]=this.specular.a/255;a[c+12]=this.power}}});GLTFViewer.Utils.Fill=function(){};Object.defineProperties(GLTFViewer.Utils.Fill,{Empty:{value:0},Opaque:{value:1},OpaqueMetal:{value:2},Transparent:{value:3},Default:{value:4}});GLTFViewer.Utils.Line=function(a,c){this.orgn=a;this.dir=c};
GLTFViewer.Utils.Line.prototype=Object.create(null,{orgn:{writable:!0,value:null},dir:{writable:!0,value:null},Set:{value:function(a){this.orgn.Set(a.orgn.x,a.orgn.y,a.orgn.z);this.dir.Set(a.dir.x,a.dir.y,a.dir.z)}},Clone:{value:function(){return new GLTFViewer.Utils.Line(this.orgn.Clone(),this.dir.Clone())}},Transform:{value:function(a){a.IsIdentity()||(this.orgn.Transform(a),this.dir.Transform(a))}},TransformCreate:{value:function(a){return a.IsIdentity()?this.Clone():new GLTFViewer.Utils.Line(this.orgn.TransformCreate(a),
this.dir.TransformCreate(a))}},Evaluate:{value:function(a,c){c.x=this.orgn.x+this.dir.x*a;c.y=this.orgn.y+this.dir.y*a;c.z=this.orgn.z+this.dir.z*a}},GetPoint:{value:function(a,c){var d=this.dir.CrossCreate(a.dir).GetMagnitude();if(GLTFViewer.Utils.IslengthZero(d))return!1;var e=this.dir.Dot(this.dir),f=a.dir.Dot(this.dir),g=f,d=a.dir.Dot(a.dir),k=GLTFViewer.Utils.Vec3.Create(this.orgn,a.orgn),h=this.dir.Dot(k),k=a.dir.Dot(k),g=f*g-e*d,e=f/g*k-d/g*h;c.x=this.orgn.x+e*this.dir.x;c.y=this.orgn.y+e*
this.dir.y;c.z=this.orgn.z+e*this.dir.z;return!0}}});GLTFViewer.Utils.Plane=function(a,c){this.orgn=a.Clone();this.dix=c.CreateArbitraryPerpendicular();this.diy=c.CrossCreate(this.dix).GetDirection();this.diz=c.Clone()};
GLTFViewer.Utils.Plane.prototype=Object.create(null,{orgn:{writable:!0,value:null},dix:{writable:!0,value:null},diy:{writable:!0,value:null},diz:{writable:!0,value:null},Set:{value:function(a,c){this.orgn.x=a.x;this.orgn.y=a.y;this.orgn.z=a.z;this.dix=c.CreateArbitraryPerpendicular();this.diy.x=c.x;this.diy.y=c.y;this.diy.z=c.z;this.diy.Cross(this.dix).Normalize();this.diz.x=c.x;this.diz.y=c.y;this.diz.z=c.z}},Clone:{value:function(){return new GLTFViewer.Utils.Plane(this.orgn,this.diz)}},GetPoint:{value:function(a,
c){var d=a.dir.Dot(this.diz);if(GLTFViewer.Utils.IslengthZero(d)){d=a.dir.Dot(this.dix);if(GLTFViewer.Utils.IslengthZero(d))return!1;d=this.dix.Dot(GLTFViewer.Utils.Vec3.Create(a.orgn,this.orgn))/d}else d=this.diz.Dot(GLTFViewer.Utils.Vec3.Create(a.orgn,this.orgn))/d;a.Evaluate(d,c);return!0}},Evaluate:{value:function(a,c,d){a.x=this.orgn.x+c*this.dix.x+d*this.diy.x;a.y=this.orgn.y+c*this.dix.y+d*this.diy.y;a.z=this.orgn.z+c*this.dix.z+d*this.diy.z}}});
GLTFViewer.Utils.Box=function(a,c,d,e,f,g){this.Set(a,c,d,e,f,g)};
GLTFViewer.Utils.Box.prototype=Object.create(null,{mix:{writable:!0,value:0},miy:{writable:!0,value:0},miz:{writable:!0,value:0},max:{writable:!0,value:0},may:{writable:!0,value:0},maz:{writable:!0,value:0},Reset:{value:function(){this.Set()}},Equals:{value:function(a){return a&&GLTFViewer.Utils.EqualDoubles(this.mix,a.mix)&&GLTFViewer.Utils.EqualDoubles(this.miy,a.miy)&&GLTFViewer.Utils.EqualDoubles(this.miz,a.miz)&&GLTFViewer.Utils.EqualDoubles(this.max,a.max)&&GLTFViewer.Utils.EqualDoubles(this.may,
a.may)&&GLTFViewer.Utils.EqualDoubles(this.maz,a.maz)}},Set:{value:function(a,c,d,e,f,g){GLTFViewer.Utils.IsNull(a)?(this.miz=this.miy=this.mix=GLTFViewer.Utils.maxValue,this.max=-GLTFViewer.Utils.maxValue,this.may=-GLTFViewer.Utils.maxValue,this.maz=-GLTFViewer.Utils.maxValue):a instanceof Array&&3===a.length&&c instanceof Array&&3===c.length?(this.mix=1*a[0],this.miy=1*a[1],this.miz=1*a[2],this.max=1*c[0],this.may=1*c[1],this.maz=1*c[2]):a instanceof GLTFViewer.Utils.Vec3&&c instanceof GLTFViewer.Utils.Vec3?
(this.mix=a.x,this.miy=a.y,this.miz=a.z,this.max=c.x,this.may=c.y,this.maz=c.z):a instanceof GLTFViewer.Utils.Box?(this.mix=a.mix,this.miy=a.miy,this.miz=a.miz,this.max=a.max,this.may=a.may,this.maz=a.maz):a instanceof GLTFViewer.Utils.Vec3?(this.mix=a.x,this.miy=a.y,this.miz=a.z,this.max=a.x,this.may=a.y,this.maz=a.z):(this.mix=a,this.miy=c,this.miz=d,this.max=e,this.may=f,this.maz=g);return this}},Clone:{value:function(){return new GLTFViewer.Utils.Box(this.mix,this.miy,this.miz,this.max,this.may,
this.maz)}},GetCenter:{value:function(a){var c=(this.mix+this.max)/2,d=(this.miy+this.may)/2,e=(this.miz+this.maz)/2;if(a)a.Set(c,d,e);else return new GLTFViewer.Utils.Vec3(c,d,e)}},GetDiameter:{value:function(){var a=this.max-this.mix,c=this.may-this.miy,d=this.maz-this.miz;return Math.sqrt(a*a+c*c+d*d)}},GetCorners:{value:function(){return[new GLTFViewer.Utils.Vec3(this.mix,this.miy,this.miz),new GLTFViewer.Utils.Vec3(this.mix,this.miy,this.maz),new GLTFViewer.Utils.Vec3(this.mix,this.may,this.miz),
new GLTFViewer.Utils.Vec3(this.mix,this.may,this.maz),new GLTFViewer.Utils.Vec3(this.max,this.miy,this.miz),new GLTFViewer.Utils.Vec3(this.max,this.miy,this.maz),new GLTFViewer.Utils.Vec3(this.max,this.may,this.miz),new GLTFViewer.Utils.Vec3(this.max,this.may,this.maz)]}},IsEmpty:{value:function(){return this.mix===GLTFViewer.Utils.maxValue}},IsSane:{value:function(){return!this.IsEmpty()&&(this.GetDiameter()>GLTFViewer.Utils.maxDouble||this.mix<-GLTFViewer.Utils.maxDouble||this.mix>GLTFViewer.Utils.maxDouble||
this.miy<-GLTFViewer.Utils.maxDouble||this.miy>GLTFViewer.Utils.maxDouble||this.miz<-GLTFViewer.Utils.maxDouble||this.miz>GLTFViewer.Utils.maxDouble||this.max<-GLTFViewer.Utils.maxDouble||this.max>GLTFViewer.Utils.maxDouble||this.may<-GLTFViewer.Utils.maxDouble||this.may>GLTFViewer.Utils.maxDouble||this.maz<-GLTFViewer.Utils.maxDouble||this.maz>GLTFViewer.Utils.maxDouble)?!1:!0}},IsWithin:{value:function(a){return this.IsEmpty()?!1:a.x>=this.mix&&a.x<=this.max&&a.y>=this.miy&&a.y<=this.may&&a.z>=
this.miz&&a.z<=this.maz}},Unite:{value:function(a,c,d,e,f,g){a=new GLTFViewer.Utils.Box(a,c,d,e,f,g);a.IsEmpty()||(a.mix<this.mix&&(this.mix=a.mix),a.max>this.max&&(this.max=a.max),a.miy<this.miy&&(this.miy=a.miy),a.may>this.may&&(this.may=a.may),a.miz<this.miz&&(this.miz=a.miz),a.maz>this.maz&&(this.maz=a.maz));return this}},Multiply:{value:function(a){if(!this.IsEmpty()&&!a.IsIdentity()){for(var c=this.GetCorners(),d=new GLTFViewer.Utils.Box,e=0;e<c.length;++e)c[e].Transform(a),d.Unite(c[e]);this.Set(d)}return this}}});
Object.defineProperties(GLTFViewer.Utils.Box,{empty:{get:function(){return new GLTFViewer.Utils.Box}}});GLTFViewer.Utils.Ball=function(){this.Reset()};
GLTFViewer.Utils.Ball.prototype=Object.create(null,{w:{writable:!0,value:0},h:{writable:!0,value:0},cx:{writable:!0,value:0},cy:{writable:!0,value:0},dq:{writable:!0,value:null},nq:{writable:!0,value:null},dp:{writable:!0,value:null},cp:{writable:!0,value:null},a:{writable:!0,value:0},d:{writable:!0,value:null},Reset:{value:function(){this.nq=this.dq=GLTFViewer.Utils.Quat.Identity}},getScreenToVector:{value:function(a,c){var d=(a-this.cx)/this.w,e=-(c-this.cy)/this.h,f=0,g=d*d+e*e;1<g?(g=1/Math.sqrt(g),
d*=g,e*=g):f=Math.sqrt(1-g);return new GLTFViewer.Utils.Vec3(d,e,f)}},onBegin:{value:function(a,c){this.Reset();this.h=this.w=400;this.cx=a;this.cy=c;this.dq=this.nq;this.dp=this.getScreenToVector(a,c)}},onMove:{value:function(a,c){if(Math.abs(this.cx-a)>.75*this.w||Math.abs(this.cy-c)>.75*this.h)this.cx=a,this.cy=c,this.dq=this.nq,this.dp=this.getScreenToVector(a,c);this.cp=this.getScreenToVector(a,c);var d=this.dp.Dot(this.cp),e=this.dp.CrossCreate(this.cp);this.nq=(new GLTFViewer.Utils.Quat(e.x,
e.y,e.z,d)).MultiplyCreate(this.dq);var d=this.nq.w,e=1-d*d,f=0;0<e&&(f=Math.sqrt(e));5E-4>Math.abs(f)&&(f=1);this.a=2*GLTFViewer.Utils.acos(d);this.d=new GLTFViewer.Utils.Direction(this.nq.x/f,this.nq.y/f,this.nq.z/f)}}});GLTFViewer.Utils.Vec3=function(a,c,d){GLTFViewer.Utils.Vec3.prototype.Set.call(this,a,c,d)};
GLTFViewer.Utils.Vec3.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Vec3},x:{writable:!0,value:0},y:{writable:!0,value:0},z:{writable:!0,value:0},Set:{value:function(a,c,d){GLTFViewer.Utils.IsNull(a)?this.z=this.y=this.x=0:a instanceof Array&&3===a.length?(this.x=1*a[0],this.y=1*a[1],this.z=1*a[2]):a instanceof GLTFViewer.Utils.Vec3?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=a,this.y=c,this.z=d);return this}},Clone:{value:function(){return new this.constructor(this.x,this.y,this.z)}},
Equals:{value:function(a){return GLTFViewer.Utils.EqualDoubles(this.x,a.x)&&GLTFViewer.Utils.EqualDoubles(this.y,a.y)&&GLTFViewer.Utils.EqualDoubles(this.z,a.z)}},Normalize:{value:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;1!==a&&(a<GLTFViewer.Utils.lengthAccuracySquared?this.z=this.y=this.x=0:(a=Math.sqrt(a),this.x/=a,this.y/=a,this.z/=a));return this}},ToArray:{value:function(a,c){var d=GLTFViewer.Utils.IsNull(c)?0:c;a[d+0]=this.x;a[d+1]=this.y;a[d+2]=this.z}},Dot:{value:function(a){return this.x*
a.x+this.y*a.y+this.z*a.z}},Negate:{value:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this}},NegateCreate:{value:function(){return this.Clone().Negate()}},Cross:{value:function(a){var c=a.x*this.z-this.x*a.z,d=this.x*a.y-a.x*this.y;this.x=this.y*a.z-a.y*this.z;this.y=c;this.z=d;return this}},CrossCreate:{value:function(a){return this.Clone().Cross(a)}},Transform:{value:function(a){if(a.IsIdentity())return this;var c=a.a01*this.x+a.a11*this.y+a.a21*this.z+a.a31,d=a.a02*this.x+a.a12*
this.y+a.a22*this.z+a.a32,e=a.a03*this.x+a.a13*this.y+a.a23*this.z+a.a33;this.x=(a.a00*this.x+a.a10*this.y+a.a20*this.z+a.a30)/e;this.y=c/e;this.z=d/e;return this}},TransformCreate:{value:function(a){return this.Clone().Transform(a)}},Add:{value:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this}},Subtract:{value:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this}},Scale:{value:function(a){this.x*=a;this.y*=a;this.z*=a;return this}},ScaleCreate:{value:function(a){return this.Clone().Scale(a)}},
IsZero:{value:function(){return!this.x&&!this.y&&!this.z}},GetDirection:{value:function(){return new GLTFViewer.Utils.Direction(this.x,this.y,this.z)}},GetMagnitude:{value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},GetMagnitudeSquared:{value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},IsLength:{value:function(a){return GLTFViewer.Utils.EqualLengths(this.GetMagnitude(),a)}}});
Object.defineProperties(GLTFViewer.Utils.Vec3,{Origin:{get:function(){return new GLTFViewer.Utils.Vec3}},Create:{value:function(a,c){return new GLTFViewer.Utils.Vec3(c.x-a.x,c.y-a.y,c.z-a.z)}}});GLTFViewer.Utils.Direction=function(a,c,d){GLTFViewer.Utils.Vec3.call(this,a,c,d);this.Normalize()};
GLTFViewer.Utils.Direction.prototype=Object.create(GLTFViewer.Utils.Vec3.prototype,{constructor:{value:GLTFViewer.Utils.Direction},Set:{value:function(a,c,d){return GLTFViewer.Utils.Vec3.prototype.Set.call(this,a,c,d).Normalize()}},Subtract:{value:function(a){return GLTFViewer.Utils.Vec3.prototype.Subtract.call(this,a).Normalize()}},Transform:{value:function(a){if(a.IsIdentity())return this;var c=a.a01*this.x+a.a11*this.y+a.a21*this.z,d=a.a02*this.x+a.a12*this.y+a.a22*this.z;this.x=a.a00*this.x+a.a10*
this.y+a.a20*this.z;this.y=c;this.z=d;return this.Normalize()}},TransformCreate:{value:function(a){return this.Clone().Transform(a)}},GetComponent:{value:function(a){a=this.Dot(a);return new GLTFViewer.Utils.Vec3(this.x*a,this.y*a,this.z*a)}},SetArbitraryPerpendicular:{value:function(){if(-.6<this.z&&.6>this.z){var a=this.x;this.x=-this.y;this.y=a;this.z=0}else-.6<this.y&&.6>this.y?(a=this.x,this.x=this.z,this.y=0,this.z=-a):(a=this.y,this.x=0,this.y=-this.z,this.z=a);return this}},CreateArbitraryPerpendicular:{value:function(){return-.6<
this.z&&.6>this.z?new GLTFViewer.Utils.Direction(-this.y,this.x,0):-.6<this.y&&.6>this.y?new GLTFViewer.Utils.Direction(this.z,0,-this.x):new GLTFViewer.Utils.Direction(0,-this.z,this.y)}},RotateVectorCreate:{value:function(a,c){var d=this.GetComponent(a),e=GLTFViewer.Utils.Vec3.Create(d,a),f=(new GLTFViewer.Utils.Vec3(this)).CrossCreate(e);d.Add(e.ScaleCreate(Math.cos(c)));return d.Add(f.ScaleCreate(Math.sin(c)))}}});
Object.defineProperties(GLTFViewer.Utils.Direction,{dix:{get:function(){return new GLTFViewer.Utils.Direction(1,0,0)}},diy:{get:function(){return new GLTFViewer.Utils.Direction(0,1,0)}},diz:{get:function(){return new GLTFViewer.Utils.Direction(0,0,1)}},Create:{value:function(a,c){return new GLTFViewer.Utils.Direction(c.x-a.x,c.y-a.y,c.z-a.z)}},ScaleCreate:{value:function(a,c){return new GLTFViewer.Utils.Vec3(a.x*c,a.y*c,a.z*c)}}});
GLTFViewer.Utils.Quat=function(a,c,d,e){this.w=e;this.x=a;this.y=c;this.z=d};
GLTFViewer.Utils.Quat.prototype=Object.create(null,{x:{writable:!0,value:0},y:{writable:!0,value:0},z:{writable:!0,value:0},w:{writable:!0,value:0},Clone:{value:function(){return new GLTFViewer.Utils.Quat(this.x,this.y,this.z,this.w)}},SetFromAxisAngle:{value:function(a){var c=Math.sin(a[3]/2),d=new GLTFViewer.Utils.Direction(1*a[0],1*a[1],1*a[2]);this.x=d.x*c;this.y=d.y*c;this.z=d.z*c;this.w=Math.cos(a[3]/2)}},Normalize:{value:function(){var a=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;
1!==a&&(a<GLTFViewer.Utils.lengthAccuracySquared?(this.z=this.y=this.x=0,this.z=1):(a=Math.sqrt(a),this.x/=a,this.y/=a,this.z/=a,this.w/=a))}},MultiplyCreate:{value:function(a){return new GLTFViewer.Utils.Quat(this.w*a.x+this.x*a.w+this.y*a.z-this.z*a.y,this.w*a.y+this.y*a.w+this.z*a.x-this.x*a.z,this.w*a.z+this.z*a.w+this.x*a.y-this.y*a.x,this.w*a.w-this.x*a.x-this.y*a.y-this.z*a.z)}}});
Object.defineProperties(GLTFViewer.Utils.Quat,{Identity:{get:function(){return new GLTFViewer.Utils.Quat(0,0,0,1)}},Slerp:{value:function(a,c,d){a=a.Clone();var e=a.w*c.w+a.x*c.x+a.y*c.y+a.z*c.z;0>e&&(a.x*=-1,a.y*=-1,a.z*=-1,a.w*=-1,e*=-1);if(1<=Math.abs(e))return new GLTFViewer.Utils.Quat(a.x,a.y,a.z,a.w);var f=Math.acos(e),g=Math.sqrt(1-e*e);if(.001>Math.abs(g))return new GLTFViewer.Utils.Quat((a.x+c.x)/2,(a.y+c.y)/2,(a.z+c.z)/2,(a.w+c.w)/2);e=Math.sin((1-d)*f)/g;d=Math.sin(d*f)/g;return new GLTFViewer.Utils.Quat(a.x*
e+c.x*d,a.y*e+c.y*d,a.z*e+c.z*d,a.w*e+c.w*d)}}});GLTFViewer.Utils.Matrix=function(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w){this.Set(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w)};
GLTFViewer.Utils.Matrix.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Matrix},a00:{writable:!0,value:0},a01:{writable:!0,value:0},a02:{writable:!0,value:0},a03:{writable:!0,value:0},a10:{writable:!0,value:0},a11:{writable:!0,value:0},a12:{writable:!0,value:0},a13:{writable:!0,value:0},a20:{writable:!0,value:0},a21:{writable:!0,value:0},a22:{writable:!0,value:0},a23:{writable:!0,value:0},a30:{writable:!0,value:0},a31:{writable:!0,value:0},a32:{writable:!0,value:0},a33:{writable:!0,
value:0},Set:{value:function(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w){a instanceof GLTFViewer.Utils.Matrix?(this.a00=a.a00,this.a01=a.a01,this.a02=a.a02,this.a03=a.a03,this.a10=a.a10,this.a11=a.a11,this.a12=a.a12,this.a13=a.a13,this.a20=a.a20,this.a21=a.a21,this.a22=a.a22,this.a23=a.a23,this.a30=a.a30,this.a31=a.a31,this.a32=a.a32,this.a33=a.a33):(a instanceof Array||a instanceof Float32Array)&&16===a.length?(this.a00=1*a[0],this.a01=1*a[1],this.a02=1*a[2],this.a03=1*a[3],this.a10=1*a[4],this.a11=1*a[5],
this.a12=1*a[6],this.a13=1*a[7],this.a20=1*a[8],this.a21=1*a[9],this.a22=1*a[10],this.a23=1*a[11],this.a30=1*a[12],this.a31=1*a[13],this.a32=1*a[14],this.a33=1*a[15]):"undefined"===typeof a?this.a33=this.a32=this.a31=this.a30=this.a23=this.a22=this.a21=this.a20=this.a13=this.a12=this.a11=this.a10=this.a03=this.a02=this.a01=this.a00=0:(this.a00=a,this.a01=c,this.a02=d,this.a03=e,this.a10=f,this.a11=g,this.a12=k,this.a13=h,this.a20=l,this.a21=m,this.a22=n,this.a23=p,this.a30=q,this.a31=u,this.a32=r,
this.a33=w)}},Clone:{value:function(){return new this.constructor(this.a00,this.a01,this.a02,this.a03,this.a10,this.a11,this.a12,this.a13,this.a20,this.a21,this.a22,this.a23,this.a30,this.a31,this.a32,this.a33)}},IsIdentity:{value:function(){return 1===this.a00&&0===this.a01&&0===this.a02&&0===this.a03&&0===this.a10&&1===this.a11&&0===this.a12&&0===this.a13&&0===this.a20&&0===this.a21&&1===this.a22&&0===this.a23&&0===this.a30&&0===this.a31&&0===this.a32&&1===this.a33}},IsEqual:{value:function(a){return this===
a?!0:GLTFViewer.Utils.EqualDoubles(this.a00,a.a00)&&GLTFViewer.Utils.EqualDoubles(this.a01,a.a01)&&GLTFViewer.Utils.EqualDoubles(this.a02,a.a02)&&GLTFViewer.Utils.EqualDoubles(this.a03,a.a03)&&GLTFViewer.Utils.EqualDoubles(this.a10,a.a10)&&GLTFViewer.Utils.EqualDoubles(this.a11,a.a11)&&GLTFViewer.Utils.EqualDoubles(this.a12,a.a12)&&GLTFViewer.Utils.EqualDoubles(this.a13,a.a13)&&GLTFViewer.Utils.EqualDoubles(this.a20,a.a20)&&GLTFViewer.Utils.EqualDoubles(this.a21,a.a21)&&GLTFViewer.Utils.EqualDoubles(this.a22,
a.a22)&&GLTFViewer.Utils.EqualDoubles(this.a23,a.a23)&&GLTFViewer.Utils.EqualDoubles(this.a30,a.a30)&&GLTFViewer.Utils.EqualDoubles(this.a31,a.a31)&&GLTFViewer.Utils.EqualDoubles(this.a32,a.a32)&&GLTFViewer.Utils.EqualDoubles(this.a33,a.a33)}},GetDeterminant:{value:function(){return this.a03*this.a12*this.a21*this.a30+this.a02*this.a13*this.a20*this.a31+this.a01*this.a10*this.a23*this.a32-this.a03*this.a11*this.a22*this.a30-this.a00*this.a13*this.a22*this.a31-this.a02*this.a11*this.a20*this.a33-this.a00*
this.a11*this.a23*this.a32-this.a00*this.a12*this.a21*this.a33-this.a01*this.a10*this.a22*this.a33+this.a00*this.a11*this.a22*this.a33-this.a02*this.a13*this.a21*this.a30-this.a03*this.a12*this.a20*this.a31-this.a01*this.a12*this.a23*this.a30-this.a03*this.a10*this.a21*this.a32-this.a02*this.a10*this.a23*this.a31-this.a01*this.a13*this.a20*this.a32+this.a03*this.a10*this.a22*this.a31+this.a01*this.a13*this.a22*this.a30+this.a02*this.a11*this.a23*this.a30+this.a03*this.a11*this.a20*this.a32+this.a00*
this.a12*this.a23*this.a31+this.a00*this.a13*this.a21*this.a32+this.a01*this.a12*this.a20*this.a33+this.a02*this.a10*this.a21*this.a33}},Invert:{value:function(){var a=this.GetDeterminant(),c=(this.a03*this.a22*this.a31-this.a02*this.a23*this.a31-this.a03*this.a21*this.a32+this.a01*this.a23*this.a32+this.a02*this.a21*this.a33-this.a01*this.a22*this.a33)/a,d=(this.a02*this.a13*this.a31-this.a03*this.a12*this.a31+this.a03*this.a11*this.a32-this.a01*this.a13*this.a32-this.a02*this.a11*this.a33+this.a01*
this.a12*this.a33)/a,e=(this.a03*this.a12*this.a21-this.a02*this.a13*this.a21-this.a03*this.a11*this.a22+this.a01*this.a13*this.a22+this.a02*this.a11*this.a23-this.a01*this.a12*this.a23)/a,f=(this.a13*this.a22*this.a30-this.a12*this.a23*this.a30-this.a13*this.a20*this.a32+this.a10*this.a23*this.a32+this.a12*this.a20*this.a33-this.a10*this.a22*this.a33)/a,g=(this.a02*this.a23*this.a30-this.a03*this.a22*this.a30+this.a03*this.a20*this.a32-this.a00*this.a23*this.a32-this.a02*this.a20*this.a33+this.a00*
this.a22*this.a33)/a,k=(this.a03*this.a12*this.a30-this.a02*this.a13*this.a30-this.a03*this.a10*this.a32+this.a00*this.a13*this.a32+this.a02*this.a10*this.a33-this.a00*this.a12*this.a33)/a,h=(this.a02*this.a13*this.a20-this.a03*this.a12*this.a20+this.a03*this.a10*this.a22-this.a00*this.a13*this.a22-this.a02*this.a10*this.a23+this.a00*this.a12*this.a23)/a,l=(this.a11*this.a23*this.a30-this.a13*this.a21*this.a30+this.a13*this.a20*this.a31-this.a10*this.a23*this.a31-this.a11*this.a20*this.a33+this.a10*
this.a21*this.a33)/a,m=(this.a03*this.a21*this.a30-this.a01*this.a23*this.a30-this.a03*this.a20*this.a31+this.a00*this.a23*this.a31+this.a01*this.a20*this.a33-this.a00*this.a21*this.a33)/a,n=(this.a01*this.a13*this.a30-this.a03*this.a11*this.a30+this.a03*this.a10*this.a31-this.a00*this.a13*this.a31-this.a01*this.a10*this.a33+this.a00*this.a11*this.a33)/a,p=(this.a03*this.a11*this.a20-this.a01*this.a13*this.a20-this.a03*this.a10*this.a21+this.a00*this.a13*this.a21+this.a01*this.a10*this.a23-this.a00*
this.a11*this.a23)/a,q=(this.a12*this.a21*this.a30-this.a11*this.a22*this.a30-this.a12*this.a20*this.a31+this.a10*this.a22*this.a31+this.a11*this.a20*this.a32-this.a10*this.a21*this.a32)/a,u=(this.a01*this.a22*this.a30-this.a02*this.a21*this.a30+this.a02*this.a20*this.a31-this.a00*this.a22*this.a31-this.a01*this.a20*this.a32+this.a00*this.a21*this.a32)/a,r=(this.a02*this.a11*this.a30-this.a01*this.a12*this.a30-this.a02*this.a10*this.a31+this.a00*this.a12*this.a31+this.a01*this.a10*this.a32-this.a00*
this.a11*this.a32)/a,w=(this.a01*this.a12*this.a20-this.a02*this.a11*this.a20+this.a02*this.a10*this.a21-this.a00*this.a12*this.a21-this.a01*this.a10*this.a22+this.a00*this.a11*this.a22)/a;this.a00=(this.a12*this.a23*this.a31+this.a13*this.a21*this.a32-this.a13*this.a22*this.a31-this.a12*this.a21*this.a33-this.a11*this.a23*this.a32+this.a11*this.a22*this.a33)/a;this.a01=c;this.a02=d;this.a03=e;this.a10=f;this.a11=g;this.a12=k;this.a13=h;this.a20=l;this.a21=m;this.a22=n;this.a23=p;this.a30=q;this.a31=
u;this.a32=r;this.a33=w;return this}},Transpose:{value:function(){var a;a=this.a10;this.a10=this.a01;this.a01=a;a=this.a20;this.a20=this.a02;this.a02=a;a=this.a30;this.a30=this.a03;this.a03=a;a=this.a21;this.a21=this.a12;this.a12=a;a=this.a31;this.a31=this.a13;this.a13=a;a=this.a32;this.a32=this.a23;this.a23=a;return this}},Multiply:{value:function(a){var c=this.a00*a.a01+this.a01*a.a11+this.a02*a.a12+this.a03*a.a13,d=this.a00*a.a02+this.a01*a.a12+this.a02*a.a22+this.a03*a.a23,e=this.a00*a.a03+this.a01*
a.a13+this.a02*a.a32+this.a03*a.a33,f=this.a10*a.a00+this.a11*a.a10+this.a12*a.a02+this.a13*a.a03,g=this.a10*a.a01+this.a11*a.a11+this.a12*a.a12+this.a13*a.a13,k=this.a10*a.a02+this.a11*a.a12+this.a12*a.a22+this.a13*a.a23,h=this.a10*a.a03+this.a11*a.a13+this.a12*a.a32+this.a13*a.a33,l=this.a20*a.a00+this.a21*a.a10+this.a22*a.a02+this.a23*a.a03,m=this.a20*a.a01+this.a21*a.a11+this.a22*a.a12+this.a23*a.a13,n=this.a20*a.a02+this.a21*a.a12+this.a22*a.a22+this.a23*a.a23,p=this.a20*a.a03+this.a21*a.a13+
this.a22*a.a32+this.a23*a.a33,q=this.a30*a.a00+this.a31*a.a10+this.a32*a.a02+this.a33*a.a03,u=this.a30*a.a01+this.a31*a.a11+this.a32*a.a12+this.a33*a.a13,r=this.a30*a.a02+this.a31*a.a12+this.a32*a.a22+this.a33*a.a23,w=this.a30*a.a03+this.a31*a.a13+this.a32*a.a32+this.a33*a.a33;this.a00=this.a00*a.a00+this.a01*a.a10+this.a02*a.a02+this.a03*a.a03;this.a01=c;this.a02=d;this.a03=e;this.a10=f;this.a11=g;this.a12=k;this.a13=h;this.a20=l;this.a21=m;this.a22=n;this.a23=p;this.a30=q;this.a31=u;this.a32=r;
this.a33=w;return this}},MultiplyCreate:{value:function(a){return this.Clone().Multiply(a)}},ToArray:{value:function(a){a[0]=this.a00;a[1]=this.a01;a[2]=this.a02;a[3]=this.a03;a[4]=this.a10;a[5]=this.a11;a[6]=this.a12;a[7]=this.a13;a[8]=this.a20;a[9]=this.a21;a[10]=this.a22;a[11]=this.a23;a[12]=this.a30;a[13]=this.a31;a[14]=this.a32;a[15]=this.a33}},ToArray3x3:{value:function(a){a[0]=this.a00;a[1]=this.a01;a[2]=this.a02;a[3]=this.a10;a[4]=this.a11;a[5]=this.a12;a[6]=this.a20;a[7]=this.a21;a[8]=this.a22}}});
GLTFViewer.Utils.Transformation=function(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w){GLTFViewer.Utils.Matrix.call(this,a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w)};
GLTFViewer.Utils.Transformation.prototype=Object.create(GLTFViewer.Utils.Matrix.prototype,{constructor:{value:GLTFViewer.Utils.Transformation},Set:{value:function(a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w){GLTFViewer.Utils.Matrix.prototype.Set.call(this,a,c,d,e,f,g,k,h,l,m,n,p,q,u,r,w);GLTFViewer.Utils.IsNull(a)&&(this.a00=this.a11=this.a22=this.a33=1)}},Multiply:{value:function(a){var c=this.a01*a.a00+this.a11*a.a01+this.a21*a.a02+this.a31*a.a03,d=this.a02*a.a00+this.a12*a.a01+this.a22*a.a02+this.a32*a.a03,
e=this.a03*a.a00+this.a13*a.a01+this.a23*a.a02+this.a33*a.a03,f=this.a00*a.a10+this.a10*a.a11+this.a20*a.a12+this.a30*a.a13,g=this.a01*a.a10+this.a11*a.a11+this.a21*a.a12+this.a31*a.a13,k=this.a02*a.a10+this.a12*a.a11+this.a22*a.a12+this.a32*a.a13,h=this.a03*a.a10+this.a13*a.a11+this.a23*a.a12+this.a33*a.a13,l=this.a00*a.a20+this.a10*a.a21+this.a20*a.a22+this.a30*a.a23,m=this.a01*a.a20+this.a11*a.a21+this.a21*a.a22+this.a31*a.a23,n=this.a02*a.a20+this.a12*a.a21+this.a22*a.a22+this.a32*a.a23,p=this.a03*
a.a20+this.a13*a.a21+this.a23*a.a22+this.a33*a.a23,q=this.a00*a.a30+this.a10*a.a31+this.a20*a.a32+this.a30*a.a33,u=this.a01*a.a30+this.a11*a.a31+this.a21*a.a32+this.a31*a.a33,r=this.a02*a.a30+this.a12*a.a31+this.a22*a.a32+this.a32*a.a33,w=this.a03*a.a30+this.a13*a.a31+this.a23*a.a32+this.a33*a.a33;this.a00=this.a00*a.a00+this.a10*a.a01+this.a20*a.a02+this.a30*a.a03;this.a01=c;this.a02=d;this.a03=e;this.a10=f;this.a11=g;this.a12=k;this.a13=h;this.a20=l;this.a21=m;this.a22=n;this.a23=p;this.a30=q;this.a31=
u;this.a32=r;this.a33=w;return this}},Translate:{value:function(a,c,d){a=new GLTFViewer.Utils.Vec3(a,c,d);a=new GLTFViewer.Utils.Transformation(1,0,0,0,0,1,0,0,0,0,1,0,a.x,a.y,a.z,1);this.Multiply(a);return this}},Scale:{value:function(a){a=new GLTFViewer.Utils.Transformation(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1/a);this.Multiply(a);return this}},IsWellFormed:{value:function(){if(GLTFViewer.Utils.EqualDoubles(this.a33,0))return!1;var a=new GLTFViewer.Utils.Vec3(this.a00,this.a01,this.a02),c=new GLTFViewer.Utils.Vec3(this.a10,
this.a11,this.a12),d=new GLTFViewer.Utils.Vec3(this.a20,this.a21,this.a22);return a.IsLength(1)&&c.IsLength(1)&&d.IsLength(1)&&GLTFViewer.Utils.IslengthZero(a.Dot(c))&&GLTFViewer.Utils.IslengthZero(c.Dot(d))&&GLTFViewer.Utils.IslengthZero(d.Dot(a))&&a.CrossCreate(c).IsLength(1)?!0:!1}},CreateWellFormed:{value:function(){var a=new GLTFViewer.Utils.Vec3(this.a00,this.a01,this.a02),c=new GLTFViewer.Utils.Vec3(this.a10,this.a11,this.a12),d=new GLTFViewer.Utils.Vec3(this.a20,this.a21,this.a22),a=a.GetDirection(),
c=c.Clone().Subtract(GLTFViewer.Utils.Direction.ScaleCreate(a,a.Dot(c))).GetDirection(),e=a.CrossCreate(c).GetDirection();0>e.Dot(d)&&e.Negate();return new GLTFViewer.Utils.Transformation(a.x,a.y,a.z,this.a03,c.x,c.y,c.z,this.a13,e.x,e.y,e.z,this.a23,this.a30,this.a31,this.a32,this.a33)}},GetZDirection:{value:function(){return new GLTFViewer.Utils.Direction(this.a20,this.a21,this.a22)}},GetTranslationTransformation:{value:function(){return GLTFViewer.Utils.Transformation.TranslationCreate(this.a30,
this.a31,this.a32)}},GetTranslation:{value:function(){return new GLTFViewer.Utils.Vec3(this.a30/this.a33,this.a31/this.a33,this.a32/this.a33)}},GetRotationTransformation:{value:function(){return new GLTFViewer.Utils.Transformation(this.a00,this.a01,this.a02,0,this.a10,this.a11,this.a12,0,this.a20,this.a21,this.a22,0,0,0,0,1)}},GetScale:{value:function(){return 1/this.a33}},TryGetRotationAxis:{value:function(a){var c=new GLTFViewer.Utils.Vec3(this.a00-1,this.a01,this.a02),d=new GLTFViewer.Utils.Vec3(this.a10,
this.a11-1,this.a12),e=new GLTFViewer.Utils.Vec3(this.a20,this.a21,this.a22-1),f=c.CrossCreate(d),c=c.CrossCreate(e),d=d.CrossCreate(e),e=f.GetMagnitudeSquared(),g=c.GetMagnitudeSquared(),k=d.GetMagnitudeSquared();e>g?e>k?a.Set(f.x,f.y,f.z):a.Set(d.x,d.y,d.z):g>k?a.Set(c.x,c.y,c.z):a.Set(d.x,d.y,d.z);a.Normalize();return!a.IsZero()}},TryGetRotation:{value:function(a){var c=0;if(this.TryGetRotationAxis(a)){var c=a.CreateArbitraryPerpendicular(),d=a.CrossCreate(c).GetDirection(),e=c.TransformCreate(this),
c=Math.atan2(d.Dot(e),c.Dot(e));0>c&&a.Negate();c=Math.abs(c)}else c=0,a.Set(0,0,1);return c}}});
Object.defineProperties(GLTFViewer.Utils.Transformation,{Identity:{get:function(){return new GLTFViewer.Utils.Transformation}},MultiplyCreate:{value:function(a,c){return new GLTFViewer.Utils.Transformation(a.a00*c.a00+a.a10*c.a01+a.a20*c.a02+a.a30*c.a03,a.a01*c.a00+a.a11*c.a01+a.a21*c.a02+a.a31*c.a03,a.a02*c.a00+a.a12*c.a01+a.a22*c.a02+a.a32*c.a03,a.a03*c.a00+a.a13*c.a01+a.a23*c.a02+a.a33*c.a03,a.a00*c.a10+a.a10*c.a11+a.a20*c.a12+a.a30*c.a13,a.a01*c.a10+a.a11*c.a11+a.a21*c.a12+a.a31*c.a13,a.a02*c.a10+
a.a12*c.a11+a.a22*c.a12+a.a32*c.a13,a.a03*c.a10+a.a13*c.a11+a.a23*c.a12+a.a33*c.a13,a.a00*c.a20+a.a10*c.a21+a.a20*c.a22+a.a30*c.a23,a.a01*c.a20+a.a11*c.a21+a.a21*c.a22+a.a31*c.a23,a.a02*c.a20+a.a12*c.a21+a.a22*c.a22+a.a32*c.a23,a.a03*c.a20+a.a13*c.a21+a.a23*c.a22+a.a33*c.a23,a.a00*c.a30+a.a10*c.a31+a.a20*c.a32+a.a30*c.a33,a.a01*c.a30+a.a11*c.a31+a.a21*c.a32+a.a31*c.a33,a.a02*c.a30+a.a12*c.a31+a.a22*c.a32+a.a32*c.a33,a.a03*c.a30+a.a13*c.a31+a.a23*c.a32+a.a33*c.a33)}},TranslationCreate:{value:function(a,
c,d){a=new GLTFViewer.Utils.Vec3(a,c,d);return new GLTFViewer.Utils.Transformation(1,0,0,0,0,1,0,0,0,0,1,0,a.x,a.y,a.z,1)}},RotationCreate:{value:function(a,c,d,e,f,g){return new GLTFViewer.Utils.Transformation(a,c,d,0,e,f,g,0,c*g-f*d,e*d-a*g,a*f-e*c,0,0,0,0,1)}},ScaleCreate:{value:function(a){return new GLTFViewer.Utils.Transformation(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1/a)}},RotationAboutAxisCreate:{value:function(a,c){var d=a.orgn,e=a.dir,f=e.RotateVectorCreate(GLTFViewer.Utils.Direction.dix,c).GetDirection(),
e=e.RotateVectorCreate(GLTFViewer.Utils.Direction.diy,c).GetDirection();return GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(GLTFViewer.Utils.Vec3.Origin,d)).Multiply(GLTFViewer.Utils.Transformation.RotationCreate(f.x,f.y,f.z,e.x,e.y,e.z)).Multiply(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(d,GLTFViewer.Utils.Vec3.Origin)))}},ScaleAboutPointCreate:{value:function(a,c,d,e){return GLTFViewer.Utils.Transformation.TranslationCreate(c,
d,e).Multiply(GLTFViewer.Utils.Transformation.ScaleCreate(a)).Multiply(GLTFViewer.Utils.Transformation.TranslationCreate(-c,-d,-e))}},lookAtRH:{value:function(a,c,d){c=GLTFViewer.Utils.Vec3.Create(c,a).Normalize();d=d.CrossCreate(c).Normalize();var e=c.CrossCreate(d);return new GLTFViewer.Utils.Transformation(d.x,e.x,c.x,0,d.y,e.y,c.y,0,d.z,e.z,c.z,0,-d.Dot(a),-e.Dot(a),-c.Dot(a),1)}},orthoRH:{value:function(a,c,d,e){return new GLTFViewer.Utils.Transformation(2/a,0,0,0,0,2/c,0,0,0,0,-2/(e-d),0,0,
0,-(e+d)/(e-d),1)}},perspectiveRH:{value:function(a,c,d,e){return new GLTFViewer.Utils.Transformation(2*d/a,0,0,0,0,2*d/c,0,0,0,0,-(e+d)/(e-d),-1,0,0,-2*d*e/(e-d),0)}}});GLTFViewer.Utils.RGBA=function(a,c,d,e){"undefined"===typeof a?this.a=this.b=this.g=this.r=0:(this.r=a,this.g=c,this.b=d,this.a=e)};
GLTFViewer.Utils.RGBA.prototype=Object.create(null,{r:{writable:!0,value:0},g:{writable:!0,value:0},b:{writable:!0,value:0},a:{writable:!0,value:255},Clone:{value:function(){return new GLTFViewer.Utils.RGBA(this.r,this.g,this.b,this.a)}},Equals:{value:function(a){return Math.round(this.r)===Math.round(a.r)&&Math.round(this.g)===Math.round(a.g)&&Math.round(this.b)===Math.round(a.b)&&Math.round(this.a)===Math.round(a.a)}},SetHsv:{value:function(a,c,d,e){(new GLTFViewer.Utils.HSV(a,c,d,e)).SetColor(this)}},
SetRgba:{value:function(a,c,d,e){this.r=a;this.g=c;this.b=d;this.a=e}},SetColor:{value:function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a}},SetRawARGB:{value:function(a){this.r=a>>16&255;this.g=a>>8&255;this.b=a&255;this.a=a>>24&255}},GetARGB:{value:function(){return this.a<<24|this.r<<16|this.g<<8|this.b}},SetRawABGR:{value:function(a){this.r=a&255;this.g=a>>8&255;this.b=a>>16&255;this.a=a>>24&255}},GetABGR:{value:function(){return this.a<<24|this.b<<16|this.g<<8|this.r}},GetGray:{value:function(){return.299*
this.r/255+.587*this.g/255+.114*this.b/255}},ToArray:{value:function(a,c){a[c+0]=this.r/255;a[c+1]=this.g/255;a[c+2]=this.b/255;a[c+3]=this.a/255}}});
Object.defineProperties(GLTFViewer.Utils.RGBA,{CreateFromHSL:{value:function(a){function c(a,c,d){0>d&&(d+=1);1<d&&--d;return 1>6*d?a+6*(c-a)*d:1>2*d?c:2>3*d?a+(c-a)*(2/3-d)*6:a}var d=Math.round(255*a.a);if(0===a.s){var e=Math.round(255*a.l);return new GLTFViewer.Utils.RGBA(e,e,e,d)}var f=.5>a.l?a.l*(1+a.s):a.l+a.s-a.s*a.l,g=2*a.l-f,e=Math.round(255*c(g,f,a.h+1/3)),k=Math.round(255*c(g,f,a.h));a=Math.round(255*c(g,f,a.h-1/3));return new GLTFViewer.Utils.RGBA(e,k,a,d)}}});
GLTFViewer.Utils.HSV=function(a,c,d,e){this.h=a;this.s=c;this.v=d;this.a=GLTFViewer.Utils.IsNull(e)?1:e};
GLTFViewer.Utils.HSV.prototype=Object.create(null,{h:{writable:!0,value:0},s:{writable:!0,value:0},v:{writable:!0,value:0},a:{writable:!0,value:1},Set:{value:function(a,c,d,e){this.h=a;this.s=c;this.v=d;this.a=GLTFViewer.Utils.IsNull(e)?1:e}},SetColor:{value:function(a){var c,d,e;if(0===this.s)c=d=e=this.v;else{e=this.h/60;c=Math.floor(e);d=e-c;0===c%2&&(d=1-d);e=this.v*(1-this.s);var f=this.v*(1-this.s*d);switch(c){default:case 0:c=this.v;d=f;break;case 1:c=f;d=this.v;break;case 2:c=e;d=this.v;e=
f;break;case 3:c=e;d=f;e=this.v;break;case 4:c=f;d=e;e=this.v;break;case 5:c=this.v,d=e,e=f}}a.r=Math.round(255*c);a.g=Math.round(255*d);a.b=Math.round(255*e);a.a=Math.round(255*this.a)}},GetHue:{value:function(){return this.h}},SetHue:{value:function(a){this.h=GLTFViewer.Utils.HSV.ClampHue(a)}},GetSaturation:{value:function(){return this.s}},SetSaturation:{value:function(a){this.s=GLTFViewer.Utils.HSV.ClampSaturation(a)}},GetValue:{value:function(){return this.v}},SetValue:{value:function(a){this.v=
GLTFViewer.Utils.HSV.ClampValue(a)}}});
Object.defineProperties(GLTFViewer.Utils.HSV,{ClampHue:{value:function(a){return a-=360*Math.floor(a/360)}},ClampSaturation:{value:function(a){0>a?a=0:1<a&&(a=1);return a}},ClampValue:{value:function(a){0>a?a=0:1<a&&(a=1);return a}},CreateFromColor:{value:function(a){var c=a.r/255,d=a.g/255,e=a.b/255;a=a.a/255;var f=c,g=c;d<f?f=d:d>g&&(g=d);e<f?f=e:e>g&&(g=e);if(0===g)c=f=0;else if(g===f)c=f=0;else{var k=g-f,f=k/g,c=60*(c===g?(d-e)/k:d===g?2+(e-c)/k:4+(c-d)/k);0>c&&(c+=360)}return new GLTFViewer.Utils.HSV(c,
f,g,a)}},TransformColor:{value:function(a){if(a.r===a.g&&a.g===a.b)128>a.r?(a.r+=30,a.g+=30,a.b+=30):(a.r-=30,a.g-=30,a.b-=30);else{var c=GLTFViewer.Utils.HSV.CreateFromColor(a);c.SetSaturation(.18);c.SetValue(.685);c.SetColor(a)}}}});GLTFViewer.Utils.HSL=function(a,c,d,e){this.h=a;this.s=c;this.l=d;this.a=e};
GLTFViewer.Utils.HSL.prototype=Object.create(null,{h:{writable:!0,value:0},s:{writable:!0,value:0},v:{writable:!0,value:0},a:{writable:!0,value:1},Set:{value:function(a,c,d,e){this.h=a;this.s=c;this.l=v;this.a=e}},GetRgb:{value:function(a,c,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(c-a)*d:.5>d?c:d<2/3?a+(c-a)*(2/3-d)*6:a}},SetColor:{value:function(a){var c,d,e;if(0===this.s)c=d=e=this.l;else{e=.5>this.l?this.l*(1+this.s):this.l+this.s-this.l*this.s;var f=2*this.l-e;c=this.GetRgb(f,e,this.h+1/3);d=
this.GetRgb(f,e,this.h);e=this.GetRgb(f,e,this.h-1/3)}a.r=Math.round(255*c);a.g=Math.round(255*d);a.b=Math.round(255*e);a.a=this.a}},GetHue:{value:function(){return this.h}},SetHue:{value:function(a){this.h=GLTFViewer.Utils.HSL.ClampHue(a)}},GetSaturation:{value:function(){return this.s}},SetSaturation:{value:function(a){this.s=GLTFViewer.Utils.HSL.ClampSaturation(a)}},GetLight:{value:function(){return this.l}},SetLight:{value:function(a){this.l=GLTFViewer.Utils.HSL.ClampLight(a)}}});
Object.defineProperties(GLTFViewer.Utils.HSL,{ClampHue:{value:function(a){return a-=360*Math.floor(a/360)}},ClampSaturation:{value:function(a){0>a?a=0:1<a&&(a=1);return a}},ClampLight:{value:function(a){0>a?a=0:1<a&&(a=1);return a}},CreateFromColor:{value:function(a){var c=a.r/255,d=a.g/255,e=a.b/255;a=a.a;var f=Math.max(c,d,e),g=Math.min(c,d,e),k,h=(f+g)/2;if(f===g)k=g=0;else{var l=f-g,g=.5<h?l/(2-f-g):l/(f+g);switch(f){case c:k=(d-e)/l+(d<e?6:0);break;case d:k=(e-c)/l+2;break;case e:k=(c-d)/l+4}k/=
6}return new GLTFViewer.Utils.HSL(k,g,h,a)}},XColor:{value:function(a){var c=GLTFViewer.Utils.HSL.CreateFromColor(a);1E-4>c.s?c.SetHue(120):c.SetSaturation(4*c.s);c.SetLight(c.l+.45);c.SetLight(.65*c.l);c.SetColor(a)}},EColor:{value:function(a){var c=GLTFViewer.Utils.HSL.CreateFromColor(a);.3<c.l?c.SetLight(.105):c.SetLight(.6);1E-4>c.s?c.SetHue(120):c.SetHue(.875);c.SetLight(c.l+.45);c.SetLight(.65*c.l);c.SetColor(a);a.a=255>a.a?40:80}}});
GLTFViewer.Utils.TempDir=function(a){this._fs=require("fs");this._os=require("os");this._path=require("path");this._dirName=this._GenerateName(a);if(!this._MakeDir(this._dirName))throw Error("Can't create temporary directory");};
GLTFViewer.Utils.TempDir.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.TempDir},_fs:{writable:!0,value:null},_os:{writable:!0,value:null},_path:{writable:!0,value:null},_dirName:{writable:!0,value:null},name:{get:function(){return this._dirName}},_GenerateName:{value:function(a){var c=new Date;return this._path.join(a?a:this._os.tmpdir(),"AnsysViewer_"+process.pid+"_"+c.getYear()+"_"+c.getMonth()+"_"+c.getDay()+"_"+c.getHours()+"_"+c.getMinutes()+"_"+c.getSeconds()+"_"+c.getMilliseconds()+
"_"+parseInt(1E4*Math.random()))}},_MakeDir:{value:function(a){this._fs.mkdirSync(a,448);return this._fs.existsSync(a)?!0:!1}},FindFile:{value:function(a){if(this._fs.existsSync(this._dirName))for(var c=this._fs.readdirSync(this._dirName),d=0;d<c.length;++d){var e=c[d],f=this._path.join(this._dirName,e);if(this._fs.lstatSync(f).isFile()&&e.match(a))return f}return null}},FindAllFiles:{value:function(a){var c=[];if(this._fs.existsSync(this._dirName))for(var d=this._fs.readdirSync(this._dirName),e=
0;e<d.length;++e){var f=d[e],g=this._path.join(this._dirName,f);this._fs.lstatSync(g).isFile()&&f.match(a)&&c.push(g)}return c}},Remove:{value:function(a){GLTFViewer.Utils.IsNull(a)&&(a=this._dirName);this._fs.existsSync(a)&&(this._fs.readdirSync(a).forEach(function(c,d){var e=this._path.join(a,c);this._fs.lstatSync(e).isDirectory()?this.Remove(e):this._fs.unlinkSync(e)}.bind(this)),this._fs.rmdirSync(a))}}});
GLTFViewer.Utils.Touch=function(a,c,d,e){this._id=a;this._start=new GLTFViewer.Utils.Touch.Entry(c,d,e);this._previous=new GLTFViewer.Utils.Touch.Entry(c,d,e);this._last=new GLTFViewer.Utils.Touch.Entry(c,d,e)};
GLTFViewer.Utils.Touch.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Touch},_id:{writable:!0,value:null},_start:{writable:!0,value:null},_previous:{writable:!0,value:null},_last:{writable:!0,value:null},_distance2:{writable:!0,value:0},_time:{writable:!0,value:0},Reset:{value:function(){}},Clear:{value:function(){GLTFViewer.Utils.Touch.prototype.Reset.call(this);this._last=this._previous=this._start=this._id=null}},Update:{value:function(a,c,d){this._previous.Set(this._last);this._last.Set(a,
c,d);a=this._last.x-this._start.x;c=this._last.y-this._start.y;a=a*a+c*c;a>this._distance2&&(this._distance2=a);a=this._last.t-this._start.t;a>this._time&&(this._time=a)}},GetID:{value:function(){return this._id}},GetStartLocation:{value:function(){return this._start?{t:this._start.t,x:this._start.x,y:this._start.y}:null}},GetLastLocation:{value:function(){return this._last?{t:this._last.t,x:this._last.x,y:this._last.y}:null}},GetPreviousLocation:{value:function(){return this._previous?{t:this._previous.t,
x:this._previous.x,y:this._previous.y}:null}},GetElapsedTime:{value:function(){return this._time}},GetDistanceMoved2:{value:function(){return this._distance2}}});Object.defineProperties(GLTFViewer.Utils.Touch,{TouchStart:{value:1},TouchMove:{value:2},TouchEnd:{value:3},MouseDown:{value:4},MouseMove:{value:5},MouseUp:{value:6}});GLTFViewer.Utils.Touch.Entry=function(a,c,d){this.Set(a,c,d)};
GLTFViewer.Utils.Touch.Entry.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Touch.Entry},x:{writable:!0,value:0},y:{writable:!0,value:0},t:{writable:!0,value:0},Set:{value:function(a,c,d){a instanceof GLTFViewer.Utils.Touch.Entry?(this.t=a.t,this.x=a.x,this.y=a.y):(this.t=a,this.x=c,this.y=d)}}});GLTFViewer.Utils.Touch.List=function(a,c){this._touches=[];this._element=a;c&&(this._debugTouch=!0)};
GLTFViewer.Utils.Touch.List.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Touch.List},_touches:{writable:!0,value:null},_debugTouch:{writable:!0,value:!1},_element:{writable:!0,value:null},Count:{value:function(){return this._touches.length}},GetTouchById:{value:function(a){if(!GLTFViewer.Utils.IsNull(a))for(var c=0;c<this.Count();++c)if(this._touches[c].GetID()===a)return this._touches[c];return null}},GetIndexById:{value:function(a){if(!GLTFViewer.Utils.IsNull(a))for(var c=0;c<
this.Count();++c)if(this._touches[c].GetID()===a)return c;return-1}},GetTouchByIndex:{value:function(a){return a<this.Count()?this._touches[a]:null}},AddTouch:{value:function(a,c,d,e){if(this.GetTouchById(a))return GLTFViewer.Utils.WriteErr("ERROR(Touch.List.AddTouch): 'id' already defined"),!1;a=new GLTFViewer.Utils.Touch(a,c,d,e);this._touches.push(a);return!0}},RemoveTouchById:{value:function(a){a=this.GetIndexById(a);if(0>a)return!1;this._touches.splice(a,1);return!0}},UpdateTouchById:{value:function(a,
c,d,e){a=this.GetTouchById(a);if(!a)return!1;a.Update(c,d,e);return!0}},Touches:{value:function(a,c){var d=[];if(a.touches)d=a.touches;else if(a.pointerId)d=[a];else{for(var e=[1,4,2],f=0,g=0;g<this.Count();++g)var k=this.GetTouchByIndex(g),f=f|k.GetID();if(c===GLTFViewer.Utils.Touch.MouseDown||c===GLTFViewer.Utils.Touch.TouchStart)f|=e[a.button];else if(c===GLTFViewer.Utils.Touch.MouseUp||c===GLTFViewer.Utils.Touch.TouchEnd)f&=~e[a.button];for(g=0;g<e.length;++g)f&e[g]&&d.push({timeStamp:a.timeStamp,
clientX:a.clientX,clientY:a.clientY,mouseId:e[g]})}return d}},Update:{value:function(a,c){function d(a){return"undefined"!=typeof a.identifier?a.identifier:"undefined"!=typeof a.pointerId?a.pointerId:"undefined"!=typeof a.mouseId?a.mouseId:0}for(var e=this.Touches(a,c),f={},g=0;g<e.length;g++){var k=e[g],h=d(k);f[h]=k}for(var l=[],g=0;g<this.Count();)k=this.GetTouchByIndex(g),h=k.GetID(),GLTFViewer.Utils.IsNull(f[h])?this.RemoveTouchById(h)&&(l.push(k),a.pointerType&&"mouse"!==a.pointerType&&this._element.setPointerCapture&&
this._element.releasePointerCapture(h)):++g;for(g=0;g<e.length;g++)k=e[g],f=GLTFViewer.Utils.GetClientXY(this._element[0],k),h=d(k),this.GetTouchById(h)?this.UpdateTouchById(h,f.t,f.x,f.y):this.AddTouch(h,f.t,f.x,f.y)&&a.pointerType&&"mouse"!==a.pointerType&&this._element.setPointerCapture&&this._element.setPointerCapture(h);return l.length?l:null}},GetStartLocation:{value:function(a){var c=this.Count();if(1>c)return null;a||(a=2);a>c&&(a=c);for(var c={t:0,x:0,y:0},d=0;d<a;++d){var e=this._touches[d].GetStartLocation();
c.t+=e.t;c.x+=e.x;c.y+=e.y}c.t/=a;c.x/=a;c.y/=a;return c}},GetPreviousLocation:{value:function(a){var c=this.Count();if(1>c)return null;a||(a=2);a>c&&(a=c);for(var c={t:0,x:0,y:0},d=0;d<a;++d){var e=this._touches[d].GetPreviousLocation();c.t+=e.t;c.x+=e.x;c.y+=e.y}c.t/=a;c.x/=a;c.y/=a;return c}},GetLastLocation:{value:function(a){var c=this.Count();if(1>c)return null;a||(a=2);a>c&&(a=c);for(var c={t:0,x:0,y:0},d=0;d<a;++d){var e=this._touches[d].GetLastLocation();c.t+=e.t;c.x+=e.x;c.y+=e.y}c.t/=a;
c.x/=a;c.y/=a;return c}},GetStartDelta:{value:function(a){var c=this.Count();if(1>c)return null;a||(a=2);a>c&&(a=c);c=this.GetStartLocation(a);a=this.GetLastLocation(a);return{t:a.t,x:a.x-c.x,y:a.y-c.y}}},GetLastDelta:{value:function(a){var c=this.Count();if(1>c)return null;a||(a=2);a>c&&(a=c);c=this.GetPreviousLocation(a);a=this.GetLastLocation(a);return{t:a.t,x:a.x-c.x,y:a.y-c.y}}},GetStartSeparation:{value:function(a){var c=this.Count();if(1>c)return 0;a||(a=2);a>c&&(a=c);for(var c=this.GetStartLocation(a),
d=0,e=0;e<a;++e)var f=this._touches[e].GetStartLocation(),g=f.x-c.x,f=f.y-c.y,d=d+Math.sqrt(g*g+f*f);return 2*d/a}},GetPreviousSeparation:{value:function(a){var c=this.Count();if(1>c)return 0;a||(a=2);a>c&&(a=c);for(var c=this.GetPreviousLocation(a),d=0,e=0;e<a;++e)var f=this._touches[e].GetPreviousLocation(),g=f.x-c.x,f=f.y-c.y,d=d+Math.sqrt(g*g+f*f);return 2*d/a}},GetLastSeparation:{value:function(a){var c=this.Count();if(1>c)return 0;a||(a=2);a>c&&(a=c);for(var c=this.GetLastLocation(a),d=0,e=
0;e<a;++e)var f=this._touches[e].GetLastLocation(),g=f.x-c.x,f=f.y-c.y,d=d+Math.sqrt(g*g+f*f);return 2*d/a}},GetElapsedTime:{value:function(a){var c=this.Count();if(1>c)return 0;a||(a=2);a>c&&(a=c);for(var c=this._touches[0].GetElapsedTime(),d=1;d<a;++d){var e=this._touches[d].GetElapsedTime();e>c&&(c=e)}return c}},GetDistanceMoved2:{value:function(a){var c=this.Count();if(1>c)return 0;a||(a=2);a>c&&(a=c);for(var c=this._touches[0].GetDistanceMoved2(),d=1;d<a;++d){var e=this._touches[d].GetDistanceMoved2();
e>c&&(c=e)}return c}},Reset:{value:function(){this._touches=[]}},Clear:{value:function(){GLTFViewer.Utils.Touch.List.prototype.Reset.call(this);this._element=this._touches=null}}});
GLTFViewer.Utils.TouchHandler=function(a,c,d,e,f,g,k,h,l,m,n){if(c){var p=this;this._document=(this._viewer=a)?a.document:document;this._moveTolerance2=(this._isMobile=a?a.mobile:!1)?64:9;this._element=c;this._Start=d;this._Move=e;this._Finish=f;this._Wheel=g;this._Over=k;this._Out=h;this._Blur=l;this._Context=m;this._debugTouch=n;this._touches=new GLTFViewer.Utils.Touch.List(this._element,this._debugTouch);this._MouseOver=function(a){p._ContainerMouseOver(a)};this._MouseOut=function(a){p._ContainerMouseOut(a)};
this._MouseWheel=function(a){p._ContainerMouseWheel(a)};this._MouseDown=function(a){p._ContainerTouchStart(GLTFViewer.Utils.Touch.MouseDown,a)&&(p._element[0].removeEventListener("mousemove",p._MouseMove),p._document.addEventListener("mousemove",p._MouseMove,!0),p._document.addEventListener("mouseup",p._MouseUp,!0))};this._TouchStart=function(a){this._timer||(this._timer=setTimeout(function(){this._timer=0}.bind(this),600),p._ContainerTouchStart(GLTFViewer.Utils.Touch.TouchStart,a)&&(p._debugTouch?
(p._element[0].removeEventListener("mousemove",p._TouchMove),p._document.addEventListener("mousemove",p._TouchMove,!0),p._document.addEventListener("mouseup",p._TouchEnd,!0)):window.navigator.pointerEnabled?(p._document.addEventListener("pointermove",p._TouchMove,!1),p._document.addEventListener("pointerup",p._TouchEnd,!1),p._document.addEventListener("pointercancel",p._TouchEnd,!1)):(p._document.addEventListener("touchmove",p._TouchMove,!1),p._document.addEventListener("touchend",p._TouchEnd,!1),
p._document.addEventListener("touchcancel",p._TouchEnd,!1))))};this._MouseMove=function(a){p._ContainerTouchMove(GLTFViewer.Utils.Touch.MouseMove,a)};this._TouchMove=function(a){p._ContainerTouchMove(GLTFViewer.Utils.Touch.TouchMove,a)};this._MouseUp=function(a){p._ContainerTouchEnd(GLTFViewer.Utils.Touch.MouseUp,a)&&(p._document.removeEventListener("mousemove",p._MouseMove,!0),p._document.removeEventListener("mouseup",p._MouseUp,!0),p._element[0].addEventListener("mousemove",p._MouseMove,!1))};this._TouchEnd=
function(a){p._ContainerTouchEnd(GLTFViewer.Utils.Touch.TouchEnd,a)&&(p._debugTouch?(p._document.removeEventListener("mousemove",p._TouchMove,!0),p._document.removeEventListener("mouseup",p._TouchEnd,!0),p._element[0].addEventListener("mousemove",p._TouchMove,!1)):window.navigator.pointerEnabled?(p._document.removeEventListener("pointermove",p._TouchMove,!1),p._document.removeEventListener("pointerup",p._TouchEnd,!1),p._document.removeEventListener("pointercancel",p._TouchEnd,!1)):(p._document.removeEventListener("touchmove",
p._TouchMove,!1),p._document.removeEventListener("touchend",p._TouchEnd,!1),p._document.removeEventListener("touchcancel",p._TouchEnd,!1)))};this._debugTouch?(this._element[0].addEventListener("mousedown",this._TouchStart,!1),this._element[0].addEventListener("mousemove",this._TouchMove,!1)):(this._element[0].addEventListener("mousedown",this._MouseDown,!1),this._element[0].addEventListener("mousemove",this._MouseMove,!1),this._element[0].addEventListener("mouseover",this._MouseOver,!1),this._element[0].addEventListener("mouseout",
this._MouseOut,!1),this._element[0].addEventListener("mousewheel",this._MouseWheel,!1),this._element[0].addEventListener("DOMMouseScroll",this._MouseWheel,!1),window.navigator.pointerEnabled?this._element[0].addEventListener("pointerdown",this._TouchStart,!1):this._element[0].addEventListener("touchstart",this._TouchStart,!1));this._ElementBlur=function(a){p._ContainerBlur(a)};this._element[0].addEventListener("blur",this._ElementBlur,!1);this._ElementContext=function(a){p._ContainerContext(a)};this._element[0].addEventListener("contextmenu",
this._ElementContext,!1);this._ElementSelectStart=function(a){a.stopPropagation()};this._element[0].addEventListener("selectstart",this._ElementSelectStart,!1)}};
GLTFViewer.Utils.TouchHandler.prototype=Object.create(null,{_isMobile:{writable:!0,value:!1},_moveTolerance2:{writable:!0,value:9},_timer:{writable:!0,value:0},_viewer:{writable:!0,value:null},_element:{writable:!0,value:null},_Start:{writable:!0,value:null},_Move:{writable:!0,value:null},_Finish:{writable:!0,value:null},_Wheel:{writable:!0,value:null},_Blur:{writable:!0,value:null},_Context:{writable:!0,value:null},_touchActive:{writable:!0,value:!1},_mouseOver:{writable:!0,value:!1},_touches:{writable:!0,
value:null},_debugTouch:{writable:!0,value:!1},_MouseMove:{writable:!0,value:null},_MouseUp:{writable:!0,value:null},_MouseDown:{writable:!0,value:null},_MouseWheel:{writable:!0,value:null},_MouseOver:{writable:!0,value:null},_MouseOut:{writable:!0,value:null},_TouchMove:{writable:!0,value:null},_TouchUp:{writable:!0,value:null},_TouchDown:{writable:!0,value:null},_ElementBlur:{writable:!0,value:null},_ElementContext:{writable:!0,value:null},_ElementSelectStart:{writable:!0,value:null},_longTouchTmrId:{writable:!0,
value:null},_longTouch:{writable:!0,value:null},TouchActive:{get:function(){return this._touchActive}},Touches:{get:function(){return this._touches}},_ContainerTouchStart:{value:function(a,c){a===GLTFViewer.Utils.Touch.TouchStart&&"mouse"!==c.pointerType&&c.preventDefault();c.stopPropagation();if(a===GLTFViewer.Utils.Touch.TouchStart&&"mouse"===c.pointerType)return!1;this._element.focus();this._touches.Update(c,a);var d=this._touchActive;this._touchActive=!0;1===this.Touches.Count()?this._StartLongTouch(c):
this.StopLongTouch();this._Start&&setTimeout(this._Start(c),0);return!d}},_ContainerTouchMove:{value:function(a,c){c.preventDefault();c.stopPropagation();if(a===GLTFViewer.Utils.Touch.TouchMove&&"mouse"===c.pointerType)return!1;this._touches.Update(c,a);this.Touches.GetDistanceMoved2()>=this._moveTolerance2&&this.StopLongTouch();this._Move&&setTimeout(this._Move(c),0);return!0}},_ContainerTouchEnd:{value:function(a,c){c.preventDefault();c.stopPropagation();if(a===GLTFViewer.Utils.Touch.TouchEnd&&
"mouse"===c.pointerType)return!1;var d=this._touches.Update(c,a),e=this._longTouch&&0===this.Touches.Count();e&&this._ContainerContext(this._longTouch);this._Finish&&!GLTFViewer.Utils.IsNull(d)&&setTimeout(this._Finish(c,d,e),0);this.StopLongTouch();this._touchActive=0!==this._touches.Count();return!this._touchActive}},_ContainerBlur:{value:function(a){this._Blur&&setTimeout(this._Blur(a),0)}},_ContainerContext:{value:function(a){this._viewer&&this._viewer.CloseContextMenus();this._Context?setTimeout(this._Context(a),
0):(a.preventDefault(),a.stopPropagation())}},_ContainerMouseWheel:{value:function(a){a.preventDefault();a.stopPropagation();var c=0;a.wheelDelta?c=a.wheelDelta:a.detail&&(c=-a.detail);var d=GLTFViewer.Utils.GetClientXY(this._element[0],a);this._Wheel&&setTimeout(this._Wheel(a,d,c),0)}},_ContainerMouseOver:{value:function(a){!this._touchActive&&this._Over&&setTimeout(this._Over(a),0)}},_ContainerMouseOut:{value:function(a){!this._touchActive&&this._Out&&setTimeout(this._Out(a),0)}},_StartLongTouch:{value:function(a){function c(a){this._longTouchTmrId=
null;this._longTouch=a}this.StopLongTouch();this._isMobile&&(this._longTouchTmrId=setTimeout(c.bind(this,a),750))}},StopLongTouch:{value:function(){this._longTouchTmrId&&(clearTimeout(this._longTouchTmrId),this._longTouchTmrId=null);this._longTouch=null}},Clear:{value:function(){this.StopLongTouch();this._element&&(this._debugTouch?(this._element[0].removeEventListener("mousedown",this._TouchStart,!1),this._element[0].removeEventListener("mousemove",this._TouchMove,!1),this._document.removeEventListener("mousemove",
this._TouchMove,!0),this._document.removeEventListener("mouseup",this._TouchEnd,!0)):(this._element[0].removeEventListener("mousedown",this._MouseDown,!1),this._element[0].removeEventListener("mousemove",this._MouseMove,!1),this._element[0].removeEventListener("mouseover",this._MouseOver,!1),this._element[0].removeEventListener("mouseout",this._MouseOut,!1),this._element[0].removeEventListener("mousewheel",this._MouseWheel,!1),this._element[0].removeEventListener("DOMMouseScroll",this._MouseWheel,
!1),this._document.removeEventListener("mousemove",this._MouseMove,!0),this._document.removeEventListener("mouseup",this._MouseUp,!0),window.navigator.pointerEnabled?(this._element[0].removeEventListener("pointerdown",this._TouchStart,!1),this._document.removeEventListener("pointermove",this._TouchMove,!1),this._document.removeEventListener("pointerup",this._TouchEnd,!1),this._document.removeEventListener("pointercancel",this._TouchEnd,!1)):(this._element[0].removeEventListener("touchstart",this._TouchStart,
!1),this._document.removeEventListener("touchmove",this._TouchMove,!1),this._document.removeEventListener("touchend",this._TouchEnd,!1),this._document.removeEventListener("touchcancel",this._TouchEnd,!1))),this._element[0].removeEventListener("blur",this._ElementBlur,!1),this._element[0].removeEventListener("contextmenu",this._ElementContext,!1),this._element[0].removeEventListener("selectstart",this._ElementSelectStart,!1));this._Context=this._Blur=this._Out=this._Over=this._Wheel=this._Finish=this._Move=
this._Start=this._element=this._viewer=null;this._touches&&(this._touches.Clear(),this._touches=null);this._ElementSelectStart=this._ElementContext=this._ElementBlur=this._TouchDown=this._TouchUp=this._TouchMove=this._MouseOut=this._MouseOver=this._MouseWheel=this._MouseDown=this._MouseUp=this._MouseMove=null}}});
GLTFViewer.Utils.SimpleContextMenu=function(a,c,d,e,f,g){var k=function(a){for(var c=0,d=$("body"),e=0;e<a.length;++e){var f=a[e],h=!1;f instanceof Array&&(f=f[0],h=!0);"-"!==f&&(d.append("<label style='font-size:12px;font-family:Segoe UI,Arial,Helvetica,sans-serif;top:-100px;'>"+f+":</label>"),f=$("label",d).last(),h=f.width()+(h?10:0),f.remove(),c=Math.max(c,h))}return c}(d)+10;$(c).append("<div class='AVDontPrint AVContextMenu' style='overflow:auto;display:none;position:fixed;z-index:99997;padding:1px 5px 5px 5px;width:"+
k+"px;background-color:#efefff;border:solid 1px #98A8A9;box-shadow:3px 3px 3px rgba(100, 100, 100, 0.5);'></div>");this._contextMenu=$("div",c).last();GLTFViewer.Utils.NoContext(a,this._contextMenu);this._parentContext=g;this._items=[];this._contextMenu.append("<ul class='AVContextMenu' style='list-style:none;margin:0;padding:0;'></ul>");g=$("ul",this._contextMenu).last();for(var h=5,k=k+10-8,l=0;l<d.length;++l){var m=d[l],n=e?e[l]:null,p=null;if(m instanceof Array){var p=m.slice(0),q=p[0];p.splice(0,
1);var u=null;n instanceof Array&&(u=n.slice(1));p=new GLTFViewer.Utils.SimpleContextMenu(a,c,p,u,function(a,c,d,e,f){e.push(a);e.push(c);d(e,f)}.bind(this,q,l,f),this);m=m[0]}g.append("<li class='AVContextMenu' style='display:block;margin-bottom:4px;nowrap;'></li>");q=$("li",g).last();"-"===m?(q.append("<div class='AVContextMenu' style='padding-left:5px;padding-right:5px;background:transparent;margin:0;border-bottom:1px solid black;'></div>"),k+=5):(this._items.push(q),q.append("<div class='AVContextMenu'></div>"),
u=$("div",q).last(),u.append("<label class='AVContextMenu' style='display:block;padding:4px 0 0 0;font-size:12px;font-family:Segoe UI,Arial,Helvetica,sans-serif;text-decoration:none;'></label>"),u=$("label",u).last(),u.text(m),"string"===typeof n&&u.prop("title",n),p&&u.append("<img class='AVContextMenu' src='"+a.imageDir+"closed.png' style='float:right;margin-top:4px;color:black;'></img>"),q.__contextMenu__=p,q.__XOffset__=k,q.__YOffset__=h,h+=24,u.hover(function(a,c,d){GLTFViewer.GetElementEnable(a)?
(c.css("color","#3398DA"),c.css("cursor","pointer"),c.offset(),a.__contextMenu__?GLTFViewer.GetElementVisible(a.__contextMenu__._contextMenu)||(this.CloseSubMenus(),d.clientX=a.__XOffset__,d.clientY=a.__YOffset__,a.__contextMenu__.Show(3,d,null,this._other)):this.CloseSubMenus()):this.CloseSubMenus()}.bind(this,q,u),function(a,c,d){c.css("color","black");c.css("cursor","")}.bind(this,q,u)),u.bind("click",function(a,c,d){d.preventDefault();d.stopPropagation();GLTFViewer.GetElementEnable(c)&&!c.__contextMenu__&&
(this._parentContext?this._parentContext.Show(!1):this.Show(!1),f([c.text(),a],this._other),this._other=null)}.bind(this,l,q)))}this._contextMenu.bind("click",function(a){a.preventDefault();a.stopPropagation()}.bind(this));this._parentContext||$(c).bind("mousedown pointerdown touchstart",function(a){GLTFViewer.GetElementVisible(this._contextMenu)&&-1===(a&&a.target?a.target.className:"").indexOf("AVContextMenu")&&this.Show(!1)}.bind(this));$(window).on("resize",this.Show.bind(this,!1));$(window).on("keyup",
this.Show.bind(this,!1))};
GLTFViewer.Utils.SimpleContextMenu.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.SimpleContextMenu},_parentContext:{writable:!0,value:null},_contextMenu:{writable:!0,value:null},_other:{writable:!0,value:null},_items:{writable:!0,value:null},_PositionMenu:{value:function(a){a||(a=window.event);a=GLTFViewer.Utils.GetXY(a);var c=a.clientX;a=a.clientY;var d=this._contextMenu.outerWidth(!0),e=this._contextMenu.outerHeight(!0),f=$(window).outerWidth(!0),g=$(window).outerHeight(!0);
d>f&&(this._contextMenu.css("width",f+"px"),d=f);e>g&&(this._contextMenu.css("height",g+"px"),e=g);this._contextMenu.__reverseX__=!1;this._parentContext&&(this._parentContext._contextMenu.__reverseX__?(c=this._parentContext._contextMenu[0].offsetLeft-d+2,this._contextMenu.__reverseX__=!0):c+=this._parentContext._contextMenu[0].offsetLeft,a+=this._parentContext._contextMenu[0].offsetTop);f-c<d&&(c=this._parentContext?this._parentContext._contextMenu[0].offsetLeft-d+2:f-d,this._contextMenu.__reverseX__=
!0);g-a<e&&(a=g-e);this._contextMenu.css("left",c+"px");this._contextMenu.css("top",a+"px")}},Show:{value:function(a,c,d,e){if(a){if(3!==a)for(var f=0;f<this._items.length;++f){var g=!1;if(!GLTFViewer.Utils.IsNull(d)){var k=this._items[f],g=d[k.text()];GLTFViewer.Utils.IsNull(g)&&(g=0);g&&k.__contextMenu__&&k.__contextMenu__.Show(2,c,d,e)}GLTFViewer.SetElementEnable(this._items[f],g)}2!==a&&(this._other=e,this._contextMenu.css("display","block"),c&&this._PositionMenu(c))}else{for(f=0;f<this._items.length;++f)k=
this._items[f],k.__contextMenu__&&k.__contextMenu__.Show(!1);this._contextMenu.css("display","none")}}},CloseSubMenus:{value:function(){for(var a=0;a<this._items.length;++a){var c=this._items[a];if(c.__contextMenu__&&GLTFViewer.GetElementVisible(c.__contextMenu__._contextMenu)){c.__contextMenu__.Show(!1);break}}}}});
GLTFViewer.Utils.MessageHandler=function(a){this._callbacks=[];this._messageIDs=[];this._viewer=a;this._receiver=this._Receive.bind(this);document.addEventListener(this._viewer.containerID+"ANSYSViewer",this._receiver,!1)};
GLTFViewer.Utils.MessageHandler.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.MessageHandler},_callbacks:{writable:!0,value:null},_messageIDs:{writable:!0,value:null},_viewer:{writable:!0,value:null},_Receive:{value:function(a){var c=a.detail.from,d=a.detail.messageID;a=a.detail.message;for(var e=0;e<this._callbacks.length;++e)if(this._messageIDs[e]===d){setTimeout(this._callbacks[e](c,d,a),0);break}}},AddListener:{value:function(a,c){var d=this._callbacks.length;this._messageIDs.push(a);
this._callbacks.push(c);return d}},SendMessage:{value:function(a,c){var d=document.createEvent("CustomEvent");d.initCustomEvent(this._viewer.containerID+"ANSYSViewer",!0,!0,{from:this._viewer.viewportNumber,messageID:a,message:c});document.dispatchEvent(d)}},Clear:{value:function(){document.removeEventListener(this._viewer.containerID+"ANSYSViewer",this._receiver);this._receiver=this._viewer=this._callbacks=this._messageIDs=null}},Reset:{value:function(){}}});
GLTFViewer.Utils.Dialog=function(a,c,d,e,f,g,k,h,l,m,n){function p(a,c,d,e,f){f.preventDefault();f.stopPropagation();this._Apply(e,c,"Cancel"!==a);"Apply"!==a&&(d.remove(),this._curFocus.focus(),this._Clear())}var q=$("body");this._modal=GLTFViewer.Utils.IsNull(d)?!0:d;this._curFocus=$(document.activeElement);this._applyCallback=e;var u=!GLTFViewer.Utils.IsNull(f);d=document.body.clientWidth;e=document.body.clientHeight;var r=this._modal?GLTFViewer.Utils.CreateModalShield():null;r&&r.css("display",
"block");this._container=r||q;this._container.append("<div style='position:fixed;background:white;width:"+d+"px;height:"+e+"px;border:1px solid "+GLTFViewer.BORDERCOLOR+";display:flex;display:-webkit-flex;flex-direction:column;-webkit-flex-direction:column;z-index:99996;'></div>");this._dialog=$("div",this._container).last();r=r||this._dialog;GLTFViewer.Utils.NoContext(null,this._dialog);this._inputs={};this._dialog.append("<div style='background:linear-gradient(#34485D,#283849);'></div>");this._titleBar=
$("div",this._dialog).last();this._titleBarTouchHandler=new GLTFViewer.Utils.TouchHandler(null,this._titleBar,null,this._MoveTitleBar.bind(this));this._titleBar.append("<p style='margin:0;padding:3px 15px;color:white;font-size:12px;font-weight:600;font-family:Segoe UI,Arial,Helvetica,sans-serif;'>"+a+"</p>");var w=this._titleBar.height()-8,t=GLTFViewer.Utils.Dialog.GenerateCloseURL(w,"white");this._titleBar.append("<img src='"+t+"' title='Close' style='position:absolute;right:4px;top:4px;background:transparent;border-radius:"+
w/2+"px;'></img>");var x=$("img",this._titleBar).last();x.hover(function(){x.css("background",GLTFViewer.HOVERCOLOR);x.css("cursor","pointer")},function(){x.css("background","transparent");x.css("cursor","")});x.click(p.bind(this,"Cancel",c,r,this._inputs));this._minHeight=a=this._titleBar.height()+2;this._minWidth=0;this._dialog.append("<div style='margin:0;padding:0;border:0;overflow:auto;background:white;flex:1;-webkit-flex:1;'></div>");this._scroll=$("div",this._dialog).last();this._scroll.append("<table style='margin:0;padding:0 5px 0 5px;border:0;font-size:12px;font-family:Segoe UI,Arial,Helvetica,sans-serif;flex:1;-webkit-flex:1;'></table>");
this._table=$("table",this._scroll).last();if(c){for(var y=t=0;y<c.length;++y){var z=c[y][1];if(z!==GLTFViewer.Utils.Dialog.DATANONE){q.append("<label style='font-size:12px;font-family:Segoe UI,Arial,Helvetica,sans-serif;top:-100px;'>"+c[y][0]+":</label>");var G=$("label",q).last(),E=G.width()+5,A=G.height();G.remove();z!==GLTFViewer.Utils.Dialog.DATALABEL&&(t=Math.max(t,E));z===GLTFViewer.Utils.Dialog.DATALABEL||z===GLTFViewer.Utils.Dialog.DATACHECKBOX?A+=4:z===GLTFViewer.Utils.Dialog.DATATEXT||
z===GLTFViewer.Utils.Dialog.DATANUMBER||z===GLTFViewer.Utils.Dialog.DATANUMBERVEC||z===GLTFViewer.Utils.Dialog.DATAINTEGER?A+=6:z===GLTFViewer.Utils.Dialog.DATALIST&&(A+=10);0===y&&(this._minHeight+=A)}}this._minWidth=t+150;for(y=0;y<c.length;++y)switch(this._table.append("<tr style='margin:0;padding:0;border:0;'></tr>"),q=$("tr",this._table).last(),c[y][1]){default:case GLTFViewer.Utils.Dialog.DATALABEL:q.append("<td colspan=2><fieldset style='display:block;margin:0;padding:0;border:0;border-top:1px solid black;text-align:center;'><legend><b>"+
c[y][0]+"</b></legend></fieldset></td>");break;case GLTFViewer.Utils.Dialog.DATATEXT:q.append("<td style='width:"+t+"px;'>"+c[y][0]+":</td>");q.append("<td><input type='text' value='"+c[y][2]+"' style='width:100%;padding:0;margin:0;border:1px solid black;'></input></td>");this._inputs[y]=$("input",q).last();break;case GLTFViewer.Utils.Dialog.DATANUMBER:q.append("<td style='width:"+t+"px;'>"+c[y][0]+":</td>");q.append("<td><input type='number' value='"+c[y][2]+"' style='width:100%;padding:0;margin:0;border:1px solid black;'></input></td>");
this._inputs[y]=$("input",q).last();break;case GLTFViewer.Utils.Dialog.DATANUMBERVEC:q.append("<td valign='top' style='width:"+t+"px;'>"+c[y][0]+":</td>");q.append("<td style='padding:0;margin:0;border:0;'><table style='width:100%;padding:0;margin:0;border:0;border-spacing:0;border-collapse:collapse;'></table></td>");G=$("table",q).last();this._inputs[y]=[];q=c[y][2].length;E=null;for(z=0;z<q;++z){if(4>=q&&0===z||9===q&&0===z%3||16===q&&0===z%4)G.append("<tr style='margin:0;padding:0;border:0;'></tr>"),
E=$("tr",G).last();E.append("<td><input type='number' value='"+c[y][2][z]+"' style='width:100%;padding:0;margin:0;border:1px solid black;'></input></td>");this._inputs[y].push($("input",E).last())}break;case GLTFViewer.Utils.Dialog.DATAINTEGER:q.append("<td style='width:"+t+"px;'>"+c[y][0]+":</td>");q.append("<td><input type='number' min='0' step='1' value='"+c[y][2]+"' style='width:100%;padding:0;margin:0;border:1px solid black;'></input></td>");this._inputs[y]=$("input",q).last();break;case GLTFViewer.Utils.Dialog.DATACHECKBOX:q.append("<td style='width:"+
t+"px;'>"+c[y][0]+":</td>");q.append("<td><input type='checkbox'"+(c[y][2]?" checked":"")+" style='padding:0;margin:0;border:1px solid black;'></input></td>");this._inputs[y]=$("input",q).last();break;case GLTFViewer.Utils.Dialog.DATALIST:for(q.append("<td style='width:"+t+"px;'>"+c[y][0]+":</td>"),q.append("<td><select></select></td>"),q=$("select",q).last(),this._inputs[y]=q,z=0;z<c[y][3].length;++z)q.append("<option value='"+c[y][3][z]+"' "+(c[y][3][z]===c[y][2]?"selected='selected'":"")+" >"+
c[y][3][z]+"</option>")}a+=this._table.height();this._minWidth=this._table.width()+20;this._table.width("100%")}if(GLTFViewer.Utils.IsNull(g)||g){this._dialog.append("<div align='center' style='background:transparent;border:0;border-top:1px solid "+GLTFViewer.BORDERCOLOR+";flex-direction:row;-webkit-flex-direction:row;'></div>");y=g=$("div",this._dialog).last();t=0;if(u){g.append("<div style='float:left;background:transparent;border:0;margin:0;padding:0;'></div>");u=$("div",g).last();u.append("<button type='button' style='margin:10px 5px 10px 10px;width:60px;height:20px;background:"+
GLTFViewer.BUTTONCOLOR+";color:black;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:5px;'>Reset</button>");var D=$("button",u).last();D.hover(function(){D.css("border-color",GLTFViewer.HOVERCOLOR);D.css("cursor","pointer")},function(){D.css("border-color",GLTFViewer.BORDERCOLOR);D.css("cursor","")});D.click(function(a,c){a(this._Reset.bind(this))}.bind(this,f));t+=75;if(GLTFViewer.Utils.IsNull(k)||k)if(q=Object.keys(this._inputs).length,1<q){u.append("<button type='button' style='margin:10px 5px 10px 5px;width:60px;height:20px;background:"+
GLTFViewer.BUTTONCOLOR+";color:black;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:5px;'>Apply</button>");var H=$("button",u).last();H.hover(function(){H.css("border-color",GLTFViewer.HOVERCOLOR);H.css("cursor","pointer")},function(){H.css("border-color",GLTFViewer.BORDERCOLOR);H.css("cursor","")});H.click(p.bind(this,"Apply",c,r,this._inputs));t+=70}g.append("<div style='float:right;background:transparent;border:0;margin:0;padding:0;'></div>");y=$("div",g).last()}y.append("<button type='button' style='margin:10px 5px 10px 5px;width:60px;height:20px;background:"+
GLTFViewer.BUTTONCOLOR+";color:black;border:1px solid "+GLTFViewer.BORDERCOLOR+";border-radius:5px;'>OK</button>");var B=$("button",y).last();B.hover(function(){B.css("border-color",GLTFViewer.HOVERCOLOR);B.css("cursor","pointer")},function(){B.css("border-color",GLTFViewer.BORDERCOLOR);B.css("cursor","")});B.click(p.bind(this,"Ok",c,r,this._inputs));y.append("<button type='button' style='margin:10px 10px 10px 5px;width:60px;height:20px;background:"+GLTFViewer.BUTTONCOLOR+";color:black;border:1px solid "+
GLTFViewer.BORDERCOLOR+";border-radius:5px;'>Cancel</button>");var N=$("button",y).last();N.hover(function(){N.css("border-color",GLTFViewer.HOVERCOLOR);N.css("cursor","pointer")},function(){N.css("border-color",GLTFViewer.BORDERCOLOR);N.css("cursor","")});N.click(p.bind(this,"Cancel",c,r,this._inputs));a+=g.height()+1;this._minHeight+=g.height()+1;t+=145;this._minWidth<t&&(this._minWidth=t)}50>this._minWidth&&(this._minWidth=50);t=GLTFViewer.Utils.Dialog.GenerateResizeURL(w,GLTFViewer.BORDERCOLOR);
this._dialog.append("<img src='"+t+"' style='position:absolute;right:0;bottom:0;background:transparent;'></img>");f=$("img",this._dialog).last();this._resizeTouchHandler=new GLTFViewer.Utils.TouchHandler(null,f,null,this._Resize.bind(this));f.hover(function(){$(this).css("cursor","nwse-resize")},function(){$(this).css("cursor","")});GLTFViewer.Utils.IsNull(h)&&(h=Math.floor(.1*d));GLTFViewer.Utils.IsNull(m)&&(m=this._minWidth);h+m>d&&(h=d-m,0>h&&(h=0,m=d,m<this._minWidth&&(this._minWidth=m)));GLTFViewer.Utils.IsNull(l)&&
(l=Math.floor(.1*e));GLTFViewer.Utils.IsNull(n)&&(n=a);n<this._minHeight&&(n=this._minHeight);l+n>e&&(l=e-n,0>l&&(l=0,n=e,n<this._minHeight&&(this._minHeight=n)));this._dialog.css("left",h+"px");this._dialog.css("top",l+"px");this._dialog.css("width",m+"px");this._dialog.css("height",n+"px");this._dialog.keypress(function(a){27===a.charCode&&p.bind(this,"Cancel",c,r,this._inputs)(a)}.bind(this));this._dialog.focus();this._valid=!0};
GLTFViewer.Utils.Dialog.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Dialog},_modal:{writable:!0,value:!0},_container:{writable:!0,value:null},_dialog:{writable:!0,value:null},_applyCallback:{writable:!0,value:null},_curFocus:{writable:!0,value:null},_titleBar:{writable:!0,value:null},_titleBarTouchHandler:{writable:!0,value:null},_resizeTouchHandler:{writable:!0,value:null},_valid:{writable:!0,value:!1},_minHeight:{writable:!0,value:100},_minWidth:{writable:!0,value:100},_table:{writable:!0,
value:null},_scroll:{writable:!0,value:null},_Apply:{value:function(a,c,d){if(this._applyCallback&&c){for(var e=[],f=0;f<c.length;++f)switch(c[f][1]){case GLTFViewer.Utils.Dialog.DATATEXT:case GLTFViewer.Utils.Dialog.DATALIST:e.push(a[f].val());break;case GLTFViewer.Utils.Dialog.DATANUMBER:e.push(1*a[f].val());break;case GLTFViewer.Utils.Dialog.DATAINTEGER:e.push(1*parseInt(a[f].val()));break;case GLTFViewer.Utils.Dialog.DATANUMBERVEC:for(var g=[],k=0;k<a[f].length;++k)g.push(1*a[f][k].val());e.push(g);
break;case GLTFViewer.Utils.Dialog.DATACHECKBOX:e.push(a[f].prop("checked"));break;default:e.push(null)}this._applyCallback(d,e)}}},_MoveTitleBar:{value:function(a){a=this._titleBarTouchHandler.Touches.Count();if(0!==a&&1===a&&(a=this._titleBarTouchHandler.Touches.GetTouchByIndex(0).GetID(),0===a||1===a)){a=this._titleBarTouchHandler.Touches.GetStartDelta(1);var c=this._dialog.outerWidth();this._dialog.outerHeight();var d=this._dialog.offset(),e=this._modal?this._container.width():this._container.prop("scrollWidth"),
f=this._modal?this._container.height():this._container.prop("scrollHeight");d.left=d.left+a.x>e-20?e-20:d.left+a.x<20-c?20-c:d.left+a.x;d.top=d.top+a.y>f-20?f-20:0>d.top+a.y?0:d.top+a.y;this._dialog.offset(d)}}},_Resize:{value:function(a){a=this._resizeTouchHandler.Touches.Count();if(0!==a&&1===a&&(a=this._resizeTouchHandler.Touches.GetTouchByIndex(0).GetID(),0===a||1===a)){var c=this._resizeTouchHandler.Touches.GetStartDelta(1);a=this._dialog.width()+c.x;c=this._dialog.height()+c.y;a<this._minWidth&&
(a=this._minWidth);c<this._minHeight&&(c=this._minHeight);this._dialog.width(a);this._dialog.height(c)}}},_Clear:{value:function(){this._valid=!1;this._titleBarTouchHandler&&(this._titleBarTouchHandler.Clear(),this._titleBarTouchHandler=null);this._resizeTouchHandler&&(this._resizeTouchHandler.Clear(),this._resizeTouchHandler=null);this._applyCallback=this._scroll=this._table=this._titleBar=this._curFocus=this._dialog=this._container=null}},_Reset:{value:function(a){for(var c=0;c<a.length;++c)switch(a[c][1]){case GLTFViewer.Utils.Dialog.DATATEXT:case GLTFViewer.Utils.Dialog.DATANUMBER:case GLTFViewer.Utils.Dialog.DATAINTEGER:case GLTFViewer.Utils.Dialog.DATALIST:this._inputs[c].val(a[c][2]);
break;case GLTFViewer.Utils.Dialog.DATANUMBERVEC:for(var d=0;d<a[c][2].length;++d)this._inputs[c][d].val(a[c][2][d]);break;case GLTFViewer.Utils.Dialog.DATACHECKBOX:this._inputs[c].prop("checked",a[c][2])}this._Apply(this._inputs,a,!1)}},AppendData:{value:function(a){this._table.append("<tr style='margin:0;padding:0;border:0;'></tr>");$("tr",this._table).last().append("<td>"+a+"</td>");this._scroll.scrollTop(this._scroll[0].scrollHeight)}}});
Object.defineProperties(GLTFViewer.Utils.Dialog,{DATANONE:{value:0},DATATEXT:{value:1},DATANUMBER:{value:2},DATACHECKBOX:{value:3},DATALIST:{value:4},DATALABEL:{value:5},DATANUMBERVEC:{value:6},DATAINTEGER:{value:7},GenerateCloseURL:{value:function(a,c){var d=$("body");d.append("<canvas style='position:absolute:top:-"+a+"px;left:-"+a+"px;width:"+a+"px;height:"+a+"px;background:transparent;'></canvas>");d=$("canvas",d).last();d[0].width=d.width();d[0].height=d.height();var e=d[0].getContext("2d");
e.clearRect(0,0,a,a);e.strokeStyle=c;var f=a/2,g=a/2,k=a/2,h=k-4;e.lineWidth=2;e.beginPath();e.arc(f,g,k,0,2*Math.PI,!1);e.stroke();e.lineWidth=1;e.beginPath();e.moveTo(f+h,g-h);e.lineTo(f-h,g+h);e.moveTo(f-h,g-h);e.lineTo(f+h,g+h);e.stroke();e=d[0].toDataURL();d.remove();return e}},GenerateResizeURL:{value:function(a,c){var d=$("body");d.append("<canvas style='position:absolute:top:-"+a+";left:-"+a+";width:"+a+"px;height:"+a+"px;background:transparent;'></canvas>");d=$("canvas",d).last();d[0].width=
d.width();d[0].height=d.height();var e=d[0].getContext("2d");e.clearRect(0,0,a,a);e.strokeStyle=c;var f=0;e.lineWidth=2;e.beginPath();for(var g=0;3>g;++g)f=g*a/3,e.moveTo(a,0+f),e.lineTo(0+f,a);e.stroke();e=d[0].toDataURL();d.remove();return e}},GeneratePanelResizeURL:{value:function(a,c,d){var e=$("body");e.append("<canvas style='position:absolute:top:-"+c+";left:-"+a+";width:"+a+"px;height:"+c+"px;background:transparent;'></canvas>");e=$("canvas",e).last();e[0].width=e.width();e[0].height=e.height();
var f=e[0].getContext("2d");f.clearRect(0,0,a,c);f.strokeStyle=d;f.fillStyle="rgba(255, 255, 255, 1)";f.beginPath();f.moveTo(0,0);f.lineTo(0,c);f.lineTo(a,c);f.lineTo(a,0);f.fill();f.lineWidth=2;f.beginPath();for(d=0;d<=a;d+=4)f.moveTo(d,0),f.lineTo(d,c);f.lineWidth=1;f.moveTo(0,0);f.lineTo(0,c);f.lineTo(a,c);f.lineTo(a,0);f.lineTo(0,0);f.stroke();a=e[0].toDataURL();e.remove();return a}}});
GLTFViewer.Utils.Help=function(){require("fs");this._helpViewerLoc=GLTFViewer.Utils.ResolvePath(process.execPath+"/../..")+"/commonfiles/help/HelpViewer/ANSYSHelpViewer.exe";this._BeforeUnload=function(a){this._CloseMe()}.bind(this);window.addEventListener("beforeunload",this._BeforeUnload,!1)};
GLTFViewer.Utils.Help.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Help},_helpViewerLoc:{writable:!0,value:null},_port:{writable:!0,value:null},_BeforeUnload:{writable:!0,value:null},_CloseMe:{value:function(){GLTFViewer.Utils.IsNull(this._port)||this.Open("QUIT")}},_Create:{value:function(a){if(GLTFViewer.Utils.IsNull(this._port))try{var c=require("child_process").spawn(this._helpViewerLoc,["--language","en-us","--sessionID","ANSYSViewer"]);c.stdout.on("data",function(a,c){var f=
parseInt(c);!this._port&&f&&(this._port=f,a(this._port))}.bind(this,a));c.on("close",function(a,c,f){GLTFViewer.Utils.IsNull(this._port)&&a(null);this._port=null}.bind(this,a))}catch(d){a(null)}else a(this._port)}},Clear:{value:function(){this._CloseMe()}},Reset:{value:function(){}},Open:{value:function(a){this._Create(function(a,d){if(!GLTFViewer.Utils.IsNull(d))try{var e=require("net").createConnection(d,null,function(a){e.write(a+"\n")}.bind(this,a))}catch(f){}}.bind(this,a))}}});
Object.defineProperties(GLTFViewer.Utils.Help,{DATANONE:{value:0}});
GLTFViewer.Utils.FileBaseClass=function(a,c,d,e){var f=this._gl=a.gl;this._scene=a;this._navigator=a.navigator;this._viewer=a.viewer;this._progressBar=a.progressBar;this._background=a.background;this._hasLineWidthSupport=a.lineWidthSupport;this._fileType=c;this._data=d;this._other=e;this._selectionMode=GLTFViewer.SELECTION_NONE;this._clip=new GLTFViewer.Utils.Clip(a);this._hitByteData=new Uint8Array(16);this._hitFloatData=new Float32Array(this._hitByteData.buffer,0,4);this._sorthitTestShader=new GLTFViewer.Utils.ShaderProgram(f,
GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileBaseClass._vsHitTestSort,GLTFViewer.Utils.FileBaseClass._fsHitTestSort);this._sortDat=new Float32Array(44);this._sortBuf=f.createBuffer();this.CanPeel=this.CanClip=!1;f.bindBuffer(f.ARRAY_BUFFER,this._sortBuf);f.bufferData(f.ARRAY_BUFFER,this._sortDat,f.DYNAMIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,null)};
GLTFViewer.Utils.FileBaseClass.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.FileBaseClass},_scene:{writable:!0,value:null},_gl:{writable:!0,value:null},_navigator:{writable:!0,value:null},_viewer:{writable:!0,value:null},_progressBar:{writable:!0,value:null},_background:{writable:!0,value:null},_hasLineWidthSupport:{writable:!0,value:!1},_fileType:{writable:!0,value:null},_data:{writable:!0,value:null},_other:{writable:!0,value:null},_sorthitTestShader:{writable:!0,value:null},
_selectionMode:{writable:!0,value:0},_selection:{writable:!0,value:null},_width:{writable:!0,value:0},_height:{writable:!0,value:0},_worldBoundingBox:{writable:!0,value:null},_hitDepthBuffer:{writable:!0,value:null},_hitTextures:{writable:!0,value:null},_hitFBuffers:{writable:!0,value:null},_hitTextureCnt:{writable:!0,value:0},_hitTextureWidth:{writable:!0,value:0},_hitByteData:{writable:!0,value:null},_hitFloatData:{writable:!0,value:null},_sortBuf:{writable:!0,value:null},_sortDat:{writable:!0,
value:null},_empty:{writable:!0,value:!0},_minSize:{writable:!0,value:1},_clip:{writable:!0,value:null},_canClip:{writable:!0,value:!1},_canPeel:{writable:!0,value:!1},_markup:{writable:!0,value:null},_canMarkup:{writable:!0,value:!1},_canCreateViews:{writable:!0,value:!1},_canExplode:{writable:!0,value:!1},_exportFH:{writable:!0,value:null},_exportType:{writable:!0,value:null},_exportBuffer:{writable:!0,value:null},_exportDataSize:{writable:!0,value:0},IsEmpty:{get:function(){return this._empty}},
MinSize:{get:function(){return this._minSize}},Ruler:{get:function(){return null}},SetExplosion:{value:function(a,c){}},GetExplosion:{value:function(){return 0}},CanExplode:{get:function(){return this._canExplode},set:function(a){this._canExplode=a;this._scene.viewer.ExplodeBtnState(null,a?GLTFViewer.MENUSHOW:GLTFViewer.MENUHIDE)}},SetSelectionMode:{value:function(a){this._selectionMode=a;this._scene.viewer.SelectionMenuBtnState(null,null,GLTFViewer.MENUUNCHECKALL);a>=GLTFViewer.SELECTION_EDGE&&a<=
GLTFViewer.SELECTION_BODY?(this._scene.viewer.SelectionMenuBtnState(a,null,GLTFViewer.MENUCHECK),this._scene.viewer.SelectionBtnState(null,GLTFViewer.MENUICON,GLTFViewer.ICONSELECTIONEDGE+a),this._scene.viewer.SelectionBtnState(null,GLTFViewer.MENUCHECK)):this._scene.viewer.SelectionBtnState(null,GLTFViewer.MENUUNCHECK)}},GetSelectionMode:{value:function(){return this._selectionMode}},CanPeel:{get:function(){return this._canPeel},set:function(a){this._canPeel=a}},CanClip:{get:function(){return this._canClip},
set:function(a){this._canClip=a;this._scene.viewer.ClipBtnState(null,a?GLTFViewer.MENUSHOW:GLTFViewer.MENUHIDE)}},CanMarkup:{get:function(){return this._canMarkup},set:function(a){this._canMarkup=a;this._scene.viewer.MarkupBtnState(null,a?GLTFViewer.MENUSHOW:GLTFViewer.MENUHIDE);GLTFViewer.Utils.IsApple()&&this._scene.viewer.MarkupMenuBtnState(GLTFViewer.markupMenuBtns3D,null,GLTFViewer.MENUDISABLE)}},CanCreateViews:{get:function(){return this._canCreateViews},set:function(a){this._canCreateViews=
a}},_ResetHitResources:{value:function(){if(0<this._hitTextureCnt){var a=this._gl;a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindTexture(a.TEXTURE_2D,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.deleteRenderbuffer(this._hitDepthBuffer);for(var c=0;c<this._hitTextureCnt;c++)a.deleteTexture(this._hitTextures[c]),a.deleteFramebuffer(this._hitFBuffers[c]);this._hitTextureWidth=this._hitTextureCnt=0;this._hitDepthBuffer=this._hitFBuffers=this._hitTextures=null}}},_UpdateHitResources:{value:function(a,
c){var d=this._gl,e=Math.log(2),f=Math.floor(Math.log(a)/e),g=1<<f;g<a&&(g=1<<++f);var e=Math.floor(Math.log(c)/e),k=1<<e;k<c&&(k=1<<++e);f+=1;g<k&&(g=k,f=e+1);2048<g&&(g=2048,f=12);if(this._hitTextureWidth<g)for(this._ResetHitResources(),this._hitTextureWidth=g,this._hitTextureCnt=f,this._hitTextures=[],this._hitFBuffers=[],e=d.FLOAT,k=0;k<f;k++){var h=d.createTexture();d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,h);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,
d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,g,g,0,d.RGBA,e,null);this._hitTextures.push(h);var l=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,l);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,h,0);if(0==k){this._hitDepthBuffer=d.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,this._hitDepthBuffer);d.renderbufferStorage(d.RENDERBUFFER,
d.DEPTH_COMPONENT16,g,g);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this._hitDepthBuffer);if(d.checkFramebufferStatus(d.FRAMEBUFFER)!=d.FRAMEBUFFER_COMPLETE){GLTFViewer.Utils.WriteLn("ERROR(FileBaseClass.UpdateHitResources): fbo not complete");d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindTexture(d.TEXTURE_2D,null);d.bindFramebuffer(d.FRAMEBUFFER,null);this._ResetHitResources();break}d.bindRenderbuffer(d.RENDERBUFFER,null)}d.bindTexture(d.TEXTURE_2D,null);d.bindFramebuffer(d.FRAMEBUFFER,
null);this._hitFBuffers.push(l);g>>=1}}},_SortHits:{value:function(){var a=this._gl,c=this._sorthitTestShader;if(!c.StartProgram())return null;var d=this._hitTextureWidth;a.disable(a.DEPTH_TEST);a.bindBuffer(a.ARRAY_BUFFER,this._sortBuf);a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,44,0);a.vertexAttribPointer(c.aT0,2,a.FLOAT,!1,44,12);a.vertexAttribPointer(c.aT1,2,a.FLOAT,!1,44,20);a.vertexAttribPointer(c.aT2,2,a.FLOAT,!1,44,28);a.vertexAttribPointer(c.aT3,2,a.FLOAT,!1,44,36);for(var e=0,f=this._sortDat;1<
d;){var g=.5/d;a.bindFramebuffer(a.FRAMEBUFFER,this._hitFBuffers[e+1]);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,this._hitTextures[e]);a.uniform1i(c.uSmp,0);d>>=1;a.viewport(0,0,d,d);var k=0;f[k++]=-1;f[k++]=-1;f[k++]=0;f[k++]=0-g;f[k++]=0-g;f[k++]=0+g;f[k++]=0-g;f[k++]=0-g;f[k++]=0+g;f[k++]=0+g;f[k++]=0+g;f[k++]=1;f[k++]=-1;f[k++]=0;f[k++]=1-g;f[k++]=0-g;f[k++]=1+g;f[k++]=0-g;f[k++]=1-g;f[k++]=0+g;f[k++]=1+g;f[k++]=0+g;f[k++]=-1;f[k++]=1;f[k++]=0;f[k++]=0-g;f[k++]=1-g;f[k++]=0+g;f[k++]=
1-g;f[k++]=0-g;f[k++]=1+g;f[k++]=0+g;f[k++]=1+g;f[k++]=1;f[k++]=1;f[k++]=0;f[k++]=1-g;f[k++]=1-g;f[k++]=1+g;f[k++]=1-g;f[k++]=1-g;f[k++]=1+g;f[k++]=1+g;f[k++]=1+g;a.bufferSubData(a.ARRAY_BUFFER,0,this._sortDat);a.drawArrays(a.TRIANGLE_STRIP,0,4);e++}a.disableVertexAttribArray(c.aPos);a.disableVertexAttribArray(c.aT0);a.disableVertexAttribArray(c.aT1);a.disableVertexAttribArray(c.aT2);a.disableVertexAttribArray(c.aT3);c=this._hitFloatData;a.readPixels(0,0,1,1,a.RGBA,a.FLOAT,c);a.bindFramebuffer(a.FRAMEBUFFER,
null);a.bindTexture(a.TEXTURE_2D,null);a.bindBuffer(a.ARRAY_BUFFER,null);a.enable(a.DEPTH_TEST);return 0===c[0]?null:c}},Render3D:{value:function(a,c,d,e,f){}},Render2D:{value:function(a,c,d,e){}},Render2DOverlay:{value:function(a,c){}},RenderClipCap:{value:function(a,c,d,e){}},RenderExport:{value:function(){}},ResetHit:{value:function(){}},AnyHit:{value:function(){return!1}},HitPoint:{value:function(){return null}},HitIndx:{value:function(){return null}},CanSelect:{value:function(){return!1}},AnySelection:{value:function(){return!1}},
UpdateSelection:{value:function(a,c){return!1}},ResetSelection:{value:function(){return!1}},RenderSelection:{value:function(a,c,d){}},ReadFile:{value:function(a,c,d){}},CreateScene:{value:function(a,c){return!1}},DeleteScene:{value:function(a){}},HitIndexTip:{value:function(){return null}},HitTestFindClosestIndex:{value:function(a){return!1}},HitTestFindClosestPos:{value:function(a){return null}},HitTest:{value:function(a,c,d,e,f){return!1}},IsVisible:{value:function(a){return!1}},RenderMarkup3D:{value:function(a){}},
RenderMarkup2D:{value:function(a){}},ReadMarkups:{value:function(a,c){}},PostMarkups:{value:function(){}},SaveMarkups:{value:function(a){return!1}},ReadViews:{value:function(a,c,d){}},PostViews:{value:function(){}},SaveViews:{value:function(a){return!1}},CurScene:{get:function(){return null}},GetSceneBox:{value:function(a){return GLTFViewer.Utils.Box.empty}},HideBody:{value:function(a){}},EditProperties:{value:function(a){}},GetSceneState:{value:function(){return null}},ResetScene:{value:function(a){this._worldBoundingBox=
null;this.UpdateWorldScale()}},UpdateWorldScale:{value:function(){GLTFViewer.Utils.IsNull(this._worldBoundingBox)&&(this._worldBoundingBox=new GLTFViewer.Utils.Box);this._worldBoundingBox.Unite(this.GetSceneBox());this._navigator.UpdateWorldScale(this._worldBoundingBox)}},Export:{value:function(a,c){var d=require("fs");this._exportFH=a;this._exportType=c;this._exportBuffer=new Buffer(1024);switch(c){case "STL":d.writeSync(a,"solid Object\n");break;case "STLBIN":this._exportBuffer.fill(0,0,80);d.writeSync(a,
this._exportBuffer,0,80);this._exportBuffer.writeUInt32LE(0,0);d.writeSync(a,this._exportBuffer,0,4);break;default:return}this._exportDataSize=0;this.RenderExport();switch(c){case "STL":d.writeSync(a,"endsolid Object\n");break;case "STLBIN":this._exportBuffer.writeUInt32LE(this._exportDataSize/50,0),d.writeSync(a,this._exportBuffer,0,4,80)}this._exportFH=this._exportBuffer=null}},Resize:{value:function(a,c){if(this._width!==a||this._height!==c)this._width=a,this._height=c,this._UpdateHitResources(a,
c)}},Reset:{value:function(){var a=this._gl;this._height=this._width=0;if(0<this._hitTextureCnt){a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindTexture(a.TEXTURE_2D,null);a.bindFramebuffer(a.FRAMEBUFFER,null);for(var c=0;c<this._hitTextureCnt;c++)a.deleteTexture(this._hitTextures[c]),a.deleteFramebuffer(this._hitFBuffers[c]);a.deleteRenderbuffer(this._hitDepthBuffer);this._hitFBuffers=this._hitTextures=this._hitDepthBuffer=null;this._hitTextureWidth=this._hitTextureCnt=0}this._empty=!0;this._minSize=
1;this._clip.Reset();this._worldBoundingBox=this._selection=null}},Clear:{value:function(){var a=this._gl;GLTFViewer.Utils.FileBaseClass.prototype.Reset.call(this);null!==this._sorthitTestShader&&(this._sorthitTestShader.DeleteProgram(),this._sorthitTestShader=null);this._sortDat=this._hitByteData=this._hitFloatData=this._other=this._data=this._fileType=this._scene=null;this._sortBuf&&(a.bindBuffer(a.ARRAY_BUFFER,null),a.deleteBuffer(this._sortBuf),this._sortBuf=null);this._gl=this._progressBar=this._background=
this._viewer=this._navigator=null;this._clip.Clear()}},GetTopParts:{value:function(){return null}},GetPartName:{value:function(a){return null}},GetPartParent:{value:function(a){return null}},GetPartParts:{value:function(a){return null}},GetPartBodys:{value:function(a){return null}},GetBodyName:{value:function(a){return null}},GetRegions:{value:function(){return null}},GetRegionName:{value:function(a){return null}},GetSelections:{value:function(a){return null}},GetClipPlane:{value:function(a){return new GLTFViewer.Utils.Plane(GLTFViewer.Utils.Vec3.Origin,
new GLTFViewer.Utils.Direction(0,0,1))}},ClipState:{get:function(){return this._clip.clipState},set:function(a){this._clip.clipState=a}},ClipViewState:{get:function(){return this._clip._clipViewState}},ClipDrawMode:{get:function(){return this._clip.clipDrawMode},set:function(a){this._clip.clipDrawMode=a}},MarkupTextEvent:{value:function(a,c){}},MarkupState:{get:function(){return GLTFViewer.Utils.Markup.STATE_DISABLED},set:function(a){}},MarkupLineShape:{get:function(){return GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE},
set:function(a){}},MarkupLineType:{get:function(){return GLTFViewer.Utils.Markup.LINE_TYPE_2D},set:function(a){}},MarkupLineColor:{get:function(){return new GLTFViewer.Utils.RGBA(0,0,0,255)},set:function(a){}},MarkupFontColor:{get:function(){return new GLTFViewer.Utils.RGBA(0,0,0,255)},set:function(a){}},MarkupFontSize:{get:function(){return GLTFViewer.DEFAULT_MARKUP_FONT_SIZE},set:function(a){}},MarkupBackColor:{get:function(){return new GLTFViewer.Utils.RGBA(255,255,255,127)},set:function(a){}},
MarkupSelect:{get:function(){return 0}},MarkupHit:{get:function(){return 0}},MarkupStart:{value:function(a,c){}},MarkupUpdate:{value:function(a,c){}},MarkupEnd:{value:function(a,c){}},MarkupCreate3D:{value:function(){}},MarkupDelete:{value:function(a){}},MarkupEsc:{value:function(){}},MarkupTip:{get:function(){return null}},MarkupEditable:{value:function(a){return!1}},HitTestPos:{value:function(a,c,d,e,f){if(0===this._hitTextureCnt)return null;var g=this._gl;g.enable(g.DEPTH_TEST);this._navigator.transViewProjTM.ToArray(a);
g.bindFramebuffer(g.FRAMEBUFFER,this._hitFBuffers[0]);g.viewport(0,0,c,d);g.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT);return this._RenderFindClosest(a,c,d,f,e)?(b=this._SortHits())?f?this.HitTestFindClosestIndex(b):this.HitTestFindClosestPos(b):null:null}},HasAnimation:{value:function(){return!1}},AnimationMinTime:{value:function(){return 0}},AnimationMaxTime:{value:function(){return 0}},AnimationShowFrame:{value:function(a){return!1}}});
Object.defineProperties(GLTFViewer.Utils.FileBaseClass,{_vsHitTestSort:{value:"attribute vec3 aPos;\nattribute vec2 aT0;\nattribute vec2 aT1;\nattribute vec2 aT2;\nattribute vec2 aT3;\nvarying vec2 vT0;\nvarying vec2 vT1;\nvarying vec2 vT2;\nvarying vec2 vT3;\nvoid main() {\nvT0 = aT0;\nvT1 = aT1;\nvT2 = aT2;\nvT3 = aT3;\ngl_Position = vec4(aPos, 1);\n}"},_fsHitTestSort:{value:"uniform sampler2D uSmp;\nvarying vec2 vT0;\nvarying vec2 vT1;\nvarying vec2 vT2;\nvarying vec2 vT3;\nvoid main() {\nvec4 t0 = texture2D(uSmp, vT0);\nvec4 t1 = texture2D(uSmp, vT1);\nvec4 t2 = texture2D(uSmp, vT2);\nvec4 t3 = texture2D(uSmp, vT3);\nif (t1.x != 0.0 && (t0.x == 0.0 || t1.x > t0.x)) t0 = t1;\nif (t2.x != 0.0 && (t0.x == 0.0 || t2.x > t0.x)) t0 = t2;\nif (t3.x != 0.0 && (t0.x == 0.0 || t3.x > t0.x)) t0 = t3;\ngl_FragColor = t0;\n}"}});GLTFViewer.Utils.Scene=function(a,c,d,e,f,g,k){this._enableUpdate=[];this.imageDir=a.imageDir;this.viewer=a;this.container=c;this.canvas=d;this.overlay=e;this.gl=f;this.gx=g;this.progress=k;a=f.getParameter(f.ALIASED_LINE_WIDTH_RANGE);a[1]===a[0]&&(this.lineWidthSupport=!1,GLTFViewer.Utils.WriteLn("WARNING: Line Width not supported, range is "+a[0]+" to "+a[1]));this.progressBar=new GLTFViewer.Utils.Scene.ProgressBar(this.progress,this.container);this.view=[];a=new GLTFViewer.Utils.Direction(1/GLTFViewer.Utils.root2,
-1/GLTFViewer.Utils.root6,1/GLTFViewer.Utils.root3);c=new GLTFViewer.Utils.Direction(1/GLTFViewer.Utils.root2,1/GLTFViewer.Utils.root6,-1/GLTFViewer.Utils.root3);this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,c.x,c.y,c.z));a=new GLTFViewer.Utils.Direction(GLTFViewer.Utils.root3/2,-.25,GLTFViewer.Utils.root3/4);c=new GLTFViewer.Utils.Direction(.5,GLTFViewer.Utils.root3/4,-.75);this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,c.x,c.y,c.z));a=GLTFViewer.Utils.Direction.dix;
c=GLTFViewer.Utils.Direction.diy;this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,c.x,c.y,c.z).Invert());this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,-c.x,-c.y,-c.z).Invert());a=GLTFViewer.Utils.Direction.diy;c=GLTFViewer.Utils.Direction.diz;this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(-a.x,-a.y,-a.z,c.x,c.y,c.z).Invert());this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,c.x,c.y,c.z).Invert());a=GLTFViewer.Utils.Direction.dix;
c=GLTFViewer.Utils.Direction.diz;this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(a.x,a.y,a.z,c.x,c.y,c.z).Invert());this.view.push(GLTFViewer.Utils.Transformation.RotationCreate(-a.x,-a.y,-a.z,c.x,c.y,c.z).Invert());this.navigator=new GLTFViewer.Utils.Navigator(this,this.container,this.view[0]);this.viewer.mobile&&(this._canPeel=!1);this.ruler=new GLTFViewer.Utils.Ruler(g,this.navigator);this.uLit=new Float32Array(32);this.lights=[new GLTFViewer.Utils.Light,new GLTFViewer.Utils.Light];
this.defaultLightDirs=Array(2);this.defaultLightDirs[0]=new GLTFViewer.Utils.Direction(-.361,.361,.431);this.defaultLightDirs[1]=new GLTFViewer.Utils.Direction(-.319,.324,.891);this._screenQuadDat=new Float32Array(16);this._screenQuadBuf=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,this._screenQuadBuf);f.bufferData(f.ARRAY_BUFFER,this._screenQuadDat,f.DYNAMIC_DRAW);f.blendFuncSeparate(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA,f.ONE,f.ONE_MINUS_SRC_ALPHA);f.depthFunc(f.LESS);f.clearColor(0,0,0,0);this.background=
new GLTFViewer.Utils.Background(f);this.screenShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Scene._vsScreen,GLTFViewer.Utils.Scene._fsScreen);window.addEventListener("resize",this.Invalidate.bind(this,!0),!1);this._intervalTimer=setInterval(this.Timer.bind(this),1E3);this._screenTexture=f.createTexture();f.activeTexture(f.TEXTURE0);f.bindTexture(f.TEXTURE_2D,this._screenTexture);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE);
f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.NEAREST);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.NEAREST);f.bindTexture(f.TEXTURE_2D,null);if(this._canPeel){this.g_frontColorTexId=[];this.g_frontFboId=[];this.g_frontDepthId=f.createRenderbuffer();for(g=0;2>g;++g)this.g_frontColorTexId[g]=f.createTexture(),this.g_frontFboId[g]=f.createFramebuffer();this.g_frontColorBlenderTexId=f.createTexture();this.g_frontColorBlenderFboId=
f.createFramebuffer();this.g_frontColorBlenderDepthId=f.createRenderbuffer()}this.Loop()};
GLTFViewer.Utils.Scene.prototype=Object.create(null,{_screenQuadDat:{writable:!0,value:null},_screenQuadBuf:{writable:!0,value:null},_screenTexture:{writable:!0,value:null},_intervalTimer:{writable:!0,value:null},_darkBorder:{writable:!0,value:!1},_animateLoop:{writable:!0,value:!1},_animateLastClockTime:{writable:!0,value:null},_animateAllowed:{writable:!0,value:!1},_animate:{writable:!0,value:!1},_animateOnce:{writable:!0,value:!1},_animateUpdateSlider:{writable:!0,value:!0},_animateCurTime:{writable:!0,
value:null},_animateSpeed:{writable:!0,value:1},g_frontColorTexId:{writable:!0,value:null},g_frontFboId:{writable:!0,value:null},g_frontDepthId:{writable:!0,value:null},g_frontColorBlenderTexId:{writable:!0,value:null},g_frontColorBlenderFboId:{writable:!0,value:null},g_frontColorBlenderDepthId:{writable:!0,value:null},handler:{writable:!0,value:null},navigator:{writable:!0,value:null},ruler:{writable:!0,value:null},progressBar:{writable:!0,value:null},_enableUpdate:{writable:!0,value:null},paint:{writable:!0,
value:!0},paintAll:{writable:!0,value:!0},_depthPeel:{writable:!0,value:!1},_canPeel:{writable:!0,value:!0},depthPeelPass:{writable:!0,value:0},depthPeelPasses:{writable:!0,value:20},viewer:{writable:!0,value:null},canvas:{writable:!0,value:null},gl:{writable:!0,value:null},gx:{writable:!0,value:null},lineWidthSupport:{writable:!0,value:!0},container:{writable:!0,value:null},overlay:{writable:!0,value:null},progress:{writable:!0,value:null},screenShader:{writable:!0,value:null},logo:{writable:!0,
value:null},background:{writable:!0,value:null},uLit:{writable:!0,value:null},lights:{writable:!0,value:null},defaultLightDirs:{writable:!0,value:null},view:{writable:!0,value:null},showFrameRate:{writable:!0,value:!1},frameCount:{writable:!0,value:0},frameTime:{writable:!0,value:0},frameCountLast:{writable:!0,value:0},frameTimeLast:{writable:!0,value:0},requestAnimationID:{writable:!0,value:!1},depthPeel:{get:function(){return this._canPeel&&this._depthPeel},set:function(a){this._depthPeel=a}},OkToShowContextMenu:{value:function(){return this.IsEmpty()||
this.navigator.OkToShowContextMenu()}},Timer:{value:function(){var a=(new Date).getTime();this.frameCountLast=this.frameCount;this.frameTimeLast=a-this.frameTime;this.frameCount=0;this.frameTime=a}},Resize:{value:function(a,c){if(this._canPeel){for(var d=this.gl,e=0;2>e;++e)if(d.bindTexture(d.TEXTURE_2D,this.g_frontColorTexId[e]),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,
d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,a,c,0,d.RGBA,d.FLOAT,null),d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontFboId[e]),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.g_frontColorTexId[e],0),d.bindRenderbuffer(d.RENDERBUFFER,this.g_frontDepthId),d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,a,c),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.g_frontDepthId),d.checkFramebufferStatus(d.FRAMEBUFFER)!=
d.FRAMEBUFFER_COMPLETE){GLTFViewer.Utils.WriteLn("ERROR(Scene.Resize): fbo not complete");this._canPeel=!1;d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null);return}d.bindTexture(d.TEXTURE_2D,this.g_frontColorBlenderTexId);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,
d.NEAREST);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,a,c,0,d.RGBA,d.FLOAT,null);d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontColorBlenderFboId);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.g_frontColorBlenderTexId,0);d.bindRenderbuffer(d.RENDERBUFFER,this.g_frontColorBlenderDepthId);d.renderbufferStorage(d.RENDERBUFFER,d.DEPTH_COMPONENT16,a,c);d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,this.g_frontColorBlenderDepthId);d.checkFramebufferStatus(d.FRAMEBUFFER)!=
d.FRAMEBUFFER_COMPLETE&&(GLTFViewer.Utils.WriteLn("ERROR(Scene.Resize): fbo not complete"),this._canPeel=!1);d.bindTexture(d.TEXTURE_2D,null);d.bindRenderbuffer(d.RENDERBUFFER,null);d.bindFramebuffer(d.FRAMEBUFFER,null)}}},RenderScene:{value:function(a){function c(a,c,d,e){a.uniform2f(c.uSze,d,e);var f=0,h=this._screenQuadDat;h[f++]=0;h[f++]=0;h[f++]=0;h[f++]=0;h[f++]=d;h[f++]=0;h[f++]=1;h[f++]=0;h[f++]=0;h[f++]=e;h[f++]=0;h[f++]=1;h[f++]=d;h[f++]=e;h[f++]=1;h[f++]=1;a.bindBuffer(a.ARRAY_BUFFER,this._screenQuadBuf);
a.bufferSubData(a.ARRAY_BUFFER,0,this._screenQuadDat);a.vertexAttribPointer(c.aPos,2,a.FLOAT,!1,16,0);a.vertexAttribPointer(c.aTex,2,a.FLOAT,!1,16,8);a.drawArrays(a.TRIANGLE_STRIP,0,4);a.bindBuffer(a.ARRAY_BUFFER,null)}if(!this._enableUpdate.length&&this.viewer.IsVisible()){a=(a?a:(new Date).getTime())/1E3;!this._animateAllowed&&a&&(this._animateAllowed=!0);if(this._animate||this._animateOnce){this._animateOnce&&(this._animateOnce=!1,this._animateLastClockTime=null);var d=this.AnimationMinTime(),
e=this.AnimationMaxTime(),f=GLTFViewer.Utils.IsNull(this._animateCurTime)?d:this._animateCurTime,g=GLTFViewer.Utils.IsNull(this._animateLastClockTime)?0:a-this._animateLastClockTime;this._animateLastClockTime=a;g=f+g*this._animateSpeed;g>=e&&(this._animateLoop?(g=g%e+d,this._animateLastClockTime=a-g):(this._animate=!1,g=this.AnimationMaxTime(),this.viewer.animationDialog&&this.viewer.animationDialog.pauseButton&&this.viewer.animationDialog.pauseButton.click()));this.AnimationShowFrame(g)||(this._animateLastClockTime=
null)}this.handler&&(a=this.viewer.AnyAnnimationRunning()?GLTFViewer.MENUDISABLE:GLTFViewer.MENUENABLE,a===GLTFViewer.MENUDISABLE&&(this.viewer.GetMainUIViewer().FileManagerBtnState(null,GLTFViewer.MENUCLOSE),this.viewer.MarkupBtnState(null,GLTFViewer.MENUCLOSE),this.viewer.ExplodeBtnState(null,GLTFViewer.MENUCLOSE),this.SetExplosion(0,!0)),this.viewer.GetMainUIViewer().FileManagerBtnState(null,a),this.viewer.MarkupBtnState(null,this.GetExplosion()?GLTFViewer.MENUDISABLE:a),this.viewer.ExplodeBtnState(null,
a));if((this.paint||this.paintAll)&&this.SetCanvasSize()){var d=this.gl,g=this.navigator,k=g.canvasWidth;a=g.canvasHeight;d.enable(d.DEPTH_TEST);d.viewport(0,0,k,a);if(this.paintAll){e=!1;g.StartRender();this.SetupLights();if(!this.IsEmpty()&&this.handler)if(f=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,!this.depthPeel||f||!this.handler.CanPeel||g.active)d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),f&&(this.handler._clip.flipped||(this.handler.RenderClipCap(g.uTVP,g.uEye,this.uLit,
k,a),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,this.handler._clip.capTexture),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,k,a,0),d.bindTexture(d.TEXTURE_2D,null)),d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT)),this.background&&this.background.Render(),this.handler.Render3D(g.uTVP,g.uEye,this.uLit,k,a,-1),f&&(this.handler._clip.RenderCap(g.uTVP,g.uEye,this.uLit),this.handler._clip.RenderPlane(g.uTVP)),this.handler.RenderMarkup3D(g.uTVP),this.handler.Render2D(g.uTVP,g.uEye,this.uLit,k,
a),this.paintAll=!1,e=!0;else if(this.depthPeelPass<this.depthPeelPasses){e=function(a,d,e,f){a.enable(a.BLEND);a.disable(a.DEPTH_TEST);var h=this.screenShader;h.StartProgram()&&(a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,f),a.uniform1i(h.uSmp,0),c.call(this,a,h,d,e),a.bindTexture(a.TEXTURE_2D,null),a.enable(a.DEPTH_TEST),a.disable(a.BLEND))};0===this.depthPeelPass&&(d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontColorBlenderFboId),d.clear(d.COLOR_BUFFER_BIT),d.bindFramebuffer(d.FRAMEBUFFER,
this.g_frontFboId[1]),d.clear(d.DEPTH_BUFFER_BIT),this.handler.Render3D(g.uTVP,g.uEye,this.uLit,k,a,1));do{var f=this.depthPeelPass%2,h=1-f;d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontFboId[f]);d.clear(d.COLOR_BUFFER_BIT);d.enable(d.BLEND);d.disable(d.DEPTH_TEST);this.handler.Render3D(g.uTVP,g.uEye,this.uLit,k,a,2,this.g_frontColorTexId[h]);d.enable(d.DEPTH_TEST);d.disable(d.BLEND);d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontColorBlenderFboId);d.blendFuncSeparate(d.ONE_MINUS_DST_ALPHA,d.ONE,d.ONE_MINUS_DST_ALPHA,
d.ONE);e.call(this,d,k,a,this.g_frontColorTexId[f]);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);d.bindFramebuffer(d.FRAMEBUFFER,this.g_frontFboId[f]);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);this.handler.Render3D(g.uTVP,g.uEye,this.uLit,k,a,3,this.g_frontColorTexId[h]);++this.depthPeelPass}while(2>this.depthPeelPass&&this.depthPeelPass<this.depthPeelPasses);d.bindFramebuffer(d.FRAMEBUFFER,null);d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT);this.background&&
this.background.Render();d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);e.call(this,d,k,a,this.g_frontColorBlenderTexId);d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);this.handler.RenderMarkup3D(g.uTVP);this.handler.Render2D(g.uTVP,g.uEye,this.uLit,k,a);this.depthPeelPass>=this.depthPeelPasses&&(this.paintAll=!1);e=!0}else this.paintAll=!1;else d.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT),this.background&&this.background.Render(),
this.handler&&this.handler.RenderMarkup3D(g.uTVP),this.paintAll=!1,e=!0;e&&(d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,this._screenTexture),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA,0,0,k,a,0),d.bindTexture(d.TEXTURE_2D,null),d.bindBuffer(d.ARRAY_BUFFER,null));this.frameCount++;g.UpdateAnimProjStep()}else e=this.screenShader,e.StartProgram()&&(d.disable(d.DEPTH_TEST),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,this._screenTexture),d.uniform1i(e.uSmp,0),c.call(this,d,e,k,a),d.bindTexture(d.TEXTURE_2D,
null),d.enable(d.DEPTH_TEST));this.handler&&(this.handler.RenderSelection(g.uTVP,k,a),this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW&&this.ClipDrawMode>GLTFViewer.Utils.Clip.DRAWMODE_1_PT?this.handler._clip.RenderPreview(g.uTVP,k,a):(g.mouseOver||g.active)&&this.ClipDrawMode>=GLTFViewer.Utils.Clip.DRAWMODE_MOVE&&g.IsType(GLTFViewer.Utils.Navigator.NavNone)&&this.handler._clip.RenderMoveHint(k,a,g._cursorRay));g.Render3D(this.uLit);if(e=(this._darkBorder=this.background&&this.background.IsDark(GLTFViewer.Utils.Background.RIGHTTOP))?
this.viewer.whtLogo:this.viewer.blkLogo)this.viewer.isFull||1===this.viewer.viewportLayout&&0===this.viewer.viewportNumber||1===this.viewer.viewportNumber?e!==this.logo&&(this.logo=e,this.viewer.whtLogo.css("visibility","hidden"),this.viewer.blkLogo.css("visibility","hidden"),e.css("visibility","visible")):(this.logo=null,this.viewer.whtLogo.css("visibility","hidden"),this.viewer.blkLogo.css("visibility","hidden"));d.bindBuffer(d.ARRAY_BUFFER,null);d=this.gx;d.clearRect(0,0,k,a);this.ruler.Render();
this.handler&&(this.handler.RenderMarkup2D(g.uTVP),this.handler.Render2DOverlay(k,a));g.Render2D();if(this.depthPeel){var h=11,l=0,m=10,e=m,f=a-m;d.font=h+"px Verdana";d.textAlign="start";d.textBaseline="top";g="Peel passes: "+this.depthPeelPass+"/"+this.depthPeelPasses;m=d.measureText(g);m=m.width+2*l;h=1.1*h+2*l;f-=h;d.fillStyle="rgba(255, 255, 255, 0.8)";d.fillRect(e,f,m,h);d.fillStyle="rgba(0, 0, 0, 1)";d.fillText(g,e+l,f+l)}else if(this.AnyHit()||this.MarkupState===GLTFViewer.Utils.Markup.STATE_ENABLED&&
this.MarkupLineType===GLTFViewer.Utils.Markup.LINE_TYPE_2D&&!this.MarkupSelect||this.MarkupState===GLTFViewer.Utils.Markup.STATE_CREATE_LINE&&this.MarkupTip())if(f=g.lastLocation,!GLTFViewer.Utils.IsNull(f)){var e=f.x,f=f.y,n=null;g.mouseOver&&(n=this.MarkupState!==GLTFViewer.Utils.Markup.STATE_ENABLED||this.MarkupLineType!==GLTFViewer.Utils.Markup.LINE_TYPE_2D||this.MarkupSelect?this.MarkupState===GLTFViewer.Utils.Markup.STATE_CREATE_LINE?this.MarkupTip():this.handler?this.handler.HitIndexTip():
null:"("+(e/k).toFixed(4)+", "+(f/a).toFixed(4)+")");if(!GLTFViewer.Utils.IsNull(n)&&n.length){var h=11,g=h+3+2,k=k-18-4-5-e,p=e-18-4-5,q=a-10-4-5-f,u=f-10-4-5;d.fillStyle="rgba(150, 150, 250, .25)";d.strokeStyle="rgba(250, 250, 250, .45)";GLTFViewer.Utils.StrokeEllipse(d,e-8,f-8,16,16);GLTFViewer.Utils.FillEllipse(d,e-8,f-8,16,16);d.font=h+"px Verdana";var r=null,w=null;20<k&&(r=GLTFViewer.Utils.SplitLine(d,k,n),l=r.data.length*g-2);20<p&&(w=GLTFViewer.Utils.SplitLine(d,p,n),m=w.data.length*g-2);
n=w&&w.width<=p&&m<=q&&(!r||w.width>=r.width);p=w&&w.width<=p&&m<=u&&(!r||w.width>=r.width);u=r&&r.width<=k&&l<=u&&(!w||r.width>=w.width);h=null;r&&r.width<=k&&l<=q&&(!w||r.width>=w.width)?(h=r,e+=18,f+=10):n?(h=w,e-=18+w.width,f+=10):u?(h=r,e+=18,f-=10+l):p&&(h=w,e-=18+w.width,f-=10+m);if(h)for(l=h.width,m=h.data.length*g-2,d.fillStyle="rgba(255, 255, 200, .8)",d.fillRect(e,f,l+4,m+4),d.textAlign="start",d.textBaseline="top",d.fillStyle="rgba(0, 0, 0, 1)",l=e+2,m=f+2,e=0;e<h.data.length;++e)d.fillText(h.data[e],
l,m),m+=g}}this.showFrameRate&&0<this.frameCountLast&&(h=11,l=0,e=m=10,f=a-m,d.font=h+"px Verdana",g="fps: "+(this.frameCountLast/(this.frameTimeLast/1E3)).toFixed(2),m=d.measureText(g),m=m.width+2*l,h=1.1*h+2*l,f-=h,d.fillStyle="rgba(255, 255, 255, 0.8)",d.fillRect(e,f,m,h),e+=l,f+=l,d.fillStyle="rgba(0, 0, 0, 1)",d.textAlign="start",d.textBaseline="top",d.fillText(g,e,f));a=this.viewer.DrawBorder();a[0]&&(m=a[1],h=a[2],d.strokeStyle=this._darkBorder?"rgba(192, 192, 192, 1)":"rgba(64, 64, 64, 1)",
d.lineWidth=2,d.beginPath(),a[0]&2&&(d.moveTo(m-1,0),d.lineTo(m-1,h)),a[0]&4&&(d.moveTo(0,h-1),d.lineTo(m,h-1)),d.stroke());this.viewer.wantPrint&&this.viewer.SaveImage()}}}},GetImage:{value:function(a){function c(a,c){if(!(0<--c.numImages)){var d=$("body");d.append("<canvas style='position:absolute:top:-10px;left:-10px;width:10px;height:10px;background:transparent;'></canvas>");d=$("canvas",d).last();d[0].width=10;d[0].height=10;var e=d[0].getContext("2d");try{e.drawImage(c.image[0],0,0,10,10);var f=
d[0].toDataURL()}catch(g){c.image[0]=null}try{2<c.maxImages&&(e.drawImage(c.image[2],0,0,10,10),f=d[0].toDataURL())}catch(g){c.image[2]=null}d.remove();var d=this.navigator.canvasWidth,e=this.navigator.canvasHeight,k=this.gx;k.clearRect(0,0,d,e);c.image[0]&&k.drawImage(c.image[0],0,0,d,e);k.drawImage(c.image[1],0,0,d,e);2<c.maxImages&&c.image[2]&&k.drawImage(c.image[2],d-110,-20,129,96);try{f=this.overlay.toDataURL()}catch(g){}this.Invalidate(!0);a(f)}}function d(a,c,d,e){a.image[c]=new Image;a.image[c].onload=
e;a.image[c].src=d}var e={image:[],numImages:2,maxImages:2},f;f=this.handler?this.canvas.toDataURL():this.viewer.imageDir+"back.png";var g=this.overlay.toDataURL(),k=null;this.logo&&(k=this.logo[0].src,++e.numImages,++e.maxImages);d(e,0,f,c.bind(this,a,e));d(e,1,g,c.bind(this,a,e));k&&d(e,2,k,c.bind(this,a,e))}},SetupLights:{value:function(){var a=this.defaultLightDirs[0].TransformCreate(this.navigator.projectionInvTM);this.lights[0].ambient.SetHsv(0,0,0);this.lights[0].diffuse.SetHsv(0,0,0);this.lights[0].specular.SetHsv(0,
0,.75);this.lights[0].dir.Set(a.x,a.y,a.z);a=this.defaultLightDirs[1].TransformCreate(this.navigator.projectionInvTM);this.lights[1].ambient.SetHsv(0,0,.8);this.lights[1].diffuse.SetHsv(0,0,.4);this.lights[1].specular.SetHsv(0,0,.1);this.lights[1].dir.Set(a.x,a.y,a.z);for(var c=a=0;2>c;c++)this.lights[c].ambient.ToArray(this.uLit,a),a+=4,this.lights[c].diffuse.ToArray(this.uLit,a),a+=4,this.lights[c].specular.ToArray(this.uLit,a),a+=4,this.lights[c].dir.ToArray(this.uLit,a),a+=4}},ReadFile:{value:function(a,
c,d,e){a!==this.handler&&this.Reset();this.handler=a;this.handler.ReadFile(c,d,e);this.Invalidate(!0)}},SetCanvasSize:{value:function(){var a=this.viewer.viewerWidth,c=this.viewer.viewerHeight;if(0===a||0===c)return!1;this.handler&&this.handler.Resize(a,c);if(this.navigator.canvasWidth===a&&this.navigator.canvasHeight===c)return!0;this.Resize(a,c);this.navigator.SetSize(a,c);this.Invalidate(!0);return!0}},Loop:{value:function(a){this.RenderScene(a);this.requestAnimationID=requestAnimationFrame(this.Loop.bind(this))}},
SetView:{value:function(a){this.navigator.ZoomExtents(!0,this.view[a])}},MarkupTextEvent:{value:function(a,c){this.handler&&this.handler.MarkupTextEvent(a,c)}},MarkupState:{get:function(){return this.handler?this.handler.MarkupState:GLTFViewer.Utils.Markup.STATE_DISABLED},set:function(a){this.handler&&(this.handler.MarkupState=a)}},MarkupLineShape:{get:function(){return this.handler?this.handler.MarkupLineShape:GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE},set:function(a){this.handler&&(this.handler.MarkupLineShape=
a)}},MarkupLineType:{get:function(){return this.handler?this.handler.MarkupLineType:GLTFViewer.Utils.Markup.LINE_TYPE_2D},set:function(a){this.handler&&(this.handler.MarkupLineType=a)}},MarkupLineColor:{get:function(){return this.handler?this.handler.MarkupLineColor:new GLTFViewer.Utils.RGBA(0,0,0,255)},set:function(a){this.handler&&(this.handler.MarkupLineColor=a)}},MarkupFontColor:{get:function(){return this.handler?this.handler.MarkupFontColor:new GLTFViewer.Utils.RGBA(0,0,0,255)},set:function(a){this.handler&&
(this.handler.MarkupFontColor=a)}},MarkupFontSize:{get:function(){return this.handler?this.handler.MarkupFontSize:GLTFViewer.DEFAULT_MARKUP_FONT_SIZE},set:function(a){this.handler&&(this.handler.MarkupFontSize=a)}},MarkupBackColor:{get:function(){return this.handler?this.handler.MarkupBackColor:new GLTFViewer.Utils.RGBA(255,255,255,127)},set:function(a){this.handler&&(this.handler.MarkupBackColor=a)}},MarkupSelect:{get:function(){return this.handler?this.handler.MarkupSelect:0}},MarkupHit:{get:function(){return this.handler?
this.handler.MarkupHit:0}},MarkupStart:{value:function(a,c){this.handler&&this.handler.MarkupStart(a,c)}},MarkupUpdate:{value:function(a,c){this.handler&&this.handler.MarkupUpdate(a,c)}},MarkupEnd:{value:function(a,c){this.handler&&this.handler.MarkupEnd(a,c)}},MarkupCreate3D:{value:function(){this.handler&&(this.UpdateHit(this.navigator._cursorRay,!0),this.handler.MarkupCreate3D(this.navigator._cursorRay.x,this.navigator._cursorRay.y))}},MarkupDelete:{value:function(a){this.handler&&this.handler.MarkupDelete(a)}},
MarkupEsc:{value:function(){this.handler&&this.handler.MarkupEsc()}},MarkupTip:{value:function(){return this.handler?this.handler.MarkupTip:null}},MarkupEditable:{value:function(a){return this.handler?this.handler.MarkupEditable(a):!1}},ClipState:{get:function(){return this.handler?this.handler.ClipState:GLTFViewer.Utils.Clip.STATE_DISABLED},set:function(a){this.handler&&(this.handler.ClipState=a)}},ClipViewState:{get:function(){return this.handler?this.handler.ClipViewState:GLTFViewer.Utils.Clip.VIEWSTATE_NONE}},
ClipDrawMode:{get:function(){return this.handler?this.handler.ClipDrawMode:GLTFViewer.Utils.Clip.DRAWMODE_DONE},set:function(a){this.handler&&(this.handler.ClipDrawMode=a)}},GetSceneBox:{value:function(a){return this.handler?this.handler.GetSceneBox(a):GLTFViewer.Utils.Box.empty}},EnableUpdate:{value:function(a){a?this._enableUpdate.pop():this._enableUpdate.push(1);0===this._enableUpdate.length&&this.Invalidate(!0)}},Invalidate:{value:function(a){a?(this.paintAll=!0,this.depthPeelPass=0):this.paint=
!0}},IsEmpty:{value:function(){return this.handler?this.handler.IsEmpty:!0}},ResetProjection:{value:function(){this.navigator&&(this.navigator.projectionTM=this.view[0].Clone())}},SetExplosion:{value:function(a,c){this.handler&&this.handler.SetExplosion(a,c)}},GetExplosion:{value:function(){return this.handler?this.handler.GetExplosion():0}},AnyHit:{value:function(){return this.handler?this.handler.AnyHit():!1}},HitPoint:{value:function(){return this.handler?this.handler.HitPoint():null}},HitIndx:{value:function(){return this.handler?
this.handler.HitIndx():null}},UpdateHit:{value:function(a,c){this.handler&&(this.ResetHit(),this.handler.HitTest(this.navigator.uTVP,this.navigator.canvasWidth,this.navigator.canvasHeight,a,!1)?(c&&this.AnyHit()&&this.handler.HitTestPos(this.navigator.uTVP,this.navigator.canvasWidth,this.navigator.canvasHeight,a),this.Invalidate()):this.MarkupState!==GLTFViewer.Utils.Markup.STATE_ENABLED||this.MarkupLineType!==GLTFViewer.Utils.Markup.LINE_TYPE_2D||this.MarkupSelect||this.Invalidate())}},ResetHit:{value:function(){this.handler&&
this.handler.ResetHit()}},CanSelect:{value:function(){return this.handler?this.handler.CanSelect():!1}},SetSelectionMode:{value:function(a){this.handler&&this.handler.SetSelectionMode(a)}},GetSelectionMode:{value:function(){return this.handler?this.handler.GetSelectionMode():GLTFViewer.SELECTION_BODY}},AnySelection:{value:function(){return this.handler?this.handler.AnySelection():!1}},UpdateSelection:{value:function(a,c){return this.handler?this.handler.UpdateSelection(a,c):!1}},ResetSelection:{value:function(){this.handler&&
this.handler.ResetSelection()&&this.Invalidate()}},GetTopParts:{value:function(){return this.handler?this.handler.GetTopParts():null}},GetPartName:{value:function(a){return this.handler?this.handler.GetPartName(a):null}},GetPartParent:{value:function(a){return this.handler?this.handler.GetPartParent(a):null}},GetPartParts:{value:function(a){return this.handler?this.handler.GetPartParts(a):null}},GetPartBodys:{value:function(a){return this.handler?this.handler.GetPartBodys(a):null}},GetBodyName:{value:function(a){return this.handler?
this.handler.GetBodyName(a):null}},GetRegions:{value:function(){return this.handler?this.handler.GetRegions():null}},GetRegionName:{value:function(a){return this.handler?this.handler.GetRegionName(a):null}},GetSelections:{value:function(){return this.handler?this.handler.GetSelections():null}},HasAnimation:{value:function(){return this._animateAllowed&&this.handler&&this.handler.HasAnimation()&&this.AnimationMaxTime()>=this.AnimationMinTime()}},AnimationSpeed:{value:function(a){0<a&&(this._animateSpeed=
a)}},AnimationMinTime:{value:function(){return this.handler?this.handler.AnimationMinTime():0}},AnimationMaxTime:{value:function(){return this.handler?this.handler.AnimationMaxTime():0}},AnimationShowFrame:{value:function(a){this._animateCurTime=a;this.viewer.SetAnimationSlider(a,this._animateUpdateSlider);this._animateUpdateSlider=!0;return this.handler&&this.handler.AnimationShowFrame(a)}},AnimationPlayOneFrame:{value:function(a,c){this.HasAnimation()&&this._animateCurTime!==a&&(this._animateOnce=
!0,this._animateUpdateSlider=c,this._animateCurTime=a)}},AnimationPlay:{value:function(){!this._animate&&this.HasAnimation()&&(this._animate=!0,this._animateLastClockTime=null)}},AnimationPause:{value:function(){this._animate=!1}},AnimationLoop:{get:function(){return this._animateLoop},set:function(a){this._animateLoop=a}},AnimationStop:{value:function(a){this.viewer&&this.viewer.animationDialog&&this.viewer.animationDialog.pauseButton&&this.viewer.animationDialog.pauseButton.click();this.AnimationPause();
a?(this.viewer.SetAnimationSlider(this.AnimationMinTime(),!0),this._animateCurTime=null):this.AnimationPlayOneFrame(this.AnimationMinTime(),!0)}},AnimationStopped:{value:function(){return GLTFViewer.Utils.IsNull(this._animateCurTime)||this._animateCurTime===this.AnimationMinTime()}},ResetScene:{value:function(a){this.AnimationStop(!0);this.navigator&&GLTFViewer.Utils.IsNull(a)&&this.navigator.Reset();this.handler&&this.handler.ResetScene(a)}},Reset:{value:function(){this.AnimationStop();this._animateLastClockTime=
null;this._animateUpdateSlider=this._animateOnce=this._animate=this._animateLoop=!1;this._animateCurTime=null;this.ResetProjection();this.ruler&&this.ruler.Reset();this.navigator&&this.navigator.Reset();this.handler&&(this.handler.Clear(),this.handler=null);this._enableUpdate=[];this.paintAll=this.paint=!0;this.depthPeel=!1;this.depthPeelPasses=20;this.depthPeelPass=0;this.background&&this.background.Reset();this.showFrameRate=!1;this.frameTimeLast=this.frameCountLast=this.frameTime=this.frameCount=
0;this.logoBlk&&this.logoBlk.Reset();this.logoWht&&this.logoWht.Reset()}},Clear:{value:function(){GLTFViewer.Utils.IsNull(this._intervalTimer)||(clearInterval(this._intervalTimer),this._intervalTimer=null);GLTFViewer.Utils.IsNull(this.requestAnimationID)||(cancelAnimationFrame(this.requestAnimationID),this.requestAnimationID=null);GLTFViewer.Utils.Scene.prototype.Reset.call(this);var a=this.gl;this.ruler&&(this.ruler.Clear(),this.ruler=null);this.navigator&&(this.navigator.Clear(),this.navigator=
null);this._enableUpdate=this.progress=this.overlay=this.container=this.gx=this.canvas=this.viewer=this.progressBar=null;a.bindBuffer(a.ARRAY_BUFFER,null);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);GLTFViewer.Utils.IsNull(this.g_frontColorBlenderDepthId)||(a.deleteRenderbuffer(this.g_frontColorBlenderDepthId),this.g_frontColorBlenderDepthId=null);GLTFViewer.Utils.IsNull(this.g_frontColorBlenderFboId)||(a.deleteFramebuffer(this.g_frontColorBlenderFboId),
this.g_frontColorBlenderFboId=null);GLTFViewer.Utils.IsNull(this.g_frontColorBlenderTexId)||(a.deleteTexture(this.g_frontColorBlenderTexId),this.g_frontColorBlenderTexId=null);for(var c=0;2>c;++c)GLTFViewer.Utils.IsNull(this.g_frontColorTexId)||a.deleteTexture(this.g_frontColorTexId[c]),GLTFViewer.Utils.IsNull(this.g_frontFboId)||a.deleteFramebuffer(this.g_frontFboId[c]);this.g_frontFboId=this.g_frontColorTexId=null;GLTFViewer.Utils.IsNull(this.g_frontDepthId)||(a.deleteRenderbuffer(this.g_frontDepthId),
this.g_frontDepthId=null);a.deleteTexture(this._screenTexture);this._screenTexture=null;a.deleteBuffer(this._screenQuadBuf);this._screenQuadBuf=null;null!==this.screenShader&&(this.screenShader.DeleteProgram(),this.screenShader=null);this.logoBlk&&(this.logoBlk.Clear(),this.logoBlk=null);this.logoWht&&(this.logoWht.Clear(),this.logoWht=null);this.background&&(this.background.Clear(),this.background=null);this.gl=this.view=this.defaultLightDirs=this.lights=this.uLit=this._screenQuadDat=null}}});
Object.defineProperties(GLTFViewer.Utils.Scene,{_vsScreen:{value:"uniform vec2 uSze;\nattribute vec2 aPos;\nattribute vec2 aTex;\nvarying vec2 vTex;\nvoid main() {\nvec2 tmp = aPos / uSze * 2.0 - 1.0;\nvTex = aTex;\ngl_Position = vec4(tmp, 0, 1);\n}"},_fsScreen:{value:"uniform sampler2D uSmp;\nvarying vec2 vTex;\nvoid main(void) {\ngl_FragColor = texture2D(uSmp, vTex);\n}"},Create:{value:function(a,c,d,e,f){var g=null;(g=d.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}))||(g=d.getContext("experimental-webgl",
{antialias:!0,preserveDrawingBuffer:!0}));if(g&&!g.getExtension("OES_texture_float"))throw Error("ERROR(Scene.Create): No support for OES_texture_float");if(!g)throw Error("ERROR(Scene.Create): No WebGL Support");var k=e.getContext("2d");return new GLTFViewer.Utils.Scene(a,c,d,e,g,k,f)}}});GLTFViewer.Utils.Scene.ProgressBar=function(a,c){this._progressBar=a;this._container=c};
GLTFViewer.Utils.Scene.ProgressBar.prototype=Object.create(null,{_totalBytes:{writable:!0,value:0},Start:{value:function(a){this._totalBytes=a;this._progressBar.value=0;this._progressBar.style.visibility="visible";this._container.style.cursor="wait"}},Update:{value:function(a){this._totalBytes&&(this._progressBar.value=a/this._totalBytes)}},Stop:{value:function(){this._totalBytes=0;this._progressBar.value=0;this._progressBar.style.visibility="hidden";this._container.style.cursor="default"}}});GLTFViewer.Utils.Navigator=function(a,c,d){this._scene=a;this._container=c;this._type=GLTFViewer.Utils.Navigator.NavNone;this._defaultProjectionTM=d;this.projectionTM=d.Clone();this._navPtrs={};this._navPtrs[GLTFViewer.Utils.Navigator.NavPan]=new GLTFViewer.Utils.Navigator.Pan(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavZoom]=new GLTFViewer.Utils.Navigator.Zoom(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavSpinXY]=new GLTFViewer.Utils.Navigator.SpinXY(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavSpinZ]=
new GLTFViewer.Utils.Navigator.SpinZ(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavPinchRotate]=new GLTFViewer.Utils.Navigator.PinchRotate(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavPinchZoom]=new GLTFViewer.Utils.Navigator.PinchZoom(this);this._navPtrs[GLTFViewer.Utils.Navigator.NavZoomBox]=new GLTFViewer.Utils.Navigator.ZoomBox(this);this._navTypes=Object.keys(this._navPtrs);this._cameraPos=new GLTFViewer.Utils.Vec3(0,0,3);this._nearPlane=1;this._farPlane=20;this._cameraUp=new GLTFViewer.Utils.Direction(0,
1,0);this.cameraTM=GLTFViewer.Utils.Transformation.lookAtRH(this._cameraPos,GLTFViewer.Utils.Vec3.Origin,this._cameraUp);this.persp=!1;this._animProjTranslation=new GLTFViewer.Utils.Vec3;this._animProjAxis=new GLTFViewer.Utils.Direction;this._touches=new GLTFViewer.Utils.Touch.List;this.keysDown={};try{this._spinMarker=new GLTFViewer.Utils.Navigator.SpinMarker(a.gl)}catch(e){}try{this._triad=new GLTFViewer.Utils.Navigator.Triad(this,a.gl)}catch(e){}this._zoomBoxMarker=new GLTFViewer.Utils.Navigator.ZoomBoxMarker(this,
a.gx);this._moveTolerance2=(this._isMobile=a.viewer.mobile)?64:9;this._cursorRay=new GLTFViewer.Utils.CursorRay(this);this._clipPlaneMoveDir=new GLTFViewer.Utils.Direction;this.uEye=new Float32Array(3);this.uTVP=new Float32Array(16);this.uTVPOrtho=new Float32Array(16);this._touchHandler=new GLTFViewer.Utils.TouchHandler(this._scene.viewer,$(this._container),this._ContainerStart.bind(this),this._ContainerMove.bind(this),this._ContainerFinish.bind(this),this._ContainerWheel.bind(this),this._ContainerOver.bind(this),
this._ContainerOut.bind(this),this._ContainerBlur.bind(this),this._scene.viewer.ContainerContextMenu.bind(this._scene.viewer),this._debugTouch);this._container.addEventListener("keydown",this._KeyDown.bind(this),!1);this._container.addEventListener("keyup",this._KeyUp.bind(this),!1);this._container.__EKM__="EKM";this._scene.viewer.messageHandler.AddListener("Transform",this._Synchronize.bind(this,"READ"))};
GLTFViewer.Utils.Navigator.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Navigator},_deleting:{writable:!0,value:!1},_debugTouch:{value:!1},_clipPlaneOriginX:{writable:!0,value:0},_clipPlaneOriginY:{writable:!0,value:0},_clipPlaneOriginZ:{writable:!0,value:0},_clipPlaneMoveDir:{writable:!0,value:null},_scene:{writable:!0,value:null},_container:{writable:!0,value:null},_spinMarker:{writable:!0,value:null},_triad:{writable:!0,value:null},_zoomBoxMarker:{writable:!0,value:null},_isMobile:{writable:!0,
value:!1},_moveTolerance2:{writable:!0,value:9},_type:{writable:!0,value:null},_navPtrs:{writable:!0,value:null},_navTypes:{writable:!0,value:null},canvasWidth:{writable:!0,value:0},canvasHeight:{writable:!0,value:0},_normalizedWidth:{writable:!0,value:1},_normalizedHeight:{writable:!0,value:1},_cameraUp:{writable:!0,value:null},_cameraPos:{writable:!0,value:null},_nearPlane:{writable:!0,value:1},_farPlane:{writable:!0,value:20},_defaultProjectionTM:{writable:!0,value:null},_projectionTM:{writable:!0,
value:null},_modelViewTM:{writable:!0,value:null},_transViewProjTM:{writable:!0,value:null},_transViewProjOrthoTM:{writable:!0,value:null},_worldScale:{writable:!0,value:1},_animProjStart:{writable:!0,value:null},_animProjEnd:{writable:!0,value:null},_animProjCenter:{writable:!0,value:null},_animProjTranslation:{writable:!0,value:null},_animProjAxis:{writable:!0,value:null},_animProjAngle:{writable:!0,value:0},_animProjEndScale:{writable:!0,value:0},_animProjStep:{writable:!0,value:0},_animProjStepCount:{writable:!0,
value:0},_touches:{writable:!0,value:null},_contextOK:{writable:!0,value:!0},_lastLocation:{writable:!0,value:null},_lastState:{writable:!0,value:null},ps:{writable:!0,value:0},persp:{writable:!0,value:!1},cameraTM:{writable:!0,value:null},projectionGLTM:{writable:!0,value:null},projection2DGLTM:{writable:!0,value:null},modelViewInvTrp:{writable:!0,value:null},transViewProjInvTM:{writable:!0,value:null},transViewProjOrthoInvTM:{writable:!0,value:null},projectionInvTM:{writable:!0,value:null},uEye:{writable:!0,
value:null},uTVP:{writable:!0,value:null},uTVPOrtho:{writable:!0,value:null},mouseOver:{writable:!0,value:!1},keysDown:{writable:!0,value:null},_ProcessStartEnd:{value:function(a,c,d){var e=this._touchHandler.Touches.Count();d=GLTFViewer.Utils.Navigator.NavNone;if(1===e)if(this._isMobile)d=GLTFViewer.Utils.Navigator.NavSpinXY;else{var e=this._touchHandler.Touches.GetTouchByIndex(0),e=this._debugTouch?1:e.GetID(),f="";c&&(f=f+(f.length?"+":"")+"CTRL");a&&(f=f+(f.length?"+":"")+"SHIFT");f=f+(f.length?
"+":"")+(2===e?"RIGHT":4===e?"MIDDLE":"LEFT");switch(this._scene.viewer.viewerState[f]){case "Zoom":d=GLTFViewer.Utils.Navigator.NavZoom;break;case "RotateXY":d=GLTFViewer.Utils.Navigator.NavSpinXY;break;case "RotateZ":d=GLTFViewer.Utils.Navigator.NavSpinZ;break;case "PanXY":d=GLTFViewer.Utils.Navigator.NavPan;break;case "ZoomBox":d=GLTFViewer.Utils.Navigator.NavZoomBox;default:case "None":}}else 1<e&&(d=GLTFViewer.Utils.Navigator.NavPan|GLTFViewer.Utils.Navigator.NavPinchZoom|GLTFViewer.Utils.Navigator.NavPinchRotate);
for(a=0;a<this._navTypes.length;++a)0!==(this._type&this._navTypes[a])&&0===(d&this._navTypes[a])?(this._navPtrs[this._navTypes[a]].MouseUp(),this._type&=~this._navTypes[a]):0===(this._type&this._navTypes[a])&&0!==(d&this._navTypes[a])&&(this._navPtrs[this._navTypes[a]].MouseDown(this._touchHandler.Touches),this._type|=this._navTypes[a])}},_KeyDown:{value:function(a){if(!this._deleting){this.keysDown[a.keyCode]=!0;if(this.keysDown[27])this._scene.viewer.CloseContextMenus();else if(this.keysDown[16]||
this.keysDown[17]||!this.keysDown[46])if(this.keysDown[16]&&!this.keysDown[17]&&this.keysDown[68])this._scene.depthPeel=!this._scene.depthPeel,this._scene.Invalidate(!0);else if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[107])if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[109])if(this.keysDown[16]&&!this.keysDown[17]&&this.keysDown[70])this._scene.showFrameRate=!this._scene.showFrameRate;else if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[70])if(this.keysDown[16]||this.keysDown[17]||
!this.keysDown[80])if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[82])if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[73])if(this.keysDown[16]&&!this.keysDown[17]&&this.keysDown[88])this._scene.SetView(4);else if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[88])if(this.keysDown[16]&&!this.keysDown[17]&&this.keysDown[89])this._scene.SetView(6);else if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[89])if(this.keysDown[16]&&!this.keysDown[17]&&this.keysDown[90])this._scene.SetView(3);
else if(this.keysDown[16]||this.keysDown[17]||!this.keysDown[90])if(this.keysDown[37]||this.keysDown[38]||this.keysDown[39]||this.keysDown[40]){a=.08726646259971647*(this.keysDown[16]?.2:1);var c=GLTFViewer.Utils.Vec3.Origin;this._scene.GetSceneBox().GetCenter(c);!this.keysDown[17]&&this.keysDown[37]?this.SceneRotate(new GLTFViewer.Utils.Direction(0,-1,0),a,c):!this.keysDown[17]&&this.keysDown[38]?this.SceneRotate(new GLTFViewer.Utils.Direction(-1,0,0),a,c):!this.keysDown[17]&&this.keysDown[39]?this.SceneRotate(new GLTFViewer.Utils.Direction(0,
1,0),a,c):!this.keysDown[17]&&this.keysDown[40]?this.SceneRotate(new GLTFViewer.Utils.Direction(1,0,0),a,c):this.keysDown[17]&&this.keysDown[38]?this.SceneRotate(new GLTFViewer.Utils.Direction(0,0,-1),a,c):this.keysDown[17]&&this.keysDown[40]&&this.SceneRotate(new GLTFViewer.Utils.Direction(0,0,1),a,c)}else this.keysDown[16]||this.keysDown[17]||!this.keysDown[77]||(a=GLTFViewer.Utils.GetMemoryUsage())&&GLTFViewer.Utils.WriteLn("Memory: rss: "+a.rss/1024+"   heapTotal: "+a.heapTotal/1024+"   heapUsed: "+
a.heapUsed/1024);else this._scene.SetView(2);else this._scene.SetView(7);else this._scene.SetView(5);else this._scene.SetView(0);else this._scene.ResetScene();else this._scene.viewer.SaveImage();else this.ZoomExtents(!0);else 1>--this._scene.depthPeelPasses&&(this._scene.depthPeelPasses=1),this._scene.Invalidate(!0);else++this._scene.depthPeelPasses,this._scene.Invalidate(!0);else this._scene.MarkupDelete();this._scene.Invalidate()}}},_KeyUp:{value:function(a){this._deleting||(delete this.keysDown[a.keyCode],
this._scene.Invalidate())}},_ProcessMove:{value:function(){if(!this._deleting)for(var a=0;a<this._navTypes.length;++a)0!==(this._type&this._navTypes[a])&&this._navPtrs[this._navTypes[a]].MouseMove(this._touchHandler.Touches)}},_ProcessUpdate:{value:function(){if(!this._deleting)for(var a=0;a<this._navTypes.length;++a)0!==(this._type&this._navTypes[a])&&this._navPtrs[this._navTypes[a]].UpdateMouseDown(this._touchHandler.Touches)}},_WorldToScreen:{value:function(a){return(this.persp?GLTFViewer.Utils.Transformation.perspectiveRH(this._normalizedWidth,
this._normalizedHeight,this._nearPlane,this._farPlane):GLTFViewer.Utils.Transformation.orthoRH(this._normalizedWidth,this._normalizedHeight,this._nearPlane,this._farPlane)).Multiply(this.cameraTM).Multiply(a)}},_UnprojectRay2:{value:function(a,c,d){var e=a.Clone().Add(c);this.UnProject(a,d);this.UnProject(e,d);a=GLTFViewer.Utils.Vec3.Create(a,e).GetDirection();c.x=a.x;c.y=a.y;c.z=a.z}},_ContainerBlur:{value:function(a){this.keysDown={}}},_ContainerOver:{value:function(a){this.mouseOver=!0;this._scene.Invalidate()}},
_ContainerOut:{value:function(a){this.mouseOver=!1;this._scene.ResetHit()}},_ContainerWheel:{value:function(a,c,d){if(!this._scene.IsEmpty()&&"Zoom"===this._scene.viewer.viewerState[GLTFViewer.MOUSEBUTTONS[0]]){a=1.2;0<d&&(a=1/a);d=new GLTFViewer.Utils.Vec3(c.x,c.y,0);this.UnProject(d);var e=this.projectionTM.a33/a;1E-5>=e?a=this.projectionTM.a33/1E-5:1E5<=e&&(a=this.projectionTM.a33/1E5);this.SetProjection(GLTFViewer.Utils.Transformation.MultiplyCreate(this.projectionTM,GLTFViewer.Utils.Transformation.ScaleCreate(a)),
!1);c=new GLTFViewer.Utils.Vec3(c.x,c.y,0);this.UnProject(c);this.SetProjection(GLTFViewer.Utils.Transformation.MultiplyCreate(this.projectionTM,GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(d,c))),!1)}}},_ContainerStart:{value:function(a){var c=this._scene;c.viewer.CloseContextMenus();this._isMobile||c.viewer.MenuFade(!0);var d=this._touchHandler.Touches.Count();this._lastLocation=this._touchHandler.Touches.GetLastLocation();var e=this._lastLocation.x,f=this._lastLocation.y;
this._cursorRay.Update(e,f);this._contextOK=!c.MarkupHit;if(1===d){if(c.ClipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_MOVE){a=new GLTFViewer.Utils.Vec3;this._cursorRay.Update(e,f);c.handler._clip.clipPlane.GetPoint(this._cursorRay.ray,a)&&(this._clipPlaneOriginX=c.handler._clip.clipPlane.orgn.x,this._clipPlaneOriginY=c.handler._clip.clipPlane.orgn.y,this._clipPlaneOriginZ=c.handler._clip.clipPlane.orgn.z,a=c.handler._clip.clipPlane.orgn.Clone(),this.Project(a),e=a.x,f=a.y,a.x=this._clipPlaneOriginX+
c.handler._clip.clipPlane.diz.x*this.ps,a.y=this._clipPlaneOriginY+c.handler._clip.clipPlane.diz.y*this.ps,a.z=this._clipPlaneOriginZ+c.handler._clip.clipPlane.diz.z*this.ps,this.Project(a),this._clipPlaneMoveDir.Set(a.x-e,a.y-f,0),c.handler._clip.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_MOVING);return}c.UpdateHit(this._cursorRay,!0)}this._ProcessStartEnd(a.shiftKey,a.ctrlKey,a.altKey)}},_ContainerMove:{value:function(a){var c=this._scene,d=this._touchHandler.Touches.Count();this._lastLocation=
d?this._touchHandler.Touches.GetLastLocation():GLTFViewer.Utils.GetClientXY(this._container,a);var e=this._lastLocation.x,f=this._lastLocation.y,g=a.shiftKey,k=a.ctrlKey;a=a.altKey;var h=this._touchHandler.Touches.GetDistanceMoved2()>=this._moveTolerance2||100<this._touchHandler.Touches.GetElapsedTime()&&0<this._touchHandler.Touches.GetDistanceMoved2();this._cursorRay.Update(e,f);1<=d&&this._touchHandler.Touches.GetDistanceMoved2()>=this._moveTolerance2&&(this._contextOK=!1);if(0===d)c.ClipDrawMode===
GLTFViewer.Utils.Clip.DRAWMODE_MOVE?c.Invalidate():c.UpdateHit(this._cursorRay,c.MarkupState!==GLTFViewer.Utils.Markup.STATE_DISABLED);else if(c.ClipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_MOVING)d=this._touchHandler.Touches.GetStartDelta(1),d=this._clipPlaneMoveDir.GetComponent(new GLTFViewer.Utils.Vec3(d.x,d.y,0)),e=d.GetMagnitude(),e*=this.ps,0>this._clipPlaneMoveDir.Dot(new GLTFViewer.Utils.Vec3(d.x,d.y,0))&&(e=-e),c.handler._clip.clipPlane.orgn.x=this._clipPlaneOriginX+c.handler._clip.clipPlane.diz.x*
e,c.handler._clip.clipPlane.orgn.y=this._clipPlaneOriginY+c.handler._clip.clipPlane.diz.y*e,c.handler._clip.clipPlane.orgn.z=this._clipPlaneOriginZ+c.handler._clip.clipPlane.diz.z*e,c.handler._clip.UpdateClip(),c.Invalidate(!0);else{if(1===d){c.MarkupState===GLTFViewer.Utils.Markup.STATE_ENABLED&&h&&(g||k||c.MarkupStart(e,f),c.MarkupState===GLTFViewer.Utils.Markup.STATE_CREATE_LINE&&this._touchHandler.StopLongTouch());if(c.MarkupState===GLTFViewer.Utils.Markup.STATE_CREATE_LINE||c.MarkupState===GLTFViewer.Utils.Markup.STATE_EDIT_MOVE){c.MarkupUpdate(e,
f);return}if(c.MarkupState!==GLTFViewer.Utils.Markup.STATE_DISABLED)return}this._ProcessStartEnd(g,k,a);1<d||h?this._ProcessMove():this._ProcessUpdate()}}},_ContainerFinish:{value:function(a,c,d){var e=this._scene,f=this._touchHandler.Touches.Count(),g=this._lastLocation.x,k=this._lastLocation.y,h=a.shiftKey,l=a.ctrlKey;a=a.altKey;c=c&&0<c.length&&c[0].GetDistanceMoved2()<this._moveTolerance2;this._cursorRay.Update(g,k);this._type!==GLTFViewer.Utils.Navigator.NavNone&&this._ProcessStartEnd(h,l,a);
if(0===f)if(e.ClipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_MOVING)e.handler._clip.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_MOVE,e.Invalidate();else if(c&&e.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW)e.UpdateHit(this._cursorRay,!0),e.handler._clip.clipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_1_PT?e.handler._clip.SetClipPoint(e.handler.GetClipPlane()):e.handler._clip.SetClipPoint(e.HitPoint()),e.Invalidate(!0);else if(e.MarkupHit&&(this._contextOK=!1),e.MarkupState===GLTFViewer.Utils.Markup.STATE_CREATE_LINE||
e.MarkupState===GLTFViewer.Utils.Markup.STATE_EDIT_MOVE)e.MarkupEnd(g,k);else{if(c&&!d){if(e.MarkupState!==GLTFViewer.Utils.Markup.STATE_DISABLED){h||l||(e.UpdateHit(this._cursorRay,!1),e.UpdateSelection(l,a)?e.Invalidate():(e.MarkupStart(g,k),e.MarkupEnd(g,k)));return}e.UpdateHit(this._cursorRay,!1);e.UpdateSelection(l,a)}e.Invalidate(!0)}}},_GetPixelSize:{value:function(){var a=this.canvasWidth/2,c=this.canvasHeight/2,d=new GLTFViewer.Utils.Vec3(a,c,0),a=new GLTFViewer.Utils.Vec3(a+1,c,0);this.UnProject(d);
this.UnProject(a);return GLTFViewer.Utils.Vec3.Create(d,a).GetMagnitude()}},active:{get:function(){return this._touchHandler.TouchActive}},lastLocation:{get:function(){return this._lastLocation?this._lastLocation:null}},state:{get:function(){var a={};a.projectionTM=this.projectionTM.Clone();a.worldScale=this._worldScale;a.persp=this.persp;return a},set:function(a){this.projectionTM=a.projectionTM.Clone();this._worldScale=a.worldScale;this.persp=a.persp;this.SetProjection(this.projectionTM,!1)}},ClearKeys:{value:function(){this.keysDown=
{}}},OkToShowContextMenu:{value:function(){return this._contextOK&&0===this._touchHandler.Touches.Count()}},SetSize:{value:function(a,c){this.canvasWidth=a;this.canvasHeight=c;this._normalizedWidth=a<c?1:a/c;this._normalizedHeight=c<a?1:c/a;this.SetCamera2()}},Reset:{value:function(){this._touchHandler.StopLongTouch();this._spinMarker&&this._spinMarker.Reset();this._triad&&this._triad.Reset();this._zoomBoxMarker&&this._zoomBoxMarker.Reset();this._type=GLTFViewer.Utils.Navigator.NavNone;for(var a=
0;a<this._navTypes.length;++a)this._navPtrs[this._navTypes[a]].Reset();this.projectionTM=this._defaultProjectionTM.Clone();this._worldScale=1;this.ps=this._animProjStepCount=this._animProjStep=0;this.lastState=null;this.persp=!1}},Clear:{value:function(){this._deleting=!0;GLTFViewer.Utils.Navigator.prototype.Reset.call(this);this._spinMarker&&(this._spinMarker.Clear(),this._spinMarker=null);this._triad&&(this._triad.Clear(),this._triad=null);this._zoomBoxMarker&&(this._zoomBoxMarker.Clear(),this._zoomBoxMarker=
null);this._touches&&(this._touches.Clear(),this._touches=null);for(var a=0;a<this._navTypes.length;++a)this._navPtrs[this._navTypes[a]].Clear(),this._navPtrs[this._navTypes[a]]=null;this._scene=this._clipPlaneMoveDir=this._cursorRay=this._lastState=this._lastLocation=this._animProjAxis=this._animProjTranslation=this._animProjCenter=this._animProjEnd=this._animProjStart=this.uTVPOrtho=this.uTVP=this.uEye=this.transViewProjOrthoInvTM=this.transViewProjInvTM=this._transViewProjTM=this.modelViewInvTrp=
this._modelViewTM=this._projectionTM=this._defaultProjectionTM=this.projection2DGLTM=this.projectionGLTM=this.cameraTM=this._cameraUp=this._cameraPos=this._navTypes=this._type=this._container=this.keysDown=this._navPtrs=null}},StartRender:{value:function(){if(!this._deleting){this.ps=this._GetPixelSize();var a=new GLTFViewer.Utils.Vec3(0,0,-100);this.UnProject(a);a.ToArray(this.uEye,0);this.transViewProjTM.ToArray(this.uTVP);this.persp&&this.transViewProjOrthoTM.ToArray(this.uTVPOrtho)}}},Render3D:{value:function(a){if(!this._deleting&&
this._spinMarker)if(this.persp){var c=null;if(this.IsType(GLTFViewer.Utils.Navigator.NavSpinXY)||this.IsType(GLTFViewer.Utils.Navigator.NavSpinZ)||this.IsType(GLTFViewer.Utils.Navigator.NavZoom))c=this._navPtrs[this._type].GetCenter().Clone();c&&(this.Project(c),this.UnProject(c,this.transViewProjOrthoInvTM),this._spinMarker.Render(this.uTVPOrtho,this.uEye,a,this.ps,this.canvasWidth,this.canvasHeight,c))}else(this.IsType(GLTFViewer.Utils.Navigator.NavSpinXY)||this.IsType(GLTFViewer.Utils.Navigator.NavSpinZ)||
this.IsType(GLTFViewer.Utils.Navigator.NavZoom))&&this._spinMarker.Render(this.uTVP,this.uEye,a,this.ps,this.canvasWidth,this.canvasHeight,this._navPtrs[this._type].GetCenter())}},Render2D:{value:function(){if(!this._deleting&&(this._triad&&!this._scene.viewer._option.tn&&this._triad.Render(this.canvasWidth,this.canvasHeight),this._zoomBoxMarker&&this.IsType(GLTFViewer.Utils.Navigator.NavZoomBox))){var a=this._navPtrs[GLTFViewer.Utils.Navigator.NavZoomBox].GetLoc();this._zoomBoxMarker.Render(a[0],
a[1],a[2],a[3])}}},zoom:{get:function(){return this.projectionTM.a33/this._worldScale}},projectionTM:{get:function(){return this._projectionTM},set:function(a){this._projectionTM=a;this.projectionInvTM=this._projectionTM.Clone().Invert()}},modelViewTM:{get:function(){return this._modelViewTM},set:function(a){this._modelViewTM=a;this.modelViewInvTrp=this._modelViewTM.Clone().Invert().Transpose()}},transViewProjTM:{get:function(){return this._transViewProjTM},set:function(a){this._transViewProjTM=a;
this.transViewProjInvTM=this._transViewProjTM.Clone().Invert()}},transViewProjOrthoTM:{get:function(){return this._transViewProjOrthoTM},set:function(a){this._transViewProjOrthoTM=a;this.transViewProjOrthoInvTM=this._transViewProjOrthoTM.Clone().Invert()}},IsType:{value:function(a){return 0!==(this._type&a)||this._type===a}},ZoomExtents:{value:function(a,c){var d=this._scene.GetSceneBox();GLTFViewer.Utils.IsNull(c)&&(c=this.projectionTM);if(!d.IsSane()||d.IsEmpty()||0===this.canvasHeight||0===this.canvasWidth)return c;
var e=c.Clone();e.a33=this._worldScale;var f=d.Clone().Multiply(e),e=GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(f.GetCenter(),GLTFViewer.Utils.Vec3.Origin)).Multiply(e),g=new GLTFViewer.Utils.Vec3(GLTFViewer.Utils.maxValue,GLTFViewer.Utils.maxValue,0),k=new GLTFViewer.Utils.Vec3(-GLTFViewer.Utils.maxValue,-GLTFViewer.Utils.maxValue,0),h=this._WorldToScreen(e),f=h.Clone().Invert(),l=d.GetCenter();this.Project(l,h);for(var d=d.GetCorners(),m=d.length-1;0<=m;m--){var n=
d[m];this.Project(n,h);g.x=Math.min(n.x,g.x);g.y=Math.min(n.y,g.y);k.x=Math.max(n.x,k.x);k.y=Math.max(n.y,k.y)}h=k.x-g.x;d=k.y-g.y;k=1;GLTFViewer.Utils.IslengthZero(h)||GLTFViewer.Utils.IslengthZero(d)||(k=this.canvasHeight,m=this.canvasWidth,h>d?k>m?(k=m,m=h):d/h<k/m?(k=m,m=h):m=d:m>k?m=d:h/d<m/k?m=d:(k=m,m=h),k/=m);h=h/2-(l.x-g.x);d=d/2-(l.y-g.y);g=new GLTFViewer.Utils.Vec3(this.canvasWidth/2,this.canvasHeight/2,0);l=GLTFViewer.Utils.Direction.diz;this._UnprojectRay2(g,l,f);l=new GLTFViewer.Utils.Line(g,
l);h=new GLTFViewer.Utils.Vec3(this.canvasWidth/2-h,this.canvasHeight/2-d,0);d=GLTFViewer.Utils.Direction.diz;this._UnprojectRay2(h,d,f);f=new GLTFViewer.Utils.Line(h,d);d=new GLTFViewer.Utils.Plane(GLTFViewer.Utils.Vec3.Origin,e.Clone().Invert().GetZDirection());d.GetPoint(l,g);d.GetPoint(f,h);e.Multiply(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(g,h)));e.a33/=.9*k;this.SetProjection(e,a)}},ZoomView:{value:function(a,c,d,e,f){var g=f.a33/a;1E-5>=g?a=f.a33/1E-5:
1E5<=g&&(a=f.a33/1E5);this.SetProjection(GLTFViewer.Utils.Transformation.MultiplyCreate(f,GLTFViewer.Utils.Transformation.ScaleCreate(a)),!1);a=new GLTFViewer.Utils.Vec3(c,d,0);this.UnProject(a);e=GLTFViewer.Utils.Transformation.MultiplyCreate(this.projectionTM,GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(e,a)));this.SetProjection(e,!1)}},_Synchronize:{value:function(a,c,d,e){"READ"===a?c!==this._scene.viewer.viewportNumber&&(this.state=e):this._scene.viewer.viewportLock&&
this._scene.viewer.IsVisible()&&(GLTFViewer.Utils.IsNull(this._lastState)||!this._lastState.projectionTM.IsEqual(this.projectionTM)||this._lastState.worldScale!==this._worldScale||this._lastState.persp!==this.persp)&&(this._lastState=this.state,this._scene.viewer.messageHandler.SendMessage("Transform",this.state))}},SetCamera2:{value:function(){this.modelViewTM=this.projectionTM.Clone();this.modelViewTM.a33=1;var a=1/this._worldScale,a=this.cameraTM.Clone().Multiply(new GLTFViewer.Utils.Transformation(a,
0,0,0,0,a,0,0,0,0,a,0,0,0,0,1));this.persp?(this.projectionGLTM=GLTFViewer.Utils.Transformation.perspectiveRH(this._normalizedWidth*this.zoom,this._normalizedHeight*this.zoom,this._nearPlane,this._farPlane).Multiply(a),a=GLTFViewer.Utils.Transformation.orthoRH(this._normalizedWidth*this.zoom,this._normalizedHeight*this.zoom,this._nearPlane,this._farPlane).Multiply(a),this.transViewProjOrthoTM=GLTFViewer.Utils.Transformation.MultiplyCreate(a,this.modelViewTM)):this.projectionGLTM=GLTFViewer.Utils.Transformation.orthoRH(this._normalizedWidth*
this.zoom,this._normalizedHeight*this.zoom,this._nearPlane,this._farPlane).Multiply(a);this.projection2DGLTM=GLTFViewer.Utils.Transformation.orthoRH(2*this._normalizedWidth,2*this._normalizedHeight,this._nearPlane,this._farPlane);this.transViewProjTM=GLTFViewer.Utils.Transformation.MultiplyCreate(this.projectionGLTM,this.modelViewTM);this._Synchronize()}},SetCamera:{value:function(a){this.persp=a}},SetProjection:{value:function(a,c){var d=this._scene;if(c){if(!this.StartAnimProj(a,d.GetSceneBox().GetCenter()))return!1}else this.projectionTM=
a.CreateWellFormed(),this.SetCamera2(),d.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE&&d.handler._clip.UpdateClip();d.Invalidate(!0);return!0}},UpdateWorldScale:{value:function(a){var c=1;GLTFViewer.Utils.IsNull(a)||a.IsEmpty()||(c=a.GetDiameter());this._worldScale!=c&&(this._worldScale=c,this.ZoomExtents(!1))}},Project:{value:function(a,c){a.Transform(GLTFViewer.Utils.IsNull(c)?this.transViewProjTM:c);a.x=(1+a.x)*this.canvasWidth/2;a.y=(1-a.y)*this.canvasHeight/2}},UnProject:{value:function(a,
c){a.x=2*a.x/this.canvasWidth-1;a.y=1-2*a.y/this.canvasHeight;GLTFViewer.Utils.IsNull(c)?GLTFViewer.Utils.IsNull(this.transViewProjInvTM)||a.Transform(this.transViewProjInvTM):a.Transform(c)}},StartAnimProj:{value:function(a,c){this._animProjStart=this.projectionTM;this._animProjEnd=a;this._animProjCenter=c;var d=c.TransformCreate(this._animProjStart),e=c.TransformCreate(this._animProjEnd);this._animProjTranslation.Set(e.x-d.x,e.y-d.y,e.z-d.z);e=this._animProjStart.Clone().Invert();e.Multiply(a);
e.IsWellFormed()||(e=e.CreateWellFormed());this._animProjAngle=e.TryGetRotation(this._animProjAxis);this._animProjAngle>Math.PI&&(this._animProjAngle=-(2*Math.PI-this._animProjAngle));d=e.GetScale();e=e.GetTranslation().GetMagnitude();if(.01>Math.abs(this._animProjAngle)&&GLTFViewer.Utils.WithinTolerance(d,1,.01)&&e<10*GLTFViewer.Utils.fitAccuracy)return!1;this._animProjEndScale=this._animProjEnd.GetScale()/this._animProjStart.GetScale();d=Math.max(8,Math.max(Math.max(1+Math.round(Math.abs(Math.log(d))/
.05),1+Math.round(Math.abs(this._animProjAngle)/.12)),1+Math.round(Math.abs(e)/.07)));d=Math.min(30,d);0==d&&(d=1);this._animProjStep=this._animProjStepCount=d;return!0}},UpdateAnimProjStep:{value:function(){if(!(0>=this._animProjStep)){this._animProjStep--;var a=null,a=1-this._animProjStep*this._animProjStep/(this._animProjStepCount*this._animProjStepCount);if(1==a)a=this._animProjEnd;else{var c=this._animProjAngle*a,d=1-a+this._animProjEndScale*a,a=GLTFViewer.Utils.Transformation.TranslationCreate(this._animProjTranslation.x*
a,this._animProjTranslation.y*a,this._animProjTranslation.z*a),a=GLTFViewer.Utils.Transformation.MultiplyCreate(a,this._animProjStart),c=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(this._animProjCenter,this._animProjAxis),c);a.Multiply(c);d=GLTFViewer.Utils.Transformation.ScaleAboutPointCreate(d,this._animProjCenter.x,this._animProjCenter.y,this._animProjCenter.z);a.Multiply(d);a.IsWellFormed()||(a=a.CreateWellFormed())}this.SetProjection(a,!1)}}},SceneRotate:{value:function(a,
c,d){var e=this._scene;a=a.TransformCreate(this.projectionInvTM);c=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(d,a.GetDirection()),c);c=GLTFViewer.Utils.Transformation.MultiplyCreate(this.projectionTM,c);c.IsWellFormed()||(c=c.CreateWellFormed());e=e.GetSceneBox().Clone().Multiply(c);c=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(new GLTFViewer.Utils.Vec3(0,0,e.GetCenter().z),GLTFViewer.Utils.Vec3.Origin)),
c);this.SetProjection(c,!1)}}});Object.defineProperties(GLTFViewer.Utils.Navigator,{NavNone:{value:0},NavZoom:{value:1},NavSpinXY:{value:2},NavSpinZ:{value:4},NavPan:{value:8},NavPinchRotate:{value:16},NavPinchZoom:{value:32},NavZoomBox:{value:64}});GLTFViewer.Utils.Navigator.NavigatorBaseClass=function(a){this._navigator=a};
GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.Navigator.NavigatorBaseClass},_navigator:{writable:!0,value:null},_ctr:{writable:!0,value:null},GetCenter:{value:function(){return this._ctr?this._ctr:this._navigator._scene.GetSceneBox().GetCenter()}},MouseDown:{value:function(a){this.UpdateMouseDown(a)}},UpdateMouseDown:{value:function(a){}},MouseMove:{value:function(a){}},MouseUp:{value:function(){}},Reset:{value:function(){}},Clear:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this);
this._ctr=this._navigator=null}}});GLTFViewer.Utils.Navigator.PinchRotate=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a);this._lastDir=new GLTFViewer.Utils.Direction};
GLTFViewer.Utils.Navigator.PinchRotate.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.PinchRotate},_lastDir:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.PinchRotate.prototype.Reset.call(this);this._lastDir=null;GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},UpdateMouseDown:{value:function(a){var c=
a.GetTouchByIndex(0).GetLastLocation();a=a.GetTouchByIndex(1).GetLastLocation();this._lastDir.Set(a.x-c.x,a.y-c.y,0)}},MouseMove:{value:function(a){var c=this._navigator,d=c._scene,e=a.GetTouchByIndex(0).GetLastLocation(),f=a.GetTouchByIndex(1).GetLastLocation(),e=new GLTFViewer.Utils.Direction(f.x-e.x,f.y-e.y,0);if(f=Math.atan2(e.y,e.x)-Math.atan2(this._lastDir.y,this._lastDir.x)){var g=a.GetLastLocation(2);a=new GLTFViewer.Utils.Vec3(g.x,g.y,0);c.UnProject(a);g=new GLTFViewer.Utils.Vec3(g.x,g.y,
1);c.UnProject(g);g=new GLTFViewer.Utils.Direction(g.x-a.x,g.y-a.y,g.z-a.z);f=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(a,g),f);f=GLTFViewer.Utils.Transformation.MultiplyCreate(c.projectionTM,f);f.IsWellFormed()||(f=f.CreateWellFormed());d=d.GetSceneBox().Clone().Multiply(f);f=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(new GLTFViewer.Utils.Vec3(0,0,d.GetCenter().z),GLTFViewer.Utils.Vec3.Origin)),
f);c.SetProjection(f,!1)}this._lastDir.Set(e.x,e.y,e.z)}}});GLTFViewer.Utils.Navigator.PinchZoom=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a)};
GLTFViewer.Utils.Navigator.PinchZoom.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.PinchZoom},_lastSep:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.PinchZoom.prototype.Reset.call(this);GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},UpdateMouseDown:{value:function(a){this._lastSep=
a.GetLastSeparation(2)}},MouseMove:{value:function(a){var c=this._navigator,d=a.GetLastSeparation(2),e=d-this._lastSep;a=a.GetLastLocation(2);var f=new GLTFViewer.Utils.Vec3(a.x,a.y,0);c.UnProject(f);c.ZoomView(Math.exp(e/160),a.x,a.y,f,c.projectionTM);this._lastSep=d}}});
GLTFViewer.Utils.Navigator.Pan=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a);this._ctr=GLTFViewer.Utils.Vec3.Origin;this._plane=new GLTFViewer.Utils.Plane(this._ctr,GLTFViewer.Utils.Direction.diz);this._cursorRay=new GLTFViewer.Utils.CursorRay(a)};
GLTFViewer.Utils.Navigator.Pan.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.Pan},_plane:{writable:!0,value:null},_cursorRay:{writable:!0,value:null},_x:{writable:!0,value:0},_y:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.Pan.prototype.Reset.call(this);this._cursorRay=this._plane=null;GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},
MouseDown:{value:function(a){this._navigator._scene.GetSceneBox().GetCenter(this._ctr);this.UpdateMouseDown(a)}},UpdateMouseDown:{value:function(a){a=a.GetLastLocation();this._x=a.x;this._y=a.y}},MouseMove:{value:function(a){var c=this._navigator;this._plane.Set(this._ctr,c.projectionInvTM.GetZDirection());this._cursorRay.Update(this._x,this._y);var d=new GLTFViewer.Utils.Vec3;this._plane.GetPoint(this._cursorRay.ray,d);var e=new GLTFViewer.Utils.Vec3;a=a.GetLastLocation();this._x=a.x;this._y=a.y;
this._cursorRay.Update(a.x,a.y);this._plane.GetPoint(this._cursorRay.ray,e);d=GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(d,e));d=GLTFViewer.Utils.Transformation.MultiplyCreate(c.projectionTM,d);e=this._ctr.TransformCreate(d);e.x=e.y=0;d=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(e,GLTFViewer.Utils.Vec3.Origin)),d);c.SetProjection(d,!1)}}});
GLTFViewer.Utils.Navigator.Spin=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a);this._ctr=GLTFViewer.Utils.Vec3.Origin;this._ball=new GLTFViewer.Utils.Ball;this._cursorRay=new GLTFViewer.Utils.CursorRay(a)};
GLTFViewer.Utils.Navigator.Spin.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.Spin},_oldProjection:{writable:!0,value:null},_oldProjectionInv:{writable:!0,value:null},_ball:{writable:!0,value:null},_cursorRay:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.Spin.prototype.Reset.call(this);this._cursorRay=
this._ball=null;GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},MouseDown:{value:function(a){var c=this._navigator,d=c._scene,e=a.GetLastLocation(1);this._cursorRay.Update(e.x,e.y);(c=d.handler?d.handler.HitTestPos(c.uTVP,c.canvasWidth,c.canvasHeight,this._cursorRay):null)?this._ctr.Set(c.x,c.y,c.z):d.GetSceneBox().GetCenter(this._ctr);this.UpdateMouseDown(a)}},UpdateMouseDown:{value:function(a){this._oldProjection=this._navigator.projectionTM;this._oldProjectionInv=this._navigator.projectionInvTM;
a=a.GetLastLocation(1);this._ball.onBegin(a.x,a.y)}}});GLTFViewer.Utils.Navigator.SpinXY=function(a){GLTFViewer.Utils.Navigator.Spin.call(this,a)};
GLTFViewer.Utils.Navigator.SpinXY.prototype=Object.create(GLTFViewer.Utils.Navigator.Spin.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.SpinXY},Reset:{value:function(){GLTFViewer.Utils.Navigator.Spin.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.SpinXY.prototype.Reset.call(this);GLTFViewer.Utils.Navigator.Spin.prototype.Clear.call(this)}},MouseMove:{value:function(a){var c=this._navigator._scene;if(null!==this._oldProjection&&(a=a.GetLastLocation(1),this._ball.onMove(a.x,
a.y),!this._ball.d.IsZero())){a=this._ball.d.TransformCreate(this._oldProjectionInv);var d=this._ball.a;a=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(this._ctr,a.GetDirection()),d);a=GLTFViewer.Utils.Transformation.MultiplyCreate(this._oldProjection,a);a.IsWellFormed()||(a=a.CreateWellFormed());c=c.GetSceneBox().Clone().Multiply(a);a=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(new GLTFViewer.Utils.Vec3(0,
0,c.GetCenter().z),GLTFViewer.Utils.Vec3.Origin)),a);this._navigator.SetProjection(a,!1)}}}});GLTFViewer.Utils.Navigator.SpinZ=function(a){GLTFViewer.Utils.Navigator.Spin.call(this,a)};
GLTFViewer.Utils.Navigator.SpinZ.prototype=Object.create(GLTFViewer.Utils.Navigator.Spin.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.SpinZ},Reset:{value:function(){GLTFViewer.Utils.Navigator.Spin.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.SpinZ.prototype.Reset.call(this);GLTFViewer.Utils.Navigator.Spin.prototype.Clear.call(this)}},MouseMove:{value:function(a){var c=this._navigator._scene;if(null!==this._oldProjection&&(a=a.GetLastLocation(1),this._ball.onMove(this._ball.cx,
a.y),!this._ball.d.IsZero())){this._ball.d.z=this._ball.d.x;this._ball.d.x=0;a=this._ball.d.TransformCreate(this._oldProjectionInv);var d=this._ball.a;a=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(this._ctr,a.GetDirection()),d);a=GLTFViewer.Utils.Transformation.MultiplyCreate(this._oldProjection,a);a.IsWellFormed()||(a=a.CreateWellFormed());c=c.GetSceneBox().Clone().Multiply(a);a=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(new GLTFViewer.Utils.Vec3(0,
0,c.GetCenter().z),GLTFViewer.Utils.Vec3.Origin)),a);this._navigator.SetProjection(a,!1)}}}});GLTFViewer.Utils.Navigator.Zoom=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a)};
GLTFViewer.Utils.Navigator.Zoom.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.Zoom},_x:{writable:!0,value:0},_y:{writable:!0,value:0},_oldProjection:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.Zoom.prototype.Reset.call(this);this._ctr=this._oldProjection=null;GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},
UpdateMouseDown:{value:function(a){var c=this._navigator;a=a.GetLastLocation(1);this._x=a.x;this._y=a.y;this._oldProjection=c.projectionTM;this._ctr=new GLTFViewer.Utils.Vec3(this._x,this._y,0);c.UnProject(this._ctr)}},MouseMove:{value:function(a){a=a.GetLastLocation(1).y-this._y;this._navigator.ZoomView(Math.exp(a/160),this._x,this._y,this._ctr,this._oldProjection)}}});
GLTFViewer.Utils.Navigator.ZoomBox=function(a){GLTFViewer.Utils.Navigator.NavigatorBaseClass.call(this,a);this._ctr=GLTFViewer.Utils.Vec3.Origin;this._plane=new GLTFViewer.Utils.Plane(this._ctr,GLTFViewer.Utils.Direction.diz);this._cursorRay=new GLTFViewer.Utils.CursorRay(a)};
GLTFViewer.Utils.Navigator.ZoomBox.prototype=Object.create(GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.Navigator.ZoomBox},_plane:{writable:!0,value:null},_cursorRay:{writable:!0,value:null},_startX:{writable:!0,value:0},_startY:{writable:!0,value:0},_curX:{writable:!0,value:0},_curY:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Reset.call(this)}},Clear:{value:function(){GLTFViewer.Utils.Navigator.Zoom.prototype.Reset.call(this);
this._cursorRay=this._plane=null;GLTFViewer.Utils.Navigator.NavigatorBaseClass.prototype.Clear.call(this)}},GetLoc:{value:function(){return[this._startX,this._startY,this._curX,this._curY]}},MouseDown:{value:function(a){this._navigator._scene.GetSceneBox().GetCenter(this._ctr);this.UpdateMouseDown(a)}},UpdateMouseDown:{value:function(a){a=a.GetLastLocation(1);this._startX=this._curX=a.x;this._startY=this._curY=a.y}},MouseMove:{value:function(a){var c=this._navigator,d=c.canvasWidth,c=c.canvasHeight;
a=a.GetLastLocation(1);0>a.x?a.x=0:a.x>=d&&(a.x=d-1);0>a.y?a.y=0:a.y>=c&&(a.y=c-1);this._curX=a.x;this._curY=a.y}},MouseUp:{value:function(){var a=this._navigator,c=a._scene,d=a.canvasWidth,e=a.canvasHeight,f=Math.abs(this._curX-this._startX),g=Math.abs(this._curY-this._startY);if(!(3>f||3>g)){var k=(this._startX+this._curX)/2,h=(this._startY+this._curY)/2;this._cursorRay.Update(k,h);if(c=c.handler?c.handler.HitTestPos(a.uTVP,d,e,this._cursorRay):null)c=new GLTFViewer.Utils.Vec3(c.x,c.y,c.z),a.Project(c),
Math.abs(k-c.x)>f/2||Math.abs(h-c.y)>g/2||(c.x=k,c.y=h,a.UnProject(c),k=a.projectionTM.Clone(),this._plane.Set(this._ctr,a.projectionInvTM.GetZDirection()),h=new GLTFViewer.Utils.Vec3,this._cursorRay.Update(d/2,e/2),this._plane.GetPoint(this._cursorRay.ray,h),h=GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(c,h)),k.Multiply(h),h=this._ctr.TransformCreate(k),h.x=h.y=0,k=GLTFViewer.Utils.Transformation.MultiplyCreate(GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(h,
GLTFViewer.Utils.Vec3.Origin)),k),k.a33/=f>g?e>d||g/f<e/d?d/f:e/g:d>e||f/g<d/e?e/g:d/f,a.SetProjection(k,!1))}}}});GLTFViewer.Utils.Navigator.ZoomBoxMarker=function(a,c){this._navigator=a;this._gx=c};
GLTFViewer.Utils.Navigator.ZoomBoxMarker.prototype=Object.create(null,{_navigator:{writable:!0,value:null},_gx:{writable:!0,value:null},Reset:{value:function(){}},Clear:{value:function(){GLTFViewer.Utils.Navigator.ZoomBoxMarker.prototype.Reset.call(this);this._gx=this._navigator=null}},Render:{value:function(a,c,d,e){var f=this._navigator,g=this._gx;if(a>d){var k=a;a=d;d=k}c>e&&(k=c,c=e,e=k);d-=a;e-=c;f=f._scene.background&&f._scene.background.IsDark(GLTFViewer.Utils.Background.RIGHTTOP);g.strokeStyle=
f?"rgba(255, 255, 255, 1)":"rgba(0, 0, 0, 1)";g.lineWidth=1;g.strokeRect(a,c,d,e)}}});GLTFViewer.Utils.Navigator.Triad=function(a,c){this._navigator=a};
GLTFViewer.Utils.Navigator.Triad.prototype=Object.create(null,{_navigator:{writable:!0,value:null},_RenderArm:{value:function(a,c,d,e,f,g,k,h){a.font=f+"px Verdana";a.textAlign="center";a.textBaseline="middle";h?(a.lineCap="square",h="rgba(255, 255, 255, 0.5)",a.strokeStyle=h,a.fillStyle=h,a.lineWidth=e+4,a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x+.8*(d.x-c.x),c.y+.8*(d.y-c.y)),a.stroke(),a.lineWidth=0,a.beginPath(),c=this._navigator,a.arc(d.x,d.y,.012*Math.min(c.canvasWidth,c.canvasHeight),0,2*
Math.PI,!1),a.fill()):(a.lineCap="round",a.strokeStyle=k,a.fillStyle=k,a.lineWidth=e,a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x+.8*(d.x-c.x),c.y+.8*(d.y-c.y)),a.stroke(),a.fillText(g,d.x,d.y))}},Reset:{value:function(){}},Clear:{value:function(){GLTFViewer.Utils.Navigator.Triad.prototype.Reset.call(this);this._navigator=null}},Render:{value:function(a,c){var d=this._navigator,e=d._scene.gx,f=Math.min(d._normalizedWidth,d._normalizedHeight),g=d.projectionTM.Clone();g.a30=0;g.a31=0;g.a32=0;g.a33=
1;var f=(new GLTFViewer.Utils.Transformation).Translate(.5*d._normalizedWidth-.1*f,-.5*d._normalizedHeight+.1*f,0).Multiply(g).Scale(.08,.08,.08),k=GLTFViewer.Utils.Transformation.orthoRH(d._normalizedWidth,d._normalizedHeight,d._nearPlane,d._farPlane).Multiply(d.cameraTM).Multiply(f),f=["red","green","blue"],g=["X","Y","Z"],h=[];h[0]=new GLTFViewer.Utils.Vec3(1,0,0);d.Project(h[0],k);var l=h[0].z;h[1]=new GLTFViewer.Utils.Vec3(0,1,0);d.Project(h[1],k);var m=h[1].z;h[2]=new GLTFViewer.Utils.Vec3(0,
0,1);d.Project(h[2],k);var n=h[2].z;h[3]=new GLTFViewer.Utils.Vec3(0,0,0);d.Project(h[3],k);k=[];l<=m&&l<=n?(k[2]=0,m<=n?(k[1]=1,k[0]=2):(k[1]=2,k[0]=1)):m<=l&&m<=n?(k[2]=1,l<=n?(k[1]=0,k[0]=2):(k[1]=2,k[0]=0)):(k[2]=2,l<=m?(k[1]=0,k[0]=1):(k[1]=1,k[0]=0));l=Math.max(Math.sqrt(Math.min(d.canvasWidth,d.canvasHeight))/10,1);d=Math.max(Math.sqrt(Math.min(d.canvasWidth,d.canvasHeight))/2,6);for(m=0;3>m;++m)this._RenderArm(e,h[3],h[k[m]],l,d,g[k[m]],f[k[m]],!1)}}});
GLTFViewer.Utils.Navigator.SpinMarker=function(a){this._gl=a;this._phong2Shader=new GLTFViewer.Utils.ShaderProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Navigator.SpinMarker._vsPhong2,GLTFViewer.Utils.Navigator.SpinMarker._fsPhong2);this._quadShader=new GLTFViewer.Utils.ShaderProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.Navigator.SpinMarker._vsQuad,GLTFViewer.Utils.Navigator.SpinMarker._fsQuad);this._clipPointDat=new Float32Array(24);this._clipPointBuf=
a.createBuffer();this._uMtl=new Float32Array(16);this._uTex=new Float32Array([0,0,1,0,1,1,0,1]);this._uClr=new Float32Array(8);this._uPos=new Float32Array([-1,1,1,1,1,-1,-1,-1]);a.bindBuffer(a.ARRAY_BUFFER,this._clipPointBuf);a.bufferData(a.ARRAY_BUFFER,this._clipPointDat,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);this._cone=new GLTFViewer.Utils.Navigator.SpinMarker.Cylinder(a,1,0,1,16,2);var c=GLTFViewer.Utils.MakeBallImage(4,2);this._circleTexture=a.createTexture();a.activeTexture(a.TEXTURE0);
a.bindTexture(a.TEXTURE_2D,this._circleTexture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texImage2D(a.TEXTURE_2D,0,a.LUMINANCE_ALPHA,8,8,0,a.LUMINANCE_ALPHA,a.UNSIGNED_BYTE,c);a.bindTexture(a.TEXTURE_2D,null)};
GLTFViewer.Utils.Navigator.SpinMarker.prototype=Object.create(null,{_gl:{writable:!0,value:null},_phong2Shader:{writable:!0,value:null},_quadShader:{writable:!0,value:null},_cone:{writable:!0,value:null},_clipPointBuf:{writable:!0,value:null},_uMtl:{writable:!0,value:null},_uTex:{writable:!0,value:null},_uClr:{writable:!0,value:null},_uPos:{writable:!0,value:null},_circleTexture:{writable:!0,value:null},_SetMaterialRgba:{value:function(a,c,d,e){a=new GLTFViewer.Utils.RGBA(a,c,d,e);(new GLTFViewer.Utils.Material(a)).ToArray(this._uMtl,
0)}},Reset:{value:function(){this._cone.Reset()}},Clear:{value:function(){GLTFViewer.Utils.Navigator.SpinMarker.prototype.Reset.call(this);var a=this._gl;null!==this._phong2Shader&&(this._phong2Shader.DeleteProgram(),this._phong2Shader=null);null!==this._quadShader&&(this._quadShader.DeleteProgram(),this._quadShader=null);this._clipPointBuf&&(a.deleteBuffer(this._clipPointBuf),this._clipPointBuf=null);this._clipPointDat=null;this._cone&&(this._cone.Clear(),this._cone=null);this._uPos=this._uClr=this._uTex=
this._uMtl=null;this._circleTexture&&(a.deleteTexture(this._circleTexture),this._circleTexture=null);this._gl=null}},Render:{value:function(a,c,d,e,f,g,k){if(this._circleTexture){var h=this._gl,l=this._phong2Shader;if(l.StartProgram()){h.uniformMatrix4fv(l.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);h.uniformMatrix4fv(l.uTVP,!1,a);h.uniform3fv(l.uEye,c);h.uniformMatrix4fv(l.uLit,!1,d);h.enable(h.BLEND);h.enable(h.CULL_FACE);h.depthMask(!1);h.cullFace(h.BACK);c=100;d=1.5*e;var m=8*e;e*=25;h.disable(h.DEPTH_TEST);
this._SetMaterialRgba(255,0,0,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);var n=new GLTFViewer.Utils.Vec3(k.x+m,k.y,k.z),p=new GLTFViewer.Utils.Vec3(k.x+e,k.y,k.z);this._cone.Render(h,l,n,p,d);n.x=k.x-m;p.x=k.x-e;this._cone.Render(h,l,n,p,d);this._SetMaterialRgba(0,200,0,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);n.Set(k.x,k.y+m,k.z);p.Set(k.x,k.y+e,k.z);this._cone.Render(h,l,n,p,d);n.y=k.y-m;p.y=k.y-e;this._cone.Render(h,l,n,p,d);this._SetMaterialRgba(0,0,255,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);
n.Set(k.x,k.y,k.z+m);p.Set(k.x,k.y,k.z+e);this._cone.Render(h,l,n,p,d);n.z=k.z-m;p.z=k.z-e;this._cone.Render(h,l,n,p,d);c=250;h.enable(h.DEPTH_TEST);this._SetMaterialRgba(255,0,0,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);n.Set(k.x+m,k.y,k.z);p.Set(k.x+e,k.y,k.z);this._cone.Render(h,l,n,p,d);n.Set(k.x-m,k.y,k.z);p.Set(k.x-e,k.y,k.z);this._cone.Render(h,l,n,p,d);this._SetMaterialRgba(0,200,0,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);n=new GLTFViewer.Utils.Vec3(k.x,k.y+m,k.z);p=new GLTFViewer.Utils.Vec3(k.x,
k.y+e,k.z);this._cone.Render(h,l,n,p,d);n.Set(k.x,k.y-m,k.z);p.Set(k.x,k.y-e,k.z);this._cone.Render(h,l,n,p,d);this._SetMaterialRgba(0,0,255,c);h.uniformMatrix4fv(l.uMtl,!1,this._uMtl);n=new GLTFViewer.Utils.Vec3(k.x,k.y,k.z+m);p=new GLTFViewer.Utils.Vec3(k.x,k.y,k.z+e);this._cone.Render(h,l,n,p,d);n.Set(k.x,k.y,k.z-m);p.Set(k.x,k.y,k.z-e);this._cone.Render(h,l,n,p,d);h.disable(h.CULL_FACE)}l=this._quadShader;l.StartProgram()&&(h.bindBuffer(h.ARRAY_BUFFER,this._clipPointBuf),h.vertexAttribPointer(l.aPos,
3,h.FLOAT,!1,16,0),h.vertexAttribPointer(l.aTex,1,h.FLOAT,!1,16,12),h.uniformMatrix4fv(l.uTWd,!1,GLTFViewer.Utils.glMtxIdentity),h.uniformMatrix4fv(l.uTVP,!1,a),h.uniform2fv(l.uPos,this._uPos),h.uniform2fv(l.uTex,this._uTex),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,this._circleTexture),h.disable(h.DEPTH_TEST),a=new GLTFViewer.Utils.RGBA(100,100,0,180),a.ToArray(this._uClr,0),a.SetRgba(255,255,200,180),a.ToArray(this._uClr,4),h.uniform2f(l.uSze,6/f,6/g),h.uniform4fv(l.uClr,this._uClr),
f=0,g=this._clipPointDat,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=0,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=1,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=2,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=2,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=3,g[f++]=k.x,g[f++]=k.y,g[f++]=k.z,g[f++]=0,h.bufferSubData(h.ARRAY_BUFFER,0,this._clipPointDat),h.drawArrays(h.TRIANGLES,0,6),h.bindTexture(h.TEXTURE_2D,null),h.bindBuffer(h.ARRAY_BUFFER,null),h.depthMask(!0),h.disable(h.BLEND),h.enable(h.DEPTH_TEST))}}}});
GLTFViewer.Utils.Navigator.SpinMarker.Cylinder=function(a,c,d,e,f,g){this._gl=a;c=GLTFViewer.Utils.MakeFacedCylinder3D(c,d,e,f,g);this._iCnt=c.size;this._vDat=c.vertices;this._iDat=c.indices;this._vBuf=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vBuf);a.bufferData(a.ARRAY_BUFFER,this._vDat,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,null);this._iBuf=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._iBuf);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._iDat,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
null);this._tmpArray=new Float32Array(16)};
GLTFViewer.Utils.Navigator.SpinMarker.Cylinder.prototype=Object.create(null,{_gl:{writable:!0,value:null},_tmpArray:{writable:!0,value:null},_vDat:{writable:!0,value:null},_iDat:{writable:!0,value:null},_vBuf:{writable:!0,value:null},_iBuf:{writable:!0,value:null},_iCnt:{writable:!0,value:0},Reset:{value:function(){}},Clear:{value:function(){var a=this._gl;GLTFViewer.Utils.Navigator.SpinMarker.Cylinder.prototype.Reset.call(this);this._vBuf&&(a.deleteBuffer(this._vBuf),this._vBuf=null);this._iBuf&&
(a.deleteBuffer(this._iBuf),this._iBuf=null);_iDat=_vDat=null}},Render:{value:function(a,c,d,e,f,g){var k=GLTFViewer.Utils.Vec3.Create(e,d);g=k.GetMagnitude();e=new GLTFViewer.Utils.Vec3((d.x+e.x)/2,(d.y+e.y)/2,(d.z+e.z)/2);d=GLTFViewer.Utils.Transformation.TranslationCreate(e.x,e.y,e.z);var h=k.GetDirection(),k=h.Clone();k.Cross(new GLTFViewer.Utils.Vec3(0,0,1)).Normalize();k.IsZero()?e=0>h.Dot(new GLTFViewer.Utils.Vec3(0,0,1))?GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(e,
GLTFViewer.Utils.Direction.diy),Math.PI):GLTFViewer.Utils.Transformation.Identity:(h=h.Dot(new GLTFViewer.Utils.Vec3(0,0,1)),h=2*Math.PI-GLTFViewer.Utils.acos(h),e=GLTFViewer.Utils.Transformation.RotationAboutAxisCreate(new GLTFViewer.Utils.Line(e,k),h));d=GLTFViewer.Utils.Transformation.MultiplyCreate(e,d);d.Multiply(GLTFViewer.Utils.Transformation.ScaleCreate(f));d.Multiply(new GLTFViewer.Utils.Transformation(1,0,0,0,0,1,0,0,0,0,g/f,0,0,0,0,1));d.ToArray(this._tmpArray);a.uniformMatrix4fv(c.uTWd,
!1,this._tmpArray);a.bindBuffer(a.ARRAY_BUFFER,this._vBuf);a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,24,0);a.vertexAttribPointer(c.aNor,3,a.FLOAT,!1,24,12);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._iBuf);a.drawElements(a.TRIANGLES,this._iCnt,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindBuffer(a.ARRAY_BUFFER,null)}}});
Object.defineProperties(GLTFViewer.Utils.Navigator.SpinMarker,{_vsPhong2:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nuniform vec3 uEye;\nattribute vec3 aPos;\nattribute vec3 aNor;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvoid main(void) {\nvec4 pos = uTWd * vec4(aPos, 1.0);\nvNor = (uTWd * vec4(aNor, 0.0)).xyz;\nvDir = normalize(pos.xyz - uEye);\ngl_Position = uTVP * pos;\n}"},_fsPhong2:{value:"uniform mat4 uLit[2];\nuniform mat4 uMtl;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvoid main(void) {\nvec3 rgb = vec3(0);\nvec3 nor = normalize(vNor);\nnor *= -sign(dot(vDir, nor));\nvec3 r = reflect(uLit[0][3].xyz, nor);\nfloat s = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nfloat d = max(dot(uLit[0][3].xyz, nor), 0.0);\nvec3 sp = s * uMtl[2].rgb * uLit[0][2].rgb;\nvec3 di = d * uMtl[1].rgb * uLit[0][1].rgb;\nvec3 am = uMtl[0].rgb * uLit[0][0].rgb;\nrgb = am + di + sp;\nr = reflect(uLit[1][3].xyz, nor);\ns = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nd = max(dot(uLit[1][3].xyz, nor), 0.0);\nsp = s * uMtl[2].rgb * uLit[1][2].rgb;\ndi = d * uMtl[1].rgb * uLit[1][1].rgb;\nam = uMtl[0].rgb * uLit[1][0].rgb;\nrgb = rgb + am + di + sp;\ngl_FragColor = vec4(rgb, uMtl[1].a);\n}"},
_vsQuad:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nuniform vec2 uPos[4];\nuniform vec2 uTex[4];\nuniform vec2 uSze;\nattribute vec3 aPos;\nattribute float aTex;\nvarying vec2 vTex;\nvoid main() {\nint i = int(aTex);\nvTex = uTex[i];\nvec2 o = uPos[i] * uSze * uTWd[3][3] * uTVP[3][3];\ngl_Position = uTVP * uTWd * vec4(aPos, 1) + vec4(o, 0, 0);\n}"},_fsQuad:{value:"uniform vec4 uClr[2];\nuniform sampler2D uSmp;\nvarying vec2 vTex;\nvoid main(void) {\nvec4 t = texture2D(uSmp, vTex);\nvec4 c = uClr[0] + uClr[1] * t.r;\nc.a *= t.a;\ngl_FragColor = c;\n}"}});GLTFViewer.Utils.FileGLTF=function(a,c,d,e){GLTFViewer.Utils.FileBaseClass.call(this,a,c,d,e);a=this._gl;this._colorName="_u_color_";this._clipName="_u_clipPlane_";this._objMatrixName="_u_objMatrix_";this._POSITIONNAME="POSITION";this._glUniform={};this._glUniform[5124]={create:GLTFViewer.Utils.FileGLTF._Uniform1i,set:GLTFViewer.Utils.FileGLTF._SetUniform1i};this._glUniform[5126]={create:GLTFViewer.Utils.FileGLTF._Uniform1f,set:GLTFViewer.Utils.FileGLTF._SetUniform1f};this._glUniform[35664]={create:GLTFViewer.Utils.FileGLTF._Uniform2fv,
set:GLTFViewer.Utils.FileGLTF._SetUniform2fv};this._glUniform[35665]={create:GLTFViewer.Utils.FileGLTF._Uniform3fv,set:GLTFViewer.Utils.FileGLTF._SetUniform3fv};this._glUniform[35666]={create:GLTFViewer.Utils.FileGLTF._Uniform4fv,set:GLTFViewer.Utils.FileGLTF._SetUniform4fv};this._glUniform[35667]={create:GLTFViewer.Utils.FileGLTF._Uniform2iv,set:GLTFViewer.Utils.FileGLTF._SetUniform2iv};this._glUniform[35668]={create:GLTFViewer.Utils.FileGLTF._Uniform3iv,set:GLTFViewer.Utils.FileGLTF._SetUniform3iv};
this._glUniform[35669]={create:GLTFViewer.Utils.FileGLTF._Uniform4iv,set:GLTFViewer.Utils.FileGLTF._SetUniform4iv};this._glUniform[35670]={create:GLTFViewer.Utils.FileGLTF._Uniform1i,set:GLTFViewer.Utils.FileGLTF._SetUniform1i};this._glUniform[35675]={create:GLTFViewer.Utils.FileGLTF._UniformMatrix3fv,set:GLTFViewer.Utils.FileGLTF._SetUniformMatrix3fv};this._glUniform[35676]={create:GLTFViewer.Utils.FileGLTF._UniformMatrix4fv,set:GLTFViewer.Utils.FileGLTF._SetUniformMatrix4fv};this._glUniform[35678]=
{create:GLTFViewer.Utils.FileGLTF._Sampler2D,set:GLTFViewer.Utils.FileGLTF._SetSampler2D};try{this._hitTestIndexShader=new GLTFViewer.Utils.ShaderProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileGLTF._hitTestIndxVs,GLTFViewer.Utils.FileGLTF._hitTestIndxFs),this._hitTestPositionShader=new GLTFViewer.Utils.ShaderProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileGLTF._hitTestPosVs,GLTFViewer.Utils.FileGLTF._hitTestPosFs)}catch(f){throw GLTFViewer.Utils.WriteErr(f),
this._hitTestIndexShader&&(this._hitTestIndexShader.DeleteProgram(),this._hitTestIndexShader=null),this._hitTestPositionShader&&(this._hitTestPositionShader.DeleteProgram(),this._hitTestPositionShader=null),f;}if(this._hitTestIndexClipShader=GLTFViewer.Utils.ShaderProgram.CreateClipableProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.ShaderProgram.RemoveComments(GLTFViewer.Utils.FileGLTF._hitTestIndxVs),GLTFViewer.Utils.ShaderProgram.RemoveComments(GLTFViewer.Utils.FileGLTF._hitTestIndxFs),
this._objMatrixName,"aPos",this._clipName))this._hitTestPositionClipShader=GLTFViewer.Utils.ShaderProgram.CreateClipableProgram(a,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.ShaderProgram.RemoveComments(GLTFViewer.Utils.FileGLTF._hitTestPosVs),GLTFViewer.Utils.ShaderProgram.RemoveComments(GLTFViewer.Utils.FileGLTF._hitTestPosFs),this._objMatrixName,"aPos",this._clipName),this._hitTestPositionClipShader||(this._hitTestIndexClipShader.DeleteProgram(),this._hitTestIndexClipShader=null);
this.CanClip=!GLTFViewer.Utils.IsNull(this._hitTestIndexClipShader)&&!GLTFViewer.Utils.IsNull(this._hitTestPositionClipShader);this.CanCreateViews=this.CanExplode=this.CanMarkup=this.CanPeel=!0;this._glCursorRay=new Float32Array(8);this._uViewport=new Float32Array(4);this._uTProj=new Float32Array(16);this._uTProj2=new Float32Array(16);this._uModel=new Float32Array(16);this._uView=new Float32Array(16);this._uModelView=new Float32Array(16);this._uModelViewInvTrp=new Float32Array(9);this._sceneNodeIndexToSceneNode=
[];this._sceneCache={};this._sceneCacheNameMap={};this._animationCache={};this._animationSamplerCache={};this._markupCache={};this._cameraCache={};this._legendCache={};this._meshCache={};this._nodeCache={};this._nodeCacheNameMap={};this._attributeCache={};this._indexCache={};this._materialCache={};this._techniqueCache={};this._programCache={};this._bufferViewCache={};this._bufferCache={};this._shaderCache={};this._imageCache={};this._samplerCache={};this._textureCache={};this._idMap={};this.hit=new GLTFViewer.Utils.FileGLTF.Hit};
GLTFViewer.Utils.FileGLTF.prototype=Object.create(GLTFViewer.Utils.FileBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF},_fileNum:{writable:!0,value:0},_uTProj:{writable:!0,value:null},_uTProj2:{writable:!0,value:null},_uModel:{writable:!0,value:null},_uModelView:{writable:!0,value:null},_uModelViewInvTrp:{writable:!0,value:null},_uView:{writable:!0,value:null},_uViewport:{writable:!0,value:null},_glCursorRay:{writable:!0,value:null},_glUniform:{writable:!0,value:null},_colorName:{writable:!0,
value:null},_clipName:{writable:!0,value:null},_objMatrixName:{writable:!0,value:null},_POSITIONNAME:{writable:!0,value:null},_anyTransparent:{writable:!0,value:null},_anyOpaque:{writable:!0,value:null},_any2D:{writable:!0,value:null},_any2DOverlay:{writable:!0,value:null},_progressTotal:{writable:!0,value:0},_totalGLTFBytes:{writable:!0,value:0},_hitTestIndexShader:{writable:!0,value:null},_hitTestIndexClipShader:{writable:!0,value:null},_hitTestPositionShader:{writable:!0,value:null},_hitTestPositionClipShader:{writable:!0,
value:null},_sceneNodeIndexToSceneNode:{writable:!0,value:null},_idMap:{writable:!0,value:null},_animationInfo:{writable:!0,value:null},_sceneCache:{writable:!0,value:null},_sceneCacheNameMap:{writable:!0,value:null},_curScene:{writable:!0,value:null},_cameraCache:{writable:!0,value:null},_animationCache:{writable:!0,value:null},_animationSamplerCache:{writable:!0,value:null},_markupCache:{writable:!0,value:null},_legendCache:{writable:!0,value:null},_meshCache:{writable:!0,value:null},_nodeCache:{writable:!0,
value:null},_nodeCacheNameMap:{writable:!0,value:null},_attributeCache:{writable:!0,value:null},_indexCache:{writable:!0,value:null},_materialCache:{writable:!0,value:null},_techniqueCache:{writable:!0,value:null},_programCache:{writable:!0,value:null},_bufferViewCache:{writable:!0,value:null},_bufferCache:{writable:!0,value:null},_shaderCache:{writable:!0,value:null},_imageCache:{writable:!0,value:null},_samplerCache:{writable:!0,value:null},_textureCache:{writable:!0,value:null},FindSceneItemByName:{value:function(a){for(var c in this._sceneCache){var d=
this._sceneCache[c];if(d.name===a)return d}return null}},ShowNodeRefs:{value:function(){console.log("SceneCache:");for(var a in this._sceneCache){var c=this._sceneCache[a];console.log("Scene: "+c.ID+"   "+c.name+"   refCount: "+c.refCount)}console.log("NodeCache:");for(a in this._nodeCache)c=this._nodeCache[a],console.log("Node: "+c.ID+"   "+c.name+"   refCount: "+c.refCount);console.log("IDMap:");for(a in this._idMap)console.log(a+" = "+this._idMap[a])}},IDMap:{value:function(a){var c=this._idMap[a];
return GLTFViewer.Utils.IsNull(c)?a:c}},hit:{writable:!0,value:null},GetSceneBox:{value:function(a){return this._curScene?this._curScene.GetBoundingBox(a):GLTFViewer.Utils.FileBaseClass.prototype.GetSceneBox.call(this,a)}},SetExplosion:{value:function(a,c){this._viewer.ExplodeBtnState(null,a?GLTFViewer.MENUCHECK:GLTFViewer.MENUUNCHECK);this._viewer.MarkupBtnState(null,a?GLTFViewer.MENUDISABLE:GLTFViewer.MENUENABLE);c&&this._viewer.SetExplodeSlider(a);this._scene.Invalidate(!0);var d=this._curScene;
GLTFViewer.Utils.IsNull(d)||(d.explosion=a,d.UpdateBoundingBox())}},GetExplosion:{value:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?0:a.explosion}},ResetHit:{value:function(){this.hit.Reset()}},AnyHit:{value:function(){return!GLTFViewer.Utils.IsNull(this.hit.indx)}},HitPoint:{value:function(){return this.hit.pnt}},HitIndx:{value:function(){return this.hit.indx}},IsVisible:{value:function(a){a=this._sceneNodeIndexToSceneNode[a];return!GLTFViewer.Utils.IsNull(a)&&a.IsVisible()}},
AddMarkupToVisibilitySelector:{value:function(a,c){if(c._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D&&!GLTFViewer.Utils.IsNull(c._index))return null;c.Editable||a.markupVis||(a.markupVis=this._viewer.AddEntryVisibilityList("Annotations",!0,null,null,null,!0));c.Editable&&!a.markupVisEditable&&(a.markupVisEditable=this._viewer.AddEntryVisibilityList("Markups",!0,null,null,null,!0));return this._viewer.AddEntryVisibilityList("",c._visible,function(a,c){a._visible=c;this._scene.Invalidate(!0)}.bind(this,
c),null,c.Editable?a.markupVisEditable:a.markupVis,!0)}},BuildVisibilitySelector:{value:function(){function a(c){var d=c.nodeItem,e=d.fileInfo;if(!c.disconnect&&(!GLTFViewer.Utils.IsNull(d.BB)||!GLTFViewer.Utils.IsNull(e)&&this._IsMeshNode(e._jsonData,d.ID))){e=c.parent;c.visList=this._viewer.AddEntryVisibilityList(d.name,c.IsVisible(),c.SetVisibility,c.EditProperties,e?e.visList:null,0===d.meshList.length);for(var f in c.childList)a.call(this,c.childList[f])}}this._viewer.ClearVisibilityList();var c=
this._curScene;if(!GLTFViewer.Utils.IsNull(c)){for(var d in c.sceneNodeItems)a.call(this,c.sceneNodeItems[d]);c.markupVis=null;c.markupVisEditable=null;d=c.markup.GetLineKeys();for(var e=0;e<d.length;++e){var f=c.markup.GetLine(d[e]);f.visList=this.AddMarkupToVisibilitySelector(c,f)}}}},CreateMarkupLine:{value:function(a,c,d,e,f,g,k,h,l,m,n,p,q,u){if(!GLTFViewer.Utils.IsNull(a)){var r=a.markup;c=r.CreateMarkupLine(c,d,e,f,g,k,h,l,m,n,p,q,u);this._curScene===a&&(r=r.GetLine(c),r.visList=this.AddMarkupToVisibilitySelector(a,
r),this._scene.Invalidate(!0));return c}}},DeleteMarkupLine:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(a)){var d=a.markup,e=d.GetLine(c);if(e&&e.Editable){this._viewer.DeleteEntryVisibilityList(e.visList);d.DeleteMarkupLine(c);var d=a.markup.GetLineKeys(),f=d.length,g=!1;if(f)for(var k=0;k<f;++k)if(e=a.markup.GetLine(d[k]),e.Editable){g=!0;break}g||(this._viewer.DeleteEntryVisibilityList(a.markupVisEditable),a.markupVisEditable=null);this._scene.Invalidate(!0)}}}},CheckMarkupHit:{value:function(a){var c=
this._curScene;if(GLTFViewer.Utils.IsNull(c))return!1;c=c.markup;if(c._state===GLTFViewer.Utils.Markup.STATE_DISABLED||c._state===GLTFViewer.Utils.Markup.STATE_CREATE_LINE)return!1;a=new GLTFViewer.Utils.Vec3(a.x,a.y,0);a=c.HitMarkup(a);if(!a)return!1;this.hit.indx=-(a+100);this.hit.texture=null;return!0}},DeleteAllMarkups:{value:function(){for(var a in this._sceneCache)for(var c=this._sceneCache[a],d=c.markup.GetLineKeys(),e=0;e<d.length;++e)this.DeleteMarkupLine(c,d[e]);for(a in this._markupCache)this._markupCache[a].editable&&
this._markupCache[a].Clear()}},DeleteAllViews:{value:function(){for(var a in this._sceneCache){var c=this._sceneCache[a];c.editable&&this.DeleteScene(c)}}},CurScene:{get:function(){return this._curScene}},Ruler:{get:function(){return this._curScene?{units:this._curScene.rulerUnits,scale:this._curScene.rulerScale}:null}},RenderMarkup3D:{value:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||c.markup.Render3D(a)}},RenderMarkup2D:{value:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||
c.markup.Render2D(a)}},GetSceneState:{value:function(){return this._curScene?{sceneName:this._curScene.name,navigatorState:this._navigator.state,clipState:this._clip.state,explosion:this.GetExplosion()}:null}},ResetScene:{value:function(a){GLTFViewer.Utils.FileBaseClass.prototype.ResetScene.call(this);this.SetExplosion(0,!0);a||(a=this._curScene);a.Reset();a===this._curScene&&this.SelectScene(this._curScene)}},SelectScene:{value:function(a,c){if(!GLTFViewer.Utils.IsNull(a)){var d=this._curScene!==
a,e=this._navigator;this._curScene&&(d&&(this._curScene.navigatorState=e.state,this._curScene.clipState=this._clip.state),this._curScene.markup.ResetSelection());d&&(this._curScene=a,this._any2DOverlay=this._any2D=this._anyOpaque=this._anyTransparent=null);c&&c.navigatorState||a.navigatorState?(this.UpdateWorldScale(),e.state=c&&c.navigatorState?c.navigatorState:a.navigatorState):(e.Reset(),this.UpdateWorldScale(),this._viewer.ClipMenuBtnState(null,null,GLTFViewer.MENURESET),a.camera&&this._cameraCache[a.camera.cameraID]&&
e.SetCamera("perspective"===this._cameraCache[a.camera.cameraID].type),a.cameraMatrix&&e.SetProjection(a.cameraMatrix,!1),a.navigatorState=e.state);if(!(c&&c.clipState||a.clipState)){if(a.clipP0&&a.clipP1&&a.clipP2){var f=a.clipP0,g=a.clipP1,k=a.clipP2,e=new GLTFViewer.Utils.Vec3((f.x+g.x+k.x)/3,(f.y+g.y+k.y)/3,(f.z+g.z+k.z)/3),h=new GLTFViewer.Utils.Vec3,l=new GLTFViewer.Utils.Vec3;h.Set(k.x-f.x,k.y-f.y,k.z-f.z);l.Set(g.x-f.x,g.y-f.y,g.z-f.z);h.Cross(l);f=h.GetDirection();f.IsZero()||(this._clip.clipPlane=
new GLTFViewer.Utils.Plane(e,f),this._clip._SetClipPointsFromPlane(this._clip.clipPlane),this._clip.clipState=GLTFViewer.Utils.Clip.STATE_3PTS,this._clip.clipDrawMode=GLTFViewer.Utils.Clip.DRAWMODE_DONE,this._clip._clipViewState=GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,this._clip.UpdateClip())}a.clipState=this._clip.state}this._clip.state=c&&c.clipState?c.clipState:a.clipState;c&&c.explosion?this.SetExplosion(c.explosion,!0):this.SetExplosion(this.GetExplosion(),!0);this._scene.Invalidate(!0);d&&(this.BuildVisibilitySelector(),
a.background&&this._SetBackColor(a.background),this._viewer.SetSelectionSceneList(a.sceneLI))}}},UpdateScene:{value:function(){var a=this._navigator,c=a.projectionTM,d=this.GetSceneBox().GetCenter().TransformCreate(c);d.x=d.y=0;c=GLTFViewer.Utils.Transformation.TranslationCreate(GLTFViewer.Utils.Vec3.Create(d,GLTFViewer.Utils.Vec3.Origin)).Multiply(c);a.projectionTM=c;a.SetCamera2();this._scene.Invalidate(!0)}},_UpdateLoadProgress:{value:function(a){if(this._progressBar){var c=0;Object.keys(a).forEach(function(d){c+=
a[d].loaded},this);this._progressTotal&&(c=this._progressTotal+.25*this._progressTotal*c/this._totalGLTFBytes);this._progressBar.Update(c)}}},_RenderFindClosest:{value:function(a,c,d,e,f){var g=this._navigator,k=this._gl,h=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,h=e?h?this._hitTestIndexClipShader:this._hitTestIndexShader:h?this._hitTestPositionClipShader:this._hitTestPositionShader;if(!h.StartProgram())return!1;f.ToArray(this._glCursorRay);k.uniform4fv(h.uCry,this._glCursorRay);
k.uniform2f(h.uSze,c/2,d/2);k.uniformMatrix4fv(h.uTVP,!1,a);a=g.modelViewTM;g.modelViewTM=GLTFViewer.Utils.Transformation.Identity;this._RenderScene(e?GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKIDX:GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKPOS,c,d,-1,null,h);g.modelViewTM=a;return!0}},_ReadShader:{value:function(a,c,d){function e(a,c){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(c){try{a.glslShader=GLTFViewer.Utils.ShaderProgram.RemoveComments(c)}catch(d){a.Clear();
return}a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}else a.Clear()}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.shaders[c])GLTFViewer.Utils.WriteErr("ERROR(ReadShader:"+c+"):","bad id"),d(null);else{var g=this._shaderCache[c];if(g)g.DoCallbacks(d);else{f=f.shaders[c];g=new GLTFViewer.Utils.FileGLTF.ShaderItem(this,c,this._shaderCache);g.AddCallback(d);c=f.path;d=a._files;if(a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_LOCAL||a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY)d=
a._files[c];a._loader.LoadText(c,d,a._fileType,e.bind(this,g),this._UpdateLoadProgress.bind(this))}}}},_ReadImage:{value:function(a,c,d){function e(a,c){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(c?(a.image=c,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks()):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.images[c])GLTFViewer.Utils.WriteErr("ERROR(ReadImage:"+c+"):","bad id"),d(null);else{var g=this._imageCache[c];if(g)g.DoCallbacks(d);
else{f=f.images[c];g=new GLTFViewer.Utils.FileGLTF.ImageItem(this,c,this._imageCache);g.AddCallback(d);g.generateMipmap=f.generateMipmap;c=f.path;d=a._files;if(a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_LOCAL||a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY)d=a._files[c];a._loader.LoadImage(c,d,a._fileType,e.bind(this,g),this._UpdateLoadProgress.bind(this))}}}},_ReadBuffer:{value:function(a,c,d){function e(a,c){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&
(c?(a.byteLength=c.byteLength,a.buffer=c,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks()):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.buffers[c])GLTFViewer.Utils.WriteErr("ERROR(ReadBuffer:"+c+"):","bad id"),d(null);else{var g=this._bufferCache[c];if(g)g.DoCallbacks(d);else if(f=f.buffers[c],0>=f.byteLength)d(null);else{g=new GLTFViewer.Utils.FileGLTF.BufferItem(this,c,this._bufferCache);g.AddCallback(d);g.byteLength=f.byteLength;c=f.path;d=a._files;if(a._fileType===
GLTFViewer.Utils.FileGLTF.FILE_TYPE_LOCAL||a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY)d=a._files[c];a._loader.LoadBinary(c,d,a._fileType,e.bind(this,g),this._UpdateLoadProgress.bind(this))}}}},_ReadBufferView:{value:function(a,c,d){function e(a,c){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(c?a.byteOffset+a.byteLength>c.byteLength?(GLTFViewer.Utils.WriteErr("ERROR(ReadBufferView:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","buffer too small"),
a.Clear()):(a.buffer=c,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks()):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.bufferViews[c])GLTFViewer.Utils.WriteErr("ERROR(ReadBufferView:"+c+"):","bad id"),d(null);else{var g=this._bufferViewCache[c];g?g.DoCallbacks(d):(f=f.bufferViews[c],0>=f.byteLength?d(null):(g=new GLTFViewer.Utils.FileGLTF.BufferViewItem(this,c,this._bufferViewCache),g.AddCallback(d),g.byteLength=f.byteLength,g.byteOffset=f.byteOffset?f.byteOffset:
0,g.target=f.target,this._ReadBuffer(a,f.buffer,e.bind(this,g))))}}},_ReadAttribute:{value:function(a,c,d){function e(a,c){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(c){a.bufferView=c;a.baseType=GLTFViewer.Utils.FileGLTF._glType[a.type].baseGLType;a.size=GLTFViewer.Utils.FileGLTF._glType[a.type].size;var d=GLTFViewer.Utils.FileGLTF._glType[a.type].type;a.byteStride||(a.byteStride=a.size*d.BYTES_PER_ELEMENT);if(a.byteStride*a.count>c.byteLength)GLTFViewer.Utils.WriteLErr("ERROR(ReadAttribute:"+
GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","bufferview too small"),a.Clear();else if(0!==a.byteStride%d.BYTES_PER_ELEMENT)GLTFViewer.Utils.WriteErr("ERROR(ReadAttribute:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","incompatible bytestride"),a.Clear();else{var e=c.byteOffset+a.byteOffset,f=a.size*a.count,g=this._gl;try{a.data=new d(c.buffer.buffer,e,f)}catch(q){GLTFViewer.Utils.WriteErr("ERROR(ReadAttribute:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"): "+q);a.Clear();return}a.buffer=
g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,a.buffer);g.bufferData(g.ARRAY_BUFFER,a.data,g.STATIC_DRAW);g.bindBuffer(g.ARRAY_BUFFER,null);a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}}else a.Clear()}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.attributes[c])GLTFViewer.Utils.WriteErr("ERROR(ReadAttribute:"+c+"):","bad id"),d(null);else{var g=this._attributeCache[c];g?g.DoCallbacks(d):(f=f.attributes[c],0>=f.count?d(null):(g=new GLTFViewer.Utils.FileGLTF.AttributeItem(this,
c,this._attributeCache),g.AddCallback(d),g.type=f.type,g.byteStride=f.byteStride,g.byteOffset=f.byteOffset,g.count=f.count,g.normalized=f.normalized?f.normalized:0,g.mn=f.min,g.mx=f.max,this._ReadBufferView(a,f.bufferView,e.bind(this,g))))}}},_ReadIndex:{value:function(a,c,d){function e(a,c){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(c)if(34963!==c.target)GLTFViewer.Utils.WriteErr("ERROR(ReadIndex:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","bad bufferView target"),
a.Clear();else{a.bufferView=c;var d=GLTFViewer.Utils.FileGLTF._glType[a.type].size,e=GLTFViewer.Utils.FileGLTF._glType[a.type].type;if(d*e.BYTES_PER_ELEMENT*a.count>c.byteLength)GLTFViewer.Utils.WriteErr("ERROR(ReadIndex:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","bufferview too small"),a.Clear();else{var f=c.byteOffset+a.byteOffset,d=d*a.count,g=this._gl;try{a.data=new e(c.buffer.buffer,f,d)}catch(q){GLTFViewer.Utils.WriteErr("ERROR(ReadIndex:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+
"): "+q);a.Clear();return}a.buffer=g.createBuffer();g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,a.buffer);g.bufferData(g.ELEMENT_ARRAY_BUFFER,a.data,g.STATIC_DRAW);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null);this._viewer.hasNodeJS||(a.data=null);a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}}else a.Clear()}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.indices[c])GLTFViewer.Utils.WriteErr("ERROR(ReadIndex:"+c+"):","bad id"),d(null);else{var g=this._indexCache[c];g?g.DoCallbacks(d):
(f=f.indices[c],5123!==f.type?(GLTFViewer.Utils.WriteErr("ERROR(ReadIndex:"+c+"):","bad type"),d(null)):0>=f.count?d(null):(g=new GLTFViewer.Utils.FileGLTF.IndexItem(this,c,this._indexCache),g.AddCallback(d),g.byteOffset=f.byteOffset,g.count=f.count,g.type=f.type,this._ReadBufferView(a,f.bufferView,e.bind(this,g))))}}},_ReadSampler:{value:function(a,c,d){var e=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!e.samplers[c])GLTFViewer.Utils.WriteErr("ERROR(ReadSampler:"+c+"):","bad id"),d(null);else if(a=
this._samplerCache[c])a.DoCallbacks(d);else{a=e.samplers[c];var e=a.magFilter,f=a.minFilter,g=a.wrapS,k=a.wrapT;9728!==e&&9729!==e||9728!==f&&9729!==f&&9984!==f&&9986!==f&&9985!==f&&9987!==f||10497!==g&&33071!==g&&33648!==g||10497!==k&&33071!==k&&33648!==k?(GLTFViewer.Utils.WriteErr("ERROR(ReadSampler:"+c+"):","bad settings"),d(null)):(a=new GLTFViewer.Utils.FileGLTF.SamplerItem(this,c,this._samplerCache),a.AddCallback(d),a.magFilter=e,a.minFilter=f,a.wrapS=g,a.wrapT=k,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,
a.DoCallbacks())}}},_ReadTexture:{value:function(a,c,d){function e(a,c,d){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(d?("Sampler"===c?a.sampler=d:a.image=d,0<--a.numCallbacksToProcess||(c=this._gl,a.texture=c.createTexture(),c.activeTexture(c.TEXTURE0),c.bindTexture(a.target,a.texture),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!0),c.texImage2D(a.target,0,a.format,a.format,c.UNSIGNED_BYTE,a.image.image),c.texParameteri(a.target,c.TEXTURE_MAG_FILTER,a.sampler.magFilter),c.texParameteri(a.target,
c.TEXTURE_MIN_FILTER,a.sampler.minFilter),c.texParameteri(a.target,c.TEXTURE_WRAP_S,a.sampler.wrapS),c.texParameteri(a.target,c.TEXTURE_WRAP_T,a.sampler.wrapT),c.bindTexture(a.target,null),a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks())):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.textures[c])GLTFViewer.Utils.WriteErr("ERROR(ReadTexture:"+c+"):","bad id"),d(null);else{var g=this._textureCache[c];if(g)g.DoCallbacks(d);else{var f=f.textures[c],k=f.format,
h=f.target;6406>k||6410<k||3553!==h?(GLTFViewer.Utils.WriteErr("ERROR(ReadTexture:"+c+"):","bad settings"),d(null)):(g=new GLTFViewer.Utils.FileGLTF.TextureItem(this,c,this._textureCache),g.AddCallback(d),g.format=k,g.target=h,g.numCallbacksToProcess=2,this._ReadSampler(a,f.sampler,e.bind(this,g,"Sampler")),this._ReadImage(a,f.source,e.bind(this,g,"Image")))}}}},_ReadProgram:{value:function(a,c,d){function e(a,c,d){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(d){if("Vertex"===
c?a.vertex=d:a.fragment=d,!(0<--a.numCallbacksToProcess)){c=this._gl;try{a.program=new GLTFViewer.Utils.ShaderProgram(c,null,a.vertex.glslShader,a.fragment.glslShader)}catch(e){GLTFViewer.Utils.WriteErr(e);a.Clear();return}a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}}else a.Clear()}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.programs[c])GLTFViewer.Utils.WriteErr("ERROR(ReadProgram:"+c+"):","bad id"),d(null);else{var g=this._programCache[c];g?g.DoCallbacks(d):(f=
f.programs[c],g=new GLTFViewer.Utils.FileGLTF.ProgramItem(this,c,this._programCache),g.AddCallback(d),g.numCallbacksToProcess=2,this._ReadShader(a,f.fragmentShader,e.bind(this,g,"Fragment")),this._ReadShader(a,f.vertexShader,e.bind(this,g,"Vertex")))}}},_ReadPass:{value:function(a,c,d,e){function f(a,c){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(c){for(var d=!1,e=c.program.attribLocation?Object.keys(c.program.attribLocation):[],f=0;f<e.length;++f){var g=e[f];if(!a.attributes||
void 0===a.attributes[g]){GLTFViewer.Utils.WriteErr("ERROR(ReadPass:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","program attribute "+g+" not defined");a.Clear();return}}for(g in a.attributes)void 0===c.program.attribLocation[g]&&delete a.attributes[g];e=c.program.uniformLocation?Object.keys(c.program.uniformLocation):[];for(f=0;f<e.length;++f){var q=e[f];if(!a.uniforms||void 0===a.uniforms[q]){GLTFViewer.Utils.WriteErr("ERROR(ReadPass:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):",
"program uniform "+q+" not defined");a.Clear();return}"matrix2D"===a.uniforms[q]&&(d=!0)}for(q in a.uniforms)void 0===c.program.uniformLocation[q]&&delete a.uniforms[q];a.program=c;a.is2D=d;a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}else a.Clear()}if(!GLTFViewer.Utils.IsNull(c)&&d&&d[c]){d=d[c];var g=d.instanceProgram;c=new GLTFViewer.Utils.FileGLTF.PassItem(this,c);c.AddCallback(e);c.attributes=g.attributes;c.uniforms=g.uniforms;c.states=d.states;this._ReadProgram(a,
g.program,f.bind(this,c))}else GLTFViewer.Utils.WriteErr("ERROR(ReadPass:"+c+"):","bad id"),e(null)}},_ReadValue:{value:function(a,c,d,e,f){function g(a,c,d){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(d&&(a.texture=d),a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks())}var k=new GLTFViewer.Utils.FileGLTF.ValueItem(this);k.AddCallback(e);k.valueInitial=d;"string"!==typeof d||f?(k.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,k.DoCallbacks()):this._ReadTexture(a,
d,g.bind(this,k,c))}},_ReadParameter:{value:function(a,c,d,e){this._ReadValue(a,c,d.value,function(a,c,d,e){e?(e.semantic=a.semantic,e.source=a.source,e.type=a.type,c(e)):c(null)}.bind(this,d,e,c))}},_ReadTechnique:{value:function(a,c,d){function e(a,c,d,e){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(e?("Pass"===c?a.pass=e:a.parameters[d]=e,0<--a.numCallbacksToProcess||(GLTFViewer.Utils.IsNull(a.is2D)&&(a.is2D=a.pass.is2D),a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,
a.DoCallbacks())):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.techniques[c])GLTFViewer.Utils.WriteErr("ERROR(ReadTechnique:"+c+"):","bad id"),d(null);else{var g=this._techniqueCache[c];if(g)g.DoCallbacks(d);else{var k=f.techniques[c],h=(f=k.parameters)?Object.keys(f):[],l=h.length,g=new GLTFViewer.Utils.FileGLTF.TechniqueItem(this,c,this._techniqueCache);g.AddCallback(d);g.is2D=k.is2D;g.numCallbacksToProcess=l+1;this._ReadPass(a,k.pass,k.passes,e.bind(this,g,"Pass",null));for(c=
0;c<l;++c)d=h[c],this._ReadParameter(a,d,f[d],e.bind(this,g,"Parameter",d))}}}},_GenerateClipProgram:{value:function(a){var c=a.parameters,d=a.pass;a=null;var e=d.attributes,f;for(f in e)if(c[e[f]].semantic===this._POSITIONNAME){a=f;break}if(GLTFViewer.Utils.IsNull(a))return GLTFViewer.Utils.WriteErr("ERROR(GenerateClipProgram): Can't create clip program"),!1;c=d.program;c.programClip=GLTFViewer.Utils.ShaderProgram.CreateClipableProgram(this._gl,null,c.vertex.glslShader,c.fragment.glslShader,this._objMatrixName,
a,this._clipName);if(!c.programClip)return!1;c.programCap=GLTFViewer.Utils.ShaderProgram.CreateClipableCapProgram(this._gl,null,c.vertex.glslShader,c.fragment.glslShader,this._objMatrixName,a,this._clipName,this._colorName);return!0}},_GeneratePeelProgram:{value:function(a){a=a.pass.program;a.programPeel=GLTFViewer.Utils.ShaderProgram.CreatePeelProgram(this._gl,null,a.vertex.glslShader,a.fragment.glslShader);return a.programPeel?!0:!1}},_ReadMaterial:{value:function(a,c,d){function e(a,d,e,f,g){function h(a,
c,d,e){if(GLTFViewer.Utils.IsNull(a))return{type:d,data:e,defaultValue:e};c=c.split("/");for(var f=0;f<c.length;++f)if(a=a[c[f]],GLTFViewer.Utils.IsNull(a))return{type:d,data:e,defaultValue:e};return{type:d,data:a,defaultValue:a}}if(d.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(g){if("Technique"===e)d.technique=g;else if(d.values[f]=g,"solidColor"===f)for(d.solidColor=new Float32Array(4),d.solidColor[0]=d.solidColor[1]=d.solidColor[2]=d.solidColor[3]=1,e=g.value,f=0;f<e.length&&
4>f;++f)d.solidColor[f]=e[f];if(!(0<--d.numCallbacksToProcess)){d.is2D=d.technique.is2D;this._GeneratePeelProgram(d.technique)||(this.CanPeel=!1);d.is2D||!this._viewer.wantClip||this._GenerateClipProgram(d.technique)||(this.CanClip=!1);d.program=d.technique.pass.program;var k=d.technique.pass.attributes,l;for(l in k){e=k[l];var x=d.technique.parameters[e],y=x.semantic;f=x.type;if(GLTFViewer.Utils.IsNull(y)||GLTFViewer.Utils.IsNull(f)||!this._glUniform[f].set){GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+
c+"):","technique parameter "+l+" bad semantic/type");d.Clear();return}g=this._glUniform[f].set;d.attributes.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,y,g,l))}a=a._jsonData;d.semanticUniforms=[];d.valueUniforms={};l=d.technique.pass.uniforms;for(var z in l){e=l[z];x=d.technique.parameters[e];y=x.semantic;f=x.type;if(GLTFViewer.Utils.IsNull(f)||!this._glUniform[f].set){GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+c+"):","technique parameter "+z+" bad type");d.Clear();return}g=this._glUniform[f].set;
if("MODEL"===y)x=this._uModel,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else if("VIEW"===y)x=this._uView,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else if("MODELVIEW"===y)x=this._uModelView,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else if("MODELVIEWINVERSETRANSPOSE"===y)x=this._uModelViewInvTrp,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else if("VIEWPORT"===y)x=
this._uViewport,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else if("PROJECTION"===y)x=d.is2D?this._uTProj2:this._uTProj,d.semanticUniforms.push(new GLTFViewer.Utils.FileGLTF.ShaderParams(f,x,g,z));else{if(GLTFViewer.Utils.IsNull(d.values[e]))if(GLTFViewer.Utils.IsNull(x.texture))if(GLTFViewer.Utils.IsNull(x.value)){if(GLTFViewer.Utils.IsNull(x.source)){GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+c+"):","technique parameter "+z+" value not defined");d.Clear();
return}x=a.nodes[x.source];if(!x||!x.matrix){GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+c+"):","technique parameter "+z+" bad source");d.Clear();return}x=x.matrix}else x=x.value;else x=x.texture.texture;else x=d.values[e],x=GLTFViewer.Utils.IsNull(x.texture)?x.value:x.texture.texture;x=this._glUniform[f].create(x);if(GLTFViewer.Utils.IsNull(x)){GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+c+"):","technique parameter "+z+" bad value");d.Clear();return}d.valueUniforms[e]=new GLTFViewer.Utils.FileGLTF.ShaderParams(f,
x,g,z)}}z=d.technique.pass.states;d.blendEnable=h(z,"blendEnable",35670,!1);d.cullFace=h(z,"cullFace","LIST",1029);d.cullFaceEnable=h(z,"cullFaceEnable",35670,!1);d.depthFunc=h(z,"depthFunc","LIST",513);d.depthMask=h(z,"depthMask",35670,!0);d.depthTestEnable=h(z,"depthTestEnable",35670,!0);d.frontFace=h(z,"frontFace","LIST",2305);d.lineWidth=h(z,"lineWidth",5126,1);d.polygonOffsetFillEnable=h(z,"polygonOffsetFillEnable",35670,!1);d.polygonOffsetFactor=h(z,"polygonOffset/factor",5126,0);d.polygonOffsetUnits=
h(z,"polygonOffset/units",5126,0);d.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;d.DoCallbacks()}}else d.Clear()}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.materials[c])GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial:"+c+"):","bad id"),d(null);else{var g=this._materialCache[c];if(g)g.DoCallbacks(d);else{var g=f.materials[c].instanceTechnique,k=g.technique;if(0===!GLTFViewer.Utils.IsNull(k))GLTFViewer.Utils.WriteErr("ERROR(ReadMaterial):","bad instanceTechnique"),d(null);else{var h=
(f=g.values)?Object.keys(f):[],l=h.length,g=new GLTFViewer.Utils.FileGLTF.MaterialItem(this,c,this._materialCache);g.AddCallback(d);g.numCallbacksToProcess=l+1;this._ReadTechnique(a,k,e.bind(this,a,g,"Technique",null));for(d=0;d<l;++d)k=h[d],this._ReadValue(a,k,f[k],e.bind(this,a,g,"Value",k))}}}}},_ReadPrimitive:{value:function(a,c,d){function e(a,c,d,e){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(e){if("Material"===c?a.material=e:"Index"===c?a.indices=e:a.attributes[d]=
e,!(0<--a.numCallbacksToProcess)){if(!a.material.is2D)for(d in a.attributes)if(d===this._POSITIONNAME){c=a.attributes[d];c.mn&&3===c.mn.length&&c.mx&&3===c.mx.length&&a.SetBoundingBox(c.mn,c.mx);break}a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;a.DoCallbacks()}}else a.Clear()}if(c){var f=c.primitive,g=c.material,k=!GLTFViewer.Utils.IsNull(g),h=c.indices,l=!GLTFViewer.Utils.IsNull(h),m=c.attributes,n=m?Object.keys(m):[],p=n.length;if(0>f||6<f||!k||0===p)GLTFViewer.Utils.WriteErr("ERROR(ReadPrimitive):",
"bad primitive"),d(null);else for(k=new GLTFViewer.Utils.FileGLTF.PrimitiveItem(this),k.AddCallback(d),k.mode=f,GLTFViewer.Utils.IsNull(c.isPickable)||(k.isPickable=c.isPickable),k.numCallbacksToProcess=1+(l?1:0)+p,this._ReadMaterial(a,g,e.bind(this,k,"Material",null)),l&&this._ReadIndex(a,h,e.bind(this,k,"Index",null)),c=0;c<p;++c)d=n[c],this._ReadAttribute(a,m[d],e.bind(this,k,"Attribute",d))}else d(null)}},_ReadLegend:{value:function(a,c,d){function e(a,c){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&
(c?(a.image=c,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks()):a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!(this._legendCache[c]||f.legends&&f.legends[c]))GLTFViewer.Utils.WriteErr("ERROR(ReadLegend:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+"):","bad id"),d(null);else{var g=this._legendCache[c];if(g)g.DoCallbacks(d);else{var f=f.legends[c],k=f.orientation;if(GLTFViewer.Utils.IsNull(k)||"horizontal"===k||"vertical"===k){var h=f.foreground,l=f.background,
m=f.title,n=f.other,p=f.image,g=new GLTFViewer.Utils.FileGLTF.LegendItem(this,c,this._legendCache);g.AddCallback(d);g.x=f.x?f.x:0;g.y=f.y?f.y:0;g.attachment=f.attachment?f.attachment:0;g.size=f.size?f.size:0;g.vertical=GLTFViewer.Utils.IsNull(k)?!0:"horizontal"!==k;g.border=f.border?1:0;g.foreground=GLTFViewer.Utils.IsNull(h)||3>h.length?new GLTFViewer.Utils.RGBA(0,0,0,255):new GLTFViewer.Utils.RGBA(255*h[0],255*h[1],255*h[2],3<h.length?255*h[3]:255);g.background=GLTFViewer.Utils.IsNull(l)||3>l.length?
new GLTFViewer.Utils.RGBA(255,255,255,0):new GLTFViewer.Utils.RGBA(255*l[0],255*l[1],255*l[2],3<l.length?255*l[3]:255);g.title=!GLTFViewer.Utils.IsNull(m)&&m.length?m:[];g.units=f.units;g.other=!GLTFViewer.Utils.IsNull(n)&&n.length?n:[];g.min=f.min;g.max=f.max;g.ticks=f.ticks;g.valueLocation=f.valueLocation;g.logarithmic=GLTFViewer.Utils.IsNull(f.valueLocation)&&!GLTFViewer.Utils.IsNull(f.logarithmic)?1:0;this._ReadImage(a,p,e.bind(this,g))}else GLTFViewer.Utils.WriteErr("ERROR(ReadLegend:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+
"):","bad orientation"),d(null)}}}},_ReadMesh:{value:function(a,c,d){function e(a,c){a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(c&&a.AddPrimitive(c),0<--a.numCallbacksToProcess||(0==a.primitives.length?a.Clear():(a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks())))}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!(this._meshCache[c]||f.meshes&&f.meshes[c]))GLTFViewer.Utils.WriteErr("ERROR(ReadMesh:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+"):","bad id"),
d(null);else{var g=this._meshCache[c];if(g)g.DoCallbacks(d);else{var k=(f=f.meshes[c].primitives)?f.length:0;if(0===k)d(null);else for(g=new GLTFViewer.Utils.FileGLTF.MeshItem(this,c,this._meshCache),g.AddCallback(d),g.numCallbacksToProcess=k,c=0;c<k;++c)this._ReadPrimitive(a,f[c],e.bind(this,g))}}}},_ReadNode:{value:function(a,c,d,e,f){function g(a,c,d){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING||a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_LOADING)d&&("Legend"===
c?a.AddLegend(d):"Mesh"===c?a.AddMesh(d):a.AddChild(d)),0<--a.numCallbacksToProcess||(0===a.meshList.length&&0===Object.keys(a.childList).length&&GLTFViewer.Utils.IsNull(a.legend)?a.Clear():(a.state=a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING?GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK:GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_OK,a.DoCallbacks()))}var k=0,h=[],l=0,m=[],n=null,p=this._nodeCache[this.IDMap(c)],q=!1;if(GLTFViewer.Utils.IsNull(p)){n=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||
!n.nodes||!n.nodes[c]){GLTFViewer.Utils.WriteErr("ERROR(ReadNode:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+"):","bad id");d(null);return}var p=n.nodes[c],k=p.name,l=p.crc,u=this._IsCameraNode(n,c),q=this._IsLegendNode(n,c),r=this._IsMeshNode(n,c);if(!u){if(!r&&!q){d(null);return}if("string"===typeof k&&k.length&&(r=this._nodeCacheNameMap[k])&&!GLTFViewer.Utils.IsNull(l)&&r.crc===l){this._idMap[c]=r.ID;d(null);return}q||(p.mesh?h=[p.mesh]:p.meshes&&"[object Array]"===Object.prototype.toString.call(p.meshes)&&
(h=GLTFViewer.Utils.RemoveDuplicates(p.meshes)),m=GLTFViewer.Utils.RemoveDuplicates(p.children))}if(!this._ValidateNode(n,c,[])){GLTFViewer.Utils.WriteErr("ERROR(ReadNode:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+"):","not valid");d(null);return}var r=GLTFViewer.Utils.IsNull(p.visible)?1:p.visible,w=GLTFViewer.Utils.IsNull(p.matrix)?null:new GLTFViewer.Utils.Transformation(p.matrix),t=p.camera,n=p.legend,p=new GLTFViewer.Utils.FileGLTF.NodeItem(this,c,a,this._nodeCache);"string"===typeof k&&
k.length&&(this._nodeCacheNameMap[k]=p);p.name=k;p.editable=a._editable;p.visible=r;p.crc=l;p.matrix=new GLTFViewer.Utils.FileGLTF.ValueItem(this,w);p.cameraID=t;p.legendID=n;p.meshIDList=h;p.childIDList=m;if(u){p.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;p.DoCallbacks(d);return}}else{if((p.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_OK||!e)&&p.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_LOADING){p.DoCallbacks(d);return}if(p.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_LOADING){--p.refCount;
p.DoCallbacks(function(a,c,d,e,f){this._ReadNode(a,c,d,e,f)}.bind(this,a,c,d,e,f));return}--p.refCount;h=p.meshIDList;m=p.childIDList;n=p.legendID;q=!GLTFViewer.Utils.IsNull(n)}this._idMap[c]=p.ID;k=h?h.length:0;l=m?m.length:0;if(0===k&&0===l&&GLTFViewer.Utils.IsNull(n))d(null);else{p.AddCallback(d);c=p.visible&&(GLTFViewer.Utils.IsNull(f)||f);p.numCallbacksToProcess=l;p.state=c||e?GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING:GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_LOADING;
if(q&&p.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)p.numCallbacksToProcess+=1,this._ReadLegend(a,n,g.bind(this,p,"Legend"));else if(k&&p.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)for(p.numCallbacksToProcess+=k,q=0;q<k;++q)this._ReadMesh(a,h[q],g.bind(this,p,"Mesh"));else if(0===l){p.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_OK;p.DoCallbacks();return}for(q=0;q<l;++q)this._ReadNode(a,m[q],g.bind(this,p,"Node"),e,c)}}},_ReadScene:{value:function(a,
c,d){function e(a,c,d){if(c.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&(d&&(d.cameraID?(c.cameraMatrix=d.matrix.value,c.camera=d):(d.HasName()||(d.name=d.ID),c.AddNode(d))),!(0<--c.numCallbacksToProcess)))if(0===Object.keys(c.sceneNodeItems).length&&c.__NEWSCENE__)c.Clear();else{delete c.__NEWSCENE__;c.__UPDATECAMERA__&&c.camera&&this._cameraCache[c.camera.cameraID]&&(a=this._cameraCache[c.camera.cameraID],c.navigatorState=null,c.cameraMatrix&&(c.cameraMatrix=GLTFViewer.Utils.FileGLTF.CameraToProjection(a.type,
c.cameraMatrix,c.GetBoundingBox())));delete c.__UPDATECAMERA__;for(var e in this._markupCache)a=this._markupCache[e],a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK&&this.IDMap(c.ID)===this.IDMap(a.sceneID)&&(GLTFViewer.Utils.IsNull(a._key)?(a.index=this.MarkupToSceneNodeItemIndex(a),a.Create(c)):a.type===GLTFViewer.Utils.Markup.LINE_TYPE_3D&&!GLTFViewer.Utils.IsNull(a.index)&&GLTFViewer.Utils.IsNull(this._sceneNodeIndexToSceneNode[a.index])&&this.MarkupDelete(a._key));c.SetVisibility();
c.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;c.DoCallbacks()}}var f=a._jsonData;if(!GLTFViewer.Utils.IsNull(c)&&f.scenes&&f.scenes[c]){var g=f.scenes[c],k=GLTFViewer.Utils.FileGLTF.GetName(c,g),h=GLTFViewer.Utils.RemoveDuplicates(g.nodes);GLTFViewer.Utils.IsNull(h)&&(h=[]);var l=this._sceneCache[this.IDMap(c)];GLTFViewer.Utils.IsNull(l)&&(l=this._sceneCacheNameMap[k]);if(GLTFViewer.Utils.IsNull(l))l=new GLTFViewer.Utils.FileGLTF.SceneItem(this,c,this._sceneCache),this._sceneCacheNameMap[k]=
l,l.AddCallback(d),l.editable=a._editable,l.name=k,l.__NEWSCENE__=1,l.__UPDATECAMERA__=1,l.sceneLI=this._viewer.AddEntrySceneList(l,this.SelectScene.bind(this,l)),l.background=g.background,g.ruler&&l.SetRuler(g.ruler);else{if(a._loadType===GLTFViewer.LT_REPLACE){d(null);return}l.refCount=0;l.AddCallback(d);this.SelectScene(l);l.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING;if(a._fileType===GLTFViewer.Utils.FileGLTF.FILE_TYPE_SECONDARY){var m=[];for(d=0;d<h.length;++d)if(this._IsCameraNode(f,
h[d])){m.push(h[d]);break}h=m;l.__UPDATECAMERA__=1}else{l.sceneLI=this._viewer.AddEntrySceneList(l,this.SelectScene.bind(this,l));for(d=0;d<h.length;)this._IsCameraNode(f,h[d])?h.splice(d,1):++d;if(a._loadType!==GLTFViewer.LT_APPEND){f=f.nodes;for(d=0;d<h.length;++d)k=f[h[d]],k=k.name,"string"===typeof k&&k.length&&(k=this._nodeCacheNameMap[k],GLTFViewer.Utils.IsNull(k)||(k.__KEEPME__=1));for(m in l.sceneNodeItems)k=l.sceneNodeItems[m].nodeItem,k.__KEEPME__||l.DeleteNode(k.ID);m=Object.keys(this._nodeCache);
for(d=0;d<m.length;++d)k=this._nodeCache[m[d]],delete k.__KEEPME__}}}this._idMap[c]=l.ID;l.visibility=g.visibility;c=h.length;g.clip&&(l.clipState=null,GLTFViewer.Utils.IsNull(g.clip.visible)||g.clip.visible?(d=g.clip.p0,m=g.clip.p1,f=g.clip.p2,d&&3===d.length&&m&&3===m.length&&f&&3===f.length&&(l.clipP0=new GLTFViewer.Utils.Vec3(d[0],d[1],d[2]),l.clipP1=new GLTFViewer.Utils.Vec3(m[0],m[1],m[2]),l.clipP2=new GLTFViewer.Utils.Vec3(f[0],f[1],f[2]))):(l.clipP0=null,l.clipP1=null,l.clipP2=null));g.explosion&&
(g=1*g.explosion,0<g&&2>=g&&(l.explosion=g));if(c)for(l.numCallbacksToProcess=c,d=0;d<c;++d)this._ReadNode(a,h[d],e.bind(this,a,l),!this._viewer.wantLazyLoad);else e.call(this,a,l,null,null)}else GLTFViewer.Utils.WriteErr("ERROR(ReadScene:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c)+"):","bad id"),d(null)}},_ReadCamera:{value:function(a,c,d){var e=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!e.cameras[c])GLTFViewer.Utils.WriteErr("ERROR(ReadCamera:"+c+"):","bad id"),d(null);else if(a=this._cameraCache[c])a.DoCallbacks(d);
else{var e=e.cameras[c],f=e.type;"perspective"!==f&&"orthographic"!==f?(GLTFViewer.Utils.WriteErr("ERROR(ReadCamera:"+c+"):","bad camera type"),d(null)):(a=new GLTFViewer.Utils.FileGLTF.CameraItem(this,c,this._cameraCache),a.AddCallback(d),a.type=f,e[f]&&(c=e[f],a.xmag=c.xmag,a.ymag=c.ymag,a.yfov=c.yfov,a.aspectRatio=c.aspect_ratio,a.zfar=c.zfar,a.znear=c.znear),a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks())}}},_ReadAnimationParameter:{value:function(a,c,d,e){!GLTFViewer.Utils.IsNull(d)&&
c.parameters&&c.parameters[d]?this._ReadAttribute(a,c.parameters[d],e):(GLTFViewer.Utils.WriteErr("ERROR(ReadAnimationParameter:"+d+"):","bad id"),e(null))}},_ReadAnimationSampler:{value:function(a,c,d,e,f){function g(a,c,d){if(a.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING)if(d){if("Input"===c){if(5126!==d.type){GLTFViewer.Utils.WriteErr("ERROR(ReadAnimationSampler:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"): bad input type");a.Clear();return}a.input=d}else a.output=d;0<
--a.numCallbacksToProcess||(a.input.count!==a.output.count?(GLTFViewer.Utils.WriteErr("ERROR(ReadAnimationSampler:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"): input size != output size"),a.Clear()):(a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks()))}else a.Clear()}if(!GLTFViewer.Utils.IsNull(e)&&d.samplers&&d.samplers[e]){var k=this._animationSamplerCache[c+e];if(k)k.DoCallbacks(f);else{var h=d.samplers[e],k=new GLTFViewer.Utils.FileGLTF.AnimationSamplerItem(this,
c+e,this._animationSamplerCache);k.AddCallback(f);k.interpolation=h.interpolation;k.numCallbacksToProcess=2;this._ReadAnimationParameter(a,d,h.input,g.bind(this,k,"Input"));this._ReadAnimationParameter(a,d,h.output,g.bind(this,k,"Output"))}}else GLTFViewer.Utils.WriteErr("ERROR(ReadAnimationSampler:"+e+"):","bad id"),f(null)}},_ReadAnimationChannel:{value:function(a,c,d,e,f){function g(a,c){a.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING?c&&c.Clear():c?(a.sampler=c,a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,
a.DoCallbacks()):a.Clear()}if(e){var k=e.sampler,h=e.target?e.target.id:null;e=e.target?e.target.path:null;if(GLTFViewer.Utils.IsNull(k)||GLTFViewer.Utils.IsNull(h)||GLTFViewer.Utils.IsNull(e))GLTFViewer.Utils.WriteErr("ERROR(ReadAnimationChannel):","bad channel"),f(null);else{var l=new GLTFViewer.Utils.FileGLTF.AnimationChannelItem(this);l.AddCallback(f);l.targetID=h;l.targetPath=e;this._ReadAnimationSampler(a,c,d,k,g.bind(this,l))}}else f(null)}},_ReadAnimation:{value:function(a,c,d){function e(a,
c){a.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING?c&&c.Clear():c?(a.channelList.push(c),0<--a.numCallbacksToProcess||(a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,a.DoCallbacks())):(GLTFViewer.Utils.WriteErr("ERROR(ReadAnimation:"+GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.ID)+"):","bad channel"),a.Clear())}var f=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!f.animations[c])GLTFViewer.Utils.WriteErr("ERROR(ReadAnimation:"+c+"):","bad id"),d(null);else{var g=this._animationCache[c];
if(g)g.DoCallbacks(d);else if((f=f.animations[c])&&f.channels&&0!==f.channels.length){var k=f.channels,h=k.length,g=new GLTFViewer.Utils.FileGLTF.AnimationItem(this,c,this._animationCache);g.AddCallback(d);g.numCallbacksToProcess=h;for(d=0;d<h;++d)this._ReadAnimationChannel(a,c,f,k[d],e.bind(this,g))}else GLTFViewer.Utils.WriteErr("ERROR(ReadAnimation:"+c+"):","bad animation data"),d(null)}}},_ReadMarkup:{value:function(a,c,d){var e=a._jsonData;if(GLTFViewer.Utils.IsNull(c)||!e.markups[c])GLTFViewer.Utils.WriteErr("ERROR(ReadMarkup:"+
c+"):","bad id"),d(null);else{var f=this._markupCache[c];if(f)f.DoCallbacks(d);else{var f=e.markups[c],e=f.scene,g=GLTFViewer.Utils.IsNull(f.type)?GLTFViewer.Utils.Markup.LINE_TYPE_2D:f.type,k=f.path,h=f.position,l=f.lineColor,m=GLTFViewer.Utils.IsNull(f.lineShape)?GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE:f.lineShape,n=GLTFViewer.Utils.IsNull(f.text)?"":GLTFViewer.Utils.CRLFtoCR(f.text),p=f.textOffset,q=GLTFViewer.Utils.IsNull(f.textAttach)?GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO:f.textAttach,u=
GLTFViewer.Utils.IsNull(f.textSize)?10:f.textSize,r=GLTFViewer.Utils.IsNull(f.textFont)?"sans-serif":f.textFont,w=f.textColor,t=f.backgroundColor;!n.length||g<GLTFViewer.Utils.Markup.LINE_TYPE_2D||g>GLTFViewer.Utils.Markup.LINE_TYPE_3D||1===g&&(m<GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE||m>GLTFViewer.Utils.Markup.LINE_SYMBOL_BALL)||q<GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO||q>GLTFViewer.Utils.Markup.TEXT_ATTACH_SE?(GLTFViewer.Utils.WriteErr("ERROR(ReadMarkup:"+c+"):","bad settings"),d(null)):(f=
new GLTFViewer.Utils.FileGLTF.MarkupItem(this,c,this._markupCache),f.AddCallback(d),f.editable=a._editable,f.type=g,f.index=k,f.sceneID=e,f.position=GLTFViewer.Utils.IsNull(h)||2>h.length?new GLTFViewer.Utils.Vec3(0,0,0):new GLTFViewer.Utils.Vec3(h[0],h[1],2<h.length?h[2]:0),f.lineColor=GLTFViewer.Utils.IsNull(l)||3>l.length?new GLTFViewer.Utils.RGBA(0,0,0,255):new GLTFViewer.Utils.RGBA(255*l[0],255*l[1],255*l[2],3<l.length?255*l[3]:255),f.lineShape=m,f.text=n,f.textOffset=GLTFViewer.Utils.IsNull(p)||
2>p.length?new GLTFViewer.Utils.Vec3(0,0,0):new GLTFViewer.Utils.Vec3(p[0],p[1],0),f.textAttach=q,f.textSize=u,f.textFont=r,f.textColor=GLTFViewer.Utils.IsNull(w)||3>w.length?new GLTFViewer.Utils.RGBA(0,0,0,255):new GLTFViewer.Utils.RGBA(255*w[0],255*w[1],255*w[2],3<w.length?255*w[3]:255),f.backgroundColor=GLTFViewer.Utils.IsNull(t)||3>t.length?new GLTFViewer.Utils.RGBA(255,255,255,128):new GLTFViewer.Utils.RGBA(255*t[0],255*t[1],255*t[2],3<t.length?255*t[3]:255),f.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK,
f.DoCallbacks())}}}},_Readgltf:{value:function(a,c,d,e,f,g){function k(a,c,d,f){if("Camera"===d){if(0>=--c.numCamerasToProcess)if(c.markupIDs.length){if(c.markupIDs.length){for(var g=0;g<c.markupIDs.length;++g)this._ReadMarkup(a,c.markupIDs[g],k.bind(this,a,c,"Markup"));return}}else if(c.animationIDs.length||c.sceneIDs.length){for(g=0;g<c.animationIDs.length;++g)this._ReadAnimation(a,c.animationIDs[g],k.bind(this,a,c,"Animation"));for(g=0;g<c.sceneIDs.length;++g)this._ReadScene(a,c.sceneIDs[g],k.bind(this,
a,c,"Scene"));return}}else if("Markup"===d){if(0>=--c.numMarkupsToProcess&&(c.animationIDs.length||c.sceneIDs.length)){for(g=0;g<c.animationIDs.length;++g)this._ReadAnimation(a,c.animationIDs[g],k.bind(this,a,c,"Animation"));for(g=0;g<c.sceneIDs.length;++g)this._ReadScene(a,c.sceneIDs[g],k.bind(this,a,c,"Scene"));return}}else if("Animation"===d)--c.numAnimationsToProcess;else{if(f){if(GLTFViewer.Utils.IsNull(c.sceneItemName)||c.sceneID===f.ID)c.sceneItemName=f.name;f.__KEEPME__=1}--c.numScenesToProcess}if(0>=
c.numCamerasToProcess&&0>=c.numMarkupsToProcess&&0>=c.numAnimationsToProcess&&0>=c.numScenesToProcess){this._progressBar.Stop();this._empty=!1;for(g in this._sceneCache)d=this._sceneCache[g],f=d.__KEEPME__,delete d.__KEEPME__,a._loadType===GLTFViewer.LT_APPEND||f||this.DeleteScene(d.visIndex);g=a._sceneState;d=null;g&&g.sceneName&&(d=this.FindSceneItemByName(g.sceneName),GLTFViewer.Utils.IsNull(d)&&(g=null));d||GLTFViewer.Utils.IsNull(c.sceneItemName)||(d=this.FindSceneItemByName(c.sceneItemName));
d||(c=Object.keys(this._sceneCache),c.length&&(d=this._sceneCache[c[0]]));d&&(this._curScene=null,d.navigatorState=null,this.SelectScene(d,g));0<Object.keys(this._animationCache).length&&(this._animationInfo=new GLTFViewer.Utils.FileGLTF.AnimationInfo(this,a));e(!0)}}if(a){d!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_SECONDARY&&++this._fileNum;f=new GLTFViewer.Utils.FileGLTF.FileInfo(this._fileNum,a,c,d,d===GLTFViewer.Utils.FileGLTF.FILE_TYPE_SECONDARY,f,g);this._SetFileSizes(f);this._progressTotal=d===
GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY?c.totalZipFileBytes:0;c=(c=a.cameras)?Object.keys(c):[];d=c.length;g=(g=a.animations)?Object.keys(g):[];var h=g.length,l=a.markups,l=l?Object.keys(l):[],m=l.length,n=a.scene,p=a.scenes,p=p?Object.keys(p):GLTFViewer.Utils.IsNull(n)?[]:[n],p=GLTFViewer.Utils.RemoveDuplicates(p),q=p.length;if(0!==q||this._curScene){GLTFViewer.Utils.IsNull(n)&&p.length&&!this._curScene&&(n=p[0]);for(var u=[],r=0;r<q;++r)u=u.concat(a.scenes[p[r]].nodes);u=GLTFViewer.Utils.RemoveDuplicates(u);
this._totalGLTFBytes=this._ComputeLoadSizes(f,u,!this._viewer.wantLazyLoad);!this._progressTotal&&this._totalGLTFBytes&&this._progressBar.Start(this._totalGLTFBytes);a={};a.numCamerasToProcess=d;a.numScenesToProcess=q;a.numAnimationsToProcess=h;a.numMarkupsToProcess=m;a.sceneID=n;a.sceneIDs=p;a.animationIDs=g;a.markupIDs=l;a.sceneItemName=this._curScene?this._curScene.name:null;if(d)for(r=0;r<d;++r)this._ReadCamera(f,c[r],k.bind(this,f,a,"Camera"));else if(m)for(r=0;r<m;++r)this._ReadMarkup(f,l[r],
k.bind(this,f,a,"Markup"));else{for(r=0;r<h;++r)this._ReadAnimation(f,g[r],k.bind(this,f,a,"Animation"));for(r=0;r<q;++r)this._ReadScene(f,p[r],k.bind(this,f,a,"Scene"))}}else e(!1)}else GLTFViewer.Utils.WriteErr("ERROR(Readgltf):","bad GLTF data"),e(!1)}},_ValidateNode:{value:function(a,c,d){if(-1!==d.indexOf(c))return!1;var e=a.nodes[c];if(!e)return!1;if((e=e.children)&&e.length){d.push(c);c=d.length;for(var f=0;f<e.length;++f){if(!this._ValidateNode(a,e[f],d))return!1;d=d.slice(0,c)}}return!0}},
_IsCameraNode:{value:function(a,c){if(GLTFViewer.Utils.IsNull(c))return!1;var d=a.nodes[c];return d?-1!==Object.keys(d).indexOf("camera"):!1}},_IsLegendNode:{value:function(a,c){if(GLTFViewer.Utils.IsNull(c))return!1;var d=a.nodes[c];return d?-1!==Object.keys(d).indexOf("legend"):!1}},_IsLightNode:{value:function(a,c){if(GLTFViewer.Utils.IsNull(c))return!1;var d=a.nodes[c];if(!d)return!1;d=Object.keys(d);return-1!==d.indexOf("light")||-1!==d.indexOf("lights")}},_IsMeshNode:{value:function(a,c){return!this._IsCameraNode(a,
c)&&!this._IsLightNode(a,c)}},_SetBackColor:{value:function(a){try{if(0===a.type){var c=(new GLTFViewer.Utils.RGBA(Math.round(255*a.color1[0]),Math.round(255*a.color1[1]),Math.round(255*a.color1[2]),255)).GetABGR();this._background.SetSolidColors(c,c,c,c)}else if(1===a.type){var d=Math.round(255*a.color1[0]),e=Math.round(255*a.color1[1]),f=Math.round(255*a.color1[2]),g=Math.round(255*a.color2[0]),k=Math.round(255*a.color2[1]),h=Math.round(255*a.color2[2]),c=(new GLTFViewer.Utils.RGBA(d,e,f,255)).GetABGR(),
l=(new GLTFViewer.Utils.RGBA(g,k,h,255)).GetABGR();this._background.SetSolidColors(c,c,l,l)}else 2===a.type?(d=Math.round(255*a.color1[0]),e=Math.round(255*a.color1[1]),f=Math.round(255*a.color1[2]),g=Math.round(255*a.color2[0]),k=Math.round(255*a.color2[1]),h=Math.round(255*a.color2[2]),c=(new GLTFViewer.Utils.RGBA(d,e,f,255)).GetABGR(),l=(new GLTFViewer.Utils.RGBA(g,k,h,255)).GetABGR(),this._background.SetSolidColors(c,l,c,l)):3===a.type&&(d=Math.round(255*a.color1[0]),e=Math.round(255*a.color1[1]),
f=Math.round(255*a.color1[2]),g=Math.round(255*a.color2[0]),k=Math.round(255*a.color2[1]),h=Math.round(255*a.color2[2]),c=(new GLTFViewer.Utils.RGBA(d,e,f,255)).GetABGR(),l=(new GLTFViewer.Utils.RGBA(g,k,h,255)).GetABGR(),this._background.SetSolidColors(c,l,l,c))}catch(m){}}},_ComputeLoadSizes:{value:function(a,c,d){function e(a,c,d,f,g){if(!GLTFViewer.Utils.IsNull(c)&&a.nodes[c]){var h=a.nodes[c],k=GLTFViewer.Utils.IsNull(h.visible)||h.visible;g=f||k&&g;if(!d[c]&&(g&&(d[c]=1),(c=h.children)&&c.length))for(h=
0;h<c.length;++h)e(a,c[h],d,f,g)}}for(var f=0,g=a._jsonData,k={},h=0;h<c.length;++h)e(g,c[h],k,d,!0);var h={},l;for(l in k)if(k=g.nodes[l]){var m=[];k.mesh?m=[k.mesh]:k.meshes&&"[object Array]"===Object.prototype.toString.call(k.meshes)&&(m=k.meshes);for(k=0;k<m.length;++k){var n=m[k];h[n]||this._meshCache[n]||(h[n]=1)}}m=Object.keys(h);d={};c={};l={};for(h=0;h<m.length;++h)if(n=m[h],g.meshes&&(k=g.meshes[n])&&k.primitives&&k.primitives.length)for(var p=k.primitives,k=0;k<p.length;++k){var q=p[k],
n=q.material;void 0===n||d[n]||this._materialCache[n]||(d[n]=1);var u=q.attributes;if(u)for(var r in u)n=u[r],void 0===n||c[n]||this._attributeCache[n]||(c[n]=1);n=q.indices;void 0===n||l[n]||this._indexCache[n]||(l[n]=1)}for(var w in g.animations)if(k=g.animations[w],k.samplers&&k.parameters&&k.channels)for(h=0;h<k.channels.length;++h)(r=k.channels[h].sampler)&&k.samplers[r]&&(m=k.samplers[r],r=m.input,m=m.output,r&&(n=k.parameters[r],GLTFViewer.Utils.IsNull(n)||c[n]||this._attributeCache[n]||(c[n]=
1)),m&&(n=k.parameters[m],GLTFViewer.Utils.IsNull(n)||c[n]||this._attributeCache[n]||(c[n]=1)));k=Object.keys(d);c=Object.keys(c);w=Object.keys(l);l={};for(h=0;h<c.length;++h)if(n=c[h],r=g.attributes[n])r=r.bufferView,void 0===r||l[r]||this._bufferViewCache[r]||(l[r]=1);for(h=0;h<w.length;++h)if(n=w[h],c=g.indices[n])r=c.bufferView,void 0===r||l[r]||this._bufferCache[y]||(l[r]=1);w=Object.keys(l);c={};y={};for(h=0;h<k.length;++h)if(n=k[h],(r=g.materials[n])&&r.instanceTechnique&&(l=r.instanceTechnique.technique,
void 0===l||c[l]||this._techniqueCache[l]||(c[l]=1),r=r.instanceTechnique.values))for(var t in r)l=r[t],"string"===typeof l&&(y[l]||this._textureCache[l]||(y[l]=1));t=Object.keys(c);k={};for(h=0;h<t.length;++h)if(l=t[h],c=g.techniques[l])if(l=c.pass,void 0!==l&&c.passes[l]&&c.passes[l].instanceProgram&&(l=c.passes[l].instanceProgram.program,void 0===l||k[l]||this._programCache[l]||(k[l]=1)),c=c.parameters)for(var x in c)if(l=c[x])l=l.value,"string"===typeof l&&(y[l]||this._textureCache[l]||(y[l]=
1));x=Object.keys(k);t=Object.keys(y);y={};for(h=0;h<t.length;++h)l=t[h],k=g.textures[l],GLTFViewer.Utils.IsNull(k)||(k=k.source,GLTFViewer.Utils.IsNull(k)||y[k]||this._imageCache[k]||(y[k]=1,k=g.images[k],GLTFViewer.Utils.IsNull(k)||(f+=a._loader.GetSize(k.path))));t={};for(h=0;h<x.length;++h)if(l=x[h],y=g.programs[l],!GLTFViewer.Utils.IsNull(y))for(k=0;2>k;++k)l=0===k?y.fragmentShader:y.vertexShader,GLTFViewer.Utils.IsNull(l)||t[l]||this._shaderCache[l]||(t[l]=1,l=g.shaders[l],GLTFViewer.Utils.IsNull(l)||
(f+=a._loader.GetSize(l.path)));x={};for(h=0;h<w.length;++h)if(r=w[h],t=g.bufferViews[r],!GLTFViewer.Utils.IsNull(t)){var y=t.buffer;GLTFViewer.Utils.IsNull(y)||x[y]||this._bufferCache[y]||(x[y]=1,t=g.buffers[y],GLTFViewer.Utils.IsNull(t)||(f+=a._loader.GetSize(t.path)))}return f}},_SetFileSizes:{value:function(a){var c=a._jsonData,d={},e;for(e in c.images)if(!d[e]){d[e]=1;var f=c.images[e];GLTFViewer.Utils.IsNull(f)||(f=f.path,GLTFViewer.Utils.IsNull(f)||a._loader.SetSize(f,1E4))}var d={},g;for(g in c.shaders)d[g]||
(d[g]=1,e=c.shaders[g],GLTFViewer.Utils.IsNull(e)||(e=e.path,GLTFViewer.Utils.IsNull(e)||a._loader.SetSize(e,1E3)));g={};for(var k in c.buffers)g[k]||(g[k]=1,e=c.buffers[k],GLTFViewer.Utils.IsNull(e)||(d=e.path,e=e.byteLength?e.byteLength:0,GLTFViewer.Utils.IsNull(d)||a._loader.SetSize(d,e)))}},_RenderScene:{value:function(a,c,d,e,f,g){if(!this._curScene)return!1;var k=this._navigator;k.projectionGLTM.ToArray(this._uTProj);k.projection2DGLTM.ToArray(this._uTProj2);this._uViewport[0]=0;this._uViewport[1]=
0;this._uViewport[2]=c;this._uViewport[3]=d;k.modelViewTM.ToArray(this._uView);this._curScene.Render(a,c,d,e,f,g);return!0}},_MarkupsToJSON:{value:function(){var a={},c=0,d=GLTFViewer.Utils.FileGLTF.GenerateUniqueID(this._markupCache,"Markup"),e;for(e in this._sceneCache)for(var f=this._sceneCache[e],g=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(e),k=f.markup.GetLineKeys(),h=0;h<k.length;++h){e=k[h];var l=f.markup.GetLine(e);if(l.Editable){var m={};if(l._type===GLTFViewer.Utils.Markup.LINE_TYPE_2D)m.position=
[l._position.x,l._position.y];else if(l._type===GLTFViewer.Utils.Markup.LINE_TYPE_3D){if(m.position=[l._position.x,l._position.y,l._position.z],m.lineColor=[l._lineColor.r/255,l._lineColor.g/255,l._lineColor.b/255,l._lineColor.a/255],m.lineShape=l._lineShape,m.textOffset=[l._textOffset.x,l._textOffset.y],!GLTFViewer.Utils.IsNull(l._index)){var n=this.SceneNodeItemIndexToPath(l._index);GLTFViewer.Utils.IsNull(n)||(m.path=n)}}else continue;m.scene=g;m.type=l._type;m.text=l._text;m.textAttach=l._textAttach;
m.textSize=l._textSize;m.textFont=l._textFont;m.textColor=[l._textColor.r/255,l._textColor.g/255,l._textColor.b/255,l._textColor.a/255];m.backgroundColor=[l._backColor.r/255,l._backColor.g/255,l._backColor.b/255,l._backColor.a/255];++c;a[d]=m;d=GLTFViewer.Utils.FileGLTF.GenerateUniqueID(this._markupCache,GLTFViewer.Utils.FileGLTF.IncrementString(d))}}if(0===c)return null;m={markups:a};return JSON.stringify(m)}},_ViewsToJSON:{value:function(){var a={},c={},d={},e=0,f="Camera",g=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(this._curScene.ID),
k="Node",h;for(h in this._sceneCache){var l=this._sceneCache[h],m={},n={},p={nodes:[]},q=!1;l===this._curScene?q=this._navigator.persp:l.navigatorState?q=l.navigatorState.persp:l.camera&&this._cameraCache[l.camera.cameraID]&&(q="perspective"===this._cameraCache[l.camera.cameraID].type);f=GLTFViewer.Utils.FileGLTF.GenerateUniqueID(this._cameraCache,f);m.type=q?"perspective":"orthographic";c[f]=m;k=GLTFViewer.Utils.FileGLTF.GenerateUniqueID(this._nodeCache,k);n.name=GLTFViewer.Utils.FileGLTF.GenerateUniqueName(this._nodeCache,
f);n.camera=f;if(q=l!==this._curScene?l.navigatorState?l.navigatorState.projectionTM:l.cameraMatrix:this._navigator.projectionTM)m=GLTFViewer.Utils.FileGLTF.ProjectionToCamera(m.type,q),n.matrix=[],m.ToArray(n.matrix);d[k]=n;p.nodes.push(k);p.clip={};if(n=l===this._curScene?this._clip.state:l.clipState)n.clipState===GLTFViewer.Utils.Clip.STATE_DISABLED?p.clip.visible=0:(n=GLTFViewer.Utils.Clip.GetClipPointsFromPlane(n.clipPlane),p.clip.p0=[n.p0.x,n.p0.y,n.p0.z],p.clip.p1=[n.p1.x,n.p1.y,n.p1.z],p.clip.p2=
[n.p2.x,n.p2.y,n.p2.z]);p.explosion=l.explosion;p.visibility=l.GetVisibility();if(l.editable){p.name=l.name;l.background&&(p.background={},p.background.type=l.background.type,l.background.color1&&(p.background.color1=[l.background.color1[0],l.background.color1[1],l.background.color1[2]]),l.background.color2&&(p.background.color2=[l.background.color2[0],l.background.color2[1],l.background.color2[2]]));l.rulerScale&&(p.ruler={},p.ruler.units=l.rulerUnits,p.ruler.scale=l.rulerScale);for(var u in l.sceneNodeItems)GLTFViewer.Utils.IsNull(l.sceneNodeItems[u].nodeItem.camera)&&
p.nodes.push(GLTFViewer.Utils.FileGLTF.FileInfo.RealID(u))}a[GLTFViewer.Utils.FileGLTF.FileInfo.RealID(h)]=p;++e;f=GLTFViewer.Utils.FileGLTF.IncrementString(f);k=GLTFViewer.Utils.FileGLTF.IncrementString(k)}return 0===e?null:JSON.stringify({scene:g,scenes:a,cameras:c,nodes:d})}},MarkupTextEvent:{value:function(a,c){var d=this._curScene;GLTFViewer.Utils.IsNull(d)||("blur"===a?d.markup.OnTextInputBlur(c):"keydown"===a?d.markup.OnTextInputKeyDown(c):"keyup"===a?d.markup.OnTextInputKeyUp(c):"mousedown"===
a?d.markup.OnTextInputMouseDown(c):"mouseup"===a?d.markup.OnTextInputMouseUp(c):"mousemove"===a?d.markup.OnTextInputMouseMove(c):"paste"===a&&d.markup.OnTextInputOnPaste(c))}},MarkupState:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?GLTFViewer.Utils.Markup.STATE_DISABLED:a.markup._state},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup._state=a,a===GLTFViewer.Utils.Markup.STATE_DISABLED&&(c.markup.ResetSelection(),c.markup._hit=0,this._scene.Invalidate(!0)))}},
MarkupLineShape:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE:a.markup.LineShape},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.LineShape=a)}},MarkupLineType:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?GLTFViewer.Utils.Markup.LINE_TYPE_2D:a.markup.LineType},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.LineType=a)}},MarkupLineColor:{get:function(){var a=
this._curScene;return GLTFViewer.Utils.IsNull(a)?new GLTFViewer.Utils.RGBA(0,0,0,255):a.markup.LineColor},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.LineColor=a)}},MarkupFontColor:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?new GLTFViewer.Utils.RGBA(0,0,0,255):a.markup.FontColor},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.FontColor=a)}},MarkupFontSize:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?
GLTFViewer.DEFAULT_MARKUP_FONT_SIZE:a.markup.FontSize},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.FontSize=a)}},MarkupBackColor:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?new GLTFViewer.Utils.RGBA(255,255,255,127):a.markup.BackColor},set:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(c.markup.BackColor=a)}},MarkupSelect:{get:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?0:a.markup._select}},MarkupHit:{get:function(){var a=
this._curScene;return GLTFViewer.Utils.IsNull(a)||a.markup._hitWhat===GLTFViewer.Utils.Markup.Line.HIT_NONE?0:a.markup._hit}},MarkupEditable:{value:function(a){var c=this._curScene;return GLTFViewer.Utils.IsNull(c)?!1:c.markup.Editable(a)}},MarkupStart:{value:function(a,c){var d=this._curScene;GLTFViewer.Utils.IsNull(d)||d.markup.Start(a,c)}},MarkupUpdate:{value:function(a,c){var d=this._curScene;GLTFViewer.Utils.IsNull(d)||d.markup.Update(a,c)}},MarkupEnd:{value:function(a,c){var d=this._curScene;
if(!GLTFViewer.Utils.IsNull(d)){var e=this.MarkupState;d.markup.End(a,c);e===GLTFViewer.Utils.Markup.STATE_CREATE_LINE&&this.CreateMarkupLine(d,!0)}}},MarkupCreate3D:{value:function(a,c){var d=this._curScene;if(!GLTFViewer.Utils.IsNull(d)){var e=this.HitIndx(),f=this.HitPoint(),g=this._sceneNodeIndexToSceneNode.length;if(!(!this.AnyHit()||0>e||e>=g)){var g=this._sceneNodeIndexToSceneNode[this.HitIndx()],k="";null!==this.hit.texture&&(k+=this.hit.texture.toPrecision(6)+" - ");k+=g.GetName();markupItem=
new GLTFViewer.Utils.FileGLTF.MarkupItem(this,"0");markupItem.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;markupItem.editable=!0;markupItem.type=GLTFViewer.Utils.Markup.LINE_TYPE_3D;markupItem.index=e;markupItem.sceneID=this._curScene.ID;markupItem.position=f;markupItem.lineColor=this.MarkupLineColor;markupItem.lineShape=GLTFViewer.Utils.Markup.LINE_SYMBOL_NONE;markupItem.text=k;markupItem.textOffset=new GLTFViewer.Utils.Vec3(0,0,0);markupItem.textAttach=GLTFViewer.Utils.Markup.TEXT_ATTACH_AUTO;
markupItem.textSize=this.MarkupFontSize;markupItem.textFont=null;markupItem.textColor=this.MarkupFontColor;markupItem.backgroundColor=this.MarkupBackColor;markupItem.Create(d)}}}},MarkupDelete:{value:function(a){var c=this._curScene;GLTFViewer.Utils.IsNull(c)||(a=GLTFViewer.Utils.IsNull(a)?c.markup._select:a)&&this.DeleteMarkupLine(c,a)}},MarkupEsc:{value:function(){var a=this._curScene;!GLTFViewer.Utils.IsNull(a)&&a.markup.AnySelection()&&a.markup.EscMarkupLine()}},MarkupTip:{get:function(){var a=
this._curScene;return GLTFViewer.Utils.IsNull(a)?null:a.markup._tip}},HasAnimation:{value:function(){return!GLTFViewer.Utils.IsNull(this._animationInfo)&&this._animationInfo.maxTime>=this._animationInfo.minTime}},AnimationMinTime:{value:function(){return this._animationInfo?this._animationInfo.minTime:0}},AnimationMaxTime:{value:function(){return this._animationInfo?this._animationInfo.maxTime:0}},AnimationShowFrame:{value:function(a){return this._animationInfo?this._animationInfo.Show(a):!1}},SetNodeVisibility:{value:function(a,
c){function d(a,c,d,e){d&&this._progressBar.Stop();e&&(this._any2DOverlay=this._any2D=this._anyOpaque=this._anyTransparent=null,a.visible.value=c,this._scene.Invalidate(!0),this._curScene.UpdateBoundingBox(),this.UpdateWorldScale())}if(a.visible.value!==c){var e=a.nodeItem;if(e.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_OK){var f=e.fileInfo;this._totalGLTFBytes=this._ComputeLoadSizes(f,[e.ID],!0);var g=!this._progressTotal&&0!==this._totalGLTFBytes;g&&this._progressBar.Start(this._totalGLTFBytes);
this._ReadNode(f,e.ID,d.bind(this,a,c,g),!0)}else d.call(this,a,c,!1,e)}}},RenderClipCap:{value:function(a,c,d,e,f){this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUECAP,e,f,-1,null);this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENTCAP,e,f,-1,null)}},Render3D:{value:function(a,c,d,e,f,g,k){if(GLTFViewer.Utils.IsNull(this._anyOpaque)||this._anyOpaque)this._anyRendered=!1,this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUE,e,f,g,k)&&(this._anyOpaque=
this._anyRendered);if(GLTFViewer.Utils.IsNull(this._anyTransparent)||this._anyTransparent)this._anyRendered=!1,this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENT,e,f,g,k)&&(this._anyTransparent=this._anyRendered)}},Render2D:{value:function(a,c,d,e,f){if(GLTFViewer.Utils.IsNull(this._any2D)||this._any2D)this._anyRendered=!1,this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDER2D,e,f,-1,null)&&(this._any2D=this._anyRendered)}},Render2DOverlay:{value:function(a,c){if(GLTFViewer.Utils.IsNull(this._any2DOverlay)||
this._any2DOverlay)this._anyRendered=!1,this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDER2DOVERLAY,a,c,-1,null)&&(this._any2DOverlay=this._anyRendered)}},RenderExport:{value:function(){this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDEREXPORT)}},CanSelect:{value:function(){return!0}},AnySelection:{value:function(){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)||this._scene.MarkupState===GLTFViewer.Utils.Markup.STATE_DISABLED?this._selection&&Object.keys(this._selection).length:
a.markup.AnySelection()}},ResetSelection:{value:function(){var a=this._curScene;if(!GLTFViewer.Utils.IsNull(a)){var c=this.AnySelection();a.markup.ResetSelection();this._selection=null;return c}return!1}},UpdateSelection:{value:function(a,c){var d=this._curScene;return GLTFViewer.Utils.IsNull(d)||this._scene.MarkupState===GLTFViewer.Utils.Markup.STATE_DISABLED?!1:d.markup.UpdateSelection(a,c)}},RenderSelection:{value:function(a,c,d){if(this.AnySelection()||this.AnyHit()){a=this._gl;this._hasLineWidthSupport&&
a.lineWidth(3);this.AnySelection()&&this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDERSELECTION,c,d,-1,null);var e=this._sceneNodeIndexToSceneNode.length;this._selectionMode!==GLTFViewer.SELECTION_NONE&&this.AnyHit()&&0<=this.HitIndx()&&this.HitIndx()<e&&this._RenderScene(GLTFViewer.Utils.FileGLTF._renderType.RENDERHIT,c,d,-1,null);this._hasLineWidthSupport&&a.lineWidth(1)}}},HideBody:{value:function(a){var c=this._sceneNodeIndexToSceneNode.length;if(!(0>a||a>=c)){a=this._sceneNodeIndexToSceneNode[a];
a=a.GetFirstNonDisconnected();for(var c=a.nodeItem,d=0;d<c.sceneNodeItems.length;++d)c.sceneNodeItems[d]===a&&a.visList&&a.visList.ToggleFunc()}}},EditProperties:{value:function(a){var c=this._sceneNodeIndexToSceneNode.length;0>a||a>=c||(a=this._sceneNodeIndexToSceneNode[a],a=a.GetFirstNonDisconnected(),a.EditProperties())}},Reset:{value:function(a){this._totalGLTFBytes=this._progressTotal=0;this._any2DOverlay=this._any2D=this._anyOpaque=this._anyTransparent=null;this.hit.Reset();if(a!==GLTFViewer.LT_APPEND&&
a!==GLTFViewer.LT_UPDATE){a=this._gl;this._curScene=null;this._sceneNodeIndexToSceneNode=[];this._animationInfo=null;if(this._sceneCache)for(var c in this._sceneCache)this._sceneCache[c].Clear();this._sceneCache={};this._sceneCacheNameMap={};if(this._cameraCache)for(c in this._cameraCache)this._cameraCache[c].Clear();this._cameraCache={};if(this._markupCache)for(c in this._markupCache)this._markupCache[c].Clear();this._markupCache={};if(this._animationCache)for(c in this._animationCache)this._animationCache[c].Clear();
this._animationCache={};if(this._animationSamplerCache)for(c in this._animationSamplerCache)this._animationSamplerCache[c].Clear();this._animationSamplerCache={};if(this._legendCache)for(c in this._legendCache)this._legendCache[c].Clear();this._legendCache={};if(this._meshCache)for(c in this._meshCache)this._meshCache[c].Clear();this._meshCache={};if(this._nodeCache)for(c in this._nodeCache)this._nodeCache[c].Clear();this._nodeCache={};this._nodeCacheNameMap={};if(this._attributeCache)for(c in a.bindBuffer(a.ARRAY_BUFFER,
null),this._attributeCache)this._attributeCache[c].Clear();this._attributeCache={};if(this._indexCache)for(c in a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),this._indexCache)this._indexCache[c].Clear();this._indexCache={};if(this._materialCache)for(c in this._materialCache)this._materialCache[c].Clear();this._materialCache={};if(this._techniqueCache)for(c in this._techniqueCache)this._techniqueCache[c].Clear();this._techniqueCache={};if(this._programCache)for(c in this._programCache)this._programCache[c].Clear();
this._programCache={};if(this._bufferViewCache)for(c in this._bufferViewCache)this._bufferViewCache[c].Clear();this._bufferViewCache={};if(this._bufferCache)for(c in this._bufferCache)this._bufferCache[c].Clear();this._bufferCache={};if(this._shaderCache)for(c in this._shaderCache)this._shaderCache[c].Clear();this._shaderCache={};if(this._imageCache)for(c in this._imageCache)this._imageCache[c].Clear();this._imageCache={};if(this._samplerCache)for(c in this._samplerCache)this._samplerCache[c].Clear();
this._samplerCache={};if(this._textureCache)for(c in this._textureCache)this._textureCache[c].Clear();this._textureCache={};this._idMap={};GLTFViewer.Utils.FileBaseClass.prototype.Reset.call(this)}}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.prototype.Reset.call(this);this._loader=null;null!==this._hitTestIndexShader&&(this._hitTestIndexShader.DeleteProgram(),this._hitTestIndexShader=null);null!==this._hitTestIndexClipShader&&(this._hitTestIndexClipShader.DeleteProgram(),this._hitTestIndexClipShader=
null);null!==this._hitTestPositionShader&&(this._hitTestPositionShader.DeleteProgram(),this._hitTestPositionShader=null);null!==this._hitTestPositionClipShader&&(this._hitTestPositionClipShader.DeleteProgram(),this._hitTestPositionClipShader=null);this._uViewport=this._uView=this._uModelViewInvTrp=this._uModelView=this._uModel=this._uTProj2=this._uTProj=this.glCursorRay=this._POSITIONNAME=this._objMatrixName=this._colorName=this._clipName=this._glUniform=null;this.hit.Clear();this._idMap=this.hit=
null;GLTFViewer.Utils.FileBaseClass.prototype.Clear.call(this)}},AnyDirtyMarkups:{value:function(){for(var a in this._sceneCache)if(this._sceneCache[a].markup.IsDirty())return!0;return!1}},ResetDirtyMarkups:{value:function(){for(var a in this._sceneCache)this._sceneCache[a].markup.ResetDirty()}},PostMarkups:{value:function(){if(this.AnyDirtyMarkups()){this.ResetDirtyMarkups();var a=this._MarkupsToJSON();"undefined"!==typeof postMarkups&&postMarkups(a)}}},SaveMarkups:{value:function(a){if(!a)return!1;
var c=this._MarkupsToJSON();try{var d=require("fs");if(c)return d.writeFileSync(a,c),!0;try{d.unlinkSync(a)}catch(e){}}catch(e){GLTFViewer.Utils.WriteErr("ERROR(SaveMarkups:"+a+"): "+e)}return!1}},ReadMarkups:{value:function(a,c){function d(a,c){this._scene.EnableUpdate(!0);if(c)for(var d in this._markupCache){var k=this._markupCache[d];if(k.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK&&GLTFViewer.Utils.IsNull(k._key))for(var h in this._sceneCache){var l=this._sceneCache[h];this.IDMap(l.ID)===
this.IDMap(k.sceneID)&&(k.index=this.MarkupToSceneNodeItemIndex(k),k.Create(l))}}GLTFViewer.Utils.IsNull(a)||a()}this.CanMarkup?(this.DeleteAllMarkups(),this._scene.EnableUpdate(!1),this._Readgltf(a,null,GLTFViewer.Utils.FileGLTF.FILE_TYPE_SECONDARY,d.bind(this,c),GLTFViewer.LT_APPEND)):GLTFViewer.Utils.IsNull(c)||c()}},PostViews:{value:function(){var a=this._ViewsToJSON();"undefined"!==typeof postViews&&postViews(a)}},SaveViews:{value:function(a){if(!a)return!1;var c=this._ViewsToJSON();try{var d=
require("fs");if(c)return d.writeFileSync(a,c),!0;try{d.unlinkSync(a)}catch(e){}}catch(e){GLTFViewer.Utils.WriteErr("ERROR(SaveViews:"+a+"): "+e)}return!1}},ReadViews:{value:function(a,c,d){function e(a,c){this._scene.EnableUpdate(!0);GLTFViewer.Utils.IsNull(a)||a()}this.CanCreateViews?(this.DeleteAllViews(),this._scene.EnableUpdate(!1),this._Readgltf(a,null,GLTFViewer.Utils.FileGLTF.FILE_TYPE_SECONDARY,e.bind(this,c),GLTFViewer.LT_UPDATE,d)):GLTFViewer.Utils.IsNull(c)||c()}},ReadFile:{value:function(a,
c,d){this.Reset(c);this._fileType===GLTFViewer.FT_GLTF?this._other?this._Readgltf(this._data,this._other,GLTFViewer.Utils.FileGLTF.FILE_TYPE_LOCAL,a,c,d):this._Readgltf(this._data,null,GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL,a,c,d):this._fileType===GLTFViewer.FT_AVZ&&("string"!==typeof this._other?this._Readgltf(this._data,this._other,GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY,a,c,d):this._Readgltf(this._data,this._other,GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_DISK,a,c,d))}},SceneNodeItemIndexToPath:{value:function(a){var c=
null;for(a=this._sceneNodeIndexToSceneNode[a];a;){var d=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a.nodeItem.ID),c=c?d+";"+c:d;a=a.parent}return c}},MarkupToSceneNodeItemIndex:{value:function(a){function c(a,c){var d=[];c=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c);for(var e in a){var l=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(e);c===l&&d.push(e)}return d}function d(a,e,k,h){if(0>h)return null;var l=c(e,k[h]);if(0===l.length)return null;var m=[];0<h&&(m=c(e,k[h-1]));for(var n=0;n<l.length;++n){var p=
e[l[n]].sceneNodeItems;if(0!=p.length)for(var q=0;q<p.length;++q){var u=p[q],r=u.parent;if(0===m.length){if(GLTFViewer.Utils.IsNull(r)&&u===a.sceneNodeItems[u.nodeItem.ID])return u}else if(0<=m.indexOf(r.nodeItem.ID))return u=d(a,e,k,h-1),GLTFViewer.Utils.IsNull(u)?null:u.childList[k[h]]}}return null}var e=a.index;a=a.sceneID;if("string"!==typeof e)return e;if(GLTFViewer.Utils.IsNull(e))return null;e=e.split(";");return(e=d(this._sceneCache[this.IDMap(a)],this._nodeCache,e,e.length-1))?e.index:null}},
GetSelections:{value:function(){if(!this.AnySelection())return null;var a=[];for(key in this._selection){var c=this._selection[key].indx;GLTFViewer.Utils.IsNull(c)||0>c||a.push(c)}return a}},CreateScene:{value:function(a,c){var d=GLTFViewer.Utils.IsNull(c);if(c=d?this._curScene:c){var e=c.Clone(a);e.sceneLI=this._viewer.AddEntrySceneList(e,this.SelectScene.bind(this,e));var f=this._curScene;this.SelectScene(e);d||this._scene.EnableUpdate(!1);c.markupVis&&c.markupVis.displayedValue!==e.markupVis.displayedValue&&
e.markupVis.ToggleFunc();c.markupVisEditable&&c.markupVisEditable.displayedValue!==e.markupVisEditable.displayedValue&&e.markupVisEditable.ToggleFunc();d||(this._scene.EnableUpdate(!0),this.SelectScene(f))}}},DeleteScene:{value:function(a){var c=!1,d=null,e;for(e in this._sceneCache){var f=this._sceneCache[e];if(f===a){f.Clear();if(this._curScene)return;this._curScene=null;c=!0}else if(d=f,c)break}this.SelectScene(d)}},HitIndexTip:{value:function(){if(-100>this.HitIndx()){var a=this._curScene;return GLTFViewer.Utils.IsNull(a)?
null:a.markup.GetTip()}a=this._sceneNodeIndexToSceneNode.length;if(!this.AnyHit()||0>this.HitIndx()||this.HitIndx()>=a)return null;var a=this._sceneNodeIndexToSceneNode[this.HitIndx()],c="";if(this._scene.MarkupState===GLTFViewer.Utils.Markup.STATE_ENABLED&&this.MarkupLineType===GLTFViewer.Utils.Markup.LINE_TYPE_3D){var d=this.HitPoint();d&&(c="("+d.x.toPrecision(4)+", "+d.y.toPrecision(4)+", "+d.z.toPrecision(4)+")  ")}null!==this.hit.texture&&(c+=this.hit.texture.toPrecision(6)+" - ");return c+=
a.GetName()}},HitTestFindClosestIndex:{value:function(a){var c=this.AnyHit()&&!a;a?(this.hit.indx=Math.floor(a[2]+.5),this.hit.texture=a[1]?a[3]:null,c=!0):(this.hit.indx=null,this.hit.texture=null);return c}},HitTestFindClosestPos:{value:function(a){return a?(this.hit.SetPnt(a[1],a[2],a[3]),this.HitPoint()):null}},HitTest:{value:function(a,c,d,e,f){return!f&&this.CheckMarkupHit(e)?!0:this.HitTestPos(a,c,d,e,!0)}}});
Object.defineProperties(GLTFViewer.Utils.FileGLTF,{FindByName:{value:function(a,c){for(var d in a)if(a[d].name===c)return a[d];return null}},IncrementString:{value:function(a){var c=a.match(/(.*)([^0-9])([0-9]*)/);return 4===c.length&&c[3].length?String(c[1])+String(c[2])+String(1*c[3]+1):a+"1"}},GenerateUniqueID:{value:function(a,c){for(c=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c);;){var d=!1,e;for(e in a){var f=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(e);if(c===f){d=!0;break}}if(!d)return c;
c=GLTFViewer.Utils.FileGLTF.IncrementString(c)}}},GenerateUniqueName:{value:function(a,c){for(;;){if(!GLTFViewer.Utils.FileGLTF.FindByName(a,c))return c;c=GLTFViewer.Utils.FileGLTF.IncrementString(c)}}},GetName:{value:function(a,c){if(GLTFViewer.Utils.IsNull(c))return"";var d=c.name;if(GLTFViewer.Utils.IsNull(d)||0===d.length)d=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(a);return d}}});
GLTFViewer.Utils.FileGLTF.FileInfo=function(a,c,d,e,f,g,k){this._fileNum=a;this._loader=new GLTFViewer.Utils.FileGLTF.Loader;this._FixGLTF(c);this._jsonData=c;this._files=d;this._fileType=e;this._editable=f;this._loadType=g;this._sceneState=k};
GLTFViewer.Utils.FileGLTF.FileInfo.prototype=Object.create(null,{_fileNum:{writable:!0,value:null},_loader:{writable:!0,value:null},_jsonData:{writable:!0,value:null},_files:{writable:!0,value:null},_fileType:{writable:!0,value:0},_editable:{writable:!0,value:!1},_loadType:{writable:!0,value:0},_sceneState:{writable:!0,value:null},_RenameKeys:{value:function(a,c){for(var d in a)a[c+d]=a[d],delete a[d]}},_RenameValue:{value:function(a,c,d){c=c.split(".");var e=c[0];c.shift();for(var f in a)if("*"===
e||f===e){if("object"===typeof a[f])if("[object Array]"===Object.prototype.toString.call(a[f]))for(var g=0;g<a[f].length;++g)"object"===typeof a[f][g]?this._RenameValue(a[f][g],c.join("."),d):"string"===typeof a[f][g]&&(a[f][g]=d+a[f][g]);else this._RenameValue(a[f],c.join("."),d);else"string"===typeof a[f]&&(a[f]=d+a[f]);if("*"!==e)break}}},_RenameString:{value:function(a,c,d,e){var f=c.split(".");c=f[0];f.shift();for(var g in a)if("*"===c||g===c){if("string"===typeof a[g])if(GLTFViewer.Utils.IsNull(d))a[g]=
e+a[g];else{for(var f=a[g].split(d),k="",h=0;h<f.length;++h)0<h&&(k+=d),k+=e+f[h];a[g]=k}if("*"!==c)break}}},_FixGLTF:{value:function(a){if(a){var c="__"+this._fileNum+"__",d;for(d in a)switch(d){case "buffers":case "images":case "samplers":case "shaders":case "cameras":case "lights":this._RenameKeys(a[d],c);break;case "bufferViews":this._RenameKeys(a[d],c);for(var e in a[d])this._RenameValue(a[d][e],"buffer",c);break;case "markups":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],
"scene",c),this._RenameString(a[d][e],"path",";",c);break;case "legends":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"image",c);break;case "textures":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"sampler",c),this._RenameValue(a[d][e],"source",c);break;case "programs":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"fragmentShader",c),this._RenameValue(a[d][e],"vertexShader",c);break;case "techniques":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],
"parameters.*.value",c),this._RenameValue(a[d][e],"parameters.*.source",c),this._RenameValue(a[d][e],"passes.*.instanceProgram.program",c);break;case "materials":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"instanceTechnique.technique",c),this._RenameValue(a[d][e],"instanceTechnique.values.*",c);break;case "indices":case "attributes":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"bufferView",c);break;case "meshes":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],
"primitives.material",c),this._RenameValue(a[d][e],"primitives.indices",c),this._RenameValue(a[d][e],"primitives.attributes.*",c);break;case "nodes":this._RenameKeys(a[d],c);for(e in a[d])this._RenameValue(a[d][e],"mesh",c),this._RenameValue(a[d][e],"camera",c),this._RenameValue(a[d][e],"legend",c),this._RenameValue(a[d][e],"light",c),this._RenameValue(a[d][e],"meshes",c),this._RenameValue(a[d][e],"lights",c),this._RenameValue(a[d][e],"children",c);break;case "animations":this._RenameKeys(a[d],c);
for(e in a[d])if(this._RenameKeys(a[d][e].samplers,c),this._RenameValue(a[d][e],"parameters.*",c),a[d][e].channels)for(var f=0;f<a[d][e].channels.length;++f)this._RenameValue(a[d][e].channels[f],"sampler",c),this._RenameValue(a[d][e].channels[f],"target.id",c);break;case "scenes":this._RenameKeys(a[d],c);for(e in a[d]){var g=function(a,c){this._RenameKeys(a,c);for(var d in a)g.call(this,a[d].children,c)};this._RenameValue(a[d][e],"nodes",c);g.call(this,a[d][e].visibility,c)}break;case "scene":this._RenameValue(a,
"scene",c)}}}}});Object.defineProperties(GLTFViewer.Utils.FileGLTF.FileInfo,{RealID:{value:function(a){var c=a.match(/^__[^_]*__/);return c&&c.length?a.substr(c[0].length):a}}});GLTFViewer.Utils.FileGLTF.ItemBaseClass=function(a,c,d){this.gltf=a;this.ID=c;this.cache=d;this.Callbacks=[];GLTFViewer.Utils.IsNull(d)||(d[c]=this)};
GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype=Object.create(null,{constructor:{value:GLTFViewer.Utils.FileGLTF.ItemBaseClass},gltf:{writable:!0,value:null},numCallbacksToProcess:{writable:!0,value:0},Callbacks:{writable:!0,value:null},cache:{writable:!0,value:null},ID:{writable:!0,value:null},state:{writable:!0,value:1},refCount:{writable:!0,value:0},editable:{writable:!0,value:!1},Reset:{value:function(){}},Clear:{value:function(){if(0>=this.refCount||0<--this.refCount)return!1;this.cache&&!GLTFViewer.Utils.IsNull(this.ID)&&
delete this.cache[this.ID];this.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_BAD;this.DoCallbacks();return!0}},AddCallback:{value:function(a){GLTFViewer.Utils.IsNull(a)||0<=this.Callbacks.indexOf(a)||(++this.refCount,this.Callbacks.push(a))}},DoCallbacks:{value:function(a){this.AddCallback(a);if(this.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&this.state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_LOADING&&0!==this.Callbacks.length){a=this.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_BAD?
null:this;var c=this.Callbacks;this.Callbacks=[];for(var d=0;d<c.length;++d)c[d](a)}}}});Object.defineProperties(GLTFViewer.Utils.FileGLTF.ItemBaseClass,{STATE_BAD:{value:-1},STATE_OK:{value:0},STATE_LOADING:{value:1},STATE_PARTIAL_OK:{value:2},STATE_PARTIAL_LOADING:{value:3}});GLTFViewer.Utils.FileGLTF.ShaderItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.ShaderItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.ShaderItem},glslShader:{writable:!0,value:null},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.glslShader=null)}}});GLTFViewer.Utils.FileGLTF.ImageItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.ImageItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.ImageItem},image:{writable:!0,value:null},generateMipmap:{writable:!0,value:1},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.image=null)}}});GLTFViewer.Utils.FileGLTF.BufferItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.BufferItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.BufferItem},byteLength:{writable:!0,value:0},buffer:{writable:!0,value:null},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.buffer=null)}}});GLTFViewer.Utils.FileGLTF.BufferViewItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.BufferViewItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.BufferViewItem},byteLength:{writable:!0,value:0},byteOffset:{writable:!0,value:0},buffer:{writable:!0,value:null},target:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.buffer&&this.buffer.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&
this.buffer&&(this.buffer.Clear(),this.buffer=null)}}});GLTFViewer.Utils.FileGLTF.AttributeItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.AttributeItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.AttributeItem},byteStride:{writable:!0,value:0},byteOffset:{writable:!0,value:0},count:{writable:!0,value:0},type:{writable:!0,value:0},size:{writable:!0,value:0},baseType:{writable:!0,value:0},bufferView:{writable:!0,value:null},data:{writable:!0,value:null},buffer:{writable:!0,value:null},normalized:{writable:!0,value:!1},_mn:{writable:!0,
value:null},mn:{get:function(){if(!GLTFViewer.Utils.IsNull(this._mn))return this._mn;this._CalculateMinMax();return this._mn},set:function(a){this._mn=a}},_mx:{writable:!0,value:null},mx:{get:function(){if(!GLTFViewer.Utils.IsNull(this._mx))return this._mx;this._CalculateMinMax();return this._mx},set:function(a){this._mx=a}},_CalculateMinMax:{value:function(){this._mn=[];this._mx=[];for(var a=0,c=0;c<this.count;++c)for(var d=0;d<this.size;++d,++a){var e=this.data[a];0===c?this._mn[d]=this._mx[d]=
e:(this._mn[d]=Math.min(this._mn[d],e),this._mx[d]=Math.max(this._mx[d],e))}}},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.bufferView&&this.bufferView.Reset()}},Clear:{value:function(){var a=this.gltf;GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.bufferView&&(this.bufferView.Clear(),this.bufferView=null),this.buffer&&(a._gl.bindBuffer(a._gl.ARRAY_BUFFER,null),a._gl.deleteBuffer(this.buffer),this.buffer=null),this._mx=
this._mn=this.data=null)}}});GLTFViewer.Utils.FileGLTF.IndexItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.IndexItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.IndexItem},bufferView:{writable:!0,value:null},data:{writable:!0,value:null},buffer:{writable:!0,value:null},byteOffset:{writable:!0,value:0},count:{writable:!0,value:0},type:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.bufferView&&this.bufferView.Reset()}},Clear:{value:function(){var a=
this.gltf;GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.bufferView&&(this.bufferView.Clear(),this.bufferView=null),this.buffer&&(a._gl.bindBuffer(a._gl.ELEMENT_ARRAY_BUFFER,null),a._gl.deleteBuffer(this.buffer),this.buffer=null),this.data=null)}}});GLTFViewer.Utils.FileGLTF.SamplerItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.SamplerItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.SamplerItem},magFilter:{writable:!0,value:0},minFilter:{writable:!0,value:0},wrapS:{writable:!0,value:0},wrapT:{writable:!0,value:0}});GLTFViewer.Utils.FileGLTF.TextureItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.TextureItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.TextureItem},format:{writable:!0,value:0},target:{writable:!0,value:0},sampler:{writable:!0,value:null},image:{writable:!0,value:null},texture:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.sampler&&this.sampler.Reset();this.image&&this.image.Reset()}},Clear:{value:function(){var a=
this.gltf;GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.sampler&&(this.sampler.Clear(),this.sampler=null),this.image&&(this.image.Clear(),this.image=null),this.texture&&(a._gl.bindTexture(this.target,null),a._gl.deleteTexture(this.texture),this.texture=null))}}});GLTFViewer.Utils.FileGLTF.ProgramItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.ProgramItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.ProgramItem},fragment:{writable:!0,value:null},vertex:{writable:!0,value:null},program:{writable:!0,value:null},programClip:{writable:!0,value:null},programCap:{writable:!0,value:null},programPeel:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.fragment&&this.fragment.Reset();
this.vertex&&this.vertex.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.fragment&&(this.fragment.Clear(),this.fragment=null),this.vertex&&(this.vertex.Clear(),this.vertex=null),this.program&&(this.program.DeleteProgram(),this.program=null),this.programClip&&(this.programClip.DeleteProgram(),this.programClip=null),this.programCap&&(this.programCap.DeleteProgram(),this.programCap=null),this.programPeel&&(this.programPeel.DeleteProgram(),this.programPeel=
null))}}});GLTFViewer.Utils.FileGLTF.PassItem=function(a,c){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c);this.attributes={};this.uniforms={};this.states={}};
GLTFViewer.Utils.FileGLTF.PassItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.PassItem},attributes:{writable:!0,value:null},uniforms:{writable:!0,value:null},program:{writable:!0,value:null},states:{writable:!0,value:null},is2D:{writable:!0,value:!1},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.program&&this.program.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&
(this.program&&(this.program.Clear(),this.program=null),this.states=this.uniforms=this.attributes=null)}}});GLTFViewer.Utils.FileGLTF.ValueItem=function(a,c){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a);GLTFViewer.Utils.IsNull(c)||(this.valueInitial=c,this.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK)};
GLTFViewer.Utils.FileGLTF.ValueItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.ValueItem},_valueInitialSet:{writable:!0,value:!1},_valueInitial:{writable:!0,value:null},_value:{writable:!0,value:null},valueInitial:{get:function(){return this._valueInitial},set:function(a){this._valueInitialSet=!0;this._value=this._valueInitial=a}},value:{get:function(){return this._value},set:function(a){this._value=a}},texture:{writable:!0,
value:null},semantic:{writable:!0,value:null},source:{writable:!0,value:null},type:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this._value=this._valueInitialSet?this._valueInitial:null;this.texture&&this.texture.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this._valueInitialSet=!1,this._value=this._valueInitial=null,this.texture&&(this.texture.Clear(),this.texture=null),this.source=
this.semantic=null)}},Clone:{value:function(){var a=new GLTFViewer.Utils.FileGLTF.ValueItem(this.gltf,this.valueInitial);a.refCount=1;a.editable=!0;a.texture=this.texture;a.semantic=this.semantic;a.source=this.source;a.type=this.type;a.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;return a}}});GLTFViewer.Utils.FileGLTF.TechniqueItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.parameters={}};
GLTFViewer.Utils.FileGLTF.TechniqueItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.TechniqueItem},pass:{writable:!0,value:null},parameters:{writable:!0,value:null},is2D:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.pass&&this.pass.Reset();for(var a in this.parameters)this.parameters[a].Reset()}},Clear:{value:function(){if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){this.pass&&
(this.pass.Clear(),this.pass=null);for(var a in this.parameters)this.parameters[a].Clear();this.parameters=null}}}});GLTFViewer.Utils.FileGLTF.MaterialItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.values={};this.attributes=[];this.semanticUniforms=[];this.valueUniforms={}};
GLTFViewer.Utils.FileGLTF.MaterialItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.MaterialItem},technique:{writable:!0,value:null},values:{writable:!0,value:null},attributes:{writable:!0,value:null},semanticUniforms:{writable:!0,value:null},valueUniforms:{writable:!0,value:null},program:{writable:!0,value:null},frontFace:{writable:!0,value:null},blendEnable:{writable:!0,value:null},cullFaceEnable:{writable:!0,value:null},
cullFace:{writable:!0,value:null},depthTestEnable:{writable:!0,value:null},depthMask:{writable:!0,value:null},lineWidth:{writable:!0,value:null},polygonOffsetFillEnable:{writable:!0,value:null},polygonOffsetFactor:{writable:!0,value:null},polygonOffsetUnits:{writable:!0,value:null},is2D:{writable:!0,value:!1},solidColor:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.technique&&this.technique.Reset();for(var a in this.values){var c=
this.values[a];c.Reset();var d=this.valueUniforms[a];if(d)if(GLTFViewer.Utils.IsNull(d.data.length)||d.data.length!==c.value.length)"number"===typeof d.data&&"number"===typeof this.values[a].value&&(d.data=this.values[a].value);else for(var e=0;e<c.value.length;++e)d.data[e]=this.values[a].value[e]}}},Clear:{value:function(){if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){this.technique&&(this.technique.Clear(),this.technique=null);for(var a in this.values)this.values[a].Clear();
this.values=null;if(this.attributes){for(var c=0;c<this.attributes.length;++c)this.attributes[c].Clear();this.attributes=null}if(this.semanticUniforms){for(c=0;c<this.semanticUniforms.length;++c)this.semanticUniforms[c].Clear();this.semanticUniforms=null}if(this.valueUniforms){for(a in this.valueUniforms)this.valueUniforms[a].Clear();this.valueUniforms=null}this.solidColor=this.program=null}}}});
GLTFViewer.Utils.FileGLTF.PrimitiveItem=function(a){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a);this.attributes={};this._bbox=new GLTFViewer.Utils.Box};
GLTFViewer.Utils.FileGLTF.PrimitiveItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.PrimitiveItem},mode:{writable:!0,value:0},material:{writable:!0,value:null},indices:{writable:!0,value:null},isPickable:{writable:!0,value:null},attributes:{writable:!0,value:null},_bbox:{writable:!0,value:null},activeTexture:{writable:!0,value:0},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.material&&
this.material.Reset();this.indices&&this.indices.Reset();for(var a in this.attributes)this.attributes[a].Reset()}},Clear:{value:function(){if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){this.material&&(this.material.Clear(),this.material=null);this.indices&&(this.indices.Clear(),this.indices=null);for(var a in this.attributes)this.attributes[a].Clear();this._bbox=this.isPickable=this.attributes=null}}},SetBoundingBox:{value:function(a,c){this._bbox.Set(a,c)}},BoundingBox:{value:function(a){var c=
this._bbox.Clone();a&&!a.IsIdentity()&&c.Multiply(a);return c}},RenderExport:{value:function(a){function c(a){a=new GLTFViewer.Utils.Vec3(k.data[3*a+0],k.data[3*a+1],k.data[3*a+2]);a.Transform(n);switch(f._exportType){case "STL":e.writeSync(f._exportFH,"vertex "+a.x+" "+a.y+" "+a.z+"\n");break;case "STLBIN":f._exportBuffer.writeFloatLE(a.x,0),f._exportBuffer.writeFloatLE(a.y,4),f._exportBuffer.writeFloatLE(a.z,8),e.writeSync(f._exportFH,f._exportBuffer,0,12),f._exportDataSize+=12}}var d=this.material;
if(!(4!==this.mode&&5!==this.mode&&6!==this.mode||d.is2D)){for(var e=require("fs"),f=this.gltf,g=this.indices,d=this.material,k=null,h=0;h<d.attributes.length;h++){var l=d.attributes[h],m=this.attributes[l.data];if(l.data===f._POSITIONNAME){if(35665!==m.type){GLTFViewer.Utils.WriteErr("ERROR(RenderExport:"+a+"):","bad POSITION");return}k=m}else if("NORMAL"===l.data&&35665!==m.type){GLTFViewer.Utils.WriteErr("ERROR(RenderExport:"+a+"):","bad NORMAL");return}}if(!GLTFViewer.Utils.IsNull(k)){var n=new GLTFViewer.Utils.Transformation(f._uModel);
if(g)for(d=0,l=1,m=2;m<g.count;){switch(f._exportType){case "STL":a=new GLTFViewer.Utils.Vec3(0,0,0);e.writeSync(f._exportFH,"facet normal "+a.x+" "+a.y+" "+a.z+"\n");e.writeSync(f._exportFH,"outer loop\n");break;case "STLBIN":a=new GLTFViewer.Utils.Vec3(0,0,0),f._exportBuffer.writeFloatLE(a.x,0),f._exportBuffer.writeFloatLE(a.y,4),f._exportBuffer.writeFloatLE(a.z,8),e.writeSync(f._exportFH,f._exportBuffer,0,12),f._exportDataSize+=12}c(g.data[d]);c(g.data[l]);c(g.data[m]);switch(f._exportType){case "STL":e.writeSync(f._exportFH,
"endloop\n");e.writeSync(f._exportFH,"endfacet\n");break;case "STLBIN":f._exportBuffer.writeUInt16LE(0,0),e.writeSync(f._exportFH,f._exportBuffer,0,2),f._exportDataSize+=2}switch(this.mode){case 5:1==h%2?d=m:l=m;++m;break;case 6:l=m;++m;break;default:d+=3,l+=3,m+=3}}else if(4===this.mode)for(g=k.count,h=0;h<g-2;h+=3){switch(f._exportType){case "STL":a=new GLTFViewer.Utils.Vec3(0,0,0);e.writeSync(f._exportFH,"facet normal "+a.x+" "+a.y+" "+a.z+"\n");e.writeSync(f._exportFH,"outer loop\n");break;case "STLBIN":a=
new GLTFViewer.Utils.Vec3(0,0,0),f._exportBuffer.writeFloatLE(a.x,0),f._exportBuffer.writeFloatLE(a.y,4),f._exportBuffer.writeFloatLE(a.z,8),e.writeSync(f._exportFH,f._exportBuffer,0,12),f._exportDataSize+=12}c(h);c(h+1);c(h+2);switch(f._exportType){case "STL":e.writeSync(f._exportFH,"endloop\n");e.writeSync(f._exportFH,"endfacet\n");break;case "STLBIN":f._exportBuffer.writeUInt16LE(0,0),e.writeSync(f._exportFH,f._exportBuffer,0,2),f._exportDataSize+=2}}}}}},Render:{value:function(a,c,d,e,f,g,k,h){if(d===
GLTFViewer.Utils.FileGLTF._renderType.RENDEREXPORT)this.RenderExport(a);else{var l=this.gltf,m=this.material,n=d===GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUECAP||d===GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENTCAP,p=d===GLTFViewer.Utils.FileGLTF._renderType.RENDERHIT,q=d===GLTFViewer.Utils.FileGLTF._renderType.RENDERSELECTION,u=(GLTFViewer.Utils.IsNull(this.isPickable)?!0:this.isPickable)&&!m.is2D;if(!p&&!q||m.program.programCap)if(!n||!(!m.program.programCap||GLTFViewer.Utils.IsNull(m.solidColor)||
4>this.mode))if(d!==GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKPOS&&d!==GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKIDX||u)if(d!==GLTFViewer.Utils.FileGLTF._renderType.RENDER2D||m.is2D)if(d!==GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUE&&d!==GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUECAP||!m.blendEnable.data)if(d!==GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENT&&d!==GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENTCAP||m.blendEnable.data){d=(u=d===GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKIDX)||
d===GLTFViewer.Utils.FileGLTF._renderType.RENDERPICKPOS;var r=l._gl;this.activeTexture=0;var w=l.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE;if(!d){h=0<g?m.program.programPeel:m.program.program;n||p||q?h=m.program.programCap:w&&(m.program.programClip?h=m.program.programClip:w=!1);if(!h.StartProgram())return;0<g&&(r.uniform2f(h.uSze,e,f),r.uniform1i(h.uPass,g),1<g&&(r.activeTexture(r.TEXTURE0+this.activeTexture),r.bindTexture(r.TEXTURE_2D,k),r.uniform1i(h.DepthTex,this.activeTexture++)))}e=
!1;for(f=0;f<m.attributes.length;f++){k=m.attributes[f];var t=this.attributes[k.data];if(d){if(k.data===l._POSITIONNAME){if(35665!==t.type){GLTFViewer.Utils.WriteErr("ERROR(PICK:"+a+"):","bad POSITION");return}r.bindBuffer(r.ARRAY_BUFFER,t.buffer);r.vertexAttribPointer(h.aPos,t.size,t.baseType,t.normalized,t.byteStride,t.byteOffset)}u&&"TEXCOORD0"===k.data&&5126===t.type&&(r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(h.aTexCoord0,1,t.baseType,t.normalized,t.byteStride,t.byteOffset),
e=!0)}else r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(h[k.name],t.size,t.baseType,t.normalized,t.byteStride,t.byteOffset)}!e&&u&&(t=this.attributes[l._POSITIONNAME],r.bindBuffer(r.ARRAY_BUFFER,t.buffer),r.vertexAttribPointer(h.aTexCoord0,1,t.baseType,t.normalized,t.byteStride,t.byteOffset));a=this.attributes[l._POSITIONNAME].count;this.indices&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indices.buffer);if(d)r.uniform1i(h.uHasTexture,e),r.uniformMatrix4fv(h.uTWd,!1,l._uModelView),u&&
r.uniform1f(h.uIdx,c);else{for(f=0;f<m.semanticUniforms.length;f++)k=m.semanticUniforms[f],k.setter(r,h[k.name],k.data,this);for(var x in m.valueUniforms)k=m.valueUniforms[x],k.setter(r,h[k.name],k.data,this)}if(p||q)c=new Float32Array(4),c[0]=1,c[1]=(p?216:100)/255,c[2]=0,c[3]=70/255,r.uniform4fv(h[l._colorName],c),c[0]=0,c[1]=0,c[2]=0,c[3]=0,r.uniform4fv(h[l._clipName],c);w&&(r.uniformMatrix4fv(h[l._objMatrixName],!1,l._uModel),n?(r.uniform4fv(h[l._colorName],m.solidColor),r.uniform4fv(h[l._clipName],
l._clip.glClip1)):r.uniform4fv(h[l._clipName],l._clip.glClip0));0>g&&(n?r.depthFunc(r.LESS):r.depthFunc(m.depthFunc.data),!m.depthTestEnable.data&&!n||p||q?r.disable(r.DEPTH_TEST):r.enable(r.DEPTH_TEST),p||q?(r.depthMask(!1),r.enable(r.BLEND)):d||n||(r.depthMask(m.depthMask.data),m.blendEnable.data?r.enable(r.BLEND):r.disable(r.BLEND)));this._hasLineWidthSupport&&r.lineWidth(m.lineWidth.data);r.frontFace(m.frontFace.data);m.polygonOffsetFillEnable.data&&!n?(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(m.polygonOffsetFactor.data,
m.polygonOffsetUnits.data)):r.disable(r.POLYGON_OFFSET_FILL);if(!d&&(m.blendEnable.data||p||q)&&0!==this.mode&&!n&&0>g){r.enable(r.CULL_FACE);if(!m.cullFaceEnable.data||1029!==m.cullFace.data&&1032!==m.cullFace.data)r.cullFace(r.FRONT),this.indices?r.drawElements(this.mode,this.indices.count,r.UNSIGNED_SHORT,0):r.drawArrays(this.mode,0,a),l._anyRendered=!0;if(!m.cullFaceEnable.data||1028!==m.cullFace.data&&1032!==m.cullFace.data)r.cullFace(r.BACK),this.indices?r.drawElements(this.mode,this.indices.count,
r.UNSIGNED_SHORT,0):r.drawArrays(this.mode,0,a),l._anyRendered=!0;r.disable(r.CULL_FACE)}else!m.cullFaceEnable.data||0===this.mode||n||p||q?(this.indices?r.drawElements(this.mode,this.indices.count,r.UNSIGNED_SHORT,0):r.drawArrays(this.mode,0,a),l._anyRendered=!0):1032!==m.cullFace.data&&(r.enable(r.CULL_FACE),r.cullFace(m.cullFace.data),this.indices?r.drawElements(this.mode,this.indices.count,r.UNSIGNED_SHORT,0):r.drawArrays(this.mode,0,a),r.disable(r.CULL_FACE),l._anyRendered=!0);0>g&&(r.depthFunc(r.LESS),
r.disable(r.DEPTH_TEST),!d&&!n||p||q)&&(r.depthMask(!0),r.disable(r.BLEND));this._hasLineWidthSupport&&r.lineWidth(1);r.frontFace(r.CCW);for(m.polygonOffsetFillEnable.data&&!n&&r.disable(r.POLYGON_OFFSET_FILL);0<this.activeTexture;)--this.activeTexture,r.activeTexture(r.TEXTURE0+this.activeTexture),r.bindTexture(r.TEXTURE_2D,null);this.indices&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,null);r.bindBuffer(r.ARRAY_BUFFER,null)}}}}});
GLTFViewer.Utils.FileGLTF.LegendItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.ID=c;this.title=[];this.other=[]};
GLTFViewer.Utils.FileGLTF.LegendItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.LegendItem},x:{writable:!0,value:0},y:{writable:!0,value:0},attachment:{writable:!0,value:15},size:{writable:!0,value:.5},vertical:{writable:!0,value:!0},border:{writable:!0,value:!1},foreground:{writable:!0,value:null},background:{writable:!0,value:null},title:{writable:!0,value:null},units:{writable:!0,value:null},other:{writable:!0,value:null},
image:{writable:!0,value:null},min:{writable:!0,value:0},max:{writable:!0,value:1},ticks:{writable:!0,value:null},valueLocation:{writable:!0,value:null},logarithmic:{writable:!0,value:!1},_legend:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.image&&this.image.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.other=this.units=this.title=this.background=this.foreground=
null,this.image&&(this.image.Clear(),this.image=null),this.valueLocation=this.ticks=null)}},Render:{value:function(a){a===GLTFViewer.Utils.FileGLTF._renderType.RENDER2DOVERLAY&&(GLTFViewer.Utils.IsNull(this._legend)&&(this._legend=new GLTFViewer.Utils.Legend(this.gltf._scene,this.vertical,this.x,this.y,this.size,this.attachment,this.border,this.foreground,this.background,this.title,this.min,this.max,this.ticks,this.valueLocation,this.logarithmic,this.image.image,this.units,this.other)),this.gltf._anyRendered=
!0,this._legend.Render())}}});GLTFViewer.Utils.FileGLTF.MeshItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.primitives=[]};
GLTFViewer.Utils.FileGLTF.MeshItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.MeshItem},primitives:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);for(var a=0;a<this.primitives.length;++a)this.primitives[a].Reset()}},Clear:{value:function(){if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){for(var a=0;a<this.primitives.length;++a)this.primitives[a].Clear();
this.primitives=null}}},AddPrimitive:{value:function(a){this.primitives.push(a)}},BoundingBox:{value:function(a){var c=new GLTFViewer.Utils.Box;if(this.primitives)for(var d=0;d<this.primitives.length;++d)c.Unite(this.primitives[d].BoundingBox(a));return c}},Render:{value:function(a,c,d,e,f,g,k,h){if(this.primitives&&0!==this.primitives.length){var l=this.gltf._gl;if(d===GLTFViewer.Utils.FileGLTF._renderType.RENDEROPAQUECAP||d===GLTFViewer.Utils.FileGLTF._renderType.RENDERTRANSPARENTCAP){l.enable(l.CULL_FACE);
l.clear(l.DEPTH_BUFFER_BIT);l.enable(l.POLYGON_OFFSET_FILL);l.polygonOffset(0,-1);l.colorMask(!1,!1,!1,!1);l.cullFace(l.BACK);for(var m=0;m<this.primitives.length;++m){var n=this.primitives[m];n.Render(a,c,d,e,f,g,k,h)}l.colorMask(!0,!0,!0,!0);l.disable(l.POLYGON_OFFSET_FILL);l.cullFace(l.FRONT);for(m=0;m<this.primitives.length;++m)n=this.primitives[m],n.Render(a,c,d,e,f,g,k,h);l.disable(l.CULL_FACE)}else for(m=0;m<this.primitives.length;++m)n=this.primitives[m],n.Render(a,c,d,e,f,g,k,h)}}}});
GLTFViewer.Utils.FileGLTF.NodeItem=function(a,c,d,e){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,e);this.ID=c;this.fileInfo=d;this.meshIDList=[];this.meshList=[];this.childIDList=[];this.childList={};this.sceneNodeItems=[]};
GLTFViewer.Utils.FileGLTF.NodeItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.NodeItem},legendID:{writable:!0,value:null},legend:{writable:!0,value:null},meshIDList:{writable:!0,value:null},meshList:{writable:!0,value:null},childIDList:{writable:!0,value:null},childList:{writable:!0,value:null},sceneNodeItems:{writable:!0,value:null},fileInfo:{writable:!0,value:null},name:{writable:!0,value:null},visible:{writable:!0,value:!0},
matrix:{writable:!0,value:null},cameraID:{writable:!0,value:null},crc:{writable:!0,value:null},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.legend&&this.legend.Reset();for(var a=0;a<this.meshList.length;++a)this.meshList[a].Reset();for(var c in this.childList)this.childList[c].Reset();this.matrix&&this.matrix.Reset()}},Clear:{value:function(){var a=this.gltf,c=this.ID;if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){this.legend&&
this.legend.Clear();this.legendID=this.legend=null;for(var d=0;d<this.meshList.length;++d)this.meshList[d].Clear();this.meshIDList=this.meshList=null;for(var e in this.childList)this.childList[e].Clear();this.name=this.fileInfo=this.sceneNodeItems=this.childIDList=this.childList=null;this.matrix&&(this.matrix.Clear(),this.matrix=null);this.cameraID=null;for(e in a._nodeCacheNameMap)this===a._nodeCacheNameMap[e]&&delete a._nodeCacheNameMap[e];for(e in a._idMap)a._idMap[e]===c&&delete a._idMap[e]}}},
AddLegend:{value:function(a){this.legend=a}},AddMesh:{value:function(a){this.meshList.push(a)}},AddChild:{value:function(a){this.childList[a.ID]=a}},HasName:{value:function(){return!GLTFViewer.Utils.IsNull(this.name)&&"string"===typeof this.name&&0<this.name.length}},SetVisibility:{value:function(a){for(var c=0;c<this.sceneNodeItems.length;++c){var d=this.sceneNodeItems[c];d.visible.value!==a&&(d.visList?d.visList.ToggleFunc():d.SetVisibility(a))}}}});
GLTFViewer.Utils.FileGLTF.SceneNodeItem=function(a,c,d){this.nodeItem=d instanceof GLTFViewer.Utils.FileGLTF.SceneNodeItem?d.nodeItem:d;var e=GLTFViewer.Utils.IsNull(c)?1:c.visible.value,f=GLTFViewer.Utils.IsNull(c)?0:c.disconnect,e=(this.disconnect=!this.nodeItem.HasName()||f)?e:this.nodeItem.visible;this.gltf=a;this.parent=c;this.childList={};this.visible=new GLTFViewer.Utils.FileGLTF.ValueItem(a,e?1:0);this.SetVisibility=a.SetNodeVisibility.bind(a,this);this.EditProperties=this._EditProperties.bind(this);
for(var g in d.childList)this.childList[g]=new GLTFViewer.Utils.FileGLTF.SceneNodeItem(a,this,d.childList[g]);this.nodeItem.sceneNodeItems.push(this);this.index=a._sceneNodeIndexToSceneNode.length;a._sceneNodeIndexToSceneNode.push(this)};
GLTFViewer.Utils.FileGLTF.SceneNodeItem.prototype=Object.create(null,{gltf:{writable:!0,value:null},nodeItem:{writable:!0,value:null},childList:{writable:!0,value:null},parent:{writable:!0,value:null},visible:{writable:!0,value:null},visList:{writable:!0,value:null},index:{writable:!0,value:0},disconnect:{writable:!0,value:!1},SetVisibility:{writable:!0,value:null},EditProperties:{writable:!0,value:null},_GetEditableNodeIDs:{value:function(a){if(GLTFViewer.Utils.IsNull(a))a=[];else if(this.disconnect){if(0<=
a.indexOf(this.nodeItem.ID))return a}else return a;a.push(this.nodeItem.ID);for(var c in this.childList)this.childList[c]._GetEditableNodeIDs(a);return a}},_GetEditableMeshIDs:{value:function(){for(var a=this._GetEditableNodeIDs(),c=[],d=0;d<a.length;++d)for(var e=this.gltf._nodeCache[a[d]].meshIDList,f=0;f<e.length;++f){var g=e[f];0>c.indexOf(g)&&c.push(g)}return c}},_GetEditableMaterialIDs:{value:function(){for(var a=this._GetEditableMeshIDs(),c=[],d=0;d<a.length;++d)for(var e=this.gltf._meshCache[a[d]].primitives,
f=0;f<e.length;++f){var g=e[f].material,k=g.ID;0>c.indexOf(k)&&Object.keys(g.valueUniforms).length&&c.push(k)}return c}},_EditProperties:{value:function(){function a(a,c,d,e){if(d){d=new GLTFViewer.Utils.Transformation(e[1]);if(!d.IsIdentity()||a.matrix.value)a.matrix.value=d;var f=null,g=2;for(a=0;a<c.length;++a,++g){var h=function(){if(GLTFViewer.Utils.IsNull(f)||f!==l)f=l,++g},k=c[a].name,l=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c[a].materialItem.ID);d=c[a].shaderParam;switch(d.type){case "LIST":switch(k){case "cullFace":h();
d.data="FRONT"===e[g]?1028:"FRONT_AND_BACK"===e[g]?1032:1029;break;case "depthFunc":h();h=513;"NEVER"===e[g]?h=512:"EQUAL"===e[g]?h=514:"LEQUAL"===e[g]?h=515:"GREATER"===e[g]?h=516:"NOTEQUAL"===e[g]?h=517:"GEQUAL"===e[g]?h=518:"ALWAYS"===e[g]&&(h=519);d.data=h;break;case "frontFace":h(),d.data="CW"===e[g]?2304:2305}break;case 5124:case 5126:case 35670:h();isNaN(e[g])||(d.data=e[g]);break;case 35678:--g;break;default:for(h(),h=0;h<e[g].length;++h)isNaN(e[g][h])||(d.data[h]=e[g][h])}}this.gltf._anyTransparent=
null;this.gltf._anyOpaque=null;this.gltf._scene.Invalidate(!0)}}function c(a,c,e){e&&(a=d(a,c,!0),e(a))}function d(a,c,d){var e=[];e.push([a.name,GLTFViewer.Utils.Dialog.DATALABEL]);var f;if(a.matrix.value){var g=d?a.matrix.valueInitial:a.matrix.value;GLTFViewer.Utils.IsNull(g)||(f=[],g.ToArray(f))}GLTFViewer.Utils.IsNull(f)&&(f=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);e.push(["matrix",GLTFViewer.Utils.Dialog.DATANUMBERVEC,f]);var h=null;for(a=0;a<c.length;++a){var g=function(){if(GLTFViewer.Utils.IsNull(h)||
h!==l)h=l,e.push([l,GLTFViewer.Utils.Dialog.DATALABEL])},k=c[a].name,l=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c[a].materialItem.ID);f=c[a].defaultValue;var m=c[a].shaderParam;f=d?f:m.data;switch(m.type){case "LIST":switch(k){case "cullFace":g();e.push([k,GLTFViewer.Utils.Dialog.DATALIST,1028===f?"FRONT":1032===f?"FRONT_AND_BACK":"BACK",["BACK","FRONT","FRONT_AND_BACK"]]);break;case "depthFunc":g();g="LESS";512===f?g="NEVER":514===f?g="EQUAL":515===f?g="LEQUAL":516===f?g="GREATER":517===f?g="NOTEQUAL":
518===f?g="GEQUAL":519===f&&(g="ALWAYS");e.push([k,GLTFViewer.Utils.Dialog.DATALIST,g,"ALWAYS EQUAL GEQUAL GREATER LEQUAL LESS NEVER NOTEQUAL".split(" ")]);break;case "frontFace":g(),e.push([k,GLTFViewer.Utils.Dialog.DATALIST,2304===f?"CW":"CCW",["CCW","CW"]])}break;case 5124:g();e.push([k,GLTFViewer.Utils.Dialog.DATAINTEGER,f]);break;case 5126:g();e.push([k,GLTFViewer.Utils.Dialog.DATANUMBER,f]);break;case 35670:g();e.push([k,GLTFViewer.Utils.Dialog.DATACHECKBOX,f]);break;case 35678:break;default:g(),
e.push([k,GLTFViewer.Utils.Dialog.DATANUMBERVEC,f])}}return e}for(var e=this._GetEditableMaterialIDs(),f=[],g=0;g<e.length;++g){for(var k=this.gltf._materialCache[e[g]],h=k.valueUniforms,l=Object.keys(h),m=0;m<l.length;++m){valueName=l[m];var n=k.values[valueName],p=h[valueName];f.push({name:valueName,materialItem:k,defaultValue:n?n.valueInitial:p.defaultData,shaderParam:p})}f.push({name:"lineWidth",materialItem:k,defaultValue:k.lineWidth.defaultValue,shaderParam:k.lineWidth});f.push({name:"cullFaceEnable",
materialItem:k,defaultValue:k.cullFaceEnable.defaultValue,shaderParam:k.cullFaceEnable});f.push({name:"cullFace",materialItem:k,defaultValue:k.cullFace.defaultValue,shaderParam:k.cullFace});f.push({name:"depthTestEnable",materialItem:k,defaultValue:k.depthTestEnable.defaultValue,shaderParam:k.depthTestEnable});f.push({name:"depthMask",materialItem:k,defaultValue:k.depthMask.defaultValue,shaderParam:k.depthMask});f.push({name:"depthFunc",materialItem:k,defaultValue:k.depthFunc.defaultValue,shaderParam:k.depthFunc});
f.push({name:"blendEnable",materialItem:k,defaultValue:k.blendEnable.defaultValue,shaderParam:k.blendEnable});f.push({name:"frontFace",materialItem:k,defaultValue:k.frontFace.defaultValue,shaderParam:k.frontFace});f.push({name:"polygonOffsetFillEnable",materialItem:k,defaultValue:k.polygonOffsetFillEnable.defaultValue,shaderParam:k.polygonOffsetFillEnable});f.push({name:"polygonOffset/factor",materialItem:k,defaultValue:k.polygonOffsetFactor.defaultValue,shaderParam:k.polygonOffsetFactor});f.push({name:"polygonOffset/units",
materialItem:k,defaultValue:k.polygonOffsetUnits.defaultValue,shaderParam:k.polygonOffsetUnits})}e=d(this.nodeItem,f,!1);e.length&&new GLTFViewer.Utils.Dialog("Properties",e,!0,a.bind(this,this.nodeItem,f),c.bind(this,this.nodeItem,f))}},Reset:{value:function(){this.nodeItem&&this.nodeItem.Reset();for(var a in this.childList)this.childList[a].Reset();this.visible.value!==this.visible.valueInitial&&this.visList&&this.visList.ToggleFunc()}},Clear:{value:function(){delete this.gltf._sceneNodeIndexToSceneNode[this.index];
if(this.nodeItem.sceneNodeItems)for(var a=0;a<this.nodeItem.sceneNodeItems.length;++a)if(this.nodeItem.sceneNodeItems[a]===this){this.nodeItem.sceneNodeItems.splice(a,1);break}GLTFViewer.Utils.IsNull(this.parent)&&this.nodeItem.Clear();this.nodeItem=null;for(var c in this.childList)this.childList[c].Clear();this.childList=null;this.visList&&(this.gltf._viewer.DeleteEntryVisibilityList(this.visList),this.visList=null);this.visible.Clear();this.gltf=this.EditProperties=this.SetVisibility=this.parent=
this.visible=null}},IsHit:{value:function(){var a=this.gltf.HitIndx();if(GLTFViewer.Utils.IsNull(a))return!1;a=this.gltf._sceneNodeIndexToSceneNode[a];return GLTFViewer.Utils.IsNull(a)?!1:this.GetIndex()===a.GetIndex()}},IsSelected:{value:function(){var a=this.gltf._selection;if(GLTFViewer.Utils.IsNull(a)||0===Object.keys(a).length)return!1;var c=this.GetIndex();for(key in a){var d=this.gltf._sceneNodeIndexToSceneNode[a[key].indx];if(!GLTFViewer.Utils.IsNull(d)&&c===d.GetIndex())return!0}return!1}},
Clone:{value:function(){var a=new GLTFViewer.Utils.FileGLTF.SceneNodeItem(this.gltf,null,this);++a.nodeItem.refCount;return a}},IsVisible:{value:function(){return this.nodeItem.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK&&(this.disconnect?this.parent?this.parent.IsVisible():!0:this.visible.value)}},GetName:{value:function(){var a=this.parent?this.parent.GetName():"";this.disconnect||(a+=(a.length?"~":"")+this.nodeItem.name);return a}},GetFirstNonDisconnected:{value:function(){return this.disconnect?
this.parent.GetFirstNonDisconnected():this}},GetIndex:{value:function(){return this.disconnect?this.parent?this.parent.GetIndex():null:this.index}},GetVisibility:{value:function(){var a={visible:this.visible.value},c={},d;for(d in this.childList){var e=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(d);c[e]=this.childList[d].GetVisibility()}a.children=c;return a}},AccumulatedMatrix:{value:function(){for(var a=[],c=this.parent;c;)c.nodeItem.matrix.value&&a.push(c.nodeItem),c=c.parent;for(var c=GLTFViewer.Utils.Transformation.Identity,
d=a.length-1;0<=d;--d)c.Multiply(a[d].matrix.value);return c}},BoundingBox:{value:function(a,c,d,e){e=e?e.Clone():GLTFViewer.Utils.Transformation.Identity;var f=this.IsVisible(),g=this.nodeItem;g.matrix.value&&e.Multiply(g.matrix.value);var k=GLTFViewer.Utils.Box.empty;if(f&&g.meshList&&g.meshList.length){for(var h=0;h<g.meshList.length;++h)k.Unite(g.meshList[h].BoundingBox(e));!k.IsEmpty()&&c&&k.Multiply(GLTFViewer.Utils.ExplosionMatrix(a,k.GetCenter(),c))}if(!d)for(var l in this.childList)g=this.childList[l],
g.disconnect&&!f||k.Unite(g.BoundingBox(a,c,d,e));return k}},Render:{value:function(a,c,d,e,f,g,k){var h=this.gltf,l=!1,m=!1,n=this.nodeItem,p=this.IsVisible(),q=h._navigator,u=a;n.matrix.value&&!n.matrix.value.IsIdentity()&&(u=u.Clone().Multiply(n.matrix.value));var r=q.modelViewTM,q=q.modelViewInvTrp,w=u;c!==GLTFViewer.Utils.FileGLTF._renderType.RENDER2D&&(l=c!==GLTFViewer.Utils.FileGLTF._renderType.RENDERHIT?!1:this.IsHit(),m=c!==GLTFViewer.Utils.FileGLTF._renderType.RENDERSELECTION?!1:this.IsSelected(),
0<h.GetExplosion()&&(w=h.GetSceneBox(!0).GetCenter(),a=this.BoundingBox(null,0,!0).GetCenter().TransformCreate(a),w=GLTFViewer.Utils.ExplosionMatrix(w,a,h.GetExplosion()).Multiply(u)),w.IsIdentity()||(r=r.Clone().Multiply(w),q=r.Clone().Invert().Transpose()));w.ToArray(h._uModel);r.ToArray(h._uModelView);q.ToArray3x3(h._uModelViewInvTrp);if(p&&n.meshList&&c!==GLTFViewer.Utils.FileGLTF._renderType.RENDER2DOVERLAY&&(c!==GLTFViewer.Utils.FileGLTF._renderType.RENDERHIT&&c!=GLTFViewer.Utils.FileGLTF._renderType.RENDERSELECTION||
l||m))for(h=0;h<n.meshList.length;++h)n.meshList[h].Render(this.nodeItem.name,this.index,c,d,e,f,g,k);for(var t in this.childList)h=this.childList[t],h.disconnect&&!p||h.Render(u,c,d,e,f,g,k);p&&n.legend&&c===GLTFViewer.Utils.FileGLTF._renderType.RENDER2DOVERLAY&&n.legend.Render(c)}}});GLTFViewer.Utils.FileGLTF.SceneItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.sceneNodeItems={};this.name=c;this.markup=new GLTFViewer.Utils.Markup(a._scene)};
GLTFViewer.Utils.FileGLTF.SceneItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.SceneItem},camera:{writable:!0,value:null},cameraMatrix:{writable:!0,value:null},name:{writable:!0,value:null},sceneNodeItems:{writable:!0,value:null},visibility:{writable:!0,value:null},sceneLI:{writable:!0,value:null},_box:{writable:!0,value:null},_explodeBox:{writable:!0,value:null},explosion:{writable:!0,value:0},background:{writable:!0,value:null},
rulerUnits:{writable:!0,value:null},rulerScale:{writable:!0,value:1},navigatorState:{writable:!0,value:null},clipState:{writable:!0,value:null},markup:{writable:!0,value:null},markupVis:{writable:!0,value:null},markupVisEditable:{writable:!0,value:null},clipP0:{writable:!0,value:null},clipP1:{writable:!0,value:null},clipP2:{writable:!0,value:null},update:{writable:!0,value:!1},_BoundingBox:{value:function(a){var c=a?this._box.GetCenter():null;a=a?this.gltf.GetExplosion():0;var d=GLTFViewer.Utils.Box.empty,
e;for(e in this.sceneNodeItems)d.Unite(this.sceneNodeItems[e].BoundingBox(c,a));return d}},GetBoundingBox:{value:function(a){GLTFViewer.Utils.IsNull(this._box)&&this.UpdateBoundingBox();return a?this._box:this._explodeBox}},UpdateBoundingBox:{value:function(){this._box=this._BoundingBox(!1);this.gltf.GetExplosion()?this._explodeBox=this._BoundingBox(!0):this._explodeBox=this._box.Clone();this.gltf._curScene===this&&this.gltf._scene.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE&&this.gltf._clip.UpdateClip()}},
Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);for(var a in this.sceneNodeItems)this.sceneNodeItems[a].Reset();this.camera&&this.camera.Reset();this._explodeBox=this._box=null;this.explosion=0;this.clipState=this.navigatorState=null;this.markup.ResetSelection();this.SetVisibility()}},Clear:{value:function(){var a=this.gltf,c=this.ID;if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){a._curScene==this&&(a._curScene=null);this.camera&&
(this.camera.Clear(),this.camera=null);this.name=this.cameraMatrix=null;for(var d in this.sceneNodeItems)this.sceneNodeItems[d].Clear();this.sceneNodeItems=null;this.sceneLI&&(a._viewer.DeleteEntrySceneList(this.sceneLI),this.sceneLI=null);this.clipState=this.clipP2=this.clipP1=this.clipP0=this.navigatorState=this.rulerUnits=this.background=this._explodeBox=this._box=this.visibility=null;for(var e=this.markup.GetLineKeys(),f=0;f<e.length;++f)a.DeleteMarkupLine(this,e[f]);this.markup=null;if(a._markupCache)for(d in a._markupCache)e=
a._markupCache[d],a.IDMap(c)===a.IDMap(e.sceneID)&&a._markupCache[d].Clear();for(d in this.gltf._sceneCacheNameMap)this===this.gltf._sceneCacheNameMap[d]&&delete this.gltf._sceneCacheNameMap[d];for(d in a._idMap)a._idMap[d]===c&&delete a._idMap[d]}}},DeleteNode:{value:function(a){var c=this.sceneNodeItems[a];return GLTFViewer.Utils.IsNull(c)?!1:(c.Clear(),delete this.sceneNodeItems[a],this.UpdateBoundingBox(),!0)}},DeleteNodeByName:{value:function(a){for(var c in this.sceneNodeItems){var d=this.sceneNodeItems[c];
if(!GLTFViewer.Utils.IsNull(d)&&d.nodeItem.name===a)return this.DeleteNode(c)}return!1}},AddNode:{value:function(a){var c=a.ID,d=a.visible,e=this.sceneNodeItems[c];if(GLTFViewer.Utils.IsNull(e)){var f=a.name,g;for(g in this.sceneNodeItems)if(e=this.sceneNodeItems[g],!GLTFViewer.Utils.IsNull(e)&&e.nodeItem.name===f){d=this.sceneNodeItems[e.nodeItem.ID].IsVisible();break}}else d=e.IsVisible();a.visible=d;!this.DeleteNode(c)&&"string"===typeof a.name&&a.name.length&&this.DeleteNodeByName(a.name);a=new GLTFViewer.Utils.FileGLTF.SceneNodeItem(this.gltf,
null,a);this.sceneNodeItems[c]=a;this.UpdateBoundingBox()}},GetVisibility:{value:function(){var a={},c;for(c in this.sceneNodeItems){var d=GLTFViewer.Utils.FileGLTF.FileInfo.RealID(c);a[d]=this.sceneNodeItems[c].GetVisibility()}return a}},SetVisibility:{value:function(){function a(c,e){if(!GLTFViewer.Utils.IsNull(c)&&!GLTFViewer.Utils.IsNull(e)){e.visible!==c.visible.value&&(c.visList?c.visList.ToggleFunc():c.SetVisibility(e.visible));for(var f in e.children)a(c.childList[f],e.children[f])}}if(!GLTFViewer.Utils.IsNull(this.visibility))for(var c in this.visibility)a(this.sceneNodeItems[c],
this.visibility[c])}},SetRuler:{value:function(a){this.rulerScale=a.scale;this.rulerUnits=a.units}},Render:{value:function(a,c,d,e,f,g){for(var k in this.sceneNodeItems)this.sceneNodeItems[k].Render(GLTFViewer.Utils.Transformation.Identity,a,c,d,e,f,g,!1)}},Clone:{value:function(a){var c=this.gltf,d,e;this===c._curScene?(d=c._navigator.projectionTM,e=c._clip.state):(d=this.navigatorState?this.navigatorState.projectionTM:this.cameraMatrix,e=this.clipState);var f=GLTFViewer.Utils.FileGLTF.GenerateUniqueID(c._sceneCache,
this.ID),f=new GLTFViewer.Utils.FileGLTF.SceneItem(c,f,c._sceneCache);c._sceneCacheNameMap[a]=f;f.refCount=1;f.editable=!0;f.name=GLTFViewer.Utils.FileGLTF.GenerateUniqueName(c._sceneCache,a);f.cameraMatrix=d.Clone();this.camera&&(f.camera=this.camera,++this.camera.refCount);this.background&&(f.background={type:this.background.type},this.background.color1&&(f.background.color1=[this.background.color1[0],this.background.color1[1],this.background.color1[2]]),this.background.color2&&(f.background.color2=
[this.background.color2[0],this.background.color2[1],this.background.color2[2]]));this.rulerScale&&f.SetRuler({scale:this.rulerScale,units:this.rulerUnits});e&&e.clipPlane&&(f.clipState={},f.clipState.clipState=e.clipState,f.clipState.clipPlane=e.clipPlane.Clone(),a=GLTFViewer.Utils.Clip.GetClipPointsFromPlane(e.clipPlane),f.clipP0=a.p0,f.clipP1=a.p1,f.clipP2=a.p2);f.explosion=this.explosion;for(var g in this.sceneNodeItems)f.sceneNodeItems[g]=this.sceneNodeItems[g].Clone();f.state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;
a=this.markup.GetLineKeys();for(c=0;c<a.length;++c)g=a[c],g=this.markup.GetLine(g),f.markup.CreateMarkupLine(g);return f}}});GLTFViewer.Utils.FileGLTF.CameraItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.CameraItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.CameraItem},type:{writable:!0,value:null},xmag:{writable:!0,value:1},ymag:{writable:!0,value:1},yfov:{writable:!0,value:0},aspectRatio:{writable:!0,value:1},zfar:{writable:!0,value:0},znear:{writable:!0,value:0},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.type=null)}}});
GLTFViewer.Utils.FileGLTF.MarkupItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.MarkupItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.MarkupItem},type:{writable:!0,value:null},sceneID:{writable:!0,value:null},position:{writable:!0,value:null},index:{writable:!0,value:null},lineColor:{writable:!0,value:null},lineShape:{writable:!0,value:0},text:{writable:!0,value:null},textOffset:{writable:!0,value:null},textAttach:{writable:!0,value:0},textSize:{writable:!0,value:10},textFont:{writable:!0,
value:null},textColor:{writable:!0,value:null},backgroundColor:{writable:!0,value:null},_key:{writable:!0,value:null},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this._key=this.backgroundColor=this.textColor=this.textFont=this.textOffset=this.text=this.lineColor=this.position=this.sceneID=this.type=null)}},Create:{value:function(a){if(this.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK){var c=this.gltf;c.IDMap(a.ID)===c.IDMap(this.sceneID)&&
(this._key&&c.DeleteMarkupLine(a,this._key),this._key=c.CreateMarkupLine(a,this.editable,this.type,this.position,this.index,this.lineColor,this.lineShape,this.text,this.textOffset,this.textAttach,this.textSize,this.textFont,this.textColor,this.backgroundColor))}}},Destroy:{value:function(a){if(!GLTFViewer.Utils.IsNull(this._key)){var c=this.gltf;c.IDMap(a.ID)===c.IDMap(this.sceneID)&&(c.DeleteMarkupLine(a,this._key),this._key=null)}}}});
GLTFViewer.Utils.FileGLTF.AnimationSamplerItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d)};
GLTFViewer.Utils.FileGLTF.AnimationSamplerItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.AnimationSamplerItem},interpolation:{writable:!0,value:null},input:{writable:!0,value:null},output:{writable:!0,value:null},minTime:{get:function(){return this.input?this.input.mn:0}},maxTime:{get:function(){return this.input?this.input.mx:-1}},GetValue:{value:function(a){var c=this.input,d=this.output,e=null,f=null,g;if(2>c.count)g=
f=e=0;else if(a<this.minTime)e=null,f=0,g=null;else if(a>=this.maxTime)e=c.count-1,f=null,g=0;else for(var k=c.data[0],h=1;h<c.count;++h){var l=c.data[h];if(a<=l){e=h-1;f=h;g=(a-k)/(l-k);break}k=l}a=GLTFViewer.Utils.IsNull(e)?null:[];c=null;k=GLTFViewer.Utils.IsNull(f)?null:[];for(h=0;h<d.size;++h)GLTFViewer.Utils.IsNull(e)||(a[h]=d.data[e*d.size+h]),GLTFViewer.Utils.IsNull(f)||(k[h]=d.data[f*d.size+h]);GLTFViewer.Utils.IsNull(g)||(c=GLTFViewer.Utils.Interpolate(a,k,g));return{value:c,before:a,after:k}}},
Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.input&&this.input.Reset();this.output&&this.output.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.interpolation=null,this.input&&(this.input.Clear(),this.input=null),this.output&&(this.output.Clear(),this.output=null))}}});GLTFViewer.Utils.FileGLTF.AnimationChannelItem=function(a){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a)};
GLTFViewer.Utils.FileGLTF.AnimationChannelItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.AnimationChannelItem},sampler:{writable:!0,value:null},targetID:{writable:!0,value:null},targetPath:{writable:!0,value:null},minTime:{get:function(){return this.sampler?this.sampler.minTime:0}},maxTime:{get:function(){return this.sampler?this.sampler.maxTime:-1}},TargetNodeItem:{value:function(){return this.gltf._nodeCache[this.targetID]}},
Show:{value:function(a){var c=this.sampler.GetValue(a);if(!GLTFViewer.Utils.IsNull(c.value)){var d=this.gltf;a=c.value;var e=d._nodeCache[this.targetID],f=d._materialCache[this.targetID];if(e)"matrix"===this.targetPath&&16===a.length?e.matrix.value=new GLTFViewer.Utils.Transformation(a):"visible"===this.targetPath&&1===a.length&&(parseInt(a[0])!==a[0]&&(a=c.before),e.SetVisibility(a[0]));else if((f=d._materialCache[this.targetID])&&f.valueUniforms&&f.valueUniforms[this.targetPath])if(c=f.valueUniforms[this.targetPath],
GLTFViewer.Utils.IsNull(c.data.length)||a.length!==c.data.length)"number"===typeof c.data&&1===a.length&&(c.data=a[0]);else for(d=0;d<a.length;++d)c.data[d]=a[d]}}},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);this.sampler&&this.sampler.Reset()}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)&&(this.sampler&&(this.sampler.Clear(),this.sampler=null),this.targetPath=this.targetID=null)}}});
GLTFViewer.Utils.FileGLTF.AnimationItem=function(a,c,d){GLTFViewer.Utils.FileGLTF.ItemBaseClass.call(this,a,c,d);this.channelList=[]};
GLTFViewer.Utils.FileGLTF.AnimationItem.prototype=Object.create(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileGLTF.AnimationItem},channelList:{writable:!0,value:null},_minTime:{writable:!0,value:0},minTime:{get:function(){if(this._maxTime>=this._minTime)return this._minTime;this._CalculateTimes();return this._minTime}},_maxTime:{writable:!0,value:-1},maxTime:{get:function(){if(this._maxTime>=this._minTime)return this._maxTime;this._CalculateTimes();return this._maxTime}},
_CalculateTimes:{value:function(){for(var a=0;a<this.channelList.length;++a){var c=this.channelList[a];0===a?(this._minTime=c.minTime,this._maxTime=c.maxTime):(this._minTime=Math.min(c.minTime,this._minTime),this._maxTime=Math.max(c.maxTime,this._maxTime))}}},GetRequiredUnloadedNodes:{value:function(){for(var a=[],c=0;c<this.channelList.length;++c){var d=this.channelList[c].TargetNodeItem();d&&d.state===GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_PARTIAL_OK&&a.push(d.ID)}return a}},Show:{value:function(a){for(var c=
0;c<this.channelList.length;++c)this.channelList[c].Show(a)}},Reset:{value:function(){GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Reset.call(this);for(var a=0;a<this.channelList.length;++a)this.channelList[a].Reset()}},Clear:{value:function(){if(GLTFViewer.Utils.FileGLTF.ItemBaseClass.prototype.Clear.call(this)){for(var a=0;a<this.channelList.length;++a)this.channelList[a].Clear();this.channelList=null}}}});GLTFViewer.Utils.FileGLTF.AnimationInfo=function(a,c){this.gltf=a;this._fileInfo=c;this._CalculateTimes()};
GLTFViewer.Utils.FileGLTF.AnimationInfo.prototype=Object.create(null,{gltf:{writable:!0,value:null},_fileInfo:{writable:!0,value:null},_state:{writable:!0,value:2},_minTime:{writable:!0,value:0},minTime:{get:function(){if(this._maxTime>=this._minTime)return this._minTime;this._CalculateTimes();return this._minTime}},_maxTime:{writable:!0,value:-1},maxTime:{get:function(){if(this._maxTime>=this._minTime)return this._maxTime;this._CalculateTimes();return this._maxTime}},_CalculateTimes:{value:function(){for(var a in this.gltf._animationCache){var c=
this.gltf._animationCache[a];this._maxTime<this._minTime?(this._minTime=c.minTime,this._maxTime=c.maxTime):(this._minTime=Math.min(c.minTime,this._minTime),this._maxTime=Math.max(c.maxTime,this._maxTime))}}},_LoadNodes:{value:function(){function a(a,c){0<--a.numNodes||(this.gltf._progressBar.Stop(),this._state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK)}if(this._state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING&&this._state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK){this._state=
GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_LOADING;var c=this.gltf,d=[],e;for(e in c._animationCache)var f=c._animationCache[e].GetRequiredUnloadedNodes(),d=d.concat(f);d=GLTFViewer.Utils.RemoveDuplicates(d);e=d.length;if(0===e)this._state=GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK;else{c._totalGLTFBytes=c._ComputeLoadSizes(this._fileInfo,d,!0);this._progressTotal||c._progressBar.Start(c._totalGLTFBytes);for(var f={numNodes:e},g=0;g<e;++g)c._ReadNode(c._nodeCache[d[g]].fileInfo,d[g],a.bind(this,
f),!0)}}}},Show:{value:function(a){this._LoadNodes();if(this._state!==GLTFViewer.Utils.FileGLTF.ItemBaseClass.STATE_OK)return!1;var c=this.gltf,d;for(d in c._animationCache)c._animationCache[d].Show(a);c._curScene.UpdateBoundingBox();c.UpdateScene();return!0}}});
GLTFViewer.Utils.FileGLTF.ShaderParams=function(a,c,d,e){this.type=a;this.data=c;if("string"===typeof c||GLTFViewer.Utils.IsNull(c.length))"number"===typeof c&&(this.defaultData=c);else for(this.defaultData=[],a=0;a<c.length;++a)this.defaultData[a]=c[a];this.setter=d;this.name=e};
GLTFViewer.Utils.FileGLTF.ShaderParams.prototype=Object.create(null,{name:{writable:!0,value:null},type:{writable:!0,value:0},data:{writable:!0,value:null},defaultData:{writable:!0,value:null},setter:{writable:!0,value:null},Clear:{value:function(){this.name=this.setter=this.defaultData=this.data=null}}});GLTFViewer.Utils.FileGLTF.Loader=function(){this.Reset()};
GLTFViewer.Utils.FileGLTF.Loader.prototype=Object.create(null,{_sizes:{writable:!0,value:null},_loads:{writable:!0,value:null},_fails:{writable:!0,value:null},_imagesCB:{writable:!0,value:null},_textsCB:{writable:!0,value:null},_binaryCB:{writable:!0,value:null},Reset:{value:function(){this._loads={};this._fails={};this._sizes={};this._imagesCB={};this._textsCB={};this._binaryCB={}}},Clear:{value:function(){}},FileLoad:{value:function(a,c,d,e,f){function g(c){return function(d){d.lengthComputable&&
c.HandleProgress(a,d.total,d.loaded)}}function k(a,c){return function(d){a.HandleData(c,d.target.result)}}if("arraybuffer"!==e&&"text"!==e&&"img"!==e)f.HandleError(a,"Invalid stream type "+e);else if(d===GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_MEMORY)"arraybuffer"===e?f.HandleData(a,c):"text"===e?f.HandleData(a,c):f.HandleData(a,"data:image/png;base64,"+GLTFViewer.Utils.Base64EncArr(new Uint8Array(c)));else if(d===GLTFViewer.Utils.FileGLTF.FILE_TYPE_UNZIP_TO_DISK)try{require("fs").readFile(c+
"/"+a,"text"===e?"utf8":null,function(d,g){if(d)f.HandleError(a,"Can't load file "+c+"/"+a);else if("text"===e)f.HandleData(a,g);else{for(var k=new ArrayBuffer(g.length),n=new Uint8Array(k),p=0;p<g.length;++p)n[p]=g[p];"arraybuffer"===e?f.HandleData(a,k):f.HandleData(a,"data:image/png;base64,"+GLTFViewer.Utils.Base64EncArr(n))}})}catch(h){f.HandleError(a,"Can't load file "+a)}else c?(d=new FileReader,d.onload=k(f,a),f.HandleProgress&&(d.onprogress=g(f)),"arraybuffer"===e?d.readAsArrayBuffer(c):"text"===
e?d.readAsText(c):d.readAsDataURL(c)):f.HandleError(a,"Can't load file "+a)}},_LoadSuccess:{value:function(a,c,d){this._fails[a]=!c;this._loads[a]&&(this._loads[a].loaded=this._loads[a].total);d&&d(this._loads)}},SetSize:{value:function(a,c){this._sizes[a]=c}},GetSize:{value:function(a){return this._sizes[a]?this._sizes[a]:0}},LoadImage:{value:function(a,c,d,e,f){var g=Object.create(this,{HandleError:{value:function(a,c){GLTFViewer.Utils.WriteErr("ERROR(LoadImage:"+a+"): "+c);this.HandleData(a,null)}},
HandleProgress:{value:function(a,c,d){this._loads[a].total=this._sizes[a];this._loads[a].loaded=this._sizes[a]*d/(c?c:1);f&&f(this._loads)}},HandleData:{value:function(a,c){this._loads[a].total=this._loads[a].loaded=this._sizes[a];if(null===c)this._LoadSuccess(a,!1,f),this._imagesCB[a].callback.forEach(function(a){a(null)},this),delete this._imagesCB[a];else{var d=new Image;d.onerror=function(c){g.HandleError(a,"The image could not be loaded")}.bind(this);d.onload=function(c){this._LoadSuccess(a,
!0,f);this._imagesCB[a].callback.forEach(function(a){a(d)},this);delete this._imagesCB[a];c=Object.keys(this._imagesCB);if(0<c.length){c=c[0];var e=this._imagesCB[c],h=e.file,e=e.fileType;e!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(c,h,e,"img",g):g.HandleData(c,c)}}.bind(this);d.src=c}}}});this._fails[a]?e(null):this._imagesCB[a]?this._imagesCB[a].callback.push(e):(this._loads[a]={total:0,loaded:0},this._imagesCB[a]={file:c,fileType:d,callback:[e]},1===Object.keys(this._imagesCB).length&&
(d!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(a,c,d,"img",g):g.HandleData(a,a)))}},LoadText:{value:function(a,c,d,e,f){var g=Object.create(this,{HandleError:{value:function(a,c){GLTFViewer.Utils.WriteErr("ERROR(LoadText:"+a+"): "+c);this.HandleData(a,null)}},HandleProgress:{value:function(a,c,d){this._loads[a].total=this._sizes[a];this._loads[a].loaded=this._sizes[a]*d/(c?c:1);f&&f(this._loads)}},HandleData:{value:function(a,c){this._loads[a].total=this._loads[a].loaded=this._sizes[a];
this._LoadSuccess(a,null!==c,f);this._textsCB[a].callback.forEach(function(a){setTimeout(a(c),0)},this);delete this._textsCB[a];var d=Object.keys(this._textsCB);if(0<d.length){var d=d[0],e=this._textsCB[d],n=e.file,e=e.fileType;e!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(d,n,e,"text",g):GLTFViewer.Utils.FileGLTF.LoadStream(d,"text",g)}}}});this._fails[a]?e(null):this._textsCB[a]?this._textsCB[a].callback.push(e):(this._loads[a]={total:0,loaded:0},this._textsCB[a]={file:c,fileType:d,
callback:[e]},1===Object.keys(this._textsCB).length&&(d!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(a,c,d,"text",g):GLTFViewer.Utils.FileGLTF.LoadStream(a,"text",g)))}},LoadBinary:{value:function(a,c,d,e,f){var g=Object.create(this,{HandleError:{value:function(a,c){GLTFViewer.Utils.WriteErr("ERROR(LoadBinary:"+a+"): "+c);this.HandleData(a,null)}},HandleProgress:{value:function(a,c,d){this._loads[a].total=this._sizes[a];this._loads[a].loaded=this._sizes[a]*d/(c?c:1);f&&f(this._loads)}},
HandleData:{value:function(a,c){this._loads[a].total=this._loads[a].loaded=this._sizes[a];this._LoadSuccess(a,null!==c,f);this._binaryCB[a].callback.forEach(function(a){setTimeout(a(c),0)},this);delete this._binaryCB[a];var d=Object.keys(this._binaryCB);if(0<d.length){var d=d[0],e=this._binaryCB[d],n=e.file,e=e.fileType;e!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(d,n,e,"arraybuffer",g):GLTFViewer.Utils.FileGLTF.LoadStream(d,"arraybuffer",g)}}}});this._fails[a]?e(null):this._binaryCB[a]?
this._binaryCB[a].callback.push(e):(this._loads[a]={total:0,loaded:0},this._binaryCB[a]={file:c,fileType:d,callback:[e]},1===Object.keys(this._binaryCB).length&&(d!==GLTFViewer.Utils.FileGLTF.FILE_TYPE_URL?this.FileLoad(a,c,d,"arraybuffer",g):GLTFViewer.Utils.FileGLTF.LoadStream(a,"arraybuffer",g)))}}});
Object.defineProperties(GLTFViewer.Utils.FileGLTF,{FILE_TYPE_LOCAL:{value:0},FILE_TYPE_SECONDARY:{value:1},FILE_TYPE_URL:{value:2},FILE_TYPE_UNZIP_TO_MEMORY:{value:3},FILE_TYPE_UNZIP_TO_DISK:{value:4},_hitTestIndxVs:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nuniform bool uHasTexture;\nattribute float aTexCoord0;\nvarying float vTexCoord0;\nvarying vec3 vPos;\nvoid main() {\nvec4 pos = uTVP * uTWd * vec4(aPos, 1.0);\nvPos = pos.xyz / pos.w;\nif (uHasTexture) vTexCoord0 = aTexCoord0; else vTexCoord0 = 0.0;\ngl_PointSize = 1.0;\ngl_Position = pos;\n}"},
_hitTestIndxFs:{value:"uniform vec4 uCry[2];\nuniform vec2 uSze;\nuniform float uIdx;\nuniform bool uHasTexture;\nvarying float vTexCoord0;\nvarying vec3 vPos;\nvoid main() {\nvec2 xy = floor((1.0 + vec2(vPos.x, -vPos.y)) * uSze + .5);\nfloat w = length(vec2(uCry[0].w, uCry[1].w) - xy);\nif (w >= 3.0) discard;\ngl_FragColor = vec4(-(w + 1.0), float(uHasTexture), uIdx, vTexCoord0);\n}"},_hitTestPosVs:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvarying vec3 vPos;\nvoid main() {\nvec4 pos = uTWd * vec4(aPos, 1.0);\nvPos = pos.xyz;\ngl_PointSize = 1.0;\ngl_Position = uTVP * pos;\n}"},
_hitTestPosFs:{value:"uniform vec4 uCry[2];\nvarying vec3 vPos;\nvoid main() {\nfloat d = length(cross(uCry[1].xyz, vPos - uCry[0].xyz));\ngl_FragColor = vec4(-(d + 1.0), vPos);\n}"},_glType:{value:{5120:{type:Int8Array,baseGLType:5120,size:1},5121:{type:Uint8Array,baseGLType:5121,size:1},5122:{type:Int16Array,baseGLType:5122,size:1},5123:{type:Uint16Array,baseGLType:5123,size:1},5124:{type:Int32Array,baseGLType:5124,size:1},5125:{type:Uint32Array,baseGLType:5125,size:1},5126:{type:Float32Array,baseGLType:5126,
size:1},35664:{type:Float32Array,baseGLType:5126,size:2},35665:{type:Float32Array,baseGLType:5126,size:3},35666:{type:Float32Array,baseGLType:5126,size:4},35667:{type:Int32Array,baseGLType:5124,size:2},35668:{type:Int32Array,baseGLType:5124,size:3},35669:{type:Int32Array,baseGLType:5124,size:4},35675:{type:Float32Array,baseGLType:5126,size:9},35676:{type:Float32Array,baseGLType:5126,size:16}}},_renderType:{value:{RENDEROPAQUE:1,RENDERTRANSPARENT:2,RENDER2D:3,RENDER2DOVERLAY:4,RENDEROPAQUECAP:5,RENDERTRANSPARENTCAP:6,
RENDERPICKPOS:7,RENDERPICKIDX:8,RENDERHIT:9,RENDERSELECTION:10}},_Uniform1i:{value:function(a){return a}},_Uniform1f:{value:function(a){return a}},_Uniform2fv:{value:function(a){return new Float32Array(a)}},_Uniform3fv:{value:function(a){return new Float32Array(a)}},_Uniform4fv:{value:function(a){return new Float32Array(a)}},_Uniform2iv:{value:function(a){return new Int32Array(a)}},_Uniform3iv:{value:function(a){return new Int32Array(a)}},_Uniform4iv:{value:function(a){return new Int32Array(a)}},
_UniformMatrix3fv:{value:function(a){return new Float32Array(a)}},_UniformMatrix4fv:{value:function(a){return new Float32Array(a)}},_Sampler2D:{value:function(a){return a}},_SetUniform1i:{value:function(a,c,d){a.uniform1i(c,d)}},_SetUniform1f:{value:function(a,c,d){a.uniform1f(c,d)}},_SetUniform2fv:{value:function(a,c,d){a.uniform2fv(c,d)}},_SetUniform3fv:{value:function(a,c,d){a.uniform3fv(c,d)}},_SetUniform4fv:{value:function(a,c,d){a.uniform4fv(c,d)}},_SetUniform2iv:{value:function(a,c,d){a.uniform2iv(c,
d)}},_SetUniform3iv:{value:function(a,c,d){a.uniform3iv(c,d)}},_SetUniform4iv:{value:function(a,c,d){a.uniform4iv(c,d)}},_SetUniformMatrix3fv:{value:function(a,c,d){a.uniformMatrix3fv(c,!1,d)}},_SetUniformMatrix4fv:{value:function(a,c,d){a.uniformMatrix4fv(c,!1,d)}},_SetSampler2D:{value:function(a,c,d,e){a.activeTexture(a.TEXTURE0+e.activeTexture);a.bindTexture(a.TEXTURE_2D,d);a.uniform1i(c,e.activeTexture++)}},LoadStream:{value:function(a,c,d){function e(c){return function(d){d.lengthComputable&&
c.HandleProgress(a,d.total,d.loaded)}}function f(a,c){return function(d){if(200===this.status||206===this.status)try{a.HandleData(c,this.response)}catch(e){a.HandleError(c,"XMLHttpRequest "+e)}else a.HandleError(c,"XMLHttpRequest "+this.status)}}function g(a,c,d){return function(e){if(4===d.readyState)try{var f=new Uint8Array(d.responseBody.toArray());a.HandleData(c,f)}catch(g){a.HandleError(c,"XMLHttpRequest "+g)}}}if("FILE"===c)if("ActiveXObject"in window){var k=new ActiveXObject("MSXML2.XMLHttp.3.0");
k.open("GET",a,!0);k.setRequestHeader("Accept-Charset","x-user-defined");k.onreadystatechange=g(d,a,k);k.send(null)}else d.HandleError(a,"Local files not supported");else"arraybuffer"!==c&&"text"!==c?d.HandleError(a,"Invalid stream type "+c):(k=new XMLHttpRequest,k.open("GET",a,!0),k.responseType=c,"arraybuffer"===c&&k.overrideMimeType("text/plain; charset=x-user-defined"),d.HandleProgress&&(k.onprogress=e(d)),k.onload=f(d,a),k.send(null))}},LoadJSON:{value:function(a,c,d){var e=Object.create(this,
{HandleError:{value:function(a,e){c||GLTFViewer.Utils.WriteErr("ERROR(LoadJSON:"+a+"): "+e);d(null)}},HandleData:{value:function(a,c){var e;try{e=JSON.parse(c)}catch(l){this.HandleError(a,l);return}var h=GLTFViewer.Utils.GetEKMBasePath(a);(function(a,c,d){d.forEach(function(d){var f=e[d];f&&Object.keys(f).forEach(function(d){d=f[d];d.path&&(d.path=GLTFViewer.Utils.ResolveEKMPath(a,c,d.path))},this)},this)})(h.ekmUrlParamNameContextIdValue,h.pathBase,["buffers","shaders","images"]);d(e)}}});GLTFViewer.Utils.FileGLTF.LoadStream(a,
"text",e)}},CameraToProjection:{value:function(a,c,d){if(!c)return null;c=c.Clone().Invert();var e=Math.sqrt(c.a00*c.a00+c.a01*c.a01+c.a02*c.a02),f=GLTFViewer.Utils.Transformation.Identity;f.a00=1/e;f.a11=1/e;f.a22=1/e;c.Multiply(f);c.a30/=e;c.a31/=e;c.a32=0;c.a33="orthographic"===a?2/e:.70710678/e;if(a=d.Clone().Multiply(c).GetCenter().z)c.a32=-a*c.a33;return c}},ProjectionToCamera:{value:function(a,c){if(!c)return null;var d=c.Clone(),e;e="orthographic"===a?2/d.a33:.70710678/d.a33;d.a33=1;d.a32*=
e;d.a31*=e;d.a30*=e;var f=GLTFViewer.Utils.Transformation.Identity;f.a00=e;f.a11=e;f.a22=e;d.Multiply(f);d.Invert();return d}}});GLTFViewer.Utils.FileGLTF.Hit=function(a){a&&(this.indx=a.indx,a.pnt&&(this.pnt=a.pnt.Clone()),this.texture=a.texture)};
GLTFViewer.Utils.FileGLTF.Hit.prototype=Object.create(null,{indx:{writable:!0,value:null},pnt:{writable:!0,value:null},texture:{writable:!0,value:null},Reset:{value:function(){this.pnt=this.texture=this.indx=null}},Clear:{value:function(){GLTFViewer.Utils.FileGLTF.Hit.prototype.Reset.call(this)}},SetPnt:{value:function(a,c,d){GLTFViewer.Utils.IsNull(this.pnt)&&(this.pnt=new GLTFViewer.Utils.Vec3);this.pnt.Set(a,c,d)}}});GLTFViewer.Utils.FileSpaceClaim=function(a,c,d,e){var f=a.gl;GLTFViewer.Utils.FileBaseClass.call(this,a,c,d,e);this._visTree={};this._namedSelections=[];this._idToName={};this._pathToPart={};this._parts=[];this._bodies=[];this._bodiesOpaque=[];this._bodiesTransparent=[];this._bodiesData={};this.hit=new GLTFViewer.Utils.FileSpaceClaim.Hit;try{this._hitTestIndexShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsHitTest,GLTFViewer.Utils.FileSpaceClaim._fsHitTest),
this._hitTestPositionShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsHitTestPos,GLTFViewer.Utils.FileSpaceClaim._fsHitTestPos),this._phongShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsPhong,GLTFViewer.Utils.FileSpaceClaim._fsPhong),this._flatShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsFlat,
GLTFViewer.Utils.FileSpaceClaim._fsFlat)}catch(g){throw GLTFViewer.Utils.WriteErr(g),this._hitTestIndexShader&&(this._hitTestIndexShader.DeleteProgram(),this._hitTestIndexShader=null),this._hitTestPositionShader&&(this._hitTestPositionShader.DeleteProgram(),this._hitTestPositionShader=null),this._phongShader&&(this._phongShader.DeleteProgram(),this._phongShader=null),this._flatShader&&(this._flatShader.DeleteProgram(),this._flatShader=null),g;}this.CanClip=!0;try{this._hitTestIndexClipShader=new GLTFViewer.Utils.ShaderProgram(f,
GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsHitTestClip,GLTFViewer.Utils.FileSpaceClaim._fsHitTestClip),this._hitTestPositionClipShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsHitTestPosClip,GLTFViewer.Utils.FileSpaceClaim._fsHitTestPosClip),this._phongClipShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsPhongClip,GLTFViewer.Utils.FileSpaceClaim._fsPhongClip),
this._flatClipShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsFlatClip,GLTFViewer.Utils.FileSpaceClaim._fsFlatClip)}catch(g){GLTFViewer.Utils.WriteErr(g),this.CanClip=!1}this._hitTestIndexClipShader&&this._hitTestPositionClipShader&&this._phongClipShader&&this._flatClipShader&&this.CanClip||(this._hitTestIndexClipShader&&(this._hitTestIndexClipShader.DeleteProgram(),this._hitTestIndexClipShader=null),this._hitTestPositionClipShader&&
(this._hitTestPositionClipShader.DeleteProgram(),this._hitTestPositionClipShader=null),this._phongClipShader&&(this._phongClipShader.DeleteProgram(),this._phongClipShader=null),this._flatClipShader&&(this._flatClipShader.DeleteProgram(),this._flatClipShader=null),this.CanClip=!1);this.CanPeel=!0;try{this._phongPeelShader=new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsPhong,GLTFViewer.Utils.FileSpaceClaim._fsPhongPeel),this._flatPeelShader=
new GLTFViewer.Utils.ShaderProgram(f,GLTFViewer.Utils.ShaderProgram.precision,GLTFViewer.Utils.FileSpaceClaim._vsFlat,GLTFViewer.Utils.FileSpaceClaim._fsFlatPeel)}catch(g){GLTFViewer.Utils.WriteErr(g),this.CanPeel=!1}this._phongPeelShader&&this._flatPeelShader&&this.CanPeel||(this._phongPeelShader&&(this._phongPeelShader.DeleteProgram(),this._phongPeelShader=null),this._flatPeelShader&&(this._flatPeelShader.DeleteProgram(),this._flatPeelShader=null),this.CanPeel=!1);this._htp0=new GLTFViewer.Utils.Vec3;
this._htp1=new GLTFViewer.Utils.Vec3;this._htp2=new GLTFViewer.Utils.Vec3;this._uMtl=new Float32Array(16);this._glColor=new Float32Array(4);this._gfx=new GLTFViewer.Utils.FileSpaceClaim.Graphics(f);this._uTWd=new Float32Array(16);this._glCursorRay=new Float32Array(8);this._tmpVtxDat=new Float32Array(1048576);this._clipPlaneBuf=this._tmpVtxDat.subarray(0,15);this._tmpVtxBuf=f.createBuffer();f.bindBuffer(f.ARRAY_BUFFER,this._tmpVtxBuf);f.bufferData(f.ARRAY_BUFFER,this._tmpVtxDat.subarray(0,1E3),f.DYNAMIC_DRAW);
f.bindBuffer(f.ARRAY_BUFFER,null)};
GLTFViewer.Utils.FileSpaceClaim.prototype=Object.create(GLTFViewer.Utils.FileBaseClass.prototype,{constructor:{value:GLTFViewer.Utils.FileSpaceClaim},_gfx:{writable:!0,value:null},_flatColor:{writable:!0,value:!1},_bodyColor:{writable:!0,value:0},_visTree:{writable:!0,value:null},_namedSelections:{writable:!0,value:null},_idToName:{writable:!0,value:null},_pathToPart:{writable:!0,value:null},_parts:{writable:!0,value:null},_bodies:{writable:!0,value:null},_bodiesOpaque:{writable:!0,value:null},_bodiesTransparent:{writable:!0,
value:null},_bodiesData:{writable:!0,value:null},_hitTestIndexShader:{writable:!0,value:null},_hitTestIndexClipShader:{writable:!0,value:null},_hitTestPositionShader:{writable:!0,value:null},_hitTestPositionClipShader:{writable:!0,value:null},_phongShader:{writable:!0,value:null},_phongPeelShader:{writable:!0,value:null},_phongClipShader:{writable:!0,value:null},_flatShader:{writable:!0,value:null},_flatPeelShader:{writable:!0,value:null},_flatClipShader:{writable:!0,value:null},_htp0:{writable:!0,
value:null},_htp1:{writable:!0,value:null},_htp2:{writable:!0,value:null},_clipPlaneBuf:{writable:!0,value:null},_tmpVtxDat:{writable:!0,value:null},_tmpVtxBuf:{writable:!0,value:null},_glColor:{writable:!0,value:null},_sceneBox:{writable:!0,value:null},_GetName:{value:function(a){a=this._idToName[a];return GLTFViewer.Utils.IsNull(a)||""===a?"UNKNOWN":a}},_BuildBodyBox:{value:function(){if(null!==this._bodiesData){var a=this._gl,c=0,d=0,e=108*Math.floor(this._tmpVtxDat.byteLength/108)/4,f=[],g=this._tmpVtxDat,
k;for(k in this._bodiesData)if(null!=k){var h=this._bodiesData[k];h.boxIndex=d;h.boxOffset=c/3;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=
h.may;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.max;g[c++]=
h.miy;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.maz;g[c++]=h.max;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.may;g[c++]=h.miz;g[c++]=h.max;g[c++]=h.miy;g[c++]=h.miz;g[c++]=h.mix;g[c++]=h.miy;g[c++]=h.miz;c>=e&&(h=a.createBuffer(),
a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,g.subarray(0,c),a.STATIC_DRAW),f[d]=h,d++,c=0)}0<c&&(h=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,g.subarray(0,c),a.STATIC_DRAW),f[d]=h,d++);0<d&&(this._gfx.boxBuffers=f)}}},_BuildBodyMesh:{value:function(){if(null!==this._bodiesData){var a=this._gl,c=0,d=0,e=96*Math.floor(this._tmpVtxDat.byteLength/96)/4,f=[],g=[],k=this._tmpVtxDat,h;for(h in this._bodiesData){var l=this._bodiesData[h];l.faceBufferFirstIndex=
d;l.faceBufferFirstOffset=c/8;l.faceBufferNumIndices=0;for(var m in l.faceDatas){var n=l.faceDatas[m],p=n.indices,q=n.vertices;n.faceBufferIndex=d;n.faceBufferOffset=c/8;n.faceBufferNumIndices=p.length;for(var u=n=0;n<p.length;u++){var r=Math.floor(u/65536),w=u&65535,t=8*p[n++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=r;k[c++]=w;t=8*p[n++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=r;k[c++]=w;t=8*p[n++];
k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=q[t++];k[c++]=r;k[c++]=w;c>=e&&(r=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,r),a.bufferData(a.ARRAY_BUFFER,k.subarray(0,c),a.STATIC_DRAW),f[d]=r,g[d]=c/8,d++,c=0)}l.faceBufferNumIndices+=p.length}}0<c&&(r=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,r),a.bufferData(a.ARRAY_BUFFER,k.subarray(0,c),a.STATIC_DRAW),f[d]=r,g[d]=c/8,d++);0<d&&(this._gfx.faceBuffers=f,this._gfx.faceBuffersNumElements=g)}}},_BuildBodyWire:{value:function(){if(0!==
Object.keys(this._bodiesData).length){var a=this._gl,c=0,d=0,e=24*Math.floor(this._tmpVtxDat.byteLength/24)/4,f=[],g=[],k,h,l,m,n,p,q,u,r,w=this._tmpVtxDat,t;for(t in this._bodiesData){var x=this._bodiesData[t];if(x&&x.edgeDatas){x.edgeBufferFirstIndex=d;x.edgeBufferFirstOffset=c/3;x.edgeBufferNumIndices=0;for(var y in x.edgeDatas){var z=x.edgeDatas[y],G=z.faceData,E=G.vertices,A=G.edgeIndices;m=G.edgeRanges;z.edgeBufferIndex=d;z.edgeBufferOffset=c/3;var G=m[z.rangesIndex+1],D=2*m[z.rangesIndex+2];
p=n=m=GLTFViewer.Utils.maxValue;q=-GLTFViewer.Utils.maxValue;u=-GLTFViewer.Utils.maxValue;r=-GLTFViewer.Utils.maxValue;for(var H=0;H<D;H+=2)l=8*A[G++],w[c++]=k=E[l++],w[c++]=h=E[l++],w[c++]=l=E[l++],m>k&&(m=k),q<k&&(q=k),n>h&&(n=h),u<h&&(u=h),p>l&&(p=l),r<l&&(r=l),l=8*A[G++],w[c++]=k=E[l++],w[c++]=h=E[l++],w[c++]=l=E[l++],m>k&&(m=k),q<k&&(q=k),n>h&&(n=h),u<h&&(u=h),p>l&&(p=l),r<l&&(r=l),c>=e&&(k=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,k),a.bufferData(a.ARRAY_BUFFER,w.subarray(0,c),a.STATIC_DRAW),
f[d]=k,g[d]=c/3,d++,c=0);z.edgeBufferNumIndices=D;z.mix=m;z.miy=n;z.miz=p;z.max=q;z.may=u;z.maz=r;x.edgeBufferNumIndices+=D}}}0<c&&(k=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,k),a.bufferData(a.ARRAY_BUFFER,w.subarray(0,c),a.STATIC_DRAW),f[d]=k,g[d]=c/3,d++);0<d&&(this._gfx.edgeBuffers=f,this._gfx.edgeBuffersNumElements=g)}}},_BuildGraphics:{value:function(){try{var a=this._gl;this._BuildBodyBox();this._BuildBodyMesh();this._BuildBodyWire();a.bindBuffer(a.ARRAY_BUFFER,null);this._empty=!1}catch(c){}}},
_ReadMeshData:{value:function(a){var c=GLTFViewer.Utils.tEmptyArray,d=GLTFViewer.Utils.tEmptyArray;try{a.readInt32();var e=a.readFloat(),f=a.readFloat(),g=a.readFloat(),k=a.readFloat(),h=a.readFloat(),l=a.readFloat();a.readFloat();a.readFloat();a.readFloat();a.readFloat();a.readInt32();a.readInt32();var m=null,n=a.readInt32();if(0<n)for(var m=new Float32Array(3*n),p=0,q=0;p<n;p++){var u=a.readFloat(),r=a.readFloat(),w=a.readFloat();m[q++]=u;m[q++]=r;m[q++]=w}for(var t=a.readInt32(),p=0;p<t;p++){a.readFloat();
a.readFloat();a.readFloat();a.readFloat();a.readFloat();a.readFloat();for(var x=a.readInt32(),q=0;q<x;q++)a.readInt32()}for(var y=a.readInt32(),p=0;p<y;p++)for(a.readInt32(),a.readInt32(),a.readFloat(),x=a.readInt32(),q=0;q<x;q++)a.readInt32();var z=a.readInt32();if(0<z)for(n=3*z,d=65536>n?new Uint16Array(n):new Uint32Array(n),c=new Float32Array(8*n),p=n=q=0;p<z;p++){var u=a.readFloat(),r=a.readFloat(),w=a.readFloat(),G=3*a.readInt32(),E=3*a.readInt32(),A=3*a.readInt32();a.readInt32();a.readInt32();
a.readInt32();d[n]=n++;d[n]=n++;d[n]=n++;c[q++]=m[G++];c[q++]=m[G++];c[q++]=m[G++];c[q++]=u;c[q++]=r;c[q++]=w;c[q++]=0;c[q++]=0;c[q++]=m[E++];c[q++]=m[E++];c[q++]=m[E++];c[q++]=u;c[q++]=r;c[q++]=w;c[q++]=0;c[q++]=0;c[q++]=m[A++];c[q++]=m[A++];c[q++]=m[A++];c[q++]=u;c[q++]=r;c[q++]=w;c[q++]=0;c[q++]=0}}catch(D){g=f=e=GLTFViewer.Utils.maxValue,k=-GLTFViewer.Utils.maxValue,h=-GLTFViewer.Utils.maxValue,l=-GLTFViewer.Utils.maxValue,d=c=GLTFViewer.Utils.tEmptyArray}return new GLTFViewer.Utils.FileSpaceClaim.FaceData("0:1",
e,f,g,k,h,l,c,d,GLTFViewer.Utils.tEmptyArray,GLTFViewer.Utils.tEmptyArray)}},_ReadFaceData:{value:function(a){var c=a.readInt32(),d=a.readInt32(),c=c+":"+d,e=d=GLTFViewer.Utils.tEmptyArray,f=GLTFViewer.Utils.tEmptyArray,g=GLTFViewer.Utils.tEmptyArray,k=GLTFViewer.Utils.maxValue,h=GLTFViewer.Utils.maxValue,l=GLTFViewer.Utils.maxValue,m=-GLTFViewer.Utils.maxValue,n=-GLTFViewer.Utils.maxValue,p=-GLTFViewer.Utils.maxValue;try{a.readInt32();a.readInt32();var q=a.readInt32();if(0<q)for(var d=new Float32Array(8*
q),u=0,r=0;u<q;u++){var w=a.readFloat(),t=a.readFloat(),x=a.readFloat();k>w&&(k=w);m<w&&(m=w);h>t&&(h=t);n<t&&(n=t);l>x&&(l=x);p<x&&(p=x);d[r++]=w;d[r++]=t;d[r++]=x;d[r++]=a.readFloat();d[r++]=a.readFloat();d[r++]=a.readFloat();d[r++]=a.readFloat();d[r++]=a.readFloat()}var y=a.readInt32();if(0<y)if(65536>q){e=new Uint16Array(y);for(u=0;u<y;u++)e[u]=a.readInt16();0!=y%2&&a.readInt16()}else for(e=new Uint32Array(y),u=0;u<y;u++)e[u]=a.readInt32();var z=a.readInt32();if(0<z)if(65536>z)for(f=new Uint16Array(z),
u=0;u<z;u++)f[u]=a.readInt16();else for(f=new Uint32Array(z),u=0;u<z;u++)f[u]=a.readInt32();var G=a.readInt32();if(0<G)for(g=new Uint32Array(3*G),r=u=0;u<G;u++){g[r++]=a.readInt32();var E=a.readUInt32(),A=a.readUInt32();g[r++]=E&1073741823;g[r++]=A&1073741823}}catch(D){l=h=k=GLTFViewer.Utils.maxValue,m=-GLTFViewer.Utils.maxValue,n=-GLTFViewer.Utils.maxValue,p=-GLTFViewer.Utils.maxValue,g=f=e=d=GLTFViewer.Utils.tEmptyArray}return new GLTFViewer.Utils.FileSpaceClaim.FaceData(c,k,h,l,m,n,p,d,e,f,g)}},
_ReadBodyData:{value:function(a,c,d){a=new GLTFViewer.Utils.FileSpaceClaim.BodyData(this,a);a.faceDatas={};if(0!=(c&4)){var e=this._ReadMeshData(d);0<e.vertices.length&&(a.mix=e.mix,a.max=e.max,a.miy=e.miy,a.may=e.may,a.miz=e.miz,a.maz=e.maz);a.faceDatas[e.id]=e}else{c={};for(var f=0,g=GLTFViewer.Utils.maxValue,k=GLTFViewer.Utils.maxValue,h=GLTFViewer.Utils.maxValue,l=-GLTFViewer.Utils.maxValue,m=-GLTFViewer.Utils.maxValue,n=-GLTFViewer.Utils.maxValue,p=d.readInt32(),q=0;q<p;q++){e=this._ReadFaceData(d);
0<e.vertices.length&&(g>e.mix&&(g=e.mix),l<e.max&&(l=e.max),k>e.miy&&(k=e.miy),m<e.may&&(m=e.may),h>e.miz&&(h=e.miz),n<e.maz&&(n=e.maz));a.faceDatas[e.id]=e;for(var u=0;u<e.edgeRanges.length;u+=3)if(0<e.edgeRanges[u+2]){var r=e.edgeRanges[u];void 0===c[r]&&(c[r]=new GLTFViewer.Utils.FileSpaceClaim.EdgeData(r,e,u),f++)}}a.mix=g;a.miy=k;a.miz=h;a.max=l;a.may=m;a.maz=n;e=d.readInt32();for(q=0;q<e;q++)r=d.readInt32(),indx=d.readInt32(),id=d.readInt32(),g=indx+":"+id,c[r].id=g,c[g]=c[r],delete c[r];0<
f&&(a.edgeDatas=c)}return a}},_ReadFacets:{value:function(a){a.readInt32();a.readInt32();var c=a.readInt32(),d=GLTFViewer.Utils.maxValue,e=GLTFViewer.Utils.maxValue,f=GLTFViewer.Utils.maxValue,g=-GLTFViewer.Utils.maxValue,k=-GLTFViewer.Utils.maxValue,h=-GLTFViewer.Utils.maxValue;if(11<=c){var l=a.readInt32();if(0<l)for(var m,n=0,p,q,u;0<l;l--)13==c&&(n=a.readInt32()),p=a.readInt32(),q=a.readInt32(),(0>p||0>q)&&GLTFViewer.Utils.WriteErr("ERROR(ReadFacets): Invalid file format"),u=p+":"+q,p=a.readInt32(),
q=a.readInt32(),0!=(n&8)?(m=new GLTFViewer.Utils.FileSpaceClaim.BodyData(this,u),m.id=p+":"+q):((0>p||0>q)&&GLTFViewer.Utils.WriteErr("ERROR(ReadFacets): Invalid file format"),a.readInt32(),13>c&&(n=a.readInt32()),m=this._ReadBodyData(u,n,a),d>m.mix&&(d=m.mix),g<m.max&&(g=m.max),e>m.miy&&(e=m.miy),k<m.may&&(k=m.may),f>m.miz&&(f=m.miz),h<m.maz&&(h=m.maz)),this._bodiesData[u]=m}else GLTFViewer.Utils.WriteErr("ERROR(ReadFacets): Unable to read this version")}},_ReadRenderListXml:{value:function(a){var c=
new GLTFViewer.Utils.RGBA(0,0,0,50),d=new GLTFViewer.Utils.RGBA;a=a.childNodes[0].childNodes[0].childNodes;var e=a.length;if(0!==e){this._parts=[];this._bodies=[];this._bodiesTransparent=[];this._bodiesOpaque=[];this._pathToPart={};this._sceneBox=GLTFViewer.Utils.Box.empty;for(var f=0;f<e;f++){var g=a[f],k=g.attributes.Id.value,h=g.attributes.Bodies.value,l=g.attributes.Path.value;if(""===l)this._pathToPart.ROOT=k;else{var m=l.split(",");this._pathToPart[m[m.length-1]]=k}var n=g.attributes.Transform.value,
m=n.split(","),p=GLTFViewer.Utils.Transformation.Identity;if(16==m.length&&"1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1"!=n)p=(new GLTFViewer.Utils.Transformation(m)).Transpose();else if(10==m.length&&"1,0,0,0,1,0,0,0,0,1"!=n)var p=1*m[0],n=1*m[1],q=1*m[3],u=1*m[4],r=1*m[6],w=1*m[7],p=(new GLTFViewer.Utils.Transformation(p,n,q*w-u*r,1*m[2],q,u,n*r-p*w,1*m[5],r,w,p*u-n*q,1*m[8],0,0,0,1*m[9])).Transpose();k=new GLTFViewer.Utils.FileSpaceClaim.Part(k,this._GetName(k),l,p);this._parts.push(k);g=g.childNodes;l=g.length;
for(n=0;0<h&&n<l;n++){var t=g[n];if("Body"===t.localName){--h;w=t.attributes.Id.value;(q=this._bodiesData[w])&&w!=q.id&&(w=q.id,q=this._bodiesData[w]);var u=1==t.attributes.Visible.value,x=parseInt(t.attributes.Color.value)>>>0,r=parseInt(t.attributes.FillStyle.value);255>(x>>24&255)&&(r=GLTFViewer.Utils.Fill.Transparent);var y=parseInt(t.attributes.BodyType.value),m=null;if(t=t.attributes.Transform)t=t.value,m=t.split(","),16<m.length&&(m.length=16),m=(new GLTFViewer.Utils.Transformation(m)).Transpose();
d.SetRawARGB(x);GLTFViewer.Utils.HSL.XColor(d);c.SetRawARGB(x);GLTFViewer.Utils.HSL.EColor(c);w=new GLTFViewer.Utils.FileSpaceClaim.Body(this,w,this._GetName(w),k,q,u,x,c.GetARGB(),d.GetARGB(),r,y,m);this._bodies.push(w);k.bodies.push(w);r==GLTFViewer.Utils.Fill.Transparent?this._bodiesTransparent.push(w):this._bodiesOpaque.push(w);u&&(q=new GLTFViewer.Utils.Box(q.mix,q.miy,q.miz,q.max,q.may,q.maz),q.Multiply(p),m&&q.Multiply(m),this._sceneBox.Unite(q))}}}this._BuildGraphics();this.UpdateWorldScale()}}},
_ReadDocumentXml:{value:function(a){var c=$(a);this._idToName={};for(var d=c.find("RootCaptionDef").add(c.find("CaptionDef")),e=0;e<d.length;++e){a=$(d[e]);var f=a.find("subjectId");f.length&&f[0].textContent&&(f=f[0].textContent,a=a.find("name"),a.length&&a[0].textContent&&(a=a[0].textContent,this._idToName[f]=a))}this._namedSelections=[];c=c.find("NamedSelectionDef");for(d=0;d<c.length;++d)a=$(c[d]),a=a.find("name"),a.length&&a[0].textContent&&this._namedSelections.push(a[0].textContent)}},_BuildVisibilitySelector:{value:function(){function a(a,
c){a.visibl=c;this._scene.Invalidate(!0);this.UpdateWorldScale()}function c(d,e,f){var g=d.children,h=d.part;d.parent=e;if(h&&(h.parentPart=e?e.part:null,e=h.bodies,0!==Object.keys(g).length||0!==e.length)){f=this._viewer.AddEntryVisibilityList(h.nme,!0,null,null,f,!0);for(h=0;h<e.length;++h){var k=e[h];k&&this._viewer.AddEntryVisibilityList(k.nme,k.visibl,a.bind(this,k),null,f,!0)}for(var l in g)c.call(this,g[l],d,f)}}this._visTree={};this._visTree.root={part:null,parent:null,children:{}};for(var d=
0;d<this._parts.length;++d){var e=this._parts[d],f=e.path.split(","),g=this._visTree.root;if(1<f.length||""!==f[0])for(var k=0;k<f.length;++k){var h=f[k];g.children[h]||(g.children[h]={part:null,parent:null,children:{}});g=g.children[h]}g.part=e}d=this._viewer.AddEntrySceneList("SCENE",null);if(GLTFViewer.Utils.IsNull(this._visTree.root.part))for(var l in this._visTree.root.children)c.call(this,this._visTree.root.children[l],null,null);else c.call(this,this._visTree.root,null,null);this._viewer.SetSelectionSceneList(d)}},
_Readscdoc:{value:function(a){function c(a,c){var d=e.entries["SpaceClaim/Graphics/facets.bin"];if(d)try{var h=new GLTFViewer.Utils.FileSpaceClaim.BinReader(d.buffer,d.byteOffset,d.byteLength);this._ReadFacets(h);(d=e.entries["SpaceClaim/document.xml"])&&""!==d?(this._ReadDocumentXml(a(d)),(d=e.entries["SpaceClaim/Graphics/renderlist.xml"])&&""!==d?(this._ReadRenderListXml(a(d)),this._BuildVisibilitySelector(),c(!0)):(GLTFViewer.Utils.WriteErr("ERROR(Readscdoc): No document found"),c(!1))):(GLTFViewer.Utils.WriteErr("ERROR(Readscdoc): No renderlist found"),
c(!1))}catch(l){GLTFViewer.Utils.WriteErr(l),c(!1)}else GLTFViewer.Utils.WriteErr("ERROR(Readscdoc): No facets found"),c(!1)}var d;if("undefined"!=typeof window.DOMParser)d=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")};else if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM"))d=function(a){var c=new window.ActiveXObject("Microsoft.XMLDOM");c.async="false";c.loadXML(a);return c};else{GLTFViewer.Utils.WriteErr("ERROR(Readscdoc): No XML parser found");
a(!1);return}var e=new JSUnzip(this._data);if(1==e.isZipFile())try{e.readEntries(c.bind(this,d,a))}catch(f){this.Reset(),GLTFViewer.Utils.WriteErr(f),a(!1)}else GLTFViewer.Utils.WriteErr("ERROR(Readscdoc): Invalid file"),a(!1)}},_RenderFindClosest:{value:function(a,c,d,e,f){if(0===this._bodiesOpaque.length&&0===this._bodiesTransparent.length)return!1;var g=this._gl;this._flatColor=!0;var k=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,h=e?k?this._hitTestIndexClipShader:this._hitTestIndexShader:
k?this._hitTestPositionClipShader:this._hitTestPositionShader;if(!h.StartProgram())return!1;g.uniformMatrix4fv(h.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);g.uniformMatrix4fv(h.uTVP,!1,a);k&&g.uniform4fv(h.uCut,this._glClip);f.ToArray(this._glCursorRay);g.uniform4fv(h.uCry,this._glCursorRay);e&&g.uniform2f(h.uSze,c/2,d/2);this._bodiesOpaque.length&&this._RenderOpaqueBodies(g,h,!1,this._bodiesOpaque);this._bodiesTransparent.length&&this._RenderOpaqueBodies(g,h,!1,this._bodiesTransparent);return!0}},_RenderBodiesClipCap:{value:function(a,
c,d,e,f){c=this._gl;this._glClip=this._clip.glClip1;this._flatColor=!0;d=this._flatClipShader;d.StartProgram()&&(c.uniformMatrix4fv(d.uTWd,!1,GLTFViewer.Utils.glMtxIdentity),c.uniformMatrix4fv(d.uTVP,!1,a),c.uniform4fv(d.uCut,this._glClip),c.enable(c.POLYGON_OFFSET_FILL),c.enable(c.CULL_FACE),this._bodiesOpaque.length&&this._RenderOpaqueBodies(c,d,!0,this._bodiesOpaque),this._bodiesTransparent.length&&(c.enable(c.BLEND),this._RenderOpaqueBodies(c,d,!0,this._bodiesTransparent),c.disable(c.BLEND)),
c.disable(c.CULL_FACE),c.disable(c.POLYGON_OFFSET_FILL),this._glClip=this._clip.glClip0)}},_RenderBodies:{value:function(a,c,d,e,f,g,k){var h=this._gl,l=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE;this._flatColor=!1;var m=0<g?this._phongPeelShader:l?this._phongClipShader:this._phongShader;m.StartProgram()&&(0<g&&(h.uniform2f(m.uSze,e,f),h.uniform1i(m.uPass,g),1<g&&(h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,k),h.uniform1i(m.DepthTex,0))),e=new GLTFViewer.Utils.RGBA(0,255,
0,255),GLTFViewer.Utils.HSV.TransformColor(e),(new GLTFViewer.Utils.Material(e)).ToArray(this._uMtl,0),h.uniformMatrix4fv(m.uTWd,!1,GLTFViewer.Utils.glMtxIdentity),h.uniformMatrix4fv(m.uTVP,!1,a),h.uniform3fv(m.uEye,c),h.uniformMatrix4fv(m.uLit,!1,d),h.uniformMatrix4fv(m.uMtl,!1,this._uMtl),l&&h.uniform4fv(m.uCut,this._glClip),this._bodiesOpaque.length&&(h.enable(h.POLYGON_OFFSET_FILL),h.polygonOffset(.5,0),this._RenderOpaqueBodies(h,m,!1,this._bodiesOpaque),h.polygonOffset(0,0),h.disable(h.POLYGON_OFFSET_FILL)),
this._bodiesTransparent.length&&(0>g?(h.depthMask(!1),h.enable(h.BLEND),this._RenderTransparentBodies(h,m,this._bodiesTransparent),h.disable(h.BLEND),h.depthMask(!0)):(h.enable(h.POLYGON_OFFSET_FILL),h.polygonOffset(.5,0),this._RenderOpaqueBodies(h,m,!1,this._bodiesTransparent),h.polygonOffset(0,0),h.disable(h.POLYGON_OFFSET_FILL))))}},_RenderOpaqueBodies:{value:function(a,c,d,e){var f=-1,g=null;this._bodyColor=0;for(var k=this._gfx.faceBuffers,h=this._gfx.faceBuffersNumElements,l=new GLTFViewer.Utils.Transformation,
m=!1,n=0;n<e.length;n++){var p=e[n];p&&p.IsVisible()&&(g!==p.part&&(g=p.part,l.Set(g.tx),m=!0),p.tx&&(l.Multiply(p.tx),m=!0,g=null),m&&(l.ToArray(this._uTWd),a.uniformMatrix4fv(c.uTWd,!1,this._uTWd),m=!1),d?p.typ===GLTFViewer.Utils.FileSpaceClaim.Body.Solid&&(a.colorMask(!1,!1,!1,!1),a.polygonOffset(1,0),a.depthFunc(a.ALWAYS),a.cullFace(a.FRONT),p.RenderBox(a,c,this._gfx.boxBuffers),a.polygonOffset(0,0),a.depthFunc(a.LEQUAL),a.cullFace(a.BACK),f=p.Render(a,c,this._bodyColor,k,h,-1),a.cullFace(a.FRONT),
a.colorMask(!0,!0,!0,!0),f=p.Render(a,c,p.xcolr,k,h,f)):f=p.Render(a,c,p.bcolr,k,h,f))}}},_RenderTransparentBodies:{value:function(a,c,d){var e=-1,f=null;this._bodyColor=0;var g=this._gfx.faceBuffers,k=this._gfx.faceBuffersNumElements;a.enable(a.CULL_FACE);for(var h=new GLTFViewer.Utils.Transformation,l=!1,m=0;m<d.length;m++){var n=d[m];n&&n.IsVisible()&&(f!==n.part&&(f=n.part,h.Set(f.tx),l=!0),n.tx&&(h.Multiply(n.tx),l=!0,f=null),l&&(h.ToArray(this._uTWd),a.uniformMatrix4fv(c.uTWd,!1,this._uTWd),
l=!1),a.cullFace(a.FRONT),e=n.Render(a,c,n.bcolr,g,k,e),a.cullFace(a.BACK),e=n.Render(a,c,n.bcolr,g,k,e))}a.disable(a.CULL_FACE)}},_RenderEdges:{value:function(a,c,d,e,f){var g=this._gfx.edgeBuffers;if(null!==g){var k=this._gl,h=this._gfx.edgeBuffersNumElements;k.depthMask(!1);k.enable(k.BLEND);var l=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE;this._flatColor=!0;var m=0<e?this._flatPeelShader:l?this._flatClipShader:this._flatShader;if(m.StartProgram()){0<e&&(k.uniform2f(m.uSze,c,d),
k.uniform1i(m.uPass,e),1<e&&(k.activeTexture(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,f),k.uniform1i(m.DepthTex,0)));k.uniformMatrix4fv(m.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);k.uniformMatrix4fv(m.uTVP,!1,a);l&&k.uniform4fv(m.uCut,this._glClip);a=-1;c=null;d=0;e=new GLTFViewer.Utils.Transformation;f=!1;for(l=0;l<this._bodies.length;l++){var n=this._bodies[l];if(n&&n.IsVisible()){var p=n.data;0<p.edgeBufferNumIndices&&(c!==n.part&&(c=n.part,e.Set(c.tx),f=!0),n.tx&&(e.Multiply(n.tx),f=!0,c=null),f&&
(e.ToArray(this._uTWd),k.uniformMatrix4fv(m.uTWd,!1,this._uTWd),f=!1),a!=p.edgeBufferFirstIndex&&(a=p.edgeBufferFirstIndex,k.bindBuffer(k.ARRAY_BUFFER,g[a]),k.vertexAttribPointer(m.aPos,3,k.FLOAT,!1,12,0)),d!=n.ecolr&&(d=n.ecolr,GLTFViewer.Utils.FlatColor(d,this._glColor),k.uniform4fv(m.uClr,this._glColor)),a=p.RenderEdge(k,m,g,h,a,p.edgeBufferFirstIndex,p.edgeBufferFirstOffset,p.edgeBufferNumIndices))}}k.depthMask(!0);k.disable(k.BLEND)}}}},_RenderSelectionEdge:{value:function(a,c,d){var e=this._gl,
f=c.body,g=f.data,k=this._gfx.edgeBuffers,h=this._gfx.edgeBuffersNumElements;this._flatColor=!0;var l=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,m=l?this._flatClipShader:this._flatShader;if(m.StartProgram()){e.uniformMatrix4fv(m.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);e.uniformMatrix4fv(m.uTVP,!1,a);l&&e.uniform4fv(m.uCut,this._glClip);e.disable(e.DEPTH_TEST);e.depthMask(!1);e.enable(e.BLEND);d.a=100;d.ToArray(this._glColor,0);e.uniform4fv(m.uClr,this._glColor);a=f.part.tx.Clone();
f.tx&&a.Multiply(f.tx);a.ToArray(this._uTWd);e.uniformMatrix4fv(m.uTWd,!1,this._uTWd);c=c.itm;f=-1;for(a=0;2>a;a++)f=g.RenderEdge(e,m,k,h,f,c.edgeBufferIndex,c.edgeBufferOffset,c.edgeBufferNumIndices),d.a=200,d.ToArray(this._glColor,0),e.uniform4fv(m.uClr,this._glColor),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL);e.depthMask(!0);e.disable(e.BLEND);e.depthFunc(e.LESS)}}},_RenderSelectionFace:{value:function(a,c,d){var e=this._gl,f=c.body,g=f.data,k=this._gfx.faceBuffers,h=this._gfx.faceBuffersNumElements;
this._flatColor=!0;var l=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,m=l?this._flatClipShader:this._flatShader;if(m.StartProgram()){e.uniformMatrix4fv(m.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);e.uniformMatrix4fv(m.uTVP,!1,a);l&&e.uniform4fv(m.uCut,this._glClip);e.disable(e.DEPTH_TEST);e.depthMask(!1);e.enable(e.BLEND);d.a=64;d.ToArray(this._glColor,0);e.uniform4fv(m.uClr,this._glColor);a=f.part.tx.Clone();f.tx&&a.Multiply(f.tx);a.ToArray(this._uTWd);e.uniformMatrix4fv(m.uTWd,!1,this._uTWd);
c=c.itm;f=-1;for(a=0;2>a;a++)f=g.Render(e,m,k,h,f,c.faceBufferIndex,c.faceBufferOffset,c.faceBufferNumIndices),d.a=128,d.ToArray(this._glColor,0),e.uniform4fv(m.uClr,this._glColor),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL);e.depthMask(!0);e.disable(e.BLEND);e.depthFunc(e.LESS)}}},_RenderSelectionBody:{value:function(a,c,d){var e=this._gl,f=c.body;c=f.data;var g=this._gfx.faceBuffers,k=this._gfx.faceBuffersNumElements;this._flatColor=!0;var h=this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE,
l=h?this._flatClipShader:this._flatShader;if(l.StartProgram()){e.uniformMatrix4fv(l.uTWd,!1,GLTFViewer.Utils.glMtxIdentity);e.uniformMatrix4fv(l.uTVP,!1,a);h&&e.uniform4fv(l.uCut,this._glClip);e.disable(e.DEPTH_TEST);e.depthMask(!1);e.enable(e.BLEND);d.a=52;d.ToArray(this._glColor,0);e.uniform4fv(l.uClr,this._glColor);a=f.part.tx.Clone();f.tx&&a.Multiply(f.tx);a.ToArray(this._uTWd);e.uniformMatrix4fv(l.uTWd,!1,this._uTWd);a=-1;for(f=0;2>f;f++)a=c.Render(e,l,g,k,a,c.faceBufferFirstIndex,c.faceBufferFirstOffset,
c.faceBufferNumIndices),d.a=105,d.ToArray(this._glColor,0),e.uniform4fv(l.uClr,this._glColor),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL);e.depthMask(!0);e.disable(e.BLEND);e.depthFunc(e.LESS)}}},hit:{writable:!0,value:null},GetSceneBox:{value:function(a){return this._sceneBox}},GetClipPlane:{value:function(){var a=this.hit,c=new GLTFViewer.Utils.Vec3,d=new GLTFViewer.Utils.Vec3,e=new GLTFViewer.Utils.Vec3,f=new GLTFViewer.Utils.Vec3,g=new GLTFViewer.Utils.Vec3,k=a.targt.body.part,h=a.targt.itm,
l=a.indx,m=8*h.indices[l++];c.x=h.vertices[m++];c.y=h.vertices[m++];c.z=h.vertices[m++];m=8*h.indices[l++];d.x=h.vertices[m++];d.y=h.vertices[m++];d.z=h.vertices[m++];m=8*h.indices[l++];e.x=h.vertices[m++];e.y=h.vertices[m++];e.z=h.vertices[m++];f.Set(e.x-c.x,e.y-c.y,e.z-c.z);g.Set(d.x-c.x,d.y-c.y,d.z-c.z);f.Cross(g);g=f.TransformCreate(k.tx.GetRotationTransformation());return new GLTFViewer.Utils.Plane(a.pnt,g.GetDirection())}},RenderClipCap:{value:function(a,c,d,e,f){(this._bodiesOpaque.length||
this._bodiesTransparent.length)&&this._RenderBodiesClipCap(a,c,d,e,f)}},Render3D:{value:function(a,c,d,e,f,g,k){if(this._bodiesOpaque.length||this._bodiesTransparent.length)this._RenderBodies(a,c,d,e,f,g,k),this._RenderEdges(a,e,f,g,k)}},ResetHit:{value:function(){this.hit.Reset()}},AnyHit:{value:function(){return!this.hit.IsEmpty()}},HitPoint:{value:function(){return this.hit.pnt}},CanSelect:{value:function(){return!0}},AnySelection:{value:function(){return this._selection&&Object.keys(this._selection).length}},
UpdateSelection:{value:function(a,c){return!1}},ResetSelection:{value:function(){var a=this.AnySelection();this._selection=null;return a}},RenderSelection:{value:function(a,c,d){if(this.AnySelection()||this.AnyHit()){var e=this._gl;this._hasLineWidthSupport&&e.lineWidth(3);if(this.AnySelection()){var f=new GLTFViewer.Utils.RGBA(255,100,0,255);for(key in this._selection){var g=this._selection[key];g.itm instanceof GLTFViewer.Utils.FileSpaceClaim.FaceData?this._RenderSelectionFace(a,g,f):g.itm instanceof
GLTFViewer.Utils.FileSpaceClaim.EdgeData?this._RenderSelectionEdge(a,g,f):this._RenderSelectionBody(a,g,f)}}this._selectionMode!==GLTFViewer.SELECTION_NONE&&this.AnyHit()&&(f=new GLTFViewer.Utils.RGBA(255,216,0,255),this.hit.targt.itm instanceof GLTFViewer.Utils.FileSpaceClaim.FaceData?this._RenderSelectionFace(a,this.hit.targt,f):this.hit.targt.itm instanceof GLTFViewer.Utils.FileSpaceClaim.EdgeData?this._RenderSelectionEdge(a,this.hit.targt,f):this._RenderSelectionBody(a,this.hit.targt,f));this._hasLineWidthSupport&&
e.lineWidth(1);this.AnyHit()&&this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PREVIEW&&this.ClipDrawMode===GLTFViewer.Utils.Clip.DRAWMODE_1_PT&&(e=this.GetClipPlane(),this._clip.RenderPreview(a,c,d,this.hit,e))}}},Reset:{value:function(){this._bodyColor=0;this._visTree={};this._namedSelections=[];this._idToName={};this._pathToPart={};this._parts=[];this._bodies=[];this._bodiesOpaque=[];this._bodiesTransparent=[];this._bodiesData={};this.hit.Reset();this._gfx.Reset();GLTFViewer.Utils.FileBaseClass.prototype.Reset.call(this)}},
Clear:{value:function(){GLTFViewer.Utils.FileSpaceClaim.prototype.Reset.call(this);null!==this._hitTestIndexShader&&(this._hitTestIndexShader.DeleteProgram(),this._hitTestIndexShader=null);null!==this._hitTestIndexClipShader&&(this._hitTestIndexClipShader.DeleteProgram(),this._hitTestIndexClipShader=null);null!==this._hitTestPositionShader&&(this._hitTestPositionShader.DeleteProgram(),this._hitTestPositionShader=null);null!==this._hitTestPositionClipShader&&(this._hitTestPositionClipShader.DeleteProgram(),
this._hitTestPositionClipShader=null);null!==this._phongShader&&(this._phongShader.DeleteProgram(),this._phongShader=null);null!==this._phongPeelShader&&(this._phongPeelShader.DeleteProgram(),this._phongPeelShader=null);null!==this._phongClipShader&&(this._phongClipShader.DeleteProgram(),this._phongClipShader=null);null!==this._flatShader&&(this._flatShader.DeleteProgram(),this._flatShader=null);null!==this._flatPeelShader&&(this._flatPeelShader.DeleteProgram(),this._flatPeelShader=null);null!==this._flatClipShader&&
(this._flatClipShader.DeleteProgram(),this._flatClipShader=null);this._htp2=this._htp1=this._htp0=null;this.hit.Clear();this._sceneBox=this._glClip=this._uMtl=this._glColor=this._tmpVtxBuf=this._tmpVtxDat=this._clipPlaneBuf=this._uTWd=this._glCursorRay=this.hit=null;GLTFViewer.Utils.FileBaseClass.prototype.Clear.call(this)}},ReadFile:{value:function(a){this.Reset();this._fileType===GLTFViewer.FT_SCDOC&&this._Readscdoc(a)}},GetTopParts:{value:function(){return GLTFViewer.Utils.IsNull(this._visTree.root.part)?
this._visTree.root.children:{"0:0":this._visTree.root}}},GetPartName:{value:function(a){return a&&a.part?a.part.nme:null}},GetPartParent:{value:function(a){return a?a.parent:null}},GetPartParts:{value:function(a){return a?a.children:null}},GetPartBodys:{value:function(a){return a&&a.part?a.part.bodies:null}},GetBodyName:{value:function(a){return a?a.nme:null}},GetRegions:{value:function(){return this._namedSelections}},GetRegionName:{value:function(a){return a}},GetSelections:{value:function(){if(!this.AnySelection())return null;
var a=[];for(key in this._selection){var c=this._selection[key].Key();GLTFViewer.Utils.IsNull(c)||a.push(c)}return a}},HitIndexTip:{value:function(){var a=this.hit.targt;if(!a.IsEmpty()&&a.body){var c=a.body.GetName();a.itm&&(c=c+"~"+a.itm.id);return c}return null}},HitTestFindClosestPos:{value:function(a){return a?(this.hit.pnt.Set(a[1],a[2],a[3]),this.HitPoint()):null}},KeyToIds:{value:function(a){a=a.split(";");if(3!==a.length)return null;for(var c=a[0].split(","),d=c.length,e=this._pathToPart.ROOT,
f=0;f<d;++f)if(0===f&&""!==c[f]||f)e+=","+this._pathToPart[c[f]];return e+=","+a[1]+","+a[2]}},HitTest:{value:function(a,c,d,e,f){function g(a,c,d,e,f,g,h,k,n){0<a.x?(l=e*a.x,m=h*a.x):(m=e*a.x,l=h*a.x);0<a.y?(l+=f*a.y,m+=k*a.y):(m+=f*a.y,l+=k*a.y);0<a.z?(l+=g*a.z,m+=n*a.z):(m+=g*a.z,l+=n*a.z);return l>c+d||m<c-d?!0:!1}function k(a){return 0<=(new GLTFViewer.Utils.Vec3(a.x-n.x,a.y-n.y,a.z-n.z)).Dot(p)}function h(a,c){K.Set(a.x-L.x,a.y-L.y,a.z-L.z);I=K.x*U.x+K.y*U.y+K.z*U.z;B.Set(L.x+I*U.x,L.y+I*U.y,
L.z+I*U.z);R=B.x-a.x;S=B.y-a.y;T=B.z-a.z;I=R*R+S*S+T*T;I<r&&(R=a.x-L.x,S=a.y-L.y,T=a.z-L.z,I=R*R+S*S+T*T,I<E&&(!q||k(a))&&(E=I,t=M,y=P,z=c-2,N.Set(a.x,a.y,a.z)))}d=this._navigator;a=e;var l,m;c=null;var n,p,q=!1;this.ClipViewState===GLTFViewer.Utils.Clip.VIEWSTATE_PLANE&&(q=!0,n=this._clip.clipO,p=this._clip.clipD);f=new GLTFViewer.Utils.Vec3;d.UnProject(f);var u=new GLTFViewer.Utils.Vec3(3,0,0);d.UnProject(u);var r=GLTFViewer.Utils.Vec3.Create(f,u).GetMagnitudeSquared(),u=Math.sqrt(r),w=null,t=null,
x=null,y=null,z=f=0,G=GLTFViewer.Utils.maxValue,E=GLTFViewer.Utils.maxValue,A=new GLTFViewer.Utils.Vec3,D=new GLTFViewer.Utils.Vec3,H=new GLTFViewer.Utils.Vec3,B=new GLTFViewer.Utils.Vec3;d=new GLTFViewer.Utils.Vec3;for(var N=new GLTFViewer.Utils.Vec3,K=new GLTFViewer.Utils.Vec3,F=new GLTFViewer.Utils.Vec3,Y=new GLTFViewer.Utils.Vec3,C,O,aa,I,R,S,T,da=null,ea=null,fa=null,ga=this._bodies.length-1;0<=ga;ga--){var M=this._bodies[ga];if(M&&M.IsVisible()){var Q=M.data;c!==M.part?(da=null,c=M.part,a=e.TransformCreate(c.ti),
q&&(fa=ea=null,n=this._clip.clipO.TransformCreate(c.ti),p=this._clip.clipD.TransformCreate(c.ti))):da&&(a=da,n=ea,p=fa);M.tx&&(da=a,a=a.TransformCreate(M.ti),q&&(ea=n,fa=p,n=n.TransformCreate(M.ti),p=p.TransformCreate(M.ti)));if(!g(a.dix,a.rx,u,Q.mix,Q.miy,Q.miz,Q.max,Q.may,Q.maz)&&!g(a.diy,a.ry,u,Q.mix,Q.miy,Q.miz,Q.max,Q.may,Q.maz)){var U=a.ray.dir,L=a.ray.orgn;if(this._clip.clipDrawMode!==GLTFViewer.Utils.Clip.DRAWMODE_1_PT&&this._selectionMode!==GLTFViewer.SELECTION_FACE)for(var ca in Q.edgeDatas){var P=
Q.edgeDatas[ca];if(!g(a.dix,a.rx,u,P.mix,P.miy,P.miz,P.max,P.may,P.maz)&&!g(a.diy,a.ry,u,P.mix,P.miy,P.miz,P.max,P.may,P.maz)){var J=P.faceData;O=J.vertices;aa=J.edgeIndices;for(var W=J.edgeRanges,J=W[P.rangesIndex+1],W=W[P.rangesIndex+2],ba=0;ba<W;ba++){C=8*aa[J++];A.x=O[C++];A.y=O[C++];A.z=O[C++];C=8*aa[J++];D.x=O[C++];D.y=O[C++];D.z=O[C++];h(A,J);h(D,J);K.Set(A.x-L.x,A.y-L.y,A.z-L.z);F.Set(D.x-A.x,D.y-A.y,D.z-A.z);var X=F.x*F.x+F.y*F.y+F.z*F.z;C=U.x*F.x+U.y*F.y+U.z*F.z;var V=K.x*F.x+K.y*F.y+K.z*
F.z;I=X-C*C;if(0!=I){var X=K.x*U.x+K.y*U.y+K.z*U.z,V=(X*C-V)/I,Z=X+C*V;0<=V&&1>=V&&(B.Set(A.x+V*F.x,A.y+V*F.y,A.z+V*F.z),X=L.x+Z*U.x-B.x,C=L.y+Z*U.y-B.y,V=L.z+Z*U.z-B.z,I=X*X+C*C+V*V,I<=r&&(R=B.x-L.x,S=B.y-L.y,T=B.z-L.z,I=R*R+S*S+T*T,I<E&&(!q||k(B))&&(E=I,t=M,y=P,z=J-2,N.Set(B.x,B.y,B.z))))}}}}if(this._selectionMode!==GLTFViewer.SELECTION_EDGE)for(var ha in Q.faceDatas)if(J=Q.faceDatas[ha],!g(a.dix,a.rx,u,J.mix,J.miy,J.miz,J.max,J.may,J.maz)&&!g(a.diy,a.ry,u,J.mix,J.miy,J.miz,J.max,J.may,J.maz))for(aa=
J.indices,O=J.vertices,W=0;W<aa.length;)C=8*aa[W++],A.x=O[C++],A.y=O[C++],A.z=O[C++],C=8*aa[W++],D.x=O[C++],D.y=O[C++],D.z=O[C++],C=8*aa[W++],H.x=O[C++],H.y=O[C++],H.z=O[C++],K.Set(H.x-A.x,H.y-A.y,H.z-A.z),F.Set(D.x-A.x,D.y-A.y,D.z-A.z),Y.Set(K.x,K.y,K.z),Y.Cross(F).Normalize(),(new GLTFViewer.Utils.Plane(A,new GLTFViewer.Utils.Direction(Y))).GetPoint(a.ray,B)&&(Y.Set(B.x-A.x,B.y-A.y,B.z-A.z),ba=K.Dot(K),C=K.Dot(F),X=K.Dot(Y),Z=F.Dot(F),V=F.Dot(Y),I=ba*Z-C*C,0!=I&&(Z=Z*X-C*V,ba=ba*V-C*X,0<=Z&&0<=
ba&&Z+ba<I&&(R=B.x-L.x,S=B.y-L.y,T=B.z-L.z,I=R*R+S*S+T*T,I<G&&(!q||k(B))&&(G=I,w=M,x=J,f=W-3,d.Set(B.x,B.y,B.z)))))}}}return null!==y||null!==x?(null===y?(M=w,e=x,ca=f,B=d):null===x||E<=G?(M=t,e=y,ca=z,B=N):(R=d.x-N.x,S=d.y-N.y,T=d.z-N.z,I=R*R+S*S+T*T,I<r?(M=t,e=y,ca=z,B=N):(M=w,e=x,ca=f,B=d)),B.Transform(M.part.tx),M.tx&&B.Transform(M.tx),this.hit.Set(M,this._selectionMode===GLTFViewer.SELECTION_NONE||this._selectionMode===GLTFViewer.SELECTION_BODY?null:e,ca,B.x,B.y,B.z)):this.hit.Reset()}}});
Object.defineProperties(GLTFViewer.Utils.FileSpaceClaim,{_vsHitTest:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nattribute vec2 aFid;\nvarying vec3 vPos;\nvarying vec2 vFid;\nvoid main() {\nvec4 pos = uTVP * uTWd * vec4(aPos, 1.0);\nvPos = pos.xyz / pos.w;\nvFid = aFid;\ngl_Position = pos;\n}"},_fsHitTest:{value:"uniform vec4 uCry[2];\nuniform vec2 uSze;\nvarying vec3 vPos;\nvarying vec2 vFid;\nvoid main() {\nvec2 xy = floor((1.0 + vec2(vPos.x, -vPos.y)) * uSze + .5);\nfloat w = length(vec2(uCry[0].w, uCry[1].w) - xy);\nif (w >= 3.0) discard;\ngl_FragColor = vec4(-(w + 1.0), vFid, 0.0);\n}"},
_vsHitTestClip:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nattribute vec2 aFid;\nvarying vec3 vPos;\nvarying vec4 vPos2;\nvarying vec2 vFid;\nvoid main() {\nvPos2 = uTWd * vec4(aPos, 1.0);\nvec4 pos = uTVP * vPos2;\nvPos = pos.xyz / pos.w;\nvFid = aFid;\ngl_Position = pos;\n}"},_fsHitTestClip:{value:"uniform vec4 uCry[2];\nuniform vec2 uSze;\nuniform vec4 uCut;\nvarying vec3 vPos;\nvarying vec2 vFid;\nvarying vec4 vPos2;\nvoid main() {\nif(dot(vPos2, uCut) < 0.0) discard;\nvec2 xy = floor((1.0 + vec2(vPos.x, -vPos.y)) * uSze + .5);\nfloat w = length(vec2(uCry[0].w, uCry[1].w) - xy);\nif (w >= 3.0) discard;\ngl_FragColor = vec4(-(w + 1.0), vFid, 0.0);\n}"},
_vsHitTestPos:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvarying vec3 vPos;\nvoid main() {\nvec4 pos = uTWd * vec4(aPos, 1.0);\nvPos = pos.xyz;\ngl_Position = uTVP * pos;\n}"},_fsHitTestPos:{value:"uniform vec4 uCry[2];\nvarying vec3 vPos;\nvoid main() {\nfloat d = length(cross(uCry[1].xyz, vPos - uCry[0].xyz));\ngl_FragColor = vec4(-(d + 1.0), vPos);\n}"},_vsHitTestPosClip:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvarying vec3 vPos;\nvarying vec4 vPos2;\nvarying vec2 vFid;\nvoid main() {\nvPos2 = uTWd * vec4(aPos, 1.0);\nvPos = vPos2.xyz;\ngl_Position = uTVP * vPos2;\n}"},
_fsHitTestPosClip:{value:"uniform vec4 uCry[2];\nuniform vec4 uCut;\nvarying vec3 vPos;\nvarying vec4 vPos2;\nvoid main() {\nif(dot(vPos2, uCut) < 0.0) discard;\nfloat d = length(cross(uCry[1].xyz, vPos - uCry[0].xyz));\ngl_FragColor = vec4(-(d + 1.0), vPos);\n}"},_vsPhong:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nuniform vec3 uEye;\nattribute vec3 aPos;\nattribute vec3 aNor;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvarying vec4 vPos;\nvoid main() {\nvec4 pos = uTWd * vec4(aPos, 1.0);\nvNor = (uTWd * vec4(aNor, 0.0)).xyz;\nvDir = normalize(pos.xyz - uEye);\ngl_Position = uTVP * pos;\n}"},
_fsPhong:{value:"uniform mat4 uLit[2];\nuniform mat4 uMtl;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvoid main() {\nvec3 rgb = vec3(0);\nvec3 nor = normalize(vNor);\nnor *= -sign(dot(vDir, nor));\nvec3 r = reflect(uLit[0][3].xyz, nor);\nfloat s = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nfloat d = max(dot(uLit[0][3].xyz, nor), 0.0);\nvec3 sp = s * uMtl[2].rgb * uLit[0][2].rgb;\nvec3 di = d * uMtl[1].rgb * uLit[0][1].rgb;\nvec3 am = uMtl[0].rgb * uLit[0][0].rgb;\nrgb = am + di + sp;\nr = reflect(uLit[1][3].xyz, nor);\ns = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nd = max(dot(uLit[1][3].xyz, nor), 0.0);\nsp = s * uMtl[2].rgb * uLit[1][2].rgb;\ndi = d * uMtl[1].rgb * uLit[1][1].rgb;\nam = uMtl[0].rgb * uLit[1][0].rgb;\nrgb = rgb + am + di + sp;\ngl_FragColor = vec4(rgb, uMtl[1].a);\n}"},
_fsPhongPeel:{value:"uniform mat4 uLit[2];\nuniform mat4 uMtl;\nvarying vec3 vNor;\nvarying vec3 vDir;\nuniform vec2 uSze;\nuniform int uPass;\nconst float fAcc = 0.00001;\nuniform sampler2D DepthTex;\nvoid main() {\nvec3 rgb = vec3(0);\nvec3 nor = normalize(vNor);\nnor *= -sign(dot(vDir, nor));\nvec3 r = reflect(uLit[0][3].xyz, nor);\nfloat s = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nfloat d = max(dot(uLit[0][3].xyz, nor), 0.0);\nvec3 sp = s * uMtl[2].rgb * uLit[0][2].rgb;\nvec3 di = d * uMtl[1].rgb * uLit[0][1].rgb;\nvec3 am = uMtl[0].rgb * uLit[0][0].rgb;\nrgb = am + di + sp;\nr = reflect(uLit[1][3].xyz, nor);\ns = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nd = max(dot(uLit[1][3].xyz, nor), 0.0);\nsp = s * uMtl[2].rgb * uLit[1][2].rgb;\ndi = d * uMtl[1].rgb * uLit[1][1].rgb;\nam = uMtl[0].rgb * uLit[1][0].rgb;\nrgb = rgb + am + di + sp;\ngl_FragColor = vec4(rgb, uMtl[1].a);\n\nif (uPass == 1) {\ngl_FragColor.r = gl_FragCoord.z;\n} else if (uPass == 2) {\nfloat d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\nif (d == 0.0 || abs(d - gl_FragCoord.z) > fAcc) discard;\n} else if (uPass == 3) {\nfloat d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\nif (d == 0.0 || d - gl_FragCoord.z >= -fAcc) discard;\ngl_FragColor.r = gl_FragCoord.z;\n}\n}"},
_vsPhongClip:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nuniform vec3 uEye;\nattribute vec3 aPos;\nattribute vec3 aNor;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvarying vec4 vPos;\nvoid main() {\nvPos = uTWd * vec4(aPos, 1.0);\nvNor = (uTWd * vec4(aNor, 0.0)).xyz;\nvDir = normalize(vPos.xyz - uEye);\ngl_Position = uTVP * vPos;\n}"},_fsPhongClip:{value:"uniform mat4 uLit[2];\nuniform mat4 uMtl;\nuniform vec4 uCut;\nvarying vec3 vNor;\nvarying vec3 vDir;\nvarying vec4 vPos;\nvoid main() {\nif(dot(vPos, uCut) < 0.0) discard;\nvec3 rgb = vec3(0);\nvec3 nor = normalize(vNor);\nnor *= -sign(dot(vDir, nor));\nvec3 r = reflect(uLit[0][3].xyz, nor);\nfloat s = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nfloat d = max(dot(uLit[0][3].xyz, nor), 0.0);\nvec3 sp = s * uMtl[2].rgb * uLit[0][2].rgb;\nvec3 di = d * uMtl[1].rgb * uLit[0][1].rgb;\nvec3 am = uMtl[0].rgb * uLit[0][0].rgb;\nrgb = am + di + sp;\nr = reflect(uLit[1][3].xyz, nor);\ns = pow(max(dot(r, vDir), 0.0), uMtl[3].x);\nd = max(dot(uLit[1][3].xyz, nor), 0.0);\nsp = s * uMtl[2].rgb * uLit[1][2].rgb;\ndi = d * uMtl[1].rgb * uLit[1][1].rgb;\nam = uMtl[0].rgb * uLit[1][0].rgb;\nrgb = rgb + am + di + sp;\ngl_FragColor = vec4(rgb, uMtl[1].a);\n}"},
_vsFlat:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvoid main() {\ngl_Position = uTVP * uTWd * vec4(aPos, 1.0);\n}"},_fsFlat:{value:"uniform vec4 uClr;\nvoid main() {\ngl_FragColor = uClr;\n}"},_fsFlatPeel:{value:"uniform vec4 uClr;\nuniform vec2 uSze;\nuniform int uPass;\nconst float fAcc = 0.00001;\nuniform sampler2D DepthTex;\nvoid main() {\ngl_FragColor = uClr;\n\nif (uPass == 1) {\ngl_FragColor.r = gl_FragCoord.z;\n} else if (uPass == 2) {\nfloat d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\nif (d == 0.0 || abs(d - gl_FragCoord.z) > fAcc) discard;\n} else if (uPass == 3) {\nfloat d = texture2D(DepthTex, gl_FragCoord.xy / uSze).r;\nif (d == 0.0 || d - gl_FragCoord.z >= -fAcc) discard;\ngl_FragColor.r = gl_FragCoord.z;\n}\n}"},
_vsFlatClip:{value:"uniform mat4 uTWd;\nuniform mat4 uTVP;\nattribute vec3 aPos;\nvarying vec4 vPos;\nvoid main() {\nvPos = uTWd * vec4(aPos, 1.0);\ngl_Position = uTVP * vPos;\n}"},_fsFlatClip:{value:"uniform vec4 uClr;\nuniform vec4 uCut;\nvarying vec4 vPos;\nvoid main() {\nif(dot(vPos, uCut) < 0.0) discard;\ngl_FragColor = uClr;\n}"}});GLTFViewer.Utils.FileSpaceClaim.Graphics=function(a){this._gl=a};
GLTFViewer.Utils.FileSpaceClaim.Graphics.prototype=Object.create(null,{_gl:{writable:!0,value:null},boxBuffers:{writable:!0,value:null},faceBuffers:{writable:!0,value:null},faceBuffersNumElements:{writable:!0,value:null},edgeBuffers:{writable:!0,value:null},edgeBuffersNumElements:{writable:!0,value:null},Reset:{value:function(){function a(a,d){for(var e=d.length-1;0<=e;--e)a.deleteBuffer(d[e])}this.boxBuffers&&(a(this._gl,this.boxBuffers),this.boxBuffers=null);this.faceBuffers&&(a(this._gl,this.faceBuffers),
this.faceBuffers=null);this.faceBuffersNumElements=null;this.edgeBuffers&&(a(this._gl,this.edgeBuffers),this.edgeBuffers=null);this.edgeBuffersNumElements=null}},Clear:{value:function(){GLTFViewer.Utils.FileSpaceClaim.Graphics.prototype.Reset.call(this);this._gl=null}}});GLTFViewer.Utils.FileSpaceClaim.FaceData=function(a,c,d,e,f,g,k,h,l,m,n){this.id=a;this.mix=c;this.miy=d;this.miz=e;this.max=f;this.may=g;this.maz=k;this.vertices=h;this.indices=l;this.edgeIndices=m;this.edgeRanges=n};
GLTFViewer.Utils.FileSpaceClaim.FaceData.prototype=Object.create(null,{id:{writable:!0,value:null},mix:{writable:!0,value:0},miy:{writable:!0,value:0},miz:{writable:!0,value:0},max:{writable:!0,value:0},may:{writable:!0,value:0},maz:{writable:!0,value:0},faceBufferIndex:{writable:!0,value:0},faceBufferOffset:{writable:!0,value:0},faceBufferNumIndices:{writable:!0,value:0},vertices:{writable:!0,value:null},faceIndices:{writable:!0,value:null},edgeIndices:{writable:!0,value:null},edgeRanges:{writable:!0,
value:null}});GLTFViewer.Utils.FileSpaceClaim.EdgeData=function(a,c,d){this.id=a;this.faceData=c;this.rangesIndex=d};
GLTFViewer.Utils.FileSpaceClaim.EdgeData.prototype=Object.create(null,{id:{writable:!0,value:null},faceData:{writable:!0,value:null},rangesIndex:{writable:!0,value:0},mix:{writable:!0,value:0},miy:{writable:!0,value:0},miz:{writable:!0,value:0},max:{writable:!0,value:0},may:{writable:!0,value:0},maz:{writable:!0,value:0},edgeBufferIndex:{writable:!0,value:0},edgeBufferOffset:{writable:!0,value:0},edgeBufferNumIndices:{writable:!0,value:0}});
GLTFViewer.Utils.FileSpaceClaim.BodyData=function(a,c){this._handler=a;this.id=c};
GLTFViewer.Utils.FileSpaceClaim.BodyData.prototype=Object.create(null,{_handler:{writable:!0,value:null},id:{writable:!0,value:null},mix:{writable:!0,value:0},miy:{writable:!0,value:0},miz:{writable:!0,value:0},max:{writable:!0,value:0},may:{writable:!0,value:0},maz:{writable:!0,value:0},boxIndex:{writable:!0,value:0},boxOffset:{writable:!0,value:0},faceBufferFirstIndex:{writable:!0,value:0},faceBufferFirstOffset:{writable:!0,value:0},faceBufferNumIndices:{writable:!0,value:0},edgeBufferFirstIndex:{writable:!0,
value:0},edgeBufferFirstOffset:{writable:!0,value:0},edgeBufferNumIndices:{writable:!0,value:0},faceDatas:{writable:!0,value:null},edgeDatas:{writable:!0,value:null},Render:{value:function(a,c,d,e,f,g,k,h){f!==g&&(f=g,a.bindBuffer(a.ARRAY_BUFFER,d[f]),a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,32,0),void 0!==c.aNor&&a.vertexAttribPointer(c.aNor,3,a.FLOAT,!1,32,12),void 0!==c.aFid&&a.vertexAttribPointer(c.aFid,2,a.FLOAT,!1,32,24));for(g=h;;)if(h=e[f]-k,h>=g){a.drawArrays(a.TRIANGLES,k,g);break}else a.drawArrays(a.TRIANGLES,
k,h),k=0,g-=h,a.bindBuffer(a.ARRAY_BUFFER,d[++f]),a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,32,0),void 0!==c.aNor&&a.vertexAttribPointer(c.aNor,3,a.FLOAT,!1,32,12),void 0!==c.aFid&&a.vertexAttribPointer(c.aFid,2,a.FLOAT,!1,32,24);return f}},RenderBox:{value:function(a,c,d,e){a.bindBuffer(a.ARRAY_BUFFER,d);a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,12,0);a.drawArrays(a.TRIANGLES,e,36)}},RenderEdge:{value:function(a,c,d,e,f,g,k,h){f!==g&&(f=g,a.bindBuffer(a.ARRAY_BUFFER,d[f]),a.vertexAttribPointer(c.aPos,
3,a.FLOAT,!1,12,0));for(g=h;;)if(h=e[f]-k,h>=g){a.drawArrays(a.LINES,k,g);break}else a.drawArrays(a.LINES,k,h),k=0,g-=h,a.bindBuffer(a.ARRAY_BUFFER,d[++f]),a.vertexAttribPointer(c.aPos,3,a.FLOAT,!1,12,0);return f}}});GLTFViewer.Utils.FileSpaceClaim.Body=function(a,c,d,e,f,g,k,h,l,m,n,p){this._handler=a;this.id=c;this.nme=d;this.part=e;this.data=f;this.visibl=g;this.bcolr=k;this.ecolr=h;this.xcolr=l;this.fil=m;this.typ=n;p&&(this.tx=p,this.ti=p.Clone().Invert())};
GLTFViewer.Utils.FileSpaceClaim.Body.prototype=Object.create(null,{_handler:{writable:!0,value:null},id:{writable:!0,value:null},nme:{writable:!0,value:null},part:{writable:!0,value:null},data:{writable:!0,value:null},visibl:{writable:!0,value:0},bcolr:{writable:!0,value:0},ecolr:{writable:!0,value:0},xcolr:{writable:!0,value:0},colrs:{writable:!0,value:0},fil:{writable:!0,value:0},typ:{writable:!0,value:0},tx:{writable:!0,value:null},ti:{writable:!0,value:null},IsVisible:{value:function(){return this.visibl}},
GetName:{value:function(){return(this.part?this.part.GetName()+":":"")+this.nme}},Key:{value:function(){return this.part.path+";"+this.id}},Render:{value:function(a,c,d,e,f,g){if(!this.IsVisible())return-1;var k=this._handler;if(k._bodyColor!==d)if(k._bodyColor=d,this._handler._flatColor)k=new Float32Array(4),GLTFViewer.Utils.FlatColor(d,k),a.uniform4fv(c.uClr,k);else{var h=new GLTFViewer.Utils.RGBA;h.SetRawARGB(d);(new GLTFViewer.Utils.Material(h)).ToArray(k._uMtl,0);a.uniformMatrix4fv(c.uMtl,!1,
k._uMtl)}return this.data.Render(a,c,e,f,g,this.data.faceBufferFirstIndex,this.data.faceBufferFirstOffset,this.data.faceBufferNumIndices)}},RenderBox:{value:function(a,c,d){this.IsVisible()&&this.data.RenderBox(a,c,d[this.data.boxIndex],this.data.boxOffset)}}});Object.defineProperties(GLTFViewer.Utils.FileSpaceClaim.Body,{Solid:{value:0},OpenForm:{value:1}});GLTFViewer.Utils.FileSpaceClaim.Part=function(a,c,d,e){this.id=a;this.path=d;this.nme=c;this.bodies=[];this.tx=e;this.ti=e.Clone().Invert()};
GLTFViewer.Utils.FileSpaceClaim.Part.prototype=Object.create(null,{id:{writable:!0,value:null},path:{writable:!0,value:null},nme:{writable:!0,value:null},parentPart:{writable:!0,value:null},tx:{writable:!0,value:null},ti:{writable:!0,value:null},bodies:{writable:!0,value:null},GetName:{value:function(){return(this.parentPart?this.parentPart.GetName()+":":"")+this.nme}}});GLTFViewer.Utils.FileSpaceClaim.BinReader=function(a,c,d){this.dataView=new DataView(a,c,d);this.pos=0};
GLTFViewer.Utils.FileSpaceClaim.BinReader.prototype=Object.create(null,{dataView:{writable:!0,value:null},pos:{writable:!0,value:0},readInt8:{value:function(){var a=this.dataView.getInt8(this.pos,!0);this.pos+=1;return a}},readUInt8:{value:function(){var a=this.dataView.getUint8(this.pos,!0);this.pos+=1;return a}},readInt16:{value:function(){var a=this.dataView.getInt16(this.pos,!0);this.pos+=2;return a}},readUInt16:{value:function(){var a=this.dataView.getUint16(this.pos,!0);this.pos+=2;return a}},
readInt32:{value:function(){var a=this.dataView.getInt32(this.pos,!0);this.pos+=4;return a}},readUInt32:{value:function(){var a=this.dataView.getUint32(this.pos,!0);this.pos+=4;return a}},readFloat:{value:function(){var a=this.dataView.getFloat32(this.pos,!0);this.pos+=4;return a}},readDouble:{value:function(){var a=this.dataView.getFloat64(this.pos,!0);this.pos+=8;return a}},getSize:{value:function(){return this.dataView.byteLength-this.dataView.byteOffset}}});
GLTFViewer.Utils.FileSpaceClaim.HitTarget=function(a){a&&(this.body=a.body||null,this.itm=a.itm||null)};
GLTFViewer.Utils.FileSpaceClaim.HitTarget.prototype=Object.create(null,{body:{writable:!0,value:null},itm:{writable:!0,value:null},Set:{value:function(a,c){this.body=a||null;this.itm=c||null}},IsEmpty:{value:function(){return null===this.itm&&null===this.body}},Key:{value:function(){var a="";this.IsEmpty()||(a=this.body.Key()+";",this.itm instanceof GLTFViewer.Utils.FileSpaceClaim.FaceData?a+="F:"+this.itm.id:this.itm instanceof GLTFViewer.Utils.FileSpaceClaim.EdgeData&&(a+="E:"+this.itm.id));return a}}});
GLTFViewer.Utils.FileSpaceClaim.Hit=function(){this.targt=new GLTFViewer.Utils.FileSpaceClaim.HitTarget;this.pnt=new GLTFViewer.Utils.Vec3;this.dist=-1};
GLTFViewer.Utils.FileSpaceClaim.Hit.prototype=Object.create(null,{targt:{writable:!0,value:null},indx:{writable:!0,value:0},pnt:{writable:!0,value:0},dist:{writable:!0,value:0},Reset:{value:function(){var a=null!==this.targt.body||null!==this.targt.itm;this.targt.Set();return a}},Clear:{value:function(){GLTFViewer.Utils.FileSpaceClaim.Hit.prototype.Reset.call(this);this.pnt=null}},Set:{value:function(a,c,d,e,f,g){var k=a!==this.targt.body||c!==this.targt.itm||d!==this.indx||e!==this.pnt.x||f!==this.pnt.y||
g!==this.pnt.z;this.targt.Set(a,c);this.indx=d;this.pnt.Set(e,f,g);return k}},IsEmpty:{value:function(){return null===this.targt.body}}});GLTFViewer_About={base_version:"19.1",full_version:"19.1",servicePack_version:"",build_number:"11",build_date:"2018-03-26 07:12",extern_release_id:"Release 19.1"};
